{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.8.3", "generated_at": "2024-08-23T19:21:43.600343Z", "invocation_id": "7827f8dc-5893-4de5-b75d-841c3e3a0d2d", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:31.948991Z", "completed_at": "2024-08-23T19:21:31.967280Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:31.967799Z", "completed_at": "2024-08-23T19:21:31.967809Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.03712797164916992, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.input_layer.encounter", "compiled": true, "compiled_code": "select \n      cast(null as TEXT ) as encounter_id\n    , cast(null as TEXT ) as patient_id\n    , cast(null as TEXT ) as encounter_type\n    , cast(null as date) as encounter_start_date\n    , cast(null as date) as encounter_end_date\n    , cast(null as integer ) as length_of_stay\n    , cast(null as TEXT ) as admit_source_code\n    , cast(null as TEXT ) as admit_source_description\n    , cast(null as TEXT ) as admit_type_code\n    , cast(null as TEXT ) as admit_type_description\n    , cast(null as TEXT ) as discharge_disposition_code\n    , cast(null as TEXT ) as discharge_disposition_description\n    , cast(null as TEXT ) as attending_provider_id\n    , cast(null as TEXT ) as attending_provider_name\n    , cast(null as TEXT ) as facility_id\n    , cast(null as TEXT ) as facility_name\n    , cast(null as TEXT ) as primary_diagnosis_code_type\n    , cast(null as TEXT ) as primary_diagnosis_code\n    , cast(null as TEXT ) as primary_diagnosis_description\n    , cast(null as TEXT ) as ms_drg_code\n    , cast(null as TEXT ) as ms_drg_description\n    , cast(null as TEXT ) as apr_drg_code\n    , cast(null as TEXT ) as apr_drg_description\n    , cast(null as numeric(28,6) ) as paid_amount\n    , cast(null as numeric(28,6) ) as allowed_amount\n    , cast(null as numeric(28,6) ) as charge_amount\n    , cast(null as TEXT ) as data_source\n    , cast(null as TEXT ) as file_name\n    , cast(null as timestamp ) as ingest_datetime\nlimit 0", "relation_name": "tuva.input_layer.encounter"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:31.933515Z", "completed_at": "2024-08-23T19:21:31.967523Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:31.968409Z", "completed_at": "2024-08-23T19:21:31.968414Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.038387298583984375, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.input_layer.condition", "compiled": true, "compiled_code": "select\n      cast(null as TEXT ) as condition_id\n    , cast(null as TEXT ) as patient_id\n    , cast(null as TEXT ) as encounter_id\n    , cast(null as TEXT ) as claim_id\n    , cast(null as date) as recorded_date\n    , cast(null as date) as onset_date\n    , cast(null as date) as resolved_date\n    , cast(null as TEXT ) as status\n    , cast(null as TEXT ) as condition_type\n    , cast(null as TEXT ) as source_code_type\n    , cast(null as TEXT ) as source_code\n    , cast(null as TEXT ) as source_description\n    , cast(null as TEXT ) as normalized_code_type\n    , cast(null as TEXT ) as normalized_code\n    , cast(null as TEXT ) as normalized_description\n    , cast(null as integer ) as condition_rank\n    , cast(null as TEXT ) as present_on_admit_code\n    , cast(null as TEXT ) as present_on_admit_description\n    , cast(null as TEXT ) as data_source\n    , cast(null as TEXT ) as file_name\n    , cast(null as timestamp ) as ingest_datetime\nlimit 0", "relation_name": "tuva.input_layer.condition"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:31.962673Z", "completed_at": "2024-08-23T19:21:31.968229Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:31.969305Z", "completed_at": "2024-08-23T19:21:31.969309Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.037693023681640625, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.input_layer.location", "compiled": true, "compiled_code": "select\n      cast(null as TEXT ) as location_id\n    , cast(null as TEXT ) as npi\n    , cast(null as TEXT ) as name\n    , cast(null as TEXT ) as facility_type\n    , cast(null as TEXT ) as parent_organization\n    , cast(null as TEXT ) as address\n    , cast(null as TEXT ) as city\n    , cast(null as TEXT ) as state\n    , cast(null as TEXT ) as zip_code\n    , cast(null as float ) as latitude\n    , cast(null as float ) as longitude\n    , cast(null as TEXT ) as data_source\n    , cast(null as TEXT ) as file_name\n    , cast(null as timestamp ) as ingest_datetime\nlimit 0", "relation_name": "tuva.input_layer.location"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:31.956531Z", "completed_at": "2024-08-23T19:21:31.968799Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:31.970061Z", "completed_at": "2024-08-23T19:21:31.970064Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.03886985778808594, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.input_layer.lab_result", "compiled": true, "compiled_code": "select\n      cast(null as TEXT ) as lab_result_id\n    , cast(null as TEXT ) as patient_id\n    , cast(null as TEXT ) as encounter_id\n    , cast(null as TEXT ) as accession_number\n    , cast(null as TEXT ) as source_code_type\n    , cast(null as TEXT ) as source_code\n    , cast(null as TEXT ) as source_description\n    , cast(null as TEXT ) as source_component\n    , cast(null as TEXT ) as normalized_code_type\n    , cast(null as TEXT ) as normalized_code\n    , cast(null as TEXT ) as normalized_description\n    , cast(null as TEXT ) as normalized_component\n    , cast(null as TEXT ) as status\n    , cast(null as TEXT ) as result\n    , cast(null as date) as result_date\n    , cast(null as date) as collection_date\n    , cast(null as TEXT ) as source_units\n    , cast(null as TEXT ) as normalized_units\n    , cast(null as TEXT ) as source_reference_range_low\n    , cast(null as TEXT ) as source_reference_range_high\n    , cast(null as TEXT ) as normalized_reference_range_low\n    , cast(null as TEXT ) as normalized_reference_range_high\n    , cast(null as integer ) as source_abnormal_flag\n    , cast(null as integer ) as normalized_abnormal_flag\n    , cast(null as TEXT ) as specimen\n    , cast(null as TEXT ) as ordering_practitioner_id\n    , cast(null as TEXT ) as data_source\n    , cast(null as TEXT ) as file_name\n    , cast(null as timestamp ) as ingest_datetime\nlimit 0", "relation_name": "tuva.input_layer.lab_result"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:31.972531Z", "completed_at": "2024-08-23T19:21:31.986591Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:31.987083Z", "completed_at": "2024-08-23T19:21:31.987087Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.016636133193969727, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.input_layer.medication", "compiled": true, "compiled_code": "select \n      cast(null as TEXT ) as medication_id\n    , cast(null as TEXT ) as patient_id\n    , cast(null as TEXT ) as encounter_id\n    , cast(null as date) as dispensing_date\n    , cast(null as date) as prescribing_date\n    , cast(null as TEXT ) as source_code_type\n    , cast(null as TEXT ) as source_code\n    , cast(null as TEXT ) as source_description\n    , cast(null as TEXT ) as ndc_code\n    , cast(null as TEXT ) as ndc_description\n    , cast(null as TEXT ) as rxnorm_code\n    , cast(null as TEXT ) as rxnorm_description\n    , cast(null as TEXT ) as atc_code\n    , cast(null as TEXT ) as atc_description\n    , cast(null as TEXT ) as route\n    , cast(null as TEXT ) as strength\n    , cast(null as integer ) as quantity\n    , cast(null as TEXT ) as quantity_unit\n    , cast(null as integer ) as days_supply\n    , cast(null as TEXT ) as practitioner_id\n    , cast(null as TEXT ) as data_source\n    , cast(null as TEXT ) as file_name\n    , cast(null as timestamp ) as ingest_datetime\nlimit 0", "relation_name": "tuva.input_layer.medication"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:31.976664Z", "completed_at": "2024-08-23T19:21:31.986842Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:31.987549Z", "completed_at": "2024-08-23T19:21:31.987554Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.016632795333862305, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.input_layer.observation", "compiled": true, "compiled_code": "select\n      cast(null as TEXT ) as observation_id\n    , cast(null as TEXT ) as patient_id\n    , cast(null as TEXT ) as encounter_id\n    , cast(null as TEXT ) as panel_id\n    , cast(null as date) as observation_date\n    , cast(null as TEXT ) as observation_type\n    , cast(null as TEXT ) as source_code_type\n    , cast(null as TEXT ) as source_code\n    , cast(null as TEXT ) as source_description\n    , cast(null as TEXT ) as normalized_code_type\n    , cast(null as TEXT ) as normalized_code\n    , cast(null as TEXT ) as normalized_description\n    , cast(null as TEXT ) as result\n    , cast(null as TEXT ) as source_units\n    , cast(null as TEXT ) as normalized_units\n    , cast(null as TEXT ) as source_reference_range_low\n    , cast(null as TEXT ) as source_reference_range_high\n    , cast(null as TEXT ) as normalized_reference_range_low\n    , cast(null as TEXT ) as normalized_reference_range_high\n    , cast(null as TEXT ) as data_source\n    , cast(null as TEXT ) as file_name\n    , cast(null as timestamp ) as ingest_datetime\nlimit 0", "relation_name": "tuva.input_layer.observation"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:31.983720Z", "completed_at": "2024-08-23T19:21:31.987373Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:31.988364Z", "completed_at": "2024-08-23T19:21:31.988368Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.016119956970214844, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.input_layer.practitioner", "compiled": true, "compiled_code": "select\n      cast(null as TEXT ) as practitioner_id\n    , cast(null as TEXT ) as npi\n    , cast(null as TEXT ) as first_name\n    , cast(null as TEXT ) as last_name\n    , cast(null as TEXT ) as practice_affiliation\n    , cast(null as TEXT ) as specialty\n    , cast(null as TEXT ) as sub_specialty\n    , cast(null as TEXT ) as data_source\n    , cast(null as TEXT ) as file_name\n    , cast(null as timestamp ) as ingest_datetime\nlimit 0", "relation_name": "tuva.input_layer.practitioner"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:31.980569Z", "completed_at": "2024-08-23T19:21:31.987876Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:31.989042Z", "completed_at": "2024-08-23T19:21:31.989046Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.017195940017700195, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.input_layer.patient", "compiled": true, "compiled_code": "select\n      cast(null as TEXT ) as patient_id\n    , cast(null as TEXT ) as first_name\n    , cast(null as TEXT ) as last_name\n    , cast(null as TEXT ) as sex\n    , cast(null as TEXT ) as race\n    , cast(null as date) as birth_date\n    , cast(null as date) as death_date\n    , cast(null as integer ) as death_flag\n    , cast(null as TEXT ) as social_security_number\n    , cast(null as TEXT ) as address\n    , cast(null as TEXT ) as city\n    , cast(null as TEXT ) as state\n    , cast(null as TEXT ) as zip_code\n    , cast(null as TEXT ) as county\n    , cast(null as float ) as latitude\n    , cast(null as float ) as longitude\n    , cast(null as TEXT ) as data_source\n    , cast(null as TEXT ) as file_name\n    , cast(null as timestamp ) as ingest_datetime\nlimit 0", "relation_name": "tuva.input_layer.patient"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:31.990925Z", "completed_at": "2024-08-23T19:21:32.012584Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.013914Z", "completed_at": "2024-08-23T19:21:32.013918Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.02462005615234375, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.input_layer.procedure", "compiled": true, "compiled_code": "select\n      cast(null as TEXT ) as procedure_id\n    , cast(null as TEXT ) as patient_id\n    , cast(null as TEXT ) as encounter_id\n    , cast(null as TEXT ) as claim_id\n    , cast(null as date) as procedure_date\n    , cast(null as TEXT ) as source_code_type\n    , cast(null as TEXT ) as source_code\n    , cast(null as TEXT ) as source_description\n    , cast(null as TEXT ) as normalized_code_type\n    , cast(null as TEXT ) as normalized_code\n    , cast(null as TEXT ) as normalized_description\n    , cast(null as TEXT ) as modifier_1\n    , cast(null as TEXT ) as modifier_2\n    , cast(null as TEXT ) as modifier_3\n    , cast(null as TEXT ) as modifier_4\n    , cast(null as TEXT ) as modifier_5\n    , cast(null as TEXT ) as practitioner_id\n    , cast(null as TEXT ) as data_source\n    , cast(null as TEXT ) as file_name\n    , cast(null as timestamp ) as ingest_datetime\nlimit 0", "relation_name": "tuva.input_layer.procedure"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.012729Z", "completed_at": "2024-08-23T19:21:32.013385Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.014203Z", "completed_at": "2024-08-23T19:21:32.014207Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.02349710464477539, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.input_layer.eligibility_seed", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:31.994433Z", "completed_at": "2024-08-23T19:21:32.013738Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.014644Z", "completed_at": "2024-08-23T19:21:32.014647Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.024905920028686523, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_nqf0034__performance_period", "compiled": true, "compiled_code": "\n/*\n    set performance period end to the end of the current calendar year\n    or use the quality_measures_period_end variable if provided\n*/\nwith period_end as (\n\n    select\n        cast(\n        \n\n    dateadd(\n        day,\n        -1,\n        \n\n    dateadd(\n        year,\n        1,\n        date_trunc('year', convert_timezone('UTC', current_timestamp()))\n        )\n\n\n        )\n\n\n        as date)\n        \n         as performance_period_end\n)\n\n/*\n    set performance period begin to a year and a day prior\n    for a complete calendar year\n*/\n, period_begin as (\n\n    select\n          performance_period_end\n        , \n\n    dateadd(\n        day,\n        1,\n        \n\n    dateadd(\n        year,\n        -1,\n        performance_period_end\n        )\n\n\n        )\n\n as performance_period_begin\n    from period_end\n\n)\n\n/*\n    set performance lookback periods for each type of test\n\n    during the measurement period:\n    - Fecal occult blood test (FOBT) during the measurement period\n\n    during the measurement period or the two years prior:\n    - Fecal immunochemical DNA test (FIT-DNA)\n\n    during the measurement period or the four years prior:\n    - Flexible sigmoidoscopy\n    - Computed tomography (CT) colonography\n\n    during the measurement period or the nine years prior:\n    - Colonoscopy\n\n*/\n, period_lookback as (\n\n    select\n          performance_period_end\n        , performance_period_begin\n        , \n\n    dateadd(\n        year,\n        -2,\n        performance_period_end\n        )\n\n as performance_period_begin_1yp\n        , \n\n    dateadd(\n        year,\n        -3,\n        performance_period_end\n        )\n\n as performance_period_begin_2yp\n        , \n\n    dateadd(\n        year,\n        -5,\n        performance_period_end\n        )\n\n as performance_period_begin_4yp\n        , \n\n    dateadd(\n        year,\n        -10,\n        performance_period_end\n        )\n\n as performance_period_begin_9yp\n    from period_begin\n\n)\n\nselect\n      cast(performance_period_begin as date) as performance_period_begin\n    , cast(performance_period_end as date) as performance_period_end\n    , cast(performance_period_begin_1yp as date) as performance_period_begin_1yp\n    , cast(performance_period_begin_2yp as date) as performance_period_begin_2yp\n    , cast(performance_period_begin_4yp as date) as performance_period_begin_4yp\n    , cast(performance_period_begin_9yp as date) as performance_period_begin_9yp\nfrom period_lookback", "relation_name": "dev_tom.quality_measures._int_nqf0034__performance_period"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.017341Z", "completed_at": "2024-08-23T19:21:32.018027Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.020793Z", "completed_at": "2024-08-23T19:21:32.020797Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.004534006118774414, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.input_layer.lab_result_seed", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.018377Z", "completed_at": "2024-08-23T19:21:32.019022Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.021087Z", "completed_at": "2024-08-23T19:21:32.021091Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.004641056060791016, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.input_layer.medical_claim_seed", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.019366Z", "completed_at": "2024-08-23T19:21:32.020605Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.021361Z", "completed_at": "2024-08-23T19:21:32.021363Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0047228336334228516, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.input_layer.observation_seed", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.023497Z", "completed_at": "2024-08-23T19:21:32.024125Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.025934Z", "completed_at": "2024-08-23T19:21:32.025937Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.0037250518798828125, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.input_layer.pharmacy_claim_seed", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.024280Z", "completed_at": "2024-08-23T19:21:32.024921Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.026216Z", "completed_at": "2024-08-23T19:21:32.026220Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.0036118030548095703, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.ccsr__dxccsr_v2023_1_body_systems", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.025096Z", "completed_at": "2024-08-23T19:21:32.025746Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.026497Z", "completed_at": "2024-08-23T19:21:32.026500Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0037119388580322266, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.ccsr__dxccsr_v2023_1_cleaned_map", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.028504Z", "completed_at": "2024-08-23T19:21:32.029163Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.030874Z", "completed_at": "2024-08-23T19:21:32.030877Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.003496885299682617, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.ccsr__prccsr_v2023_1_cleaned_map", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.029332Z", "completed_at": "2024-08-23T19:21:32.029959Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.031119Z", "completed_at": "2024-08-23T19:21:32.031122Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.0034949779510498047, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.chronic_conditions__cms_chronic_conditions_hierarchy", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.030115Z", "completed_at": "2024-08-23T19:21:32.030717Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.031361Z", "completed_at": "2024-08-23T19:21:32.031364Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.003549814224243164, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.chronic_conditions__tuva_chronic_conditions_hierarchy", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.033120Z", "completed_at": "2024-08-23T19:21:32.033742Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.035473Z", "completed_at": "2024-08-23T19:21:32.035476Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.003306865692138672, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.clinical_concept_library__clinical_concepts", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.033896Z", "completed_at": "2024-08-23T19:21:32.034508Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.035731Z", "completed_at": "2024-08-23T19:21:32.035734Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.0033969879150390625, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.clinical_concept_library__coding_systems", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.034664Z", "completed_at": "2024-08-23T19:21:32.035279Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.035976Z", "completed_at": "2024-08-23T19:21:32.035979Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0034933090209960938, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.clinical_concept_library__value_set_members", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.037785Z", "completed_at": "2024-08-23T19:21:32.039242Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.040948Z", "completed_at": "2024-08-23T19:21:32.040951Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.004147052764892578, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.cms_hcc__adjustment_rates", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.039399Z", "completed_at": "2024-08-23T19:21:32.040019Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.041193Z", "completed_at": "2024-08-23T19:21:32.041196Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.004198789596557617, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.cms_hcc__cpt_hcpcs", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.040175Z", "completed_at": "2024-08-23T19:21:32.040780Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.041436Z", "completed_at": "2024-08-23T19:21:32.041439Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.004273891448974609, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.cms_hcc__demographic_factors", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.043142Z", "completed_at": "2024-08-23T19:21:32.043740Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.045407Z", "completed_at": "2024-08-23T19:21:32.045410Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.003197908401489258, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.cms_hcc__disabled_interaction_factors", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.043891Z", "completed_at": "2024-08-23T19:21:32.044484Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.045664Z", "completed_at": "2024-08-23T19:21:32.045667Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.003282308578491211, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.cms_hcc__disease_factors", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.044634Z", "completed_at": "2024-08-23T19:21:32.045249Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.045908Z", "completed_at": "2024-08-23T19:21:32.045911Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0033719539642333984, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.cms_hcc__disease_hierarchy", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.047673Z", "completed_at": "2024-08-23T19:21:32.048278Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.049952Z", "completed_at": "2024-08-23T19:21:32.049955Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.0032591819763183594, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.cms_hcc__disease_interaction_factors", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.048443Z", "completed_at": "2024-08-23T19:21:32.049044Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.050203Z", "completed_at": "2024-08-23T19:21:32.050206Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.0033397674560546875, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.cms_hcc__enrollment_interaction_factors", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.049197Z", "completed_at": "2024-08-23T19:21:32.049791Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.050444Z", "completed_at": "2024-08-23T19:21:32.050447Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0034151077270507812, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.cms_hcc__icd_10_cm_mappings", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.052163Z", "completed_at": "2024-08-23T19:21:32.052766Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.055292Z", "completed_at": "2024-08-23T19:21:32.055295Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.004072904586791992, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.cms_hcc__payment_hcc_count_factors", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.052914Z", "completed_at": "2024-08-23T19:21:32.054368Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.055542Z", "completed_at": "2024-08-23T19:21:32.055545Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.004155158996582031, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.data_quality__crosswalk_field_info", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.054532Z", "completed_at": "2024-08-23T19:21:32.055131Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.055792Z", "completed_at": "2024-08-23T19:21:32.055795Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0042459964752197266, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.data_quality__crosswalk_field_to_mart", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.057593Z", "completed_at": "2024-08-23T19:21:32.058214Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.059895Z", "completed_at": "2024-08-23T19:21:32.059898Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.0033092498779296875, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.data_quality__crosswalk_mart_to_outcome_measure", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.058381Z", "completed_at": "2024-08-23T19:21:32.058975Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.060151Z", "completed_at": "2024-08-23T19:21:32.060154Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.003390073776245117, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.data_quality__crosswalk_measure_reasonable_ranges", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.059136Z", "completed_at": "2024-08-23T19:21:32.059738Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.060399Z", "completed_at": "2024-08-23T19:21:32.060402Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0034749507904052734, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.ed_classification__categories", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.062176Z", "completed_at": "2024-08-23T19:21:32.062781Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.064430Z", "completed_at": "2024-08-23T19:21:32.064433Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.003226041793823242, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.ed_classification__icd_10_cm_to_ccs", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.062935Z", "completed_at": "2024-08-23T19:21:32.063541Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.064671Z", "completed_at": "2024-08-23T19:21:32.064674Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.003283977508544922, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.ed_classification__johnston_icd10", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.063699Z", "completed_at": "2024-08-23T19:21:32.064279Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.064948Z", "completed_at": "2024-08-23T19:21:32.064950Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.00339508056640625, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.ed_classification__johnston_icd9", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.066697Z", "completed_at": "2024-08-23T19:21:32.067282Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.068917Z", "completed_at": "2024-08-23T19:21:32.068920Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.0031769275665283203, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.hcc_suspecting__clinical_concepts", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.067428Z", "completed_at": "2024-08-23T19:21:32.068025Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.069152Z", "completed_at": "2024-08-23T19:21:32.069155Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.003220796585083008, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.hcc_suspecting__hcc_descriptions", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.068173Z", "completed_at": "2024-08-23T19:21:32.068763Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.069384Z", "completed_at": "2024-08-23T19:21:32.069386Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0032939910888671875, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.hcc_suspecting__icd_10_cm_mappings", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.071100Z", "completed_at": "2024-08-23T19:21:32.072567Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.074215Z", "completed_at": "2024-08-23T19:21:32.074218Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.0040400028228759766, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.pharmacy__rxnorm_generic_available", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.072721Z", "completed_at": "2024-08-23T19:21:32.073320Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.074458Z", "completed_at": "2024-08-23T19:21:32.074461Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.004156827926635742, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.pqi__measures", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.073479Z", "completed_at": "2024-08-23T19:21:32.074059Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.074732Z", "completed_at": "2024-08-23T19:21:32.074735Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.004238128662109375, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.pqi__value_sets", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.076435Z", "completed_at": "2024-08-23T19:21:32.077031Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.078669Z", "completed_at": "2024-08-23T19:21:32.078672Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.003161907196044922, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.quality_measures__concepts", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.077186Z", "completed_at": "2024-08-23T19:21:32.077779Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.078912Z", "completed_at": "2024-08-23T19:21:32.078915Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.0032460689544677734, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.quality_measures__measures", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.077934Z", "completed_at": "2024-08-23T19:21:32.078518Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.079175Z", "completed_at": "2024-08-23T19:21:32.079178Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0033538341522216797, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.quality_measures__value_sets", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.081000Z", "completed_at": "2024-08-23T19:21:32.081604Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.083304Z", "completed_at": "2024-08-23T19:21:32.083308Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.0032460689544677734, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.readmissions__acute_diagnosis_ccs", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.081755Z", "completed_at": "2024-08-23T19:21:32.082382Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.083552Z", "completed_at": "2024-08-23T19:21:32.083555Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.003351926803588867, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.readmissions__acute_diagnosis_icd_10_cm", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.082544Z", "completed_at": "2024-08-23T19:21:32.083145Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.083828Z", "completed_at": "2024-08-23T19:21:32.083831Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.003434896469116211, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.readmissions__always_planned_ccs_diagnosis_category", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.085549Z", "completed_at": "2024-08-23T19:21:32.086137Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.088653Z", "completed_at": "2024-08-23T19:21:32.088656Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.0040471553802490234, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.readmissions__always_planned_ccs_procedure_category", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.086290Z", "completed_at": "2024-08-23T19:21:32.087757Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.088895Z", "completed_at": "2024-08-23T19:21:32.088898Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.004116058349609375, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.readmissions__exclusion_ccs_diagnosis_category", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.087919Z", "completed_at": "2024-08-23T19:21:32.088501Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.089132Z", "completed_at": "2024-08-23T19:21:32.089135Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.004197120666503906, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.readmissions__icd_10_cm_to_ccs", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.090843Z", "completed_at": "2024-08-23T19:21:32.091429Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.093072Z", "completed_at": "2024-08-23T19:21:32.093075Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.003178119659423828, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.readmissions__icd_10_pcs_to_ccs", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.091585Z", "completed_at": "2024-08-23T19:21:32.092177Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.093314Z", "completed_at": "2024-08-23T19:21:32.093317Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.0032482147216796875, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.readmissions__potentially_planned_ccs_procedure_category", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.092337Z", "completed_at": "2024-08-23T19:21:32.092915Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.093554Z", "completed_at": "2024-08-23T19:21:32.093557Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0033261775970458984, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.readmissions__potentially_planned_icd_10_pcs", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.095307Z", "completed_at": "2024-08-23T19:21:32.095904Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.097501Z", "completed_at": "2024-08-23T19:21:32.097504Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.003184795379638672, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.readmissions__specialty_cohort", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.096059Z", "completed_at": "2024-08-23T19:21:32.096636Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.097738Z", "completed_at": "2024-08-23T19:21:32.097741Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.0032501220703125, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.readmissions__surgery_gynecology_cohort", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.096784Z", "completed_at": "2024-08-23T19:21:32.097353Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.097982Z", "completed_at": "2024-08-23T19:21:32.097985Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0033349990844726562, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.reference_data__ansi_fips_state", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.099631Z", "completed_at": "2024-08-23T19:21:32.100228Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.101887Z", "completed_at": "2024-08-23T19:21:32.101890Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.003159046173095703, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.reference_data__calendar", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.100382Z", "completed_at": "2024-08-23T19:21:32.100989Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.102123Z", "completed_at": "2024-08-23T19:21:32.102126Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.0032329559326171875, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.reference_data__code_type", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.101143Z", "completed_at": "2024-08-23T19:21:32.101734Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.102354Z", "completed_at": "2024-08-23T19:21:32.102357Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0033130645751953125, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.reference_data__fips_county", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.105113Z", "completed_at": "2024-08-23T19:21:32.105699Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.107301Z", "completed_at": "2024-08-23T19:21:32.107304Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.004077911376953125, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.reference_data__ssa_fips_state", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.105849Z", "completed_at": "2024-08-23T19:21:32.106427Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.107559Z", "completed_at": "2024-08-23T19:21:32.107562Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.0032148361206054688, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.service_category__service_categories", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.106577Z", "completed_at": "2024-08-23T19:21:32.107152Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.107806Z", "completed_at": "2024-08-23T19:21:32.107809Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.003309965133666992, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.terminology__admit_source", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.109820Z", "completed_at": "2024-08-23T19:21:32.110434Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.112103Z", "completed_at": "2024-08-23T19:21:32.112107Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.003451108932495117, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.terminology__admit_type", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.110589Z", "completed_at": "2024-08-23T19:21:32.111183Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.112362Z", "completed_at": "2024-08-23T19:21:32.112365Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.003367900848388672, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.terminology__apr_drg", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.111337Z", "completed_at": "2024-08-23T19:21:32.111936Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.112617Z", "completed_at": "2024-08-23T19:21:32.112620Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0034520626068115234, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.terminology__bill_type", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.114489Z", "completed_at": "2024-08-23T19:21:32.115094Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.116768Z", "completed_at": "2024-08-23T19:21:32.116771Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.0033249855041503906, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.terminology__claim_type", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.115247Z", "completed_at": "2024-08-23T19:21:32.115842Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.117070Z", "completed_at": "2024-08-23T19:21:32.117074Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.0034470558166503906, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.terminology__discharge_disposition", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.115995Z", "completed_at": "2024-08-23T19:21:32.116583Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.117360Z", "completed_at": "2024-08-23T19:21:32.117364Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0035698413848876953, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.terminology__encounter_type", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.119138Z", "completed_at": "2024-08-23T19:21:32.119756Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.122334Z", "completed_at": "2024-08-23T19:21:32.122337Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.004128932952880859, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.terminology__ethnicity", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.119910Z", "completed_at": "2024-08-23T19:21:32.121429Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.122579Z", "completed_at": "2024-08-23T19:21:32.122581Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.004205226898193359, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.terminology__gender", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.121585Z", "completed_at": "2024-08-23T19:21:32.122179Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.122812Z", "completed_at": "2024-08-23T19:21:32.122815Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0042879581451416016, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.terminology__hcpcs_level_2", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.124575Z", "completed_at": "2024-08-23T19:21:32.125172Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.126827Z", "completed_at": "2024-08-23T19:21:32.126829Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.003185272216796875, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.terminology__hcpcs_to_rbcs", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.125326Z", "completed_at": "2024-08-23T19:21:32.125949Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.127063Z", "completed_at": "2024-08-23T19:21:32.127066Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.003244161605834961, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.terminology__icd_10_cm", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.126099Z", "completed_at": "2024-08-23T19:21:32.126679Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.127293Z", "completed_at": "2024-08-23T19:21:32.127296Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.003313779830932617, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.terminology__icd_10_pcs", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.128993Z", "completed_at": "2024-08-23T19:21:32.129573Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.131193Z", "completed_at": "2024-08-23T19:21:32.131196Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.0031249523162841797, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.terminology__icd_9_cm", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.129720Z", "completed_at": "2024-08-23T19:21:32.130303Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.131435Z", "completed_at": "2024-08-23T19:21:32.131438Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.0032067298889160156, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.terminology__icd_9_pcs", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.130450Z", "completed_at": "2024-08-23T19:21:32.131045Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.131665Z", "completed_at": "2024-08-23T19:21:32.131668Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0032842159271240234, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.terminology__loinc", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.133517Z", "completed_at": "2024-08-23T19:21:32.134147Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.136697Z", "completed_at": "2024-08-23T19:21:32.136701Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.004248142242431641, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.terminology__loinc_deprecated_mapping", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.134304Z", "completed_at": "2024-08-23T19:21:32.134907Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.136964Z", "completed_at": "2024-08-23T19:21:32.136967Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.004300117492675781, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.terminology__mdc", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.135058Z", "completed_at": "2024-08-23T19:21:32.136540Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.137205Z", "completed_at": "2024-08-23T19:21:32.137207Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0043790340423583984, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.terminology__medicare_dual_eligibility", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.138893Z", "completed_at": "2024-08-23T19:21:32.139488Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.141101Z", "completed_at": "2024-08-23T19:21:32.141104Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.003145933151245117, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.terminology__medicare_orec", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.139643Z", "completed_at": "2024-08-23T19:21:32.140220Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.141337Z", "completed_at": "2024-08-23T19:21:32.141340Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.003208160400390625, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.terminology__medicare_status", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.140368Z", "completed_at": "2024-08-23T19:21:32.140947Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.141569Z", "completed_at": "2024-08-23T19:21:32.141572Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0032880306243896484, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.terminology__ms_drg", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.143301Z", "completed_at": "2024-08-23T19:21:32.143905Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.145612Z", "completed_at": "2024-08-23T19:21:32.145615Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.0032968521118164062, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.terminology__ms_drg_weights_los", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.144056Z", "completed_at": "2024-08-23T19:21:32.144654Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.145861Z", "completed_at": "2024-08-23T19:21:32.145864Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.0033469200134277344, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.terminology__ndc", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.144807Z", "completed_at": "2024-08-23T19:21:32.145454Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.146097Z", "completed_at": "2024-08-23T19:21:32.146100Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0034058094024658203, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.terminology__other_provider_taxonomy", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.147800Z", "completed_at": "2024-08-23T19:21:32.148376Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.149990Z", "completed_at": "2024-08-23T19:21:32.149993Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.0031130313873291016, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.terminology__payer_type", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.148526Z", "completed_at": "2024-08-23T19:21:32.149097Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.150224Z", "completed_at": "2024-08-23T19:21:32.150227Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.0031821727752685547, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.terminology__place_of_service", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.149247Z", "completed_at": "2024-08-23T19:21:32.149838Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.150456Z", "completed_at": "2024-08-23T19:21:32.150459Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0032591819763183594, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.terminology__present_on_admission", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.152167Z", "completed_at": "2024-08-23T19:21:32.152802Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.155397Z", "completed_at": "2024-08-23T19:21:32.155400Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.00415492057800293, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.terminology__provider", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.152958Z", "completed_at": "2024-08-23T19:21:32.154473Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.155638Z", "completed_at": "2024-08-23T19:21:32.155642Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.004271030426025391, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.terminology__race", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.154643Z", "completed_at": "2024-08-23T19:21:32.155241Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.155917Z", "completed_at": "2024-08-23T19:21:32.155920Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.004354953765869141, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.terminology__revenue_center", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.157687Z", "completed_at": "2024-08-23T19:21:32.158272Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.159980Z", "completed_at": "2024-08-23T19:21:32.159983Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.0032122135162353516, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.terminology__rxnorm_brand_generic", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.158421Z", "completed_at": "2024-08-23T19:21:32.159010Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.160219Z", "completed_at": "2024-08-23T19:21:32.160222Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.0032868385314941406, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.terminology__rxnorm_to_atc", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.159178Z", "completed_at": "2024-08-23T19:21:32.159830Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.160453Z", "completed_at": "2024-08-23T19:21:32.160456Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0033719539642333984, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.terminology__snomed_ct", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.162180Z", "completed_at": "2024-08-23T19:21:32.162772Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.169330Z", "completed_at": "2024-08-23T19:21:32.169334Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.008084774017333984, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.terminology__snomed_ct_transitive_closures", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.162923Z", "completed_at": "2024-08-23T19:21:32.163510Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.169592Z", "completed_at": "2024-08-23T19:21:32.169595Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.008175134658813477, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.the_tuva_project.terminology__snomed_icd_10_map", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.163657Z", "completed_at": "2024-08-23T19:21:32.170471Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.170938Z", "completed_at": "2024-08-23T19:21:32.170941Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.009366035461425781, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.core__stg_clinical_encounter", "compiled": true, "compiled_code": "\n\nselect \n    cast(encounter_id as TEXT ) as encounter_id\n    , cast(patient_id as TEXT ) as patient_id\n    , cast(encounter_type as TEXT ) as encounter_type\n    , try_cast( encounter_start_date as date ) as encounter_start_date\n    , try_cast( encounter_end_date as date ) as encounter_end_date\n    , cast(length_of_stay as integer ) as length_of_stay\n    , cast(admit_source_code as TEXT ) as admit_source_code\n    , cast(admit_source_description as TEXT ) as admit_source_description\n    , cast(admit_type_code as TEXT ) as admit_type_code\n    , cast(admit_type_description as TEXT ) as admit_type_description\n    , cast(discharge_disposition_code as TEXT ) as discharge_disposition_code\n    , cast(discharge_disposition_description as TEXT ) as discharge_disposition_description\n    , cast(attending_provider_id as TEXT ) as attending_provider_id\n    , cast(attending_provider_name as TEXT ) as attending_provider_name\n    , cast(facility_id as TEXT ) as facility_id\n    , cast(facility_name as TEXT ) as facility_name\n    , cast(primary_diagnosis_code_type as TEXT ) as primary_diagnosis_code_type\n    , cast(primary_diagnosis_code as TEXT ) as primary_diagnosis_code\n    , cast(primary_diagnosis_description as TEXT ) as primary_diagnosis_description\n    , cast(ms_drg_code as TEXT ) as ms_drg_code\n    , cast(ms_drg_description as TEXT ) as ms_drg_description \n    , cast(apr_drg_code as TEXT ) as apr_drg_code\n    , cast(apr_drg_description as TEXT ) as apr_drg_description\n    , cast(paid_amount as numeric(28,6) ) as paid_amount\n    , cast(allowed_amount as numeric(28,6) ) as allowed_amount\n    , cast(charge_amount as numeric(28,6) ) as charge_amount\n    , cast(data_source as TEXT ) as data_source\n    , cast('2024-08-23 19:21:27.787896+00:00' as timestamp ) as tuva_last_run\nfrom tuva.input_layer.encounter", "relation_name": "dev_tom.core._stg_clinical_encounter"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.171317Z", "completed_at": "2024-08-23T19:21:32.176651Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.178663Z", "completed_at": "2024-08-23T19:21:32.178666Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.00838613510131836, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__encounter_admit_source_description", "compiled": true, "compiled_code": "\n\nSELECT\n      m.data_source\n    , coalesce(m.encounter_start_date,cast('1900-01-01' as date)) as source_date\n    , 'ENCOUNTER' AS table_name\n    , 'Encounter ID' as drill_down_key\n    , coalesce(encounter_id, 'NULL') AS drill_down_value\n    , 'ADMIT_SOURCE_DESCRIPTION' AS field_name\n    , case when m.admit_source_description is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(substring(admit_source_description, 1, 255) as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.encounter m", "relation_name": "dev_tom.data_quality.encounter_admit_source_description"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.174296Z", "completed_at": "2024-08-23T19:21:32.178937Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.179350Z", "completed_at": "2024-08-23T19:21:32.179353Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.008753776550292969, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__encounter_admit_type_description", "compiled": true, "compiled_code": "\n\nSELECT\n    m.data_source\n    ,coalesce(m.encounter_start_date,cast('1900-01-01' as date)) as source_date\n    ,'ENCOUNTER' AS table_name\n    ,'Encounter ID' as drill_down_key\n    , coalesce(encounter_id, 'NULL') AS drill_down_value\n    ,'ADMIT_TYPE_DESCRIPTION' AS field_name\n    ,case when m.admit_type_description is not null then 'valid' else 'null' end as bucket_name\n    ,cast(null as TEXT) as invalid_reason\n    ,cast(substring(admit_type_description, 1, 255) as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.encounter m", "relation_name": "dev_tom.data_quality.encounter_admit_type_description"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.176824Z", "completed_at": "2024-08-23T19:21:32.179786Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.180333Z", "completed_at": "2024-08-23T19:21:32.180337Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.004151105880737305, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__encounter_allowed_amount", "compiled": true, "compiled_code": "\n\nSELECT\n      m.data_source\n    , coalesce(m.encounter_start_date,cast('1900-01-01' as date)) as source_date\n    , 'ENCOUNTER' AS table_name\n    , 'Encounter ID' as drill_down_key\n    , coalesce(encounter_id, 'NULL') AS drill_down_value\n    , 'ALLOWED_AMOUNT' AS field_name\n    , case when m.allowed_amount is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(allowed_amount as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.encounter m", "relation_name": "dev_tom.data_quality.encounter_allowed_amount"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.180798Z", "completed_at": "2024-08-23T19:21:32.185161Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.185488Z", "completed_at": "2024-08-23T19:21:32.185492Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.0059032440185546875, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__encounter_apr_drg_description", "compiled": true, "compiled_code": "\n\nSELECT\n      m.data_source\n    , coalesce(m.encounter_start_date,cast('1900-01-01' as date)) as source_date\n    , 'ENCOUNTER' AS table_name\n    , 'Encounter ID' as drill_down_key\n    , coalesce(encounter_id, 'NULL') AS drill_down_value\n    , 'APR_DRG_DESCRIPTION' AS field_name\n    , case when m.apr_drg_description is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(substring(apr_drg_description, 1, 255) as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.encounter m", "relation_name": "dev_tom.data_quality.encounter_apr_drg_description"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.183347Z", "completed_at": "2024-08-23T19:21:32.187774Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.188210Z", "completed_at": "2024-08-23T19:21:32.188213Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.007636070251464844, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__encounter_charge_amount", "compiled": true, "compiled_code": "\n\nSELECT\n      m.data_source\n    , coalesce(m.encounter_start_date,cast('1900-01-01' as date)) as source_date\n    , 'ENCOUNTER' AS table_name\n    , 'Encounter ID' as drill_down_key\n    , coalesce(encounter_id, 'NULL') AS drill_down_value\n    , 'CHARGE_AMOUNT' AS field_name\n    , case when m.charge_amount is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(charge_amount as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.encounter m", "relation_name": "dev_tom.data_quality.encounter_charge_amount"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.185780Z", "completed_at": "2024-08-23T19:21:32.188486Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.189028Z", "completed_at": "2024-08-23T19:21:32.189031Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.00591588020324707, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__encounter_data_source", "compiled": true, "compiled_code": "\n\nSELECT\n    m.data_source\n    ,coalesce(m.encounter_start_date,cast('1900-01-01' as date)) as source_date\n    ,'ENCOUNTER' AS table_name\n    ,'Encounter ID' as drill_down_key\n    , coalesce(encounter_id, 'NULL') AS drill_down_value\n    ,'DATA_SOURCE' AS field_name\n    ,case when m.data_source is not null then 'valid' else 'null' end as bucket_name\n    ,cast(null as TEXT) as invalid_reason\n    ,cast(data_source as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.encounter m", "relation_name": "dev_tom.data_quality.encounter_data_source"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.189317Z", "completed_at": "2024-08-23T19:21:32.194432Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.197419Z", "completed_at": "2024-08-23T19:21:32.197423Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.009474039077758789, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__encounter_discharge_disposition_description", "compiled": true, "compiled_code": "\n\nSELECT\n      m.data_source\n    , coalesce(m.encounter_start_date,cast('1900-01-01' as date)) as source_date\n    , 'ENCOUNTER' AS table_name\n    , 'Encounter ID' as drill_down_key\n    , coalesce(encounter_id, 'NULL') AS drill_down_value\n    , 'DISCHARGE_DISPOSITION_DESCRIPTION' AS field_name\n    , case when m.discharge_disposition_description is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(substring(discharge_disposition_description, 1, 255) as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.encounter m", "relation_name": "dev_tom.data_quality.encounter_discharge_disposition_description"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.194828Z", "completed_at": "2024-08-23T19:21:32.200254Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.200626Z", "completed_at": "2024-08-23T19:21:32.200629Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.009450912475585938, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__encounter_encounter_end_date", "compiled": true, "compiled_code": "\n\nSELECT\n      m.data_source\n    , coalesce(m.encounter_start_date,cast('1900-01-01' as date)) as source_date\n    , 'ENCOUNTER' AS table_name\n    , 'Encounter ID' as drill_down_key\n    , coalesce(encounter_id, 'NULL') AS drill_down_value\n    , 'ENCOUNTER_END_DATE' AS field_name\n    , case\n        when m.encounter_end_date > cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) then 'invalid'\n        when m.encounter_end_date <= cast('1901-01-01' as date) then 'invalid'\n        when m.encounter_end_date < m.encounter_start_date then 'invalid'\n        when m.encounter_end_date is null then 'null'\n        else 'valid'\n    end as bucket_name\n    , case\n        when m.encounter_end_date > cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) then 'future'\n        when m.encounter_end_date <= cast('1901-01-01' as date) then 'too old'\n        when m.encounter_end_date < m.encounter_start_date then 'Encounter end date before encounter start date'\n        else null\n    end as invalid_reason\n    , cast(encounter_end_date as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.encounter m", "relation_name": "dev_tom.data_quality.encounter_encounter_end_date"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.198123Z", "completed_at": "2024-08-23T19:21:32.200884Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.204575Z", "completed_at": "2024-08-23T19:21:32.204578Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.009974956512451172, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__encounter_encounter_id", "compiled": true, "compiled_code": "\n\nSELECT\n      m.data_source\n    , coalesce(m.encounter_start_date,cast('1900-01-01' as date)) as source_date\n    , 'ENCOUNTER' AS table_name\n    , 'Encounter ID' as drill_down_key\n    , coalesce(encounter_id, 'NULL') AS drill_down_value\n    , 'ENCOUNTER_ID' AS field_name\n    , case when m.encounter_id is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(encounter_id as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.encounter m", "relation_name": "dev_tom.data_quality.encounter_encounter_id"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.201041Z", "completed_at": "2024-08-23T19:21:32.205303Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.205799Z", "completed_at": "2024-08-23T19:21:32.205803Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.005757808685302734, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__encounter_encounter_start_date", "compiled": true, "compiled_code": "\n\nSELECT\n      m.data_source\n    , coalesce(m.encounter_start_date,cast('1900-01-01' as date)) as source_date\n    , 'ENCOUNTER' AS table_name\n    , 'Encounter ID' as drill_down_key\n    , coalesce(encounter_id, 'NULL') AS drill_down_value\n    , 'ENCOUNTER_START_DATE' AS field_name\n    , case\n        when m.encounter_start_date > cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) then 'invalid'\n        when m.encounter_start_date <= cast('1901-01-01' as date) then 'invalid'\n        when m.encounter_start_date > m.encounter_end_date then 'invalid'\n        when m.encounter_start_date is null then 'null'\n        else 'valid'\n    end as bucket_name\n    , case\n        when m.encounter_start_date > cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) then 'future'\n        when m.encounter_start_date <= cast('1901-01-01' as date) then 'too old'\n        when m.encounter_start_date > m.encounter_end_date then 'Encounter start date after encounter end date'\n        else null\n    end as invalid_reason\n    , cast(encounter_start_date as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.encounter m", "relation_name": "dev_tom.data_quality.encounter_encounter_start_date"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.206074Z", "completed_at": "2024-08-23T19:21:32.210368Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.210709Z", "completed_at": "2024-08-23T19:21:32.210713Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.005882740020751953, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__encounter_length_of_stay", "compiled": true, "compiled_code": "\n\nSELECT\n    m.data_source\n    ,coalesce(m.encounter_start_date,cast('1900-01-01' as date)) as source_date\n    ,'ENCOUNTER' AS table_name\n    ,'Encounter ID' as drill_down_key\n    , coalesce(encounter_id, 'NULL') AS drill_down_value\n    ,'LENGTH_OF_STAY' AS field_name\n    ,case when m.length_of_stay is not null then 'valid' else 'null' end as bucket_name\n    ,cast(null as TEXT) as invalid_reason\n    ,cast(length_of_stay as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.encounter m", "relation_name": "dev_tom.data_quality.encounter_length_of_stay"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.208287Z", "completed_at": "2024-08-23T19:21:32.210995Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.213149Z", "completed_at": "2024-08-23T19:21:32.213153Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.007568836212158203, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__encounter_ms_drg_description", "compiled": true, "compiled_code": "\n\nSELECT\n      m.data_source\n    , coalesce(m.encounter_start_date,cast('1900-01-01' as date)) as source_date\n    , 'ENCOUNTER' AS table_name\n    , 'Encounter ID' as drill_down_key\n    , coalesce(encounter_id, 'NULL') AS drill_down_value\n    , 'MS_DRG_DESCRIPTION' AS field_name\n    , case when m.ms_drg_description is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(substring(ms_drg_description, 1, 255) as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.encounter m", "relation_name": "dev_tom.data_quality.encounter_ms_drg_description"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.211146Z", "completed_at": "2024-08-23T19:21:32.214008Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.216169Z", "completed_at": "2024-08-23T19:21:32.216173Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.006033897399902344, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__encounter_paid_amount", "compiled": true, "compiled_code": "\n\nSELECT\n    m.data_source\n    ,coalesce(m.encounter_start_date,cast('1900-01-01' as date)) as source_date\n    ,'ENCOUNTER' AS table_name\n    ,'Encounter ID' as drill_down_key\n    , coalesce(encounter_id, 'NULL') AS drill_down_value\n    ,'PAID_AMOUNT' AS field_name\n    ,case when m.paid_amount is not null then 'valid' else 'null' end as bucket_name\n    ,cast(null as TEXT) as invalid_reason\n    ,cast(paid_amount as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.encounter m", "relation_name": "dev_tom.data_quality.encounter_paid_amount"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.214350Z", "completed_at": "2024-08-23T19:21:32.218739Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.219093Z", "completed_at": "2024-08-23T19:21:32.219096Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.005668163299560547, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__encounter_patient_id", "compiled": true, "compiled_code": "\n\nSELECT\n    m.data_source\n    ,coalesce(m.encounter_start_date,cast('1900-01-01' as date)) as source_date\n    ,'ENCOUNTER' AS table_name\n    ,'Encounter ID' as drill_down_key\n    , coalesce(encounter_id, 'NULL') AS drill_down_value\n    ,'PATIENT_ID' AS field_name\n    ,case when m.patient_id is not null then 'valid' else 'null' end as bucket_name\n    ,cast(null as TEXT) as invalid_reason\n    ,cast(patient_id as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.encounter m", "relation_name": "dev_tom.data_quality.encounter_patient_id"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.216860Z", "completed_at": "2024-08-23T19:21:32.219717Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.223806Z", "completed_at": "2024-08-23T19:21:32.223809Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.009672164916992188, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__encounter_primary_diagnosis_description", "compiled": true, "compiled_code": "\n\nSELECT\n      m.data_source\n    , coalesce(m.encounter_start_date,cast('1900-01-01' as date)) as source_date\n    , 'ENCOUNTER' AS table_name\n    , 'Encounter ID' as drill_down_key\n    , coalesce(encounter_id, 'NULL') AS drill_down_value\n    , 'PRIMARY_DIAGNOSIS_DESCRIPTION' AS field_name\n    , case when m.primary_diagnosis_description is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(substring(primary_diagnosis_description, 1, 255) as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.encounter m", "relation_name": "dev_tom.data_quality.encounter_primary_diagnosis_description"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.219906Z", "completed_at": "2024-08-23T19:21:32.226262Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.226630Z", "completed_at": "2024-08-23T19:21:32.226633Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.007786989212036133, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.core__stg_clinical_condition", "compiled": true, "compiled_code": "\n\nselect\n    cast(condition_id as TEXT ) as condition_id\n    , cast(patient_id as TEXT ) as patient_id\n    , cast(encounter_id as TEXT ) as encounter_id\n    , cast(claim_id as TEXT ) as claim_id\n    , try_cast( recorded_date as date ) as recorded_date\n    , try_cast( onset_date as date ) as onset_date\n    , try_cast( resolved_date as date ) as resolved_date\n    , cast(status as TEXT ) as status\n    , cast(condition_type as TEXT ) as condition_type\n    , cast(source_code_type as TEXT ) as source_code_type\n    , cast(source_code as TEXT ) as source_code\n    , cast(source_description as TEXT ) as source_description\n    , cast(normalized_code_type as TEXT ) as normalized_code_type\n    , cast(normalized_code as TEXT ) as normalized_code\n    , cast(normalized_description as TEXT ) as normalized_description\n    , cast(condition_rank as integer ) as condition_rank\n    , cast(present_on_admit_code as TEXT ) as present_on_admit_code\n    , cast(present_on_admit_description as TEXT ) as present_on_admit_description\n    , cast(data_source as TEXT ) as data_source\n    , cast('2024-08-23 19:21:27.787896+00:00' as timestamp ) as tuva_last_run\nfrom tuva.input_layer.condition", "relation_name": "dev_tom.core._stg_clinical_condition"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.224509Z", "completed_at": "2024-08-23T19:21:32.227264Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.230222Z", "completed_at": "2024-08-23T19:21:32.230225Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.006618976593017578, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__condition_claim_id", "compiled": true, "compiled_code": "\n\nSELECT\n      m.data_source\n    , coalesce(m.recorded_date,cast('1900-01-01' as date)) as source_date\n    , 'CONDITION' AS table_name\n    , 'Condition ID' as drill_down_key\n    , coalesce(condition_id, 'NULL') AS drill_down_value\n    , 'CLAIM_ID' AS field_name\n    , case when m.claim_id is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(claim_id as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nFROM tuva.input_layer.condition m", "relation_name": "dev_tom.data_quality.condition_claim_id"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.227428Z", "completed_at": "2024-08-23T19:21:32.230900Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.233027Z", "completed_at": "2024-08-23T19:21:32.233031Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.006630897521972656, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__condition_condition_id", "compiled": true, "compiled_code": "\n\nSELECT\n      m.data_source\n    , coalesce(m.recorded_date,cast('1900-01-01' as date)) as source_date\n    , 'CONDITION' AS table_name\n    , 'Condition ID' as drill_down_key\n    , coalesce(condition_id, 'NULL') AS drill_down_value\n    , 'CONDITION_ID' AS field_name\n    , case when m.condition_id is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(condition_id as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.condition m", "relation_name": "dev_tom.data_quality.condition_condition_id"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.231071Z", "completed_at": "2024-08-23T19:21:32.233721Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.235892Z", "completed_at": "2024-08-23T19:21:32.235895Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.005877971649169922, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__condition_condition_rank", "compiled": true, "compiled_code": "\n\nSELECT\n      m.data_source\n    , coalesce(m.recorded_date,cast('1900-01-01' as date)) as source_date\n    , 'CONDITION' AS table_name\n    , 'Condition ID' as drill_down_key\n    , coalesce(condition_id, 'NULL') AS drill_down_value\n    , 'CONDITION_RANK' AS field_name\n    , case when m.condition_rank is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(condition_rank as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.condition m", "relation_name": "dev_tom.data_quality.condition_condition_rank"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.233968Z", "completed_at": "2024-08-23T19:21:32.236538Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.238692Z", "completed_at": "2024-08-23T19:21:32.238695Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.005877017974853516, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__condition_condition_type", "compiled": true, "compiled_code": "\n\nSELECT\n      m.data_source\n    , coalesce(m.recorded_date,cast('1900-01-01' as date)) as source_date\n    , 'CONDITION' AS table_name\n    , 'Condition ID' as drill_down_key\n    , coalesce(condition_id, 'NULL') AS drill_down_value\n    , 'CONDITION_TYPE' AS field_name\n    , case when m.condition_type is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(condition_type as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.condition m", "relation_name": "dev_tom.data_quality.condition_condition_type"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.236700Z", "completed_at": "2024-08-23T19:21:32.239358Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.241481Z", "completed_at": "2024-08-23T19:21:32.241484Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.005799055099487305, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__condition_data_source", "compiled": true, "compiled_code": "\n\nSELECT\n      m.data_source\n    , coalesce(m.recorded_date,cast('1900-01-01' as date)) as source_date\n    , 'CONDITION' AS table_name\n    , 'Condition ID' as drill_down_key\n    , coalesce(condition_id, 'NULL') AS drill_down_value\n    , 'DATA_SOURCE' AS field_name\n    , case when m.data_source is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(data_source as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.condition m", "relation_name": "dev_tom.data_quality.condition_data_source"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.239522Z", "completed_at": "2024-08-23T19:21:32.242136Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.244330Z", "completed_at": "2024-08-23T19:21:32.244332Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.0058481693267822266, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__condition_encounter_id", "compiled": true, "compiled_code": "\n\nSELECT\n    m.data_source\n    ,coalesce(m.recorded_date,cast('1900-01-01' as date)) as source_date\n    ,'CONDITION' AS table_name\n    ,'Condition ID' as drill_down_key\n    , coalesce(condition_id, 'NULL') AS drill_down_value\n    ,'ENCOUNTER_ID' AS field_name\n    ,case when m.encounter_id is not null then 'valid' else 'null' end as bucket_name\n    ,cast(null as TEXT) as invalid_reason\n    ,cast(encounter_id as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.condition m", "relation_name": "dev_tom.data_quality.condition_encounter_id"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.242302Z", "completed_at": "2024-08-23T19:21:32.244976Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.247761Z", "completed_at": "2024-08-23T19:21:32.247764Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.0064961910247802734, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__condition_normalized_description", "compiled": true, "compiled_code": "\n\nSELECT\n      m.data_source\n    , coalesce(m.recorded_date,cast('1900-01-01' as date)) as source_date\n    , 'CONDITION' AS table_name\n    , 'Condition ID' as drill_down_key\n    , coalesce(condition_id, 'NULL') AS drill_down_value\n    , 'NORMALIZED_DESCRIPTION' AS field_name\n    , case when m.normalized_description is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(substring(normalized_description, 1, 255) as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.condition m", "relation_name": "dev_tom.data_quality.condition_normalized_description"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.245146Z", "completed_at": "2024-08-23T19:21:32.248441Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.250537Z", "completed_at": "2024-08-23T19:21:32.250540Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0064198970794677734, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__condition_onset_date", "compiled": true, "compiled_code": "\n\nSELECT\n    m.data_source\n    ,coalesce(m.recorded_date,cast('1900-01-01' as date)) as source_date\n    ,'CONDITION' AS table_name\n    ,'Condition ID' as drill_down_key\n    , coalesce(condition_id, 'NULL') AS drill_down_value\n    ,'ONSET_DATE' AS field_name\n    ,case\n        when m.onset_date > cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) then 'invalid'\n        when m.onset_date <= cast('1901-01-01' as date) then 'invalid'\n        when m.onset_date > m.resolved_date then 'invalid'\n        when m.onset_date is null then 'null'\n        else 'valid'\n    end as bucket_name\n    ,case\n        when m.onset_date > cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) then 'future'\n        when m.onset_date <= cast('1901-01-01' as date) then 'too old'\n        WHEN m.onset_date < m.resolved_date THEN 'Onset date after resolved date'\n        else null\n    end as invalid_reason\n    ,cast(onset_date as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.condition m", "relation_name": "dev_tom.data_quality.condition_onset_date"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.248604Z", "completed_at": "2024-08-23T19:21:32.253003Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.253370Z", "completed_at": "2024-08-23T19:21:32.253374Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.0058269500732421875, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__condition_patient_id", "compiled": true, "compiled_code": "\n\nSELECT\n    m.data_source\n    ,coalesce(m.recorded_date,cast('1900-01-01' as date) ) as source_date\n    ,'CONDITION' AS table_name\n    ,'Condition ID' as drill_down_key\n    , coalesce(condition_id, 'NULL') AS drill_down_value\n    ,'PATIENT_ID' AS field_name\n    ,case when m.patient_id is not null then 'valid' else 'null' end as bucket_name\n    ,cast(null as TEXT) as invalid_reason\n    ,cast(patient_id as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.condition m", "relation_name": "dev_tom.data_quality.condition_patient_id"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.251198Z", "completed_at": "2024-08-23T19:21:32.253804Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.257346Z", "completed_at": "2024-08-23T19:21:32.257350Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.007027864456176758, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__condition_present_on_admit_description", "compiled": true, "compiled_code": "\n\nSELECT\n    m.data_source\n    ,coalesce(m.recorded_date,cast('1900-01-01' as date)) as source_date\n    ,'CONDITION' AS table_name\n    ,'Condition ID' as drill_down_key\n    , coalesce(condition_id, 'NULL') AS drill_down_value\n    ,'PRESENT_ON_ADMIT_DESCRIPTION' AS field_name\n    ,case when m.present_on_admit_description is not null then 'valid' else 'null' end as bucket_name\n    ,cast(null as TEXT) as invalid_reason\n    ,cast(substring(present_on_admit_description, 1, 255) as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.condition m", "relation_name": "dev_tom.data_quality.condition_present_on_admit_description"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.254162Z", "completed_at": "2024-08-23T19:21:32.258195Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.260968Z", "completed_at": "2024-08-23T19:21:32.260971Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.007842779159545898, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__condition_recorded_date", "compiled": true, "compiled_code": "\n\nSELECT\n    m.data_source\n    ,coalesce(m.recorded_date,cast('1900-01-01' as date)) as source_date\n    ,'CONDITION' AS table_name\n    ,'Condition ID' as drill_down_key\n    , coalesce(condition_id, 'NULL') AS drill_down_value\n    ,'RECORDED_DATE' AS field_name\n    ,CASE\n        when m.recorded_date > cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) then 'invalid'\n        when m.recorded_date <= cast('1901-01-01' as date) then 'invalid'\n        when m.recorded_date < m.onset_date then 'invalid'\n        when m.recorded_date is null then 'null'\n        else 'valid'\n    end as bucket_name\n    ,case\n        when m.recorded_date > cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) then 'future'\n        when m.recorded_date <= cast('1901-01-01' as date) then 'too old'\n        WHEN m.recorded_date < m.onset_date THEN 'Recorded date before onset date'\n        else null\n    end as invalid_reason\n    ,cast(recorded_date as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.condition m", "relation_name": "dev_tom.data_quality.condition_recorded_date"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.258547Z", "completed_at": "2024-08-23T19:21:32.263646Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.264021Z", "completed_at": "2024-08-23T19:21:32.264023Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.006440162658691406, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__condition_resolved_date", "compiled": true, "compiled_code": "\n\nSELECT\n      m.data_source\n    , coalesce(m.recorded_date,cast('1900-01-01' as date)) as source_date\n    , 'CONDITION' AS table_name\n    , 'Condition ID' as drill_down_key\n    , coalesce(condition_id, 'NULL') AS drill_down_value\n    , 'RESOLVED_DATE' AS field_name\n    , CASE\n        when m.resolved_date > cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) then 'invalid'\n        when m.resolved_date <= cast('1901-01-01' as date) then 'invalid'\n        when m.resolved_date < m.onset_date then 'invalid'\n        when m.resolved_date is null then 'null'\n        else 'valid'\n    end as bucket_name\n    , case\n        when m.resolved_date > cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) then 'future'\n        when m.resolved_date <= cast('1901-01-01' as date) then 'too old'\n        when m.resolved_date < m.onset_date THEN 'Resolved date before onset date'\n        else null\n    end as invalid_reason\n    , cast(resolved_date as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.condition m", "relation_name": "dev_tom.data_quality.condition_resolved_date"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.261651Z", "completed_at": "2024-08-23T19:21:32.264294Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.266437Z", "completed_at": "2024-08-23T19:21:32.266440Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.00810694694519043, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__condition_source_code", "compiled": true, "compiled_code": "\n\nSELECT\n    m.data_source\n    ,coalesce(m.recorded_date,cast('1900-01-01' as date)) as source_date\n    ,'CONDITION' AS table_name\n    ,'Condition ID' as drill_down_key\n    , coalesce(condition_id, 'NULL') AS drill_down_value\n    ,'SOURCE_CODE' AS field_name\n    ,case when m.source_code is not null then 'valid' else 'null' end as bucket_name\n    ,cast(null as TEXT) as invalid_reason\n    ,cast(source_code as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.condition m", "relation_name": "dev_tom.data_quality.condition_source_code"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.264449Z", "completed_at": "2024-08-23T19:21:32.267117Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.267587Z", "completed_at": "2024-08-23T19:21:32.267590Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.004144906997680664, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__condition_source_code_type", "compiled": true, "compiled_code": "\n\nSELECT\n      m.data_source\n    , coalesce(m.recorded_date,cast('1900-01-01' as date)) as source_date\n    , 'CONDITION' AS table_name\n    , 'Condition ID' as drill_down_key\n    , coalesce(condition_id, 'NULL') AS drill_down_value\n    , 'SOURCE_CODE_TYPE' AS field_name\n    , case when m.source_code_type is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(source_code_type as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.condition m", "relation_name": "dev_tom.data_quality.condition_source_code_type"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.267852Z", "completed_at": "2024-08-23T19:21:32.271980Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.272299Z", "completed_at": "2024-08-23T19:21:32.272302Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.0056040287017822266, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__condition_source_description", "compiled": true, "compiled_code": "\n\nSELECT\n      m.data_source\n    , coalesce(m.recorded_date,cast('1900-01-01' as date)) as source_date\n    , 'CONDITION' AS table_name\n    , 'Condition ID' as drill_down_key\n    , coalesce(condition_id, 'NULL') AS drill_down_value\n    , 'SOURCE_DESCRIPTION' AS field_name\n    , case when m.source_description is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(substring(source_description, 1, 255) as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.condition m", "relation_name": "dev_tom.data_quality.condition_source_description"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.270021Z", "completed_at": "2024-08-23T19:21:32.272567Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.275996Z", "completed_at": "2024-08-23T19:21:32.275999Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.008601903915405273, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__condition_status", "compiled": true, "compiled_code": "\n\nSELECT\n      m.data_source\n    , coalesce(m.recorded_date,cast('1900-01-01' as date)) as source_date\n    , 'CONDITION' AS table_name\n    , 'Condition ID' as drill_down_key\n    , coalesce(condition_id, 'NULL') AS drill_down_value\n    , 'STATUS' AS field_name\n    , case when m.status is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(status as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.condition m", "relation_name": "dev_tom.data_quality.condition_status"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.272724Z", "completed_at": "2024-08-23T19:21:32.276832Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.279293Z", "completed_at": "2024-08-23T19:21:32.279296Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.007554054260253906, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.core__stg_clinical_location", "compiled": true, "compiled_code": "\n\nselect\n    cast(location_id as TEXT ) as location_id\n    , cast(npi as TEXT ) as npi\n    , cast(name as TEXT ) as name\n    , cast(facility_type as TEXT ) as facility_type\n    , cast(parent_organization as TEXT ) as parent_organization\n    , cast(address as TEXT ) as address\n    , cast(city as TEXT ) as city\n    , cast(state as TEXT ) as state\n    , cast(zip_code as TEXT ) as zip_code\n    , cast(latitude as float ) as latitude\n    , cast(longitude as float ) as longitude\n    , cast(data_source as TEXT ) as data_source\n    , cast('2024-08-23 19:21:27.787896+00:00' as timestamp ) as tuva_last_run\nfrom tuva.input_layer.location", "relation_name": "dev_tom.core._stg_clinical_location"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.277165Z", "completed_at": "2024-08-23T19:21:32.282960Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.283345Z", "completed_at": "2024-08-23T19:21:32.283348Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.007080078125, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__location_address", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    \n        , cast(coalesce(convert_timezone('UTC', current_timestamp()), cast('1900-01-01' as date)) as date) as source_date\n    \n    , 'LOCATION' AS table_name\n    , 'Location ID' as drill_down_key\n    , coalesce(location_id, 'NULL') AS drill_down_value\n    , 'ADDRESS' AS field_name\n    , case when m.address is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(address as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.location m", "relation_name": "dev_tom.data_quality.location_address"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.279975Z", "completed_at": "2024-08-23T19:21:32.283966Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.286429Z", "completed_at": "2024-08-23T19:21:32.286432Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.009466886520385742, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__location_city", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    \n        , cast(coalesce(convert_timezone('UTC', current_timestamp()), cast('1900-01-01' as date)) as date) as source_date\n    \n    , 'LOCATION' AS table_name\n    , 'Location ID' as drill_down_key\n    , coalesce(location_id, 'NULL') AS drill_down_value\n    , 'CITY' AS field_name\n    , case when m.city is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(city as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.location m", "relation_name": "dev_tom.data_quality.location_city"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.284149Z", "completed_at": "2024-08-23T19:21:32.289190Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.289588Z", "completed_at": "2024-08-23T19:21:32.289590Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.00649714469909668, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__location_data_source", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    \n        , cast(coalesce(convert_timezone('UTC', current_timestamp()), cast('1900-01-01' as date)) as date) as source_date\n    \n    , 'LOCATION' AS table_name\n    , 'Location ID' as drill_down_key\n    , coalesce(location_id, 'NULL') AS drill_down_value\n    , 'DATA_SOURCE' AS field_name\n    , case when m.data_source is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(data_source as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.location m", "relation_name": "dev_tom.data_quality.location_data_source"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.287105Z", "completed_at": "2024-08-23T19:21:32.290225Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.292769Z", "completed_at": "2024-08-23T19:21:32.292772Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.006537199020385742, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__location_facility_type", "compiled": true, "compiled_code": "\n\n\nSELECT\n    m.data_source\n    \n        , cast(coalesce(convert_timezone('UTC', current_timestamp()), cast('1900-01-01' as date)) as date) as source_date\n    \n    ,'LOCATION' AS table_name\n    ,'Location ID' as drill_down_key\n    , coalesce(location_id, 'NULL') AS drill_down_value\n    ,'FACILITY_TYPE' AS field_name\n    ,case when m.facility_type is not null then 'valid' else 'null' end as bucket_name\n    ,cast(null as TEXT) as invalid_reason\n    ,cast(facility_type as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.location m", "relation_name": "dev_tom.data_quality.location_facility_type"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.290404Z", "completed_at": "2024-08-23T19:21:32.293440Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.295866Z", "completed_at": "2024-08-23T19:21:32.295869Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.006536960601806641, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__location_latitude", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    \n        , cast(coalesce(convert_timezone('UTC', current_timestamp()), cast('1900-01-01' as date)) as date) as source_date\n    \n    , 'LOCATION' AS table_name\n    , 'Location ID' as drill_down_key\n    , coalesce(location_id, 'NULL') AS drill_down_value\n    , 'LATITUDE' as field_name\n    , case when m.latitude is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(latitude as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.location m", "relation_name": "dev_tom.data_quality.location_latitude"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.293587Z", "completed_at": "2024-08-23T19:21:32.296524Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.299009Z", "completed_at": "2024-08-23T19:21:32.299012Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.006451129913330078, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__location_location_id", "compiled": true, "compiled_code": "\n\n\nSELECT\n    m.data_source\n    \n        , cast(coalesce(convert_timezone('UTC', current_timestamp()), cast('1900-01-01' as date)) as date) as source_date\n    \n    ,'LOCATION' AS table_name\n    ,'Location ID' as drill_down_key\n    , coalesce(location_id, 'NULL') AS drill_down_value\n    ,'LOCATION_ID' AS field_name\n    ,case when m.location_id is not null then 'valid' else 'null' end as bucket_name\n    ,cast(null as TEXT) as invalid_reason\n    ,cast(location_id as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.location m", "relation_name": "dev_tom.data_quality.location_location_id"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.296679Z", "completed_at": "2024-08-23T19:21:32.299657Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.302153Z", "completed_at": "2024-08-23T19:21:32.302157Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.006501913070678711, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__location_longitude", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    \n        , cast(coalesce(convert_timezone('UTC', current_timestamp()), cast('1900-01-01' as date)) as date) as source_date\n    \n    , 'LOCATION' AS table_name\n    , 'Location ID' as drill_down_key\n    , coalesce(location_id, 'NULL') AS drill_down_value\n    , 'LONGITUDE' as field_name\n    , case when m.longitude is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(longitude as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.location m", "relation_name": "dev_tom.data_quality.location_longitude"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.299842Z", "completed_at": "2024-08-23T19:21:32.302833Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.305269Z", "completed_at": "2024-08-23T19:21:32.305272Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.0064661502838134766, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__location_name", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    \n        , cast(coalesce(convert_timezone('UTC', current_timestamp()), cast('1900-01-01' as date)) as date) as source_date\n    \n    , 'LOCATION' AS table_name\n    , 'Location ID' as drill_down_key\n    , coalesce(location_id, 'NULL') AS drill_down_value\n    , 'NAME' as field_name\n    , case when m.name is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(name as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.location m", "relation_name": "dev_tom.data_quality.location_name"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.302990Z", "completed_at": "2024-08-23T19:21:32.305912Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.308429Z", "completed_at": "2024-08-23T19:21:32.308432Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.006498098373413086, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__location_parent_organization", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    \n        , cast(coalesce(convert_timezone('UTC', current_timestamp()), cast('1900-01-01' as date)) as date) as source_date\n    \n    , 'LOCATION' AS table_name\n    , 'Location ID' as drill_down_key\n    , coalesce(location_id, 'NULL') AS drill_down_value\n    , 'PARENT_ORGANIZATION' AS field_name\n    , case when m.parent_organization is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(parent_organization as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.location m", "relation_name": "dev_tom.data_quality.location_parent_organization"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.306083Z", "completed_at": "2024-08-23T19:21:32.312064Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.312451Z", "completed_at": "2024-08-23T19:21:32.312454Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.007396697998046875, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__location_state", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    \n        , cast(coalesce(convert_timezone('UTC', current_timestamp()), cast('1900-01-01' as date)) as date) as source_date\n    \n    , 'LOCATION' AS table_name\n    , 'Location ID' as drill_down_key\n    , coalesce(location_id, 'NULL') AS drill_down_value\n    , 'STATE' as field_name\n    , case when m.state is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(state as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.location m", "relation_name": "dev_tom.data_quality.location_state"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.309118Z", "completed_at": "2024-08-23T19:21:32.312898Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.317831Z", "completed_at": "2024-08-23T19:21:32.317834Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.009617090225219727, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__location_zip_code", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    \n        , cast(coalesce(convert_timezone('UTC', current_timestamp()), cast('1900-01-01' as date)) as date) as source_date\n    \n    , 'LOCATION' AS table_name\n    , 'Location ID' as drill_down_key\n    , coalesce(location_id, 'NULL') AS drill_down_value\n    , 'ZIP_CODE' as field_name\n    , case when m.zip_code is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(zip_code as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.location m", "relation_name": "dev_tom.data_quality.location_zip_code"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.313268Z", "completed_at": "2024-08-23T19:21:32.319651Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.321936Z", "completed_at": "2024-08-23T19:21:32.321939Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.00973200798034668, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.core__stg_clinical_lab_result", "compiled": true, "compiled_code": "\n\nselect\n    cast(lab_result_id as TEXT ) as lab_result_id\n    , cast(patient_id as TEXT ) as patient_id\n    , cast(encounter_id as TEXT ) as encounter_id\n    , cast(accession_number as TEXT ) as accession_number\n    , cast(source_code_type as TEXT ) as source_code_type\n    , cast(source_code as TEXT ) as source_code\n    , cast(source_description as TEXT ) as source_description\n    , cast(source_component as TEXT ) as source_component\n    , cast(normalized_code_type as TEXT ) as normalized_code_type\n    , cast(normalized_code as TEXT ) as normalized_code\n    , cast(normalized_description as TEXT ) as normalized_description\n    , cast(normalized_component as TEXT ) as normalized_component\n    , cast(status as TEXT ) as status\n    , cast(result as TEXT ) as result\n    , try_cast( result_date as date ) as result_date\n    , try_cast( collection_date as date ) as collection_date\n    , cast(source_units as TEXT ) as source_units\n    , cast(normalized_units as TEXT ) as normalized_units\n    , cast(source_reference_range_low as TEXT ) as source_reference_range_low\n    , cast(source_reference_range_high as TEXT ) as source_reference_range_high\n    , cast(normalized_reference_range_low as TEXT ) as normalized_reference_range_low\n    , cast(normalized_reference_range_high as TEXT ) as normalized_reference_range_high\n    , cast(source_abnormal_flag as TEXT ) as source_abnormal_flag\n    , cast(normalized_abnormal_flag as TEXT ) as normalized_abnormal_flag\n    , cast(specimen as TEXT ) as specimen\n    , cast(ordering_practitioner_id as TEXT ) as ordering_practitioner_id\n    , cast(data_source as TEXT ) as data_source\n    , cast('2024-08-23 19:21:27.787896+00:00' as timestamp ) as tuva_last_run\nfrom tuva.input_layer.lab_result", "relation_name": "dev_tom.core._stg_clinical_lab_result"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.319993Z", "completed_at": "2024-08-23T19:21:32.322926Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.325825Z", "completed_at": "2024-08-23T19:21:32.325829Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.006829023361206055, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__lab_result_accession_number", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.result_date,cast('1900-01-01' as date)) as source_date\n    , 'LAB_RESULT' AS table_name\n    , 'Lab Result ID' as drill_down_key\n    , coalesce(lab_result_id, 'NULL') AS drill_down_value\n    , 'ACCESSION_NUMBER' AS field_name\n    , case when m.accession_number is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(accession_number as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.lab_result m", "relation_name": "dev_tom.data_quality.lab_result_accession_number"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.323111Z", "completed_at": "2024-08-23T19:21:32.328303Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.328676Z", "completed_at": "2024-08-23T19:21:32.328679Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.008893966674804688, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__lab_result_collection_date", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.result_date,cast('1900-01-01' as date)) as source_date\n    , 'LAB_RESULT' AS table_name\n    , 'Lab Result ID' as drill_down_key\n    , coalesce(lab_result_id, 'NULL') AS drill_down_value\n    , 'COLLECTION_DATE' AS field_name\n    , case\n        when m.collection_date > cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) then 'invalid'\n        when m.collection_date <= cast('1901-01-01' as date) then 'invalid'\n        when m.collection_date > m.result_date then 'invalid'\n        when m.collection_date is null then 'null'\n        else 'valid'\n    end as bucket_name\n    , case\n        when m.collection_date > cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) then 'future'\n        when m.collection_date <= cast('1901-01-01' as date) then 'too old'\n        when m.collection_date > m.result_date then 'Collection date after result date'\n        else null\n    end as invalid_reason\n    , cast(collection_date as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.lab_result m", "relation_name": "dev_tom.data_quality.lab_result_collection_date"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.326518Z", "completed_at": "2024-08-23T19:21:32.329312Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.331436Z", "completed_at": "2024-08-23T19:21:32.331439Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0058329105377197266, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__lab_result_data_source", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.result_date,cast('1900-01-01' as date)) as source_date\n    , 'LAB_RESULT' AS table_name\n    , 'Lab Result ID' as drill_down_key\n    , coalesce(lab_result_id, 'NULL') AS drill_down_value\n    , 'DATA_SOURCE' AS field_name\n    , case when m.data_source is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(data_source as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.lab_result m", "relation_name": "dev_tom.data_quality.lab_result_data_source"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.329482Z", "completed_at": "2024-08-23T19:21:32.332109Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.334248Z", "completed_at": "2024-08-23T19:21:32.334251Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.0058040618896484375, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__lab_result_encounter_id", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.result_date,cast('1900-01-01' as date)) as source_date\n    , 'LAB_RESULT' AS table_name\n    , 'Lab Result ID' as drill_down_key\n    , coalesce(lab_result_id, 'NULL') AS drill_down_value\n    , 'ENCOUNTER_ID' as field_name\n    , case when m.encounter_id is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(encounter_id as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.lab_result m", "relation_name": "dev_tom.data_quality.lab_result_encounter_id"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.332272Z", "completed_at": "2024-08-23T19:21:32.334907Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.337107Z", "completed_at": "2024-08-23T19:21:32.337110Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.0058858394622802734, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__lab_result_lab_result_id", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.result_date,cast('1900-01-01' as date)) as source_date\n    , 'LAB_RESULT' AS table_name\n    , 'Lab Result ID' as drill_down_key\n    , coalesce(lab_result_id, 'NULL') AS drill_down_value\n    , 'LAB_RESULT_ID' as field_name\n    , case when m.lab_result_id is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(lab_result_id as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.lab_result m", "relation_name": "dev_tom.data_quality.lab_result_lab_result_id"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.335076Z", "completed_at": "2024-08-23T19:21:32.337767Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.340739Z", "completed_at": "2024-08-23T19:21:32.340742Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0066869258880615234, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__lab_result_normalized_abnormal_flag", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.result_date,cast('1900-01-01' as date)) as source_date\n    , 'LAB_RESULT' AS table_name\n    , 'Lab Result ID' as drill_down_key\n    , coalesce(lab_result_id, 'NULL') AS drill_down_value\n    , 'NORMALIZED_ABNORMAL_FLAG' as field_name\n    , case when m.normalized_abnormal_flag is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(normalized_abnormal_flag as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.lab_result m", "relation_name": "dev_tom.data_quality.lab_result_normalized_abnormal_flag"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.337941Z", "completed_at": "2024-08-23T19:21:32.341398Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.343604Z", "completed_at": "2024-08-23T19:21:32.343608Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.006702899932861328, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__lab_result_normalized_description", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.result_date,cast('1900-01-01' as date)) as source_date\n    , 'LAB_RESULT' AS table_name\n    , 'Lab Result ID' as drill_down_key\n    , coalesce(lab_result_id, 'NULL') AS drill_down_value\n    , 'NORMALIZED_DESCRIPTION' AS field_name\n    , case when m.normalized_description is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(substring(normalized_description, 1, 255) as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.lab_result m", "relation_name": "dev_tom.data_quality.lab_result_normalized_description"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.341562Z", "completed_at": "2024-08-23T19:21:32.344272Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.346367Z", "completed_at": "2024-08-23T19:21:32.346370Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.00584101676940918, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__lab_result_normalized_reference_range_high", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.result_date,cast('1900-01-01' as date)) as source_date\n    , 'LAB_RESULT' AS table_name\n    , 'Lab Result ID' as drill_down_key\n    , coalesce(lab_result_id, 'NULL') AS drill_down_value\n    , 'NORMALIZED_REFERENCE_RANGE_HIGH' as field_name\n    , case when m.normalized_reference_range_high is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(normalized_reference_range_high as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.lab_result m", "relation_name": "dev_tom.data_quality.lab_result_normalized_reference_range_high"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.344438Z", "completed_at": "2024-08-23T19:21:32.348825Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.349212Z", "completed_at": "2024-08-23T19:21:32.349215Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.005831241607666016, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__lab_result_normalized_reference_range_low", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.result_date,cast('1900-01-01' as date)) as source_date\n    , 'LAB_RESULT' AS table_name\n    , 'Lab Result ID' as drill_down_key\n    , coalesce(lab_result_id, 'NULL') AS drill_down_value\n    , 'NORMALIZED_REFERENCE_RANGE_LOW' as field_name\n    , case when m.normalized_reference_range_low is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(normalized_reference_range_low as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.lab_result m", "relation_name": "dev_tom.data_quality.lab_result_normalized_reference_range_low"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.347049Z", "completed_at": "2024-08-23T19:21:32.349857Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.351972Z", "completed_at": "2024-08-23T19:21:32.351975Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.005798816680908203, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__lab_result_normalized_units", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.result_date,cast('1900-01-01' as date)) as source_date\n    , 'LAB_RESULT' AS table_name\n    , 'Lab Result ID' as drill_down_key\n    , coalesce(lab_result_id, 'NULL') AS drill_down_value\n    , 'NORMALIZED_UNITS' as field_name\n    , case when m.normalized_units is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(normalized_units as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.lab_result m", "relation_name": "dev_tom.data_quality.lab_result_normalized_units"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.350024Z", "completed_at": "2024-08-23T19:21:32.352629Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.354732Z", "completed_at": "2024-08-23T19:21:32.354735Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.005766153335571289, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__lab_result_patient_id", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.result_date,cast('1900-01-01' as date)) as source_date\n    , 'LAB_RESULT' AS table_name\n    , 'Lab Result ID' as drill_down_key\n    , coalesce(lab_result_id, 'NULL') AS drill_down_value\n    , 'PATIENT_ID' AS field_name\n    , case when m.patient_id is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(patient_id as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.lab_result m", "relation_name": "dev_tom.data_quality.lab_result_patient_id"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.352793Z", "completed_at": "2024-08-23T19:21:32.355386Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.358129Z", "completed_at": "2024-08-23T19:21:32.358132Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0063517093658447266, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__lab_result_result", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.result_date,cast('1900-01-01' as date)) as source_date\n    , 'LAB_RESULT' AS table_name\n    , 'Lab Result ID' as drill_down_key\n    , coalesce(lab_result_id, 'NULL') AS drill_down_value\n    , 'RESULT' AS field_name\n    , case when m.result is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(result as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.lab_result m", "relation_name": "dev_tom.data_quality.lab_result_result"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.355551Z", "completed_at": "2024-08-23T19:21:32.358782Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.360938Z", "completed_at": "2024-08-23T19:21:32.360941Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.006429910659790039, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__lab_result_result_date", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.result_date,cast('1900-01-01' as date)) as source_date\n    , 'LAB_RESULT' AS table_name\n    , 'Lab Result ID' as drill_down_key\n    , coalesce(lab_result_id, 'NULL') AS drill_down_value\n    , 'RESULT_DATE' as field_name\n    , case\n        when m.result_date > cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) then 'invalid'\n        when m.result_date <= cast('1901-01-01' as date) then 'invalid'\n        when m.result_date < m.collection_date then 'invalid'\n        when m.result_date is null then 'null'\n        else 'valid'\n    end as bucket_name\n    , case\n        when m.result_date > cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) then 'future'\n        when m.result_date <= cast('1901-01-01' as date) then 'too old'\n        when m.result_date < m.collection_date then 'Result date before collection date'\n        else null\n    end as invalid_reason\n    , cast(result_date as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.lab_result m", "relation_name": "dev_tom.data_quality.lab_result_result_date"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.358928Z", "completed_at": "2024-08-23T19:21:32.361582Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.363710Z", "completed_at": "2024-08-23T19:21:32.363713Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.005774021148681641, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__lab_result_source_abnormal_flag", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.result_date,cast('1900-01-01' as date)) as source_date\n    , 'LAB_RESULT' AS table_name\n    , 'Lab Result ID' as drill_down_key\n    , coalesce(lab_result_id, 'NULL') AS drill_down_value\n    , 'SOURCE_ABNORMAL_FLAG' AS field_name\n    , case when m.source_abnormal_flag is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(source_abnormal_flag as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.lab_result m", "relation_name": "dev_tom.data_quality.lab_result_source_abnormal_flag"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.361752Z", "completed_at": "2024-08-23T19:21:32.364367Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.367260Z", "completed_at": "2024-08-23T19:21:32.367263Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0065250396728515625, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__lab_result_source_code", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.result_date,cast('1900-01-01' as date)) as source_date\n    , 'LAB_RESULT' AS table_name\n    , 'Lab Result ID' as drill_down_key\n    , coalesce(lab_result_id, 'NULL') AS drill_down_value\n    , 'SOURCE_CODE' AS field_name\n    , case when m.source_code is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(source_code as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.lab_result m", "relation_name": "dev_tom.data_quality.lab_result_source_code"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.364528Z", "completed_at": "2024-08-23T19:21:32.367931Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.370109Z", "completed_at": "2024-08-23T19:21:32.370112Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.006610870361328125, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__lab_result_source_code_type", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.result_date,cast('1900-01-01' as date)) as source_date\n    , 'LAB_RESULT' AS table_name\n    , 'Lab Result ID' as drill_down_key\n    , coalesce(lab_result_id, 'NULL') AS drill_down_value\n    , 'SOURCE_CODE_TYPE' as field_name\n    , case when m.source_code_type is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(source_code_type as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.lab_result m", "relation_name": "dev_tom.data_quality.lab_result_source_code_type"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.368098Z", "completed_at": "2024-08-23T19:21:32.370757Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.372855Z", "completed_at": "2024-08-23T19:21:32.372858Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.0057871341705322266, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__lab_result_source_component", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.result_date,cast('1900-01-01' as date)) as source_date\n    , 'LAB_RESULT' AS table_name\n    , 'Lab Result ID' as drill_down_key\n    , coalesce(lab_result_id, 'NULL') AS drill_down_value\n    , 'SOURCE_COMPONENT' AS field_name\n    , case when m.source_component is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(source_component as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.lab_result m", "relation_name": "dev_tom.data_quality.lab_result_source_component"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.370919Z", "completed_at": "2024-08-23T19:21:32.373511Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.375590Z", "completed_at": "2024-08-23T19:21:32.375592Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.005697965621948242, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__lab_result_source_description", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.result_date,cast('1900-01-01' as date)) as source_date\n    , 'LAB_RESULT' AS table_name\n    , 'Lab Result ID' as drill_down_key\n    , coalesce(lab_result_id, 'NULL') AS drill_down_value\n    , 'SOURCE_DESCRIPTION' as field_name\n    , case when m.source_description is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(substring(source_description, 1, 255) as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.lab_result m", "relation_name": "dev_tom.data_quality.lab_result_source_description"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.373675Z", "completed_at": "2024-08-23T19:21:32.376236Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.378323Z", "completed_at": "2024-08-23T19:21:32.378326Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.0056760311126708984, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__lab_result_source_reference_range_high", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.result_date,cast('1900-01-01' as date)) as source_date\n    , 'LAB_RESULT' AS table_name\n    , 'Lab Result ID' as drill_down_key\n    , coalesce(lab_result_id, 'NULL') AS drill_down_value\n    , 'SOURCE_REFERENCE_RANGE_HIGH' AS field_name\n    , case when m.source_reference_range_high is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(source_reference_range_high as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.lab_result m", "relation_name": "dev_tom.data_quality.lab_result_source_reference_range_high"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.376381Z", "completed_at": "2024-08-23T19:21:32.378982Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.381080Z", "completed_at": "2024-08-23T19:21:32.381083Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.005685091018676758, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__lab_result_source_reference_range_low", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.result_date,cast('1900-01-01' as date)) as source_date\n    , 'LAB_RESULT' AS table_name\n    , 'Lab Result ID' as drill_down_key\n    , coalesce(lab_result_id, 'NULL') AS drill_down_value\n    , 'SOURCE_REFERENCE_RANGE_LOW' AS field_name\n    , case when m.source_reference_range_low is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(source_reference_range_low as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.lab_result m", "relation_name": "dev_tom.data_quality.lab_result_source_reference_range_low"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.379135Z", "completed_at": "2024-08-23T19:21:32.381731Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.383791Z", "completed_at": "2024-08-23T19:21:32.383794Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.005658864974975586, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__lab_result_source_units", "compiled": true, "compiled_code": "\n\n\nSELECT\n    m.data_source\n    ,coalesce(m.result_date,cast('1900-01-01' as date)) as source_date\n    ,'LAB_RESULT' AS table_name\n    ,'Lab Result ID' as drill_down_key\n    , coalesce(lab_result_id, 'NULL') AS drill_down_value\n    ,'SOURCE_UNITS' AS field_name\n    ,case when m.source_units is not null then 'valid' else 'null' end as bucket_name\n    ,cast(null as TEXT) as invalid_reason\n    ,cast(source_units as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.lab_result m", "relation_name": "dev_tom.data_quality.lab_result_source_units"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.381888Z", "completed_at": "2024-08-23T19:21:32.384450Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.386565Z", "completed_at": "2024-08-23T19:21:32.386568Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.005697011947631836, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__lab_result_specimen", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.result_date,cast('1900-01-01' as date)) as source_date\n    , 'LAB_RESULT' AS table_name\n    , 'Lab Result ID' as drill_down_key\n    , coalesce(lab_result_id, 'NULL') AS drill_down_value\n    , 'SPECIMEN' as field_name\n    , case when m.specimen is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(specimen as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.lab_result m", "relation_name": "dev_tom.data_quality.lab_result_specimen"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.384597Z", "completed_at": "2024-08-23T19:21:32.387219Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.392301Z", "completed_at": "2024-08-23T19:21:32.392304Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.008700132369995117, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__lab_result_status", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.result_date,cast('1900-01-01' as date)) as source_date\n    , 'LAB_RESULT' AS table_name\n    , 'Lab Result ID' as drill_down_key\n    , coalesce(lab_result_id, 'NULL') AS drill_down_value\n    , 'STATUS' as field_name\n    , case when m.status is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(status as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.lab_result m", "relation_name": "dev_tom.data_quality.lab_result_status"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.387378Z", "completed_at": "2024-08-23T19:21:32.392959Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.395074Z", "completed_at": "2024-08-23T19:21:32.395077Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.008717060089111328, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.core__stg_clinical_medication", "compiled": true, "compiled_code": "\n\nselect\n    cast(medication_id as TEXT ) as medication_id\n    , cast(patient_id as TEXT ) as patient_id\n    , cast(encounter_id as TEXT ) as encounter_id\n    , try_cast( dispensing_date as date ) as dispensing_date\n    , try_cast( prescribing_date as date ) as prescribing_date\n    , cast(source_code_type as TEXT ) as source_code_type\n    , cast(source_code as TEXT ) as source_code\n    , cast(source_description as TEXT ) as source_description\n    , cast(ndc_code as TEXT ) as ndc_code\n    , cast(ndc_description as TEXT ) as ndc_description\n    , cast(rxnorm_code as TEXT ) as rxnorm_code\n    , cast(rxnorm_description as TEXT ) as rxnorm_description \n    , cast(atc_code as TEXT ) as atc_code\n    , cast(atc_description as TEXT ) as atc_description\n    , cast(route as TEXT ) as route\n    , cast(strength as TEXT ) as strength\n    , cast(quantity as integer ) as quantity\n    , cast(quantity_unit as TEXT ) as quantity_unit\n    , cast(days_supply as integer ) as days_supply\n    , cast(practitioner_id as TEXT ) as practitioner_id\n    , cast(data_source as TEXT ) as data_source\n    , cast('2024-08-23 19:21:27.787896+00:00' as timestamp ) as tuva_last_run\nfrom tuva.input_layer.medication", "relation_name": "dev_tom.core._stg_clinical_medication"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.393123Z", "completed_at": "2024-08-23T19:21:32.395716Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.397917Z", "completed_at": "2024-08-23T19:21:32.397920Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.005844831466674805, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__medication_atc_description", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.dispensing_date,cast('1900-01-01' as date)) as source_date\n    , 'MEDICATION' AS table_name\n    , 'Medication ID' as drill_down_key\n    , coalesce(medication_id, 'NULL') AS drill_down_value\n    , 'ATC_DESCRIPTION' as field_name\n    , case when m.atc_description is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(substring(atc_description, 1, 255) as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.medication m", "relation_name": "dev_tom.data_quality.medication_atc_description"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.395899Z", "completed_at": "2024-08-23T19:21:32.398614Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.400700Z", "completed_at": "2024-08-23T19:21:32.400703Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.005836963653564453, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__medication_data_source", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.dispensing_date,cast('1900-01-01' as date)) as source_date\n    , 'MEDICATION' AS table_name\n    , 'Medication ID' as drill_down_key\n    , coalesce(medication_id, 'NULL') AS drill_down_value\n    , 'DATA_SOURCE' AS field_name\n    , case when m.data_source is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(data_source as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.medication m", "relation_name": "dev_tom.data_quality.medication_data_source"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.398763Z", "completed_at": "2024-08-23T19:21:32.401365Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.404140Z", "completed_at": "2024-08-23T19:21:32.404143Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.006443977355957031, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__medication_days_supply", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.dispensing_date,cast('1900-01-01' as date)) as source_date\n    , 'MEDICATION' AS table_name\n    , 'Medication ID' as drill_down_key\n    , coalesce(medication_id, 'NULL') AS drill_down_value\n    , 'DAYS_SUPPLY' AS field_name\n    , case when m.days_supply is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(days_supply as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.medication m", "relation_name": "dev_tom.data_quality.medication_days_supply"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.401533Z", "completed_at": "2024-08-23T19:21:32.404815Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.406980Z", "completed_at": "2024-08-23T19:21:32.406983Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.006493806838989258, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__medication_dispensing_date", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.dispensing_date,cast('1900-01-01' as date)) as source_date\n    , 'MEDICATION' AS table_name\n    , 'Medication ID' as drill_down_key\n    , coalesce(medication_id, 'NULL') AS drill_down_value\n    , 'DISPENSING_DATE' as field_name\n    , case\n        when m.dispensing_date > cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) then 'invalid'\n        when m.dispensing_date <= cast('1901-01-01' as date) then 'invalid'\n        when m.dispensing_date < m.prescribing_date then 'invalid'\n        when m.dispensing_date is null then 'null'\n        else 'valid'\n    end as bucket_name\n    , case\n        when m.dispensing_date > cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) then 'future'\n        when m.dispensing_date <= cast('1901-01-01' as date) then 'too old'\n        when m.dispensing_date < m.prescribing_date then 'Dispensing date before prescribing date'\n        else null\n    end as invalid_reason\n    , cast(dispensing_date as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.medication m", "relation_name": "dev_tom.data_quality.medication_dispensing_date"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.404983Z", "completed_at": "2024-08-23T19:21:32.407626Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.409718Z", "completed_at": "2024-08-23T19:21:32.409720Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.00580286979675293, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__medication_encounter_id", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.dispensing_date,cast('1900-01-01' as date)) as source_date\n    , 'MEDICATION' AS table_name\n    , 'Medication ID' as drill_down_key\n    , coalesce(medication_id, 'NULL') AS drill_down_value\n    , 'ENCOUNTER_ID' as field_name\n    , case when m.encounter_id is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(encounter_id as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.medication m", "relation_name": "dev_tom.data_quality.medication_encounter_id"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.407793Z", "completed_at": "2024-08-23T19:21:32.410361Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.412504Z", "completed_at": "2024-08-23T19:21:32.412507Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.005735158920288086, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__medication_medication_id", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.dispensing_date,cast('1900-01-01' as date)) as source_date\n    , 'MEDICATION' AS table_name\n    , 'Medication ID' as drill_down_key\n    , coalesce(medication_id, 'NULL') AS drill_down_value\n    , 'MEDICATION_ID' AS field_name\n    , case when m.medication_id is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(medication_id as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.medication m", "relation_name": "dev_tom.data_quality.medication_medication_id"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.410523Z", "completed_at": "2024-08-23T19:21:32.415036Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.415419Z", "completed_at": "2024-08-23T19:21:32.415422Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.005915164947509766, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__medication_ndc_code", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.dispensing_date,cast('1900-01-01' as date)) as source_date\n    , 'MEDICATION' AS table_name\n    , 'Medication ID' as drill_down_key\n    , coalesce(medication_id, 'NULL') AS drill_down_value\n    , 'NDC_CODE' as field_name\n    , case when m.ndc_code is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(ndc_code as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.medication m", "relation_name": "dev_tom.data_quality.medication_ndc_code"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.413188Z", "completed_at": "2024-08-23T19:21:32.416055Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.418997Z", "completed_at": "2024-08-23T19:21:32.419000Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.006683826446533203, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__medication_patient_id", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.dispensing_date,cast('1900-01-01' as date)) as source_date\n    , 'MEDICATION' AS table_name\n    , 'Medication ID' as drill_down_key\n    , coalesce(medication_id, 'NULL') AS drill_down_value\n    , 'PATIENT_ID' as field_name\n    , case when m.patient_id is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(patient_id as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.medication m", "relation_name": "dev_tom.data_quality.medication_patient_id"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.416215Z", "completed_at": "2024-08-23T19:21:32.419637Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.422388Z", "completed_at": "2024-08-23T19:21:32.422391Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.00722193717956543, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__medication_practitioner_id", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.dispensing_date,cast('1900-01-01' as date)) as source_date\n    , 'MEDICATION' AS table_name\n    , 'Medication ID' as drill_down_key\n    , coalesce(medication_id, 'NULL') AS drill_down_value\n    , 'PRACTITIONER_ID' as field_name\n    , case when m.practitioner_id is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(practitioner_id as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.medication m", "relation_name": "dev_tom.data_quality.medication_practitioner_id"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.419797Z", "completed_at": "2024-08-23T19:21:32.423056Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.425172Z", "completed_at": "2024-08-23T19:21:32.425175Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.006368875503540039, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__medication_prescribing_date", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.dispensing_date,cast('1900-01-01' as date)) as source_date\n    , 'MEDICATION' AS table_name\n    , 'Medication ID' as drill_down_key\n    , coalesce(medication_id, 'NULL') AS drill_down_value\n    , 'PRESCRIBING_DATE' as field_name\n    , case\n        when m.prescribing_date > cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) then 'invalid'\n        when m.prescribing_date <= cast('1901-01-01' as date) then 'invalid'\n        when m.prescribing_date > m.dispensing_date then 'invalid'\n        when m.prescribing_date is null then 'null'\n        else 'valid'\n    end as bucket_name\n    , case\n        when m.prescribing_date > cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) then 'future'\n        when m.prescribing_date <= cast('1901-01-01' as date) then 'too old'\n        when m.prescribing_date > m.dispensing_date then 'Prescribing date after dispensing date'\n        else null\n    end as invalid_reason\n    , cast(prescribing_date as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.medication m", "relation_name": "dev_tom.data_quality.medication_prescribing_date"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.423204Z", "completed_at": "2024-08-23T19:21:32.425822Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.427905Z", "completed_at": "2024-08-23T19:21:32.427908Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.005731105804443359, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__medication_quantity", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.dispensing_date,cast('1900-01-01' as date)) as source_date\n    , 'MEDICATION' AS table_name\n    , 'Medication ID' as drill_down_key\n    , coalesce(medication_id, 'NULL') AS drill_down_value\n    , 'QUANTITY' as field_name\n    , case when m.quantity is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(quantity as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.medication m", "relation_name": "dev_tom.data_quality.medication_quantity"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.425985Z", "completed_at": "2024-08-23T19:21:32.428542Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.430720Z", "completed_at": "2024-08-23T19:21:32.430723Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0057408809661865234, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__medication_quantity_unit", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.dispensing_date,cast('1900-01-01' as date)) as source_date\n    , 'MEDICATION' AS table_name\n    , 'Medication ID' as drill_down_key\n    , coalesce(medication_id, 'NULL') AS drill_down_value\n    , 'QUANTITY_UNIT' as field_name\n    , case when m.quantity_unit is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(quantity_unit as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.medication m", "relation_name": "dev_tom.data_quality.medication_quantity_unit"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.428712Z", "completed_at": "2024-08-23T19:21:32.431366Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.433564Z", "completed_at": "2024-08-23T19:21:32.433567Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.005868196487426758, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__medication_route", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.dispensing_date,cast('1900-01-01' as date)) as source_date\n    , 'MEDICATION' AS table_name\n    , 'Medication ID' as drill_down_key\n    , coalesce(medication_id, 'NULL') AS drill_down_value\n    , 'ROUTE' as field_name\n    , case when m.route is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(route as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.medication m", "relation_name": "dev_tom.data_quality.medication_route"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.431529Z", "completed_at": "2024-08-23T19:21:32.434207Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.436319Z", "completed_at": "2024-08-23T19:21:32.436321Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.005815029144287109, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__medication_rxnorm_description", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.dispensing_date,cast('1900-01-01' as date)) as source_date\n    , 'MEDICATION' AS table_name\n    , 'Medication ID' as drill_down_key\n    , coalesce(medication_id, 'NULL') AS drill_down_value\n    , 'RXNORM_DESCRIPTION' as field_name\n    , case when m.rxnorm_description is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(substring(rxnorm_description, 1, 255) as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.medication m", "relation_name": "dev_tom.data_quality.medication_rxnorm_description"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.434374Z", "completed_at": "2024-08-23T19:21:32.436957Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.439048Z", "completed_at": "2024-08-23T19:21:32.439051Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.005694866180419922, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__medication_source_code", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.dispensing_date,cast('1900-01-01' as date)) as source_date\n    , 'MEDICATION' AS table_name\n    , 'Medication ID' as drill_down_key\n    , coalesce(medication_id, 'NULL') AS drill_down_value\n    , 'SOURCE_CODE' as field_name\n    , case when m.source_code is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(source_code as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.medication m", "relation_name": "dev_tom.data_quality.medication_source_code"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.437116Z", "completed_at": "2024-08-23T19:21:32.439713Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.441873Z", "completed_at": "2024-08-23T19:21:32.441876Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.0057659149169921875, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__medication_source_code_type", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.dispensing_date,cast('1900-01-01' as date)) as source_date\n    , 'MEDICATION' AS table_name\n    , 'Medication ID' as drill_down_key\n    , coalesce(medication_id, 'NULL') AS drill_down_value\n    , 'SOURCE_CODE_TYPE' as field_name\n    , case when m.source_code_type is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(source_code_type as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.medication m", "relation_name": "dev_tom.data_quality.medication_source_code_type"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.439881Z", "completed_at": "2024-08-23T19:21:32.442531Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.445462Z", "completed_at": "2024-08-23T19:21:32.445465Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.006637096405029297, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__medication_source_description", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.dispensing_date,cast('1900-01-01' as date)) as source_date\n    , 'MEDICATION' AS table_name\n    , 'Medication ID' as drill_down_key\n    , coalesce(medication_id, 'NULL') AS drill_down_value\n    , 'SOURCE_DESCRIPTION' as field_name\n    , case when m.source_description is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(substring(source_description, 1, 255) as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.medication m", "relation_name": "dev_tom.data_quality.medication_source_description"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.442679Z", "completed_at": "2024-08-23T19:21:32.449862Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.450236Z", "completed_at": "2024-08-23T19:21:32.450239Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.008574962615966797, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__medication_strength", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.dispensing_date,cast('1900-01-01' as date)) as source_date\n    , 'MEDICATION' AS table_name\n    , 'Medication ID' as drill_down_key\n    , coalesce(medication_id, 'NULL') AS drill_down_value\n    , 'STRENGTH' as field_name\n    , case when m.strength is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(strength as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.medication m", "relation_name": "dev_tom.data_quality.medication_strength"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.446103Z", "completed_at": "2024-08-23T19:21:32.450846Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.453108Z", "completed_at": "2024-08-23T19:21:32.453112Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.007863759994506836, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.core__stg_clinical_observation", "compiled": true, "compiled_code": "\n\n\nselect\n    cast(observation_id as TEXT ) as observation_id\n    , cast(patient_id as TEXT ) as patient_id\n    , cast(encounter_id as TEXT ) as encounter_id\n    , cast(panel_id as TEXT ) as panel_id\n    , try_cast( observation_date as date ) as observation_date\n    , cast(observation_type as TEXT ) as observation_type\n    , cast(source_code_type as TEXT ) as source_code_type\n    , cast(source_code as TEXT ) as source_code\n    , cast(source_description as TEXT ) as source_description\n    , cast(normalized_code_type as TEXT ) as normalized_code_type\n    , cast(normalized_code as TEXT ) as normalized_code\n    , cast(normalized_description as TEXT ) as normalized_description\n    , cast(result as TEXT ) as result\n    , cast(source_units as TEXT ) as source_units\n    , cast(normalized_units as TEXT ) as normalized_units\n    , cast(source_reference_range_low as TEXT ) as source_reference_range_low\n    , cast(source_reference_range_high as TEXT ) as source_reference_range_high\n    , cast(normalized_reference_range_low as TEXT ) as normalized_reference_range_low\n    , cast(normalized_reference_range_high as TEXT ) as normalized_reference_range_high\n    , cast(data_source as TEXT ) as data_source\n    , cast('2024-08-23 19:21:27.787896+00:00' as timestamp ) as tuva_last_run\nfrom tuva.input_layer.observation", "relation_name": "dev_tom.core._stg_clinical_observation"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.451018Z", "completed_at": "2024-08-23T19:21:32.453787Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.455962Z", "completed_at": "2024-08-23T19:21:32.455965Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.005964756011962891, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__observation_data_source", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.observation_date,cast('1900-01-01' as date)) as source_date\n    , 'OBSERVATION' AS table_name\n    , 'Observation ID' as drill_down_key\n    , coalesce(observation_id, 'NULL') AS drill_down_value\n    , 'DATA_SOURCE' as field_name\n    , case when m.data_source is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(data_source as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.observation m", "relation_name": "dev_tom.data_quality.observation_data_source"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.453986Z", "completed_at": "2024-08-23T19:21:32.458404Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.458787Z", "completed_at": "2024-08-23T19:21:32.458790Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.005876064300537109, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__observation_encounter_id", "compiled": true, "compiled_code": "\n\nSELECT\n    m.data_source\n    ,coalesce(m.observation_date,cast('1900-01-01' as date)) as source_date\n    ,'OBSERVATION' AS table_name\n    ,'Observation ID' as drill_down_key\n    , coalesce(observation_id, 'NULL') AS drill_down_value\n    ,'ENCOUNTER_ID' as field_name\n    ,case when m.encounter_id is not null then 'valid' else 'null' end as bucket_name\n    ,cast(null as TEXT) as invalid_reason\n    ,cast(encounter_id as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.observation m", "relation_name": "dev_tom.data_quality.observation_encounter_id"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.456656Z", "completed_at": "2024-08-23T19:21:32.459420Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.461559Z", "completed_at": "2024-08-23T19:21:32.461562Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.005807161331176758, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__observation_normalized_code", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.observation_date,cast('1900-01-01' as date)) as source_date\n    , 'OBSERVATION' AS table_name\n    , 'Observation ID' as drill_down_key\n    , coalesce(observation_id, 'NULL') AS drill_down_value\n    , 'NORMALIZED_CODE' as field_name\n    , case when m.normalized_code is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(normalized_code as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.observation m", "relation_name": "dev_tom.data_quality.observation_normalized_code"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.459596Z", "completed_at": "2024-08-23T19:21:32.462217Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.464305Z", "completed_at": "2024-08-23T19:21:32.464308Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.005764007568359375, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__observation_normalized_code_type", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.observation_date,cast('1900-01-01' as date)) as source_date\n    , 'OBSERVATION' AS table_name\n    , 'Observation ID' as drill_down_key\n    , coalesce(observation_id, 'NULL') AS drill_down_value\n    , 'NORMALIZED_CODE_TYPE' AS field_name\n    , case when m.normalized_code_type is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(normalized_code_type as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.observation m", "relation_name": "dev_tom.data_quality.observation_normalized_code_type"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.462384Z", "completed_at": "2024-08-23T19:21:32.464955Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.467030Z", "completed_at": "2024-08-23T19:21:32.467032Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.005682945251464844, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__observation_normalized_description", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.observation_date,cast('1900-01-01' as date)) as source_date\n    , 'OBSERVATION' AS table_name\n    , 'Observation ID' as drill_down_key\n    , coalesce(observation_id, 'NULL') AS drill_down_value\n    , 'NORMALIZED_DESCRIPTION' as field_name\n    , case when m.normalized_description is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(substring(normalized_description, 1, 255) as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.observation m", "relation_name": "dev_tom.data_quality.observation_normalized_description"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.465118Z", "completed_at": "2024-08-23T19:21:32.470215Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.470621Z", "completed_at": "2024-08-23T19:21:32.470624Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.00651097297668457, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__observation_normalized_reference_range_high", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.observation_date,cast('1900-01-01' as date)) as source_date\n    , 'OBSERVATION' AS table_name\n    , 'Observation ID' as drill_down_key\n    , coalesce(observation_id, 'NULL') AS drill_down_value\n    , 'NORMALIZED_REFERENCE_RANGE_HIGH' as field_name\n    , case when m.normalized_reference_range_high is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(normalized_reference_range_high as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.observation m", "relation_name": "dev_tom.data_quality.observation_normalized_reference_range_high"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.467706Z", "completed_at": "2024-08-23T19:21:32.471235Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.473381Z", "completed_at": "2024-08-23T19:21:32.473384Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.006561756134033203, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__observation_normalized_reference_range_low", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.observation_date,cast('1900-01-01' as date)) as source_date\n    , 'OBSERVATION' AS table_name\n    , 'Observation ID' as drill_down_key\n    , coalesce(observation_id, 'NULL') AS drill_down_value\n    , 'NORMALIZED_REFERENCE_RANGE_LOW' AS field_name\n    , case when m.normalized_reference_range_low is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(normalized_reference_range_low as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.observation m", "relation_name": "dev_tom.data_quality.observation_normalized_reference_range_low"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.471413Z", "completed_at": "2024-08-23T19:21:32.474030Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.476755Z", "completed_at": "2024-08-23T19:21:32.476757Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.006389141082763672, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__observation_normalized_units", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.observation_date,cast('1900-01-01' as date)) as source_date\n    , 'OBSERVATION' AS table_name\n    , 'Observation ID' as drill_down_key\n    , coalesce(observation_id, 'NULL') AS drill_down_value\n    , 'NORMALIZED_UNITS' as field_name\n    , case when m.normalized_units is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(normalized_units as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.observation m", "relation_name": "dev_tom.data_quality.observation_normalized_units"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.474206Z", "completed_at": "2024-08-23T19:21:32.479269Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.479649Z", "completed_at": "2024-08-23T19:21:32.479652Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.006484031677246094, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__observation_observation_date", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.observation_date,cast('1900-01-01' as date)) as source_date\n    , 'OBSERVATION' AS table_name\n    , 'Observation ID' as drill_down_key\n    , coalesce(observation_id, 'NULL') AS drill_down_value\n    , 'OBSERVATION_DATE' as field_name\n    , case\n        when m.observation_date > cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) then 'invalid'\n        when m.observation_date <= cast('1901-01-01' as date) then 'invalid'\n        when m.observation_date is null then 'null'\n        else 'valid'\n    end as bucket_name\n    , case\n        when m.observation_date > cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) then 'future'\n        when m.observation_date <= cast('1901-01-01' as date) then 'too old'\n        else null\n    end as invalid_reason\n    , cast(observation_date as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.observation m", "relation_name": "dev_tom.data_quality.observation_observation_date"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.477435Z", "completed_at": "2024-08-23T19:21:32.480081Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.482222Z", "completed_at": "2024-08-23T19:21:32.482225Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.005684852600097656, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__observation_observation_id", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.observation_date,cast('1900-01-01' as date)) as source_date\n    , 'OBSERVATION' AS table_name\n    , 'Observation ID' as drill_down_key\n    , coalesce(observation_id, 'NULL') AS drill_down_value\n    , 'OBSERVATION_ID' as field_name\n    , case when m.observation_id is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(observation_id as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.observation m", "relation_name": "dev_tom.data_quality.observation_observation_id"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.480466Z", "completed_at": "2024-08-23T19:21:32.483060Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.485209Z", "completed_at": "2024-08-23T19:21:32.485213Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.005815982818603516, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__observation_observation_type", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.observation_date,cast('1900-01-01' as date)) as source_date\n    , 'OBSERVATION' AS table_name\n    , 'Observation ID' as drill_down_key\n    , coalesce(observation_id, 'NULL') AS drill_down_value\n    , 'OBSERVATION_TYPE' as field_name\n    , case when m.observation_type is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(observation_type as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.observation m", "relation_name": "dev_tom.data_quality.observation_observation_type"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.483403Z", "completed_at": "2024-08-23T19:21:32.487878Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.488247Z", "completed_at": "2024-08-23T19:21:32.488249Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.005794048309326172, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__observation_panel_id", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.observation_date,cast('1900-01-01' as date)) as source_date\n    , 'OBSERVATION' AS table_name\n    , 'Observation ID' as drill_down_key\n    , coalesce(observation_id, 'NULL') AS drill_down_value\n    , 'PANEL_ID' as field_name\n    , case when m.panel_id is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(panel_id as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.observation m", "relation_name": "dev_tom.data_quality.observation_panel_id"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.485902Z", "completed_at": "2024-08-23T19:21:32.490249Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.490633Z", "completed_at": "2024-08-23T19:21:32.490636Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.00744318962097168, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__observation_patient_id", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.observation_date,cast('1900-01-01' as date)) as source_date\n    , 'OBSERVATION' AS table_name\n    , 'Observation ID' as drill_down_key\n    , coalesce(observation_id, 'NULL') AS drill_down_value\n    , 'PATIENT_ID' as field_name\n    , case when m.patient_id is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(patient_id as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.observation m", "relation_name": "dev_tom.data_quality.observation_patient_id"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.488515Z", "completed_at": "2024-08-23T19:21:32.491267Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.491767Z", "completed_at": "2024-08-23T19:21:32.491769Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.004083871841430664, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__observation_result", "compiled": true, "compiled_code": "\n\n\nSELECT\n    m.data_source\n    ,coalesce(m.observation_date,cast('1900-01-01' as date)) as source_date\n    ,'OBSERVATION' AS table_name\n    ,'Observation ID' as drill_down_key\n    , coalesce(observation_id, 'NULL') AS drill_down_value\n    ,'RESULT' as field_name\n    ,case when m.result is not null then 'valid' else 'null' end as bucket_name\n    ,cast(null as TEXT) as invalid_reason\n    ,cast(substring(result, 1, 255) as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.observation m", "relation_name": "dev_tom.data_quality.observation_result"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.492012Z", "completed_at": "2024-08-23T19:21:32.496927Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.497303Z", "completed_at": "2024-08-23T19:21:32.497306Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.006416797637939453, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__observation_source_code", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.observation_date,cast('1900-01-01' as date)) as source_date\n    , 'OBSERVATION' AS table_name\n    , 'Observation ID' as drill_down_key\n    , coalesce(observation_id, 'NULL') AS drill_down_value\n    , 'SOURCE_CODE' as field_name\n    , case when m.source_code is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(source_code as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.observation m", "relation_name": "dev_tom.data_quality.observation_source_code"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.494146Z", "completed_at": "2024-08-23T19:21:32.499372Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.499767Z", "completed_at": "2024-08-23T19:21:32.499770Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.008201122283935547, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__observation_source_code_type", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.observation_date,cast('1900-01-01' as date)) as source_date\n    , 'OBSERVATION' AS table_name\n    , 'Observation ID' as drill_down_key\n    , coalesce(observation_id, 'NULL') AS drill_down_value\n    , 'SOURCE_CODE_TYPE' as field_name\n    , case when m.source_code_type is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(source_code_type as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.observation m", "relation_name": "dev_tom.data_quality.observation_source_code_type"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.497575Z", "completed_at": "2024-08-23T19:21:32.500403Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.500906Z", "completed_at": "2024-08-23T19:21:32.500908Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.004168987274169922, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__observation_source_description", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.observation_date,cast('1900-01-01' as date)) as source_date\n    , 'OBSERVATION' AS table_name\n    , 'Observation ID' as drill_down_key\n    , coalesce(observation_id, 'NULL') AS drill_down_value\n    , 'SOURCE_DESCRIPTION' as field_name\n    , case when m.source_description is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(substring(source_description, 1, 255) as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.observation m", "relation_name": "dev_tom.data_quality.observation_source_description"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.501149Z", "completed_at": "2024-08-23T19:21:32.505307Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.505859Z", "completed_at": "2024-08-23T19:21:32.505862Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.005846977233886719, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__observation_source_reference_range_high", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.observation_date,cast('1900-01-01' as date)) as source_date\n    , 'OBSERVATION' AS table_name\n    , 'Observation ID' as drill_down_key\n    , coalesce(observation_id, 'NULL') AS drill_down_value\n    , 'SOURCE_REFERENCE_RANGE_HIGH' as field_name\n    , case when m.source_reference_range_high is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(source_reference_range_high as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.observation m", "relation_name": "dev_tom.data_quality.observation_source_reference_range_high"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.503322Z", "completed_at": "2024-08-23T19:21:32.505647Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.507908Z", "completed_at": "2024-08-23T19:21:32.507911Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.007205009460449219, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__observation_source_reference_range_low", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.observation_date,cast('1900-01-01' as date)) as source_date\n    , 'OBSERVATION' AS table_name\n    , 'Observation ID' as drill_down_key\n    , coalesce(observation_id, 'NULL') AS drill_down_value\n    , 'SOURCE_REFERENCE_RANGE_LOW' as field_name\n    , case when m.source_reference_range_low is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(source_reference_range_low as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.observation m", "relation_name": "dev_tom.data_quality.observation_source_reference_range_low"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.506152Z", "completed_at": "2024-08-23T19:21:32.508963Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.509970Z", "completed_at": "2024-08-23T19:21:32.509973Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0048980712890625, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__observation_source_units", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.observation_date,cast('1900-01-01' as date)) as source_date\n    , 'OBSERVATION' AS TABLE_NAME\n    , 'Observation ID' as drill_down_key\n    , coalesce(observation_id, 'NULL') AS drill_down_value\n    , 'SOURCE_UNITS' as field_name\n    , case when m.source_units is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(source_units as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.observation m", "relation_name": "dev_tom.data_quality.observation_source_units"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.510230Z", "completed_at": "2024-08-23T19:21:32.516244Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.517047Z", "completed_at": "2024-08-23T19:21:32.517051Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.008473873138427734, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.core__stg_clinical_practitioner", "compiled": true, "compiled_code": "\n\nselect\n    cast(practitioner_id as TEXT ) as practitioner_id\n    , cast(npi as TEXT ) as npi\n    , cast(first_name as TEXT ) as first_name\n    , cast(last_name as TEXT ) as last_name\n    , cast(practice_affiliation as TEXT ) as practice_affiliation\n    , cast(specialty as TEXT ) as specialty\n    , cast(sub_specialty as TEXT ) as sub_specialty\n    , cast(data_source as TEXT ) as data_source\n    , cast('2024-08-23 19:21:27.787896+00:00' as timestamp ) as tuva_last_run\nfrom tuva.input_layer.practitioner", "relation_name": "dev_tom.core._stg_clinical_practitioner"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.513620Z", "completed_at": "2024-08-23T19:21:32.516732Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.517515Z", "completed_at": "2024-08-23T19:21:32.517519Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.008753776550292969, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__practitioner_data_source", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    \n        , cast(coalesce(convert_timezone('UTC', current_timestamp()), cast('1900-01-01' as date)) as date) as source_date\n    \n    , 'PRACTITIONER' AS table_name\n    , 'Practitioner ID' as drill_down_key\n    , coalesce(practitioner_id, 'NULL') AS drill_down_value\n    , 'DATA_SOURCE' as field_name\n    , case when m.data_source is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(data_source as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.practitioner m", "relation_name": "dev_tom.data_quality.practitioner_data_source"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.517987Z", "completed_at": "2024-08-23T19:21:32.521185Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.523749Z", "completed_at": "2024-08-23T19:21:32.523753Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.007386922836303711, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__practitioner_first_name", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    \n        , cast(coalesce(convert_timezone('UTC', current_timestamp()), cast('1900-01-01' as date)) as date) as source_date\n    \n    , 'PRACTITIONER' AS table_name\n    , 'Practitioner ID' as drill_down_key\n    , coalesce(practitioner_id, 'NULL') AS drill_down_value\n    , 'FIRST_NAME' as field_name\n    , case when m.first_name is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(first_name as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.practitioner m", "relation_name": "dev_tom.data_quality.practitioner_first_name"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.521531Z", "completed_at": "2024-08-23T19:21:32.527443Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.527780Z", "completed_at": "2024-08-23T19:21:32.527783Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.007300853729248047, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__practitioner_last_name", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    \n        , cast(coalesce(convert_timezone('UTC', current_timestamp()), cast('1900-01-01' as date)) as date) as source_date\n    \n    , 'PRACTITIONER' AS table_name\n    , 'Practitioner ID' as drill_down_key\n    , coalesce(practitioner_id, 'NULL') AS drill_down_value\n    , 'LAST_NAME' as field_name\n    , case when m.last_name is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(last_name as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.practitioner m", "relation_name": "dev_tom.data_quality.practitioner_last_name"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.524025Z", "completed_at": "2024-08-23T19:21:32.528055Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.530544Z", "completed_at": "2024-08-23T19:21:32.530547Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.009798049926757812, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__practitioner_practice_affiliation", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    \n        , cast(coalesce(convert_timezone('UTC', current_timestamp()), cast('1900-01-01' as date)) as date) as source_date\n    \n    , 'PRACTITIONER' AS table_name\n    , 'Practitioner ID' as drill_down_key\n    , coalesce(practitioner_id, 'NULL') AS drill_down_value\n    , 'PRACTICE_AFFILIATION' AS field_name\n    , case when m.practice_affiliation is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(practice_affiliation as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.practitioner m", "relation_name": "dev_tom.data_quality.practitioner_practice_affiliation"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.528200Z", "completed_at": "2024-08-23T19:21:32.531254Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.531733Z", "completed_at": "2024-08-23T19:21:32.531737Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.004559993743896484, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__practitioner_practitioner_id", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    \n        , cast(coalesce(convert_timezone('UTC', current_timestamp()), cast('1900-01-01' as date)) as date) as source_date\n    \n    , 'PRACTITIONER' AS table_name\n    , 'Practitioner ID' as drill_down_key\n    , coalesce(practitioner_id, 'NULL') AS drill_down_value\n    , 'PRACTITIONER_ID' as field_name\n    , case when m.practitioner_id is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(practitioner_id as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.practitioner m", "relation_name": "dev_tom.data_quality.practitioner_practitioner_id"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.532082Z", "completed_at": "2024-08-23T19:21:32.537034Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.537369Z", "completed_at": "2024-08-23T19:21:32.537372Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.006537914276123047, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__practitioner_specialty", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    \n        , cast(coalesce(convert_timezone('UTC', current_timestamp()), cast('1900-01-01' as date)) as date) as source_date\n    \n    , 'PRACTITIONER' AS table_name\n    , 'Practitioner ID' as drill_down_key\n    , coalesce(practitioner_id, 'NULL') AS drill_down_value\n    , 'SPECIALTY' as field_name\n    , case when m.specialty is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(specialty as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.practitioner m", "relation_name": "dev_tom.data_quality.practitioner_specialty"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.534724Z", "completed_at": "2024-08-23T19:21:32.543918Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.545262Z", "completed_at": "2024-08-23T19:21:32.545266Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.013729095458984375, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__practitioner_sub_specialty", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    \n        , cast(coalesce(convert_timezone('UTC', current_timestamp()), cast('1900-01-01' as date)) as date) as source_date\n    \n    , 'PRACTITIONER' AS table_name\n    , 'Practitioner ID' as drill_down_key\n    , coalesce(practitioner_id, 'NULL') AS drill_down_value\n    , 'SUB_SPECIALTY' as field_name\n    , case when m.sub_specialty is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(sub_specialty as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.practitioner m", "relation_name": "dev_tom.data_quality.practitioner_sub_specialty"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.537647Z", "completed_at": "2024-08-23T19:21:32.546117Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.548671Z", "completed_at": "2024-08-23T19:21:32.548675Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.011872053146362305, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.core__stg_clinical_patient", "compiled": true, "compiled_code": "\n\nwith tuva_last_run as(\n    select\n       cast('2024-08-23 19:21:27.787896+00:00' as timestamp ) as tuva_last_run_datetime\n       , cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date ) as tuva_last_run_date\n)\nSELECT\n    cast(patient_id as TEXT ) as patient_id\n    , cast(first_name as TEXT ) as first_name\n    , cast(last_name as TEXT ) as last_name\n    , cast(sex as TEXT ) as sex\n    , cast(race as TEXT ) as race\n    , try_cast( birth_date as date ) as birth_date\n    , try_cast( death_date as date ) as death_date\n    , cast(death_flag as integer ) as death_flag\n    , cast(social_security_number as TEXT ) as social_security_number\n    , cast(address as TEXT ) as address\n    , cast(city as TEXT ) as city\n    , cast(state as TEXT ) as state\n    , cast(zip_code as TEXT ) as zip_code\n    , cast(county as TEXT ) as county\n    , cast(latitude as float ) as latitude\n    , cast(longitude as float ) as longitude\n    , cast(data_source as TEXT ) as data_source\n    , cast(floor(datediff(\n        hour,\n        birth_date,\n        tuva_last_run_date\n        ) / 8760.0) as integer ) as age\n    , cast(\n        CASE\n            WHEN cast(floor(datediff(\n        hour,\n        birth_date,\n        tuva_last_run_date\n        ) / 8760.0) as integer ) < 10 THEN '0-9'\n            WHEN cast(floor(datediff(\n        hour,\n        birth_date,\n        tuva_last_run_date\n        ) / 8760.0) as integer ) < 20 THEN '10-19'\n            WHEN cast(floor(datediff(\n        hour,\n        birth_date,\n        tuva_last_run_date\n        ) / 8760.0) as integer ) < 30 THEN '20-29'\n            WHEN cast(floor(datediff(\n        hour,\n        birth_date,\n        tuva_last_run_date\n        ) / 8760.0) as integer ) < 40 THEN '30-39'\n            WHEN cast(floor(datediff(\n        hour,\n        birth_date,\n        tuva_last_run_date\n        ) / 8760.0) as integer ) < 50 THEN '40-49'\n            WHEN cast(floor(datediff(\n        hour,\n        birth_date,\n        tuva_last_run_date\n        ) / 8760.0) as integer ) < 60 THEN '50-59'\n            WHEN cast(floor(datediff(\n        hour,\n        birth_date,\n        tuva_last_run_date\n        ) / 8760.0) as integer ) < 70 THEN '60-69'\n            WHEN cast(floor(datediff(\n        hour,\n        birth_date,\n        tuva_last_run_date\n        ) / 8760.0) as integer ) < 80 THEN '70-79'\n            WHEN cast(floor(datediff(\n        hour,\n        birth_date,\n        tuva_last_run_date\n        ) / 8760.0) as integer ) < 90 THEN '80-89'\n            ELSE '90+'\n        END as TEXT\n    ) AS age_group\n    , tuva_last_run_datetime as tuva_last_run\nFROM tuva.input_layer.patient\ncross join tuva_last_run", "relation_name": "dev_tom.core._stg_clinical_patient"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.546443Z", "completed_at": "2024-08-23T19:21:32.552308Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.552669Z", "completed_at": "2024-08-23T19:21:32.552672Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.007140159606933594, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__patient_address", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    \n        , cast(coalesce(convert_timezone('UTC', current_timestamp()), cast('1900-01-01' as date)) as date) as source_date\n    \n    , 'PATIENT' AS table_name\n    , 'Patient ID' as drill_down_key\n    , coalesce(patient_id, 'NULL') AS drill_down_value\n    , 'ADDRESS' as field_name\n    , case when m.address is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(address as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.patient m", "relation_name": "dev_tom.data_quality.patient_address"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.549350Z", "completed_at": "2024-08-23T19:21:32.555056Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.555462Z", "completed_at": "2024-08-23T19:21:32.555464Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.009244918823242188, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__patient_birth_date", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    \n        , cast(coalesce(convert_timezone('UTC', current_timestamp()), cast('1900-01-01' as date)) as date) as source_date\n    \n    , 'PATIENT' AS table_name\n    , 'Patient ID' as drill_down_key\n    , coalesce(patient_id, 'NULL') AS drill_down_value\n    , 'BIRTH_DATE' AS field_name\n    , case\n        when m.birth_date > cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) then 'invalid'\n        when m.birth_date <= cast('1901-01-01' as date) then 'invalid'\n        when m.birth_date > m.death_date then 'invalid'\n        when m.birth_date is null then 'null'\n        else 'valid'\n    end as bucket_name\n    , case\n        when m.birth_date > cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) then 'future'\n        when m.birth_date <= cast('1901-01-01' as date) then 'too old'\n        when m.birth_date > m.death_date then 'Birth date after death date'\n        else null\n    end as invalid_reason\n    , cast(birth_date as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.patient m", "relation_name": "dev_tom.data_quality.patient_birth_date"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.552939Z", "completed_at": "2024-08-23T19:21:32.556104Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.556601Z", "completed_at": "2024-08-23T19:21:32.556604Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.005264759063720703, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__patient_city", "compiled": true, "compiled_code": "\n\n\nSELECT\n    m.data_source\n    \n        , cast(coalesce(convert_timezone('UTC', current_timestamp()), cast('1900-01-01' as date)) as date) as source_date\n    \n    ,'PATIENT' AS table_name\n    ,'Patient ID' as drill_down_key\n    , coalesce(patient_id, 'NULL') AS drill_down_value\n    ,'CITY' AS field_name\n    ,case when m.city is not null then 'valid' else 'null' end as bucket_name\n    ,cast(null as TEXT) as invalid_reason\n    ,cast(city as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.patient m", "relation_name": "dev_tom.data_quality.patient_city"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.557639Z", "completed_at": "2024-08-23T19:21:32.562522Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.562849Z", "completed_at": "2024-08-23T19:21:32.562852Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.0071260929107666016, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__patient_county", "compiled": true, "compiled_code": "\n\n\nSELECT\n    m.data_source\n    \n        , cast(coalesce(convert_timezone('UTC', current_timestamp()), cast('1900-01-01' as date)) as date) as source_date\n    \n    ,'PATIENT' AS table_name\n    ,'Patient ID' as drill_down_key\n    , coalesce(patient_id, 'NULL') AS drill_down_value\n    ,'COUNTY' as field_name\n    ,case when m.county is not null then 'valid' else 'null' end as bucket_name\n    ,cast(null as TEXT) as invalid_reason\n    ,cast(county as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.patient m", "relation_name": "dev_tom.data_quality.patient_county"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.560188Z", "completed_at": "2024-08-23T19:21:32.563117Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.566309Z", "completed_at": "2024-08-23T19:21:32.566312Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.009907007217407227, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__patient_data_source", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    \n        , cast(coalesce(convert_timezone('UTC', current_timestamp()), cast('1900-01-01' as date)) as date) as source_date\n    \n    , 'PATIENT' AS table_name\n    , 'Patient ID' as drill_down_key\n    , coalesce(patient_id, 'NULL') AS drill_down_value\n    , 'DATA_SOURCE' as field_name\n    , case when m.data_source is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(data_source as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.patient m", "relation_name": "dev_tom.data_quality.patient_data_source"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.563279Z", "completed_at": "2024-08-23T19:21:32.566993Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.567484Z", "completed_at": "2024-08-23T19:21:32.567487Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0052030086517333984, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__patient_death_date", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    \n        , cast(coalesce(convert_timezone('UTC', current_timestamp()), cast('1900-01-01' as date)) as date) as source_date\n    \n    , 'PATIENT' AS table_name\n    , 'Patient ID' as drill_down_key\n    , coalesce(patient_id, 'NULL') AS drill_down_value\n    , 'DEATH_DATE' AS field_name\n    , case\n        when m.death_date > cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) then 'invalid'\n        when m.death_date <= cast('1901-01-01' as date) then 'invalid'\n        when m.death_date > m.birth_date then 'invalid'\n        when m.death_date is null then 'null'\n        else 'valid'\n    end as bucket_name\n    , case\n        when m.death_date > cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) then 'future'\n        when m.death_date <= cast('1901-01-01' as date) then 'too old'\n        when m.death_date > m.birth_date then 'Death date after birth date'\n        else null\n    end as invalid_reason\n    , cast(death_date as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.patient m", "relation_name": "dev_tom.data_quality.patient_death_date"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.567750Z", "completed_at": "2024-08-23T19:21:32.572513Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.572894Z", "completed_at": "2024-08-23T19:21:32.572896Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.0063190460205078125, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__patient_death_flag", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    \n        , cast(coalesce(convert_timezone('UTC', current_timestamp()), cast('1900-01-01' as date)) as date) as source_date\n    \n    , 'PATIENT' AS table_name\n    , 'Patient ID' as drill_down_key\n    , coalesce(patient_id, 'NULL') AS drill_down_value\n    , 'DEATH_FLAG' as field_name\n    , case when m.death_flag is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(death_flag as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.patient m", "relation_name": "dev_tom.data_quality.patient_death_flag"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.570245Z", "completed_at": "2024-08-23T19:21:32.575333Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.575725Z", "completed_at": "2024-08-23T19:21:32.575728Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.008462905883789062, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__patient_first_name", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    \n        , cast(coalesce(convert_timezone('UTC', current_timestamp()), cast('1900-01-01' as date)) as date) as source_date\n    \n    , 'PATIENT' AS table_name\n    , 'Patient ID' as drill_down_key\n    , coalesce(patient_id, 'NULL') AS drill_down_value\n    , 'FIRST_NAME' as field_name\n    , case when m.first_name is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(first_name as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.patient m", "relation_name": "dev_tom.data_quality.patient_first_name"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.573177Z", "completed_at": "2024-08-23T19:21:32.576349Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.576862Z", "completed_at": "2024-08-23T19:21:32.576865Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.004548072814941406, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__patient_last_name", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    \n        , cast(coalesce(convert_timezone('UTC', current_timestamp()), cast('1900-01-01' as date)) as date) as source_date\n    \n    , 'PATIENT' AS table_name\n    , 'Patient ID' as drill_down_key\n    , coalesce(patient_id, 'NULL') AS drill_down_value\n    , 'LAST_NAME' AS field_name\n    , case when m.last_name is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(last_name as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.patient m", "relation_name": "dev_tom.data_quality.patient_last_name"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.577137Z", "completed_at": "2024-08-23T19:21:32.582096Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.585275Z", "completed_at": "2024-08-23T19:21:32.585278Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.009300947189331055, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__patient_latitude", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    \n        , cast(coalesce(convert_timezone('UTC', current_timestamp()), cast('1900-01-01' as date)) as date) as source_date\n    \n    , 'PATIENT' AS table_name\n    , 'Patient ID' as drill_down_key\n    , coalesce(patient_id, 'NULL') AS drill_down_value\n    , 'LATITUDE' as field_name\n    , case when m.latitude is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(latitude as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.patient m", "relation_name": "dev_tom.data_quality.patient_latitude"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.579604Z", "completed_at": "2024-08-23T19:21:32.585535Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.585987Z", "completed_at": "2024-08-23T19:21:32.585990Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.009348154067993164, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__patient_longitude", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    \n        , cast(coalesce(convert_timezone('UTC', current_timestamp()), cast('1900-01-01' as date)) as date) as source_date\n    \n    , 'PATIENT' AS table_name\n    , 'Patient ID' as drill_down_key\n    , coalesce(patient_id, 'NULL') AS drill_down_value\n    , 'LONGITUDE' as field_name\n    , case when m.longitude is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(longitude as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.patient m", "relation_name": "dev_tom.data_quality.patient_longitude"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.582271Z", "completed_at": "2024-08-23T19:21:32.586448Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.587016Z", "completed_at": "2024-08-23T19:21:32.587019Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.005340099334716797, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__patient_patient_id", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    \n        , cast(coalesce(convert_timezone('UTC', current_timestamp()), cast('1900-01-01' as date)) as date) as source_date\n    \n    , 'PATIENT' AS table_name\n    , 'Patient ID' as drill_down_key\n    , coalesce(patient_id, 'NULL') AS drill_down_value\n    , 'PATIENT_ID' as field_name\n    , case when m.patient_id is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(patient_id as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.patient m", "relation_name": "dev_tom.data_quality.patient_patient_id"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.587504Z", "completed_at": "2024-08-23T19:21:32.592612Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.592969Z", "completed_at": "2024-08-23T19:21:32.592972Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.006722211837768555, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__patient_state", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    \n        , cast(coalesce(convert_timezone('UTC', current_timestamp()), cast('1900-01-01' as date)) as date) as source_date\n    \n    , 'PATIENT' AS table_name\n    , 'Patient ID' as drill_down_key\n    , coalesce(patient_id, 'NULL') AS drill_down_value\n    , 'STATE' as field_name\n    , case when m.state is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(state as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.patient m", "relation_name": "dev_tom.data_quality.patient_state"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.590323Z", "completed_at": "2024-08-23T19:21:32.597069Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.597479Z", "completed_at": "2024-08-23T19:21:32.597482Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.010257720947265625, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__patient_zip_code", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    \n        , cast(coalesce(convert_timezone('UTC', current_timestamp()), cast('1900-01-01' as date)) as date) as source_date\n    \n    , 'PATIENT' AS table_name\n    , 'Patient ID' as drill_down_key\n    , coalesce(patient_id, 'NULL') AS drill_down_value\n    , 'ZIP_CODE' as field_name\n    , case when m.zip_code is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(zip_code as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.patient m", "relation_name": "dev_tom.data_quality.patient_zip_code"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.593259Z", "completed_at": "2024-08-23T19:21:32.597792Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.598334Z", "completed_at": "2024-08-23T19:21:32.598336Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.008252143859863281, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.core__stg_clinical_procedure", "compiled": true, "compiled_code": "\n\nselect\n    cast(procedure_id as TEXT ) as procedure_id \n    , cast(patient_id as TEXT ) as patient_id\n    , cast(encounter_id as TEXT ) as encounter_id\n    , cast(claim_id as TEXT ) as claim_id\n    , try_cast( procedure_date as date ) as procedure_date\n    , cast(source_code_type as TEXT ) as source_code_type\n    , cast(source_code as TEXT ) as source_code\n    , cast(source_description as TEXT ) as source_description\n    , cast(normalized_code_type as TEXT ) as normalized_code_type\n    , cast(normalized_code as TEXT ) as normalized_code\n    , cast(normalized_description as TEXT ) as normalized_description\n    , cast(modifier_1 as TEXT ) as modifier_1\n    , cast(modifier_2 as TEXT ) as modifier_2\n    , cast(modifier_3 as TEXT ) as modifier_3\n    , cast(modifier_4 as TEXT ) as modifier_4\n    , cast(modifier_5 as TEXT ) as modifier_5\n    , cast(practitioner_id as TEXT ) as practitioner_id\n    , cast(data_source as TEXT ) as data_source\n    , cast('2024-08-23 19:21:27.787896+00:00' as timestamp ) as tuva_last_run\nfrom tuva.input_layer.procedure", "relation_name": "dev_tom.core._stg_clinical_procedure"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.598602Z", "completed_at": "2024-08-23T19:21:32.603002Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.603381Z", "completed_at": "2024-08-23T19:21:32.603384Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.006137847900390625, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__procedure_claim_id", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.procedure_date,cast('1900-01-01' as date)) as source_date\n    , 'PROCEDURE' AS table_name\n    , 'Procedure ID' as drill_down_key\n    , coalesce(procedure_id, 'NULL') AS drill_down_value\n    , 'CLAIM_ID' as field_name\n    , case when m.claim_id is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(claim_id as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.procedure m", "relation_name": "dev_tom.data_quality.procedure_claim_id"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.601150Z", "completed_at": "2024-08-23T19:21:32.605468Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.605868Z", "completed_at": "2024-08-23T19:21:32.605871Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.005529880523681641, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__procedure_data_source", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.procedure_date,cast('1900-01-01' as date)) as source_date\n    , 'PROCEDURE' AS table_name\n    , 'Procedure ID' as drill_down_key\n    , coalesce(procedure_id, 'NULL') AS drill_down_value\n    , 'DATA_SOURCE' as field_name\n    , case when m.data_source is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(data_source as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.procedure m", "relation_name": "dev_tom.data_quality.procedure_data_source"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.603684Z", "completed_at": "2024-08-23T19:21:32.606324Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.606860Z", "completed_at": "2024-08-23T19:21:32.606863Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0059359073638916016, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__procedure_encounter_id", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.procedure_date,cast('1900-01-01' as date)) as source_date\n    , 'PROCEDURE' AS table_name\n    , 'Procedure ID' as drill_down_key\n    , coalesce(procedure_id, 'NULL') AS drill_down_value\n    , 'ENCOUNTER_ID' as field_name\n    , case when m.encounter_id is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(encounter_id as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.procedure m", "relation_name": "dev_tom.data_quality.procedure_encounter_id"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.607374Z", "completed_at": "2024-08-23T19:21:32.611450Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.611814Z", "completed_at": "2024-08-23T19:21:32.611817Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.005685091018676758, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__procedure_normalized_description", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.procedure_date,cast('1900-01-01' as date)) as source_date\n    , 'PROCEDURE' AS table_name\n    , 'Procedure ID' as drill_down_key\n    , coalesce(procedure_id, 'NULL') AS drill_down_value\n    , 'NORMALIZED_DESCRIPTION' AS field_name\n    , case when m.normalized_description is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(substring(normalized_description, 1, 255) as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.procedure m", "relation_name": "dev_tom.data_quality.procedure_normalized_description"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.609709Z", "completed_at": "2024-08-23T19:21:32.614762Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.615174Z", "completed_at": "2024-08-23T19:21:32.615177Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.008085012435913086, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__procedure_patient_id", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.procedure_date,cast('1900-01-01' as date)) as source_date\n    , 'PROCEDURE' AS table_name\n    , 'Procedure ID' as drill_down_key\n    , coalesce(procedure_id, 'NULL') AS drill_down_value\n    , 'PATIENT_ID' AS field_name\n    , case when m.patient_id is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(patient_id as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.procedure m", "relation_name": "dev_tom.data_quality.procedure_patient_id"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.612109Z", "completed_at": "2024-08-23T19:21:32.615839Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.616360Z", "completed_at": "2024-08-23T19:21:32.616363Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.006895780563354492, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__procedure_practitioner_id", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.procedure_date,cast('1900-01-01' as date)) as source_date\n    , 'PROCEDURE' AS table_name\n    , 'Procedure ID' as drill_down_key\n    , coalesce(procedure_id, 'NULL') AS drill_down_value\n    , 'PRACTITIONER_ID' AS field_name\n    , case when m.practitioner_id is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(practitioner_id as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.procedure m", "relation_name": "dev_tom.data_quality.procedure_practitioner_id"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.616639Z", "completed_at": "2024-08-23T19:21:32.621827Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.622217Z", "completed_at": "2024-08-23T19:21:32.622219Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.006788969039916992, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__procedure_procedure_date", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.procedure_date,cast('1900-01-01' as date)) as source_date\n    , 'PROCEDURE' AS table_name\n    , 'Procedure ID' as drill_down_key\n    , coalesce(procedure_id, 'NULL') AS drill_down_value\n    , 'PROCEDURE_DATE' as field_name\n    , case\n        when m.procedure_date > cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) then 'invalid'\n        when m.procedure_date <= cast('1901-01-01' as date) then 'invalid'\n        when m.procedure_date is null then 'null'\n        else 'valid'\n    end as bucket_name\n    , case\n        when m.procedure_date > cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) then 'future'\n        when m.procedure_date <= cast('1901-01-01' as date) then 'too old'\n        else null\n    end as invalid_reason\n    , cast(procedure_date as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.procedure m", "relation_name": "dev_tom.data_quality.procedure_procedure_date"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.619753Z", "completed_at": "2024-08-23T19:21:32.624402Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.624823Z", "completed_at": "2024-08-23T19:21:32.624826Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.00867605209350586, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__procedure_procedure_id", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.procedure_date,cast('1900-01-01' as date)) as source_date\n    , 'PROCEDURE' AS table_name\n    , 'Procedure ID' as drill_down_key\n    , coalesce(procedure_id, 'NULL') AS drill_down_value\n    , 'PROCEDURE_ID' AS field_name\n    , case when m.procedure_id is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(procedure_id as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.procedure m", "relation_name": "dev_tom.data_quality.procedure_procedure_id"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.622504Z", "completed_at": "2024-08-23T19:21:32.625503Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.626038Z", "completed_at": "2024-08-23T19:21:32.626041Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.004423856735229492, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__procedure_source_code", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.procedure_date,cast('1900-01-01' as date)) as source_date\n    , 'PROCEDURE' AS table_name\n    , 'Procedure ID' as drill_down_key\n    , coalesce(procedure_id, 'NULL') AS drill_down_value\n    , 'SOURCE_CODE' as field_name\n    , case when m.source_code is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(source_code as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.procedure m", "relation_name": "dev_tom.data_quality.procedure_source_code"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.626321Z", "completed_at": "2024-08-23T19:21:32.632013Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.632734Z", "completed_at": "2024-08-23T19:21:32.632738Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.007651805877685547, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__procedure_source_code_type", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.procedure_date,cast('1900-01-01' as date)) as source_date\n    , 'PROCEDURE' AS table_name\n    , 'Procedure ID' as drill_down_key\n    , coalesce(procedure_id, 'NULL') AS drill_down_value\n    , 'SOURCE_CODE_TYPE' as field_name\n    , case when m.source_code_type is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(source_code_type as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.procedure m", "relation_name": "dev_tom.data_quality.procedure_source_code_type"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.629247Z", "completed_at": "2024-08-23T19:21:32.632571Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.634586Z", "completed_at": "2024-08-23T19:21:32.634589Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.008769035339355469, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__procedure_source_description", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.procedure_date,cast('1900-01-01' as date)) as source_date\n    , 'PROCEDURE' AS table_name\n    , 'Procedure ID' as drill_down_key\n    , coalesce(procedure_id, 'NULL') AS drill_down_value\n    , 'SOURCE_DESCRIPTION' as field_name\n    , case when m.source_description is not null then 'valid' else 'null' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(substring(source_description, 1, 255) as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.procedure m", "relation_name": "dev_tom.data_quality.procedure_source_description"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.633174Z", "completed_at": "2024-08-23T19:21:32.635543Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.636056Z", "completed_at": "2024-08-23T19:21:32.636059Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0042438507080078125, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.input_layer.eligibility", "compiled": true, "compiled_code": "select\n*\nfrom dev_tom._tuva_synthetic.eligibility_seed", "relation_name": "tuva.input_layer.eligibility"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.636483Z", "completed_at": "2024-08-23T19:21:32.640902Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.643936Z", "completed_at": "2024-08-23T19:21:32.643939Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.008603811264038086, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.input_layer.medical_claim", "compiled": true, "compiled_code": "select\n*\nfrom dev_tom._tuva_synthetic.medical_claim_seed", "relation_name": "tuva.input_layer.medical_claim"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.638278Z", "completed_at": "2024-08-23T19:21:32.644204Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.644997Z", "completed_at": "2024-08-23T19:21:32.645001Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.009333133697509766, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.input_layer.pharmacy_claim", "compiled": true, "compiled_code": "select\n*\nfrom dev_tom._tuva_synthetic.pharmacy_claim_seed", "relation_name": "tuva.input_layer.pharmacy_claim"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.641051Z", "completed_at": "2024-08-23T19:21:32.645258Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.645921Z", "completed_at": "2024-08-23T19:21:32.645924Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.005505084991455078, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.ccsr__dx_vertical_pivot", "compiled": true, "compiled_code": "\n\nwith codes as (\n    \n    select\n        icd_10_cm_code as code, \n        icd_10_cm_code_description as code_description,\n        -- loop to generate columns for CCSR categories 1-6\n        ccsr_category_1,\n        ccsr_category_1_description,\n        ccsr_category_2,\n        ccsr_category_2_description,\n        ccsr_category_3,\n        ccsr_category_3_description,\n        ccsr_category_4,\n        ccsr_category_4_description,\n        ccsr_category_5,\n        ccsr_category_5_description,\n        ccsr_category_6,\n        ccsr_category_6_description,\n        default_ccsr_category_ip,\n        default_ccsr_category_op\n    from dev_tom.ccsr._value_set_dxccsr_v2023_1_cleaned_map\n\n), long_union as (\n    -- generate select & union statements to pivot category columns to rows\n    \n    select \n        code,\n        code_description,\n        substring(ccsr_category_1, 1, 3) as ccsr_parent_category,\n        ccsr_category_1 as ccsr_category,\n        ccsr_category_1_description as ccsr_category_description,\n        1 as ccsr_category_rank,\n        CASE WHEN ccsr_category_1 = default_ccsr_category_ip THEN 1 ELSE 0 END as is_ip_default_category,\n        CASE WHEN ccsr_category_1 = default_ccsr_category_op THEN 1 ELSE 0 END as is_op_default_category\n    from codes \n    union all\n    select \n        code,\n        code_description,\n        substring(ccsr_category_2, 1, 3) as ccsr_parent_category,\n        ccsr_category_2 as ccsr_category,\n        ccsr_category_2_description as ccsr_category_description,\n        2 as ccsr_category_rank,\n        CASE WHEN ccsr_category_2 = default_ccsr_category_ip THEN 1 ELSE 0 END as is_ip_default_category,\n        CASE WHEN ccsr_category_2 = default_ccsr_category_op THEN 1 ELSE 0 END as is_op_default_category\n    from codes \n    union all\n    select \n        code,\n        code_description,\n        substring(ccsr_category_3, 1, 3) as ccsr_parent_category,\n        ccsr_category_3 as ccsr_category,\n        ccsr_category_3_description as ccsr_category_description,\n        3 as ccsr_category_rank,\n        CASE WHEN ccsr_category_3 = default_ccsr_category_ip THEN 1 ELSE 0 END as is_ip_default_category,\n        CASE WHEN ccsr_category_3 = default_ccsr_category_op THEN 1 ELSE 0 END as is_op_default_category\n    from codes \n    union all\n    select \n        code,\n        code_description,\n        substring(ccsr_category_4, 1, 3) as ccsr_parent_category,\n        ccsr_category_4 as ccsr_category,\n        ccsr_category_4_description as ccsr_category_description,\n        4 as ccsr_category_rank,\n        CASE WHEN ccsr_category_4 = default_ccsr_category_ip THEN 1 ELSE 0 END as is_ip_default_category,\n        CASE WHEN ccsr_category_4 = default_ccsr_category_op THEN 1 ELSE 0 END as is_op_default_category\n    from codes \n    union all\n    select \n        code,\n        code_description,\n        substring(ccsr_category_5, 1, 3) as ccsr_parent_category,\n        ccsr_category_5 as ccsr_category,\n        ccsr_category_5_description as ccsr_category_description,\n        5 as ccsr_category_rank,\n        CASE WHEN ccsr_category_5 = default_ccsr_category_ip THEN 1 ELSE 0 END as is_ip_default_category,\n        CASE WHEN ccsr_category_5 = default_ccsr_category_op THEN 1 ELSE 0 END as is_op_default_category\n    from codes \n    union all\n    select \n        code,\n        code_description,\n        substring(ccsr_category_6, 1, 3) as ccsr_parent_category,\n        ccsr_category_6 as ccsr_category,\n        ccsr_category_6_description as ccsr_category_description,\n        6 as ccsr_category_rank,\n        CASE WHEN ccsr_category_6 = default_ccsr_category_ip THEN 1 ELSE 0 END as is_ip_default_category,\n        CASE WHEN ccsr_category_6 = default_ccsr_category_op THEN 1 ELSE 0 END as is_op_default_category\n    from codes \n    \n\n)\n\nselect distinct\n    *,\n    '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom long_union\n-- as not all diagnosis codes have multiple categories, we can discard nulls\nwhere ccsr_category is not null", "relation_name": "dev_tom.ccsr.dx_vertical_pivot"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.646743Z", "completed_at": "2024-08-23T19:21:32.655543Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.655979Z", "completed_at": "2024-08-23T19:21:32.655982Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.010603904724121094, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.ccsr__procedure_category_map", "compiled": true, "compiled_code": "\n\nselect \n    icd_10_pcs as code,\n    icd_10_pcs_description as code_description,\n    prccsr as ccsr_category,\n    substring(prccsr, 1, 3) as ccsr_parent_category,\n    prccsr_description as ccsr_category_description,\n    clinical_domain,\n   '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ccsr._value_set_prccsr_v2023_1_cleaned_map", "relation_name": "dev_tom.ccsr.procedure_category_map"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.649142Z", "completed_at": "2024-08-23T19:21:32.655784Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.656283Z", "completed_at": "2024-08-23T19:21:32.656286Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.009971141815185547, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.clinical_concept_library__value_set_member_relevant_fields", "compiled": true, "compiled_code": "with value_set_member_relevant_fields as (\nselect \n  aa.concept_id,\n  aa.concept_name,\n  aa.concept_type,\n  \n  bb.value_set_member_id,\n  bb.code,\n  bb.coding_system_id,\n  bb.include_descendants,\n\n  cc.coding_system_name\n  \nfrom dev_tom.clinical_concept_library.clinical_concepts aa\n\nleft join dev_tom.clinical_concept_library.value_set_members bb\non aa.concept_id = bb.concept_id\n\nleft join dev_tom.clinical_concept_library.coding_systems cc\non bb.coding_system_id = cc.coding_system_id\n)\n\n\nselect *\nfrom value_set_member_relevant_fields", "relation_name": "dev_tom.clinical_concept_library.value_set_member_relevant_fields"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.650627Z", "completed_at": "2024-08-23T19:21:32.656572Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.657177Z", "completed_at": "2024-08-23T19:21:32.657181Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.008292675018310547, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.the_tuva_project.not_null_ed_classification__johnston_icd10_icd10.d04e7f84c7", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect icd10\nfrom dev_tom.ed_classification._value_set_johnston_icd10\nwhere icd10 is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.658605Z", "completed_at": "2024-08-23T19:21:32.664381Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.664727Z", "completed_at": "2024-08-23T19:21:32.664730Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.007301807403564453, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.the_tuva_project.unique_ed_classification__johnston_icd10_icd10.3d55f2b2dd", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    icd10 as unique_field,\n    count(*) as n_records\n\nfrom dev_tom.ed_classification._value_set_johnston_icd10\nwhere icd10 is not null\ngroup by icd10\nhaving count(*) > 1\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.660977Z", "completed_at": "2024-08-23T19:21:32.664544Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.665160Z", "completed_at": "2024-08-23T19:21:32.665164Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.007542848587036133, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.the_tuva_project.not_null_ed_classification__johnston_icd9_icd9.a7feea49c0", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect icd9\nfrom dev_tom.ed_classification._value_set_johnston_icd9\nwhere icd9 is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.662676Z", "completed_at": "2024-08-23T19:21:32.664996Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.665667Z", "completed_at": "2024-08-23T19:21:32.665670Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.007294893264770508, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.the_tuva_project.unique_ed_classification__johnston_icd9_icd9.08c1dc4617", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    icd9 as unique_field,\n    count(*) as n_records\n\nfrom dev_tom.ed_classification._value_set_johnston_icd9\nwhere icd9 is not null\ngroup by icd9\nhaving count(*) > 1\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.667279Z", "completed_at": "2024-08-23T19:21:32.676295Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.676524Z", "completed_at": "2024-08-23T19:21:32.676527Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.010419845581054688, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.pharmacy__int_brand_with_generic_available", "compiled": true, "compiled_code": "\n\nselect distinct \n    product_rxcui as brand_with_generic_available\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.pharmacy.rxnorm_generic_available\nwhere \n    ndc_product_tty in ('SCD', 'GPCK')\n    \n        and cast(product_startmarketingdate as date) <= current_date\n", "relation_name": "dev_tom.pharmacy._int_brand_with_generic_available"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.672744Z", "completed_at": "2024-08-23T19:21:32.676815Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.677353Z", "completed_at": "2024-08-23T19:21:32.677356Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.010475635528564453, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_cbe0055__performance_period", "compiled": true, "compiled_code": "/*\n    set performance period end to the end of the current calendar year\n    or use the quality_measures_period_end variable if provided\n*/\nwith period_end as (\n\n    select\n        cast(\n        \n\n    dateadd(\n        day,\n        -1,\n        \n\n    dateadd(\n        year,\n        1,\n        date_trunc('year', convert_timezone('UTC', current_timestamp()))\n        )\n\n\n        )\n\n\n        as date)\n        \n         as performance_period_end\n         \n)\n\n/*\n    set performance period begin to a year and a day prior\n    for a complete calendar year\n*/\n, period_begin as (\n\n    select\n          performance_period_end\n        , \n\n    dateadd(\n        day,\n        1,\n        \n\n    dateadd(\n        year,\n        -1,\n        performance_period_end\n        )\n\n\n        )\n\n as performance_period_begin\n    from period_end\n\n)\n\nselect\n      cast((select id\nfrom dev_tom.quality_measures._value_set_measures\nwhere id = 'CBE0055') as TEXT) as measure_id\n    , cast((select name\nfrom dev_tom.quality_measures._value_set_measures\nwhere id = 'CBE0055') as TEXT) as measure_name\n    , cast((select version\nfrom dev_tom.quality_measures._value_set_measures\nwhere id = 'CBE0055') as TEXT) as measure_version\n    , cast(performance_period_begin as date) as performance_period_begin\n    , cast(performance_period_end as date) as performance_period_end\nfrom period_begin", "relation_name": "dev_tom.quality_measures._int_cbe0055__performance_period"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.670727Z", "completed_at": "2024-08-23T19:21:32.677188Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.677805Z", "completed_at": "2024-08-23T19:21:32.677808Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.011291742324829102, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.mart_review__quality_measures_value_set", "compiled": true, "compiled_code": "\n\nselect *    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.quality_measures._value_set_measures p", "relation_name": "dev_tom.data_quality.mart_review__quality_measures_value_set"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.678828Z", "completed_at": "2024-08-23T19:21:32.689531Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.689798Z", "completed_at": "2024-08-23T19:21:32.689802Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.012203216552734375, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_cbe0101__performance_period", "compiled": true, "compiled_code": "/*\n    set performance period end to the end of the current calendar year\n    or use the quality_measures_period_end variable if provided   \n*/\n\nwith period_end as (\n\n    select\n        cast(\n        \n\n    dateadd(\n        day,\n        -1,\n        \n\n    dateadd(\n        year,\n        1,\n        date_trunc('year', convert_timezone('UTC', current_timestamp()))\n        )\n\n\n        )\n\n\n        as date)\n        \n         as performance_period_end\n         \n)\n\n/*\n    set performance period begin to following day of 1 year prior\n*/\n\n, period_begin as (\n\n    select\n          performance_period_end\n        , \n\n    dateadd(\n        day,\n        1,\n        \n\n    dateadd(\n        year,\n        -1,\n        performance_period_end\n        )\n\n\n        )\n\n as performance_period_begin\n    from period_end\n\n)\n\nselect\n      cast((select id\nfrom dev_tom.quality_measures._value_set_measures\nwhere id = 'CBE0101') as TEXT) as measure_id\n    , cast((select name\nfrom dev_tom.quality_measures._value_set_measures\nwhere id = 'CBE0101') as TEXT) as measure_name\n    , cast((select version\nfrom dev_tom.quality_measures._value_set_measures\nwhere id = 'CBE0101') as TEXT) as measure_version\n    , cast(performance_period_begin as date) as performance_period_begin\n    , cast(performance_period_end as date) as performance_period_end\nfrom period_begin", "relation_name": "dev_tom.quality_measures._int_cbe0101__performance_period"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.682743Z", "completed_at": "2024-08-23T19:21:32.690269Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.690796Z", "completed_at": "2024-08-23T19:21:32.690799Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.012207746505737305, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_cqm236__performance_period", "compiled": true, "compiled_code": "/*\n    set performance period end to the end of the current calendar year\n    or use the quality_measures_period_end variable if provided\n*/\nwith period_end as (\n\n    select\n        cast(\n        \n\n    dateadd(\n        day,\n        -1,\n        \n\n    dateadd(\n        year,\n        1,\n        date_trunc('year', convert_timezone('UTC', current_timestamp()))\n        )\n\n\n        )\n\n\n        as date)\n        \n         as performance_period_end\n)\n\n/*\n    set performance period begin to a year and a day prior\n    for a complete calendar year\n*/\n, period_begin as (\n\n    select\n          performance_period_end\n        , \n\n    dateadd(\n        day,\n        1,\n        \n\n    dateadd(\n        year,\n        -1,\n        performance_period_end\n        )\n\n\n        )\n\n as performance_period_begin\n    from period_end\n\n)\n\nselect\n      cast((select id\nfrom dev_tom.quality_measures._value_set_measures\nwhere id = 'CQM236') as TEXT) as measure_id\n    , cast((select name\nfrom dev_tom.quality_measures._value_set_measures\nwhere id = 'CQM236') as TEXT) as measure_name\n    , cast((select version\nfrom dev_tom.quality_measures._value_set_measures\nwhere id = 'CQM236') as TEXT) as measure_version\n    , cast(performance_period_begin as date) as performance_period_begin\n    , cast(performance_period_end as date) as performance_period_end\nfrom period_begin", "relation_name": "dev_tom.quality_measures._int_cqm236__performance_period"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.686162Z", "completed_at": "2024-08-23T19:21:32.690631Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.691243Z", "completed_at": "2024-08-23T19:21:32.691246Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.009096860885620117, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_cqm438__performance_period", "compiled": true, "compiled_code": "/*\n    set performance period end to the end of the current calendar year\n    or use the quality_measures_period_end variable if provided\n*/\nwith period_end as (\n\n    select\n        cast(\n        \n\n    dateadd(\n        day,\n        -1,\n        \n\n    dateadd(\n        year,\n        1,\n        date_trunc('year', convert_timezone('UTC', current_timestamp()))\n        )\n\n\n        )\n\n\n        as date)\n        \n         as performance_period_end\n         \n)\n\n/*\n    set performance period begin to a year and a day prior\n    for a complete calendar year\n*/\n, period_begin as (\n\n    select\n          performance_period_end\n        , \n\n    dateadd(\n        day,\n        1,\n        \n\n    dateadd(\n        year,\n        -1,\n        performance_period_end\n        )\n\n\n        )\n\n as performance_period_begin\n    from period_end\n\n)\n\nselect\n      cast((select id\nfrom dev_tom.quality_measures._value_set_measures\nwhere id = 'CQM438') as TEXT) as measure_id\n    , cast((select name\nfrom dev_tom.quality_measures._value_set_measures\nwhere id = 'CQM438') as TEXT) as measure_name\n    , cast((select version\nfrom dev_tom.quality_measures._value_set_measures\nwhere id = 'CQM438') as TEXT) as measure_version\n    , cast(performance_period_begin as date) as performance_period_begin\n    , cast(performance_period_end as date) as performance_period_end\nfrom period_begin", "relation_name": "dev_tom.quality_measures._int_cqm438__performance_period"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.691694Z", "completed_at": "2024-08-23T19:21:32.695991Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.707198Z", "completed_at": "2024-08-23T19:21:32.707201Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.016778945922851562, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_cqm48__performance_period", "compiled": true, "compiled_code": "/*\n    set performance period end to the end of the current calendar year\n    or use the quality_measures_period_end variable if provided   \n*/\n\nwith period_end as (\n\n    select\n        cast(\n        \n\n    dateadd(\n        day,\n        -1,\n        \n\n    dateadd(\n        year,\n        1,\n        date_trunc('year', convert_timezone('UTC', current_timestamp()))\n        )\n\n\n        )\n\n\n        as date)\n        \n         as performance_period_end\n         \n)\n\n/*\n    set performance period begin to following day of 1 year prior\n*/\n\n, period_begin as (\n\n    select\n          performance_period_end\n        , \n\n    dateadd(\n        day,\n        1,\n        \n\n    dateadd(\n        year,\n        -1,\n        performance_period_end\n        )\n\n\n        )\n\n as performance_period_begin\n    from period_end\n\n)\n\nselect\n      cast((select id\nfrom dev_tom.quality_measures._value_set_measures\nwhere id = 'CQM48') as TEXT) as measure_id\n    , cast((select name\nfrom dev_tom.quality_measures._value_set_measures\nwhere id = 'CQM48') as TEXT) as measure_name\n    , cast((select version\nfrom dev_tom.quality_measures._value_set_measures\nwhere id = 'CQM48') as TEXT) as measure_version\n    , cast(performance_period_begin as date) as performance_period_begin\n    , cast(performance_period_end as date) as performance_period_end\nfrom period_begin", "relation_name": "dev_tom.quality_measures._int_cqm48__performance_period"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.701803Z", "completed_at": "2024-08-23T19:21:32.707962Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.708428Z", "completed_at": "2024-08-23T19:21:32.708431Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.013002157211303711, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_nqf0053__performance_period", "compiled": true, "compiled_code": "/*\n    set performance period end to the end of the current calendar year\n    or use the quality_measures_period_end variable if provided\n*/\nwith period_end as (\n\n    select\n        cast(\n        \n\n    dateadd(\n        day,\n        -1,\n        \n\n    dateadd(\n        year,\n        1,\n        date_trunc('year', convert_timezone('UTC', current_timestamp()))\n        )\n\n\n        )\n\n\n        as date)\n        \n         as performance_period_end\n)\n\n/*\n    set performance period begin to a year and a day prior\n    for a complete calendar year\n*/\n, period_begin as (\n\n    select\n          performance_period_end\n        , \n\n    dateadd(\n        day,\n        1,\n        \n\n    dateadd(\n        year,\n        -1,\n        performance_period_end\n        )\n\n\n        )\n\n as performance_period_begin\n    from period_end\n\n)\n\n-- lookback_period for last june 30 and december 31\n, lookback_period as (\n\nSELECT\n  *\n  , case\n      when performance_period_end >= cast((date_part('year', performance_period_end) || '-06-30') as date)\n      then date_part('year', performance_period_end) || '-06-30'\n      else date_part('year', performance_period_begin) || '-06-30'\n    end as lookback_period_june\n  , case\n      when performance_period_end >= cast((date_part('year', performance_period_end) || '-12-31') as date)\n      then date_part('year', performance_period_end) || '-12-31'\n      else date_part('year', performance_period_begin) || '-12-31'\n    end as lookback_period_december\nFROM period_begin\n\n)\n\nselect\n      cast((select id\nfrom dev_tom.quality_measures._value_set_measures\nwhere id = 'NQF0053') as TEXT) as measure_id\n    , cast((select name\nfrom dev_tom.quality_measures._value_set_measures\nwhere id = 'NQF0053') as TEXT) as measure_name\n    , cast((select version\nfrom dev_tom.quality_measures._value_set_measures\nwhere id = 'NQF0053') as TEXT) as measure_version\n    , cast(performance_period_begin as date) as performance_period_begin\n    , cast(performance_period_end as date) as performance_period_end\n    , cast(lookback_period_june as date) as lookback_period_june\n    , cast(lookback_period_december as date) as lookback_period_december\nfrom lookback_period", "relation_name": "dev_tom.quality_measures._int_nqf0053__performance_period"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.696154Z", "completed_at": "2024-08-23T19:21:32.708120Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.708681Z", "completed_at": "2024-08-23T19:21:32.708684Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.013473033905029297, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_nqf0041__performance_period", "compiled": true, "compiled_code": "/*\n    set performance period end to the end of the current calendar year\n    or use the quality_measures_period_end variable if provided\n      - set quality_measures_period_end to december end for last quarter measurement period\n      - set quality_measures_period_end to march end for first quarter measurement period     \n*/\n\nwith period_end as (\n\n    select\n        cast(\n        \n\n    dateadd(\n        day,\n        -1,\n        \n\n    dateadd(\n        year,\n        1,\n        date_trunc('year', convert_timezone('UTC', current_timestamp()))\n        )\n\n\n        )\n\n\n        as date)\n        \n         as performance_period_end\n         \n)\n\n/*\n    set performance period begin to following day of 3 months prior\n    for visits in influenza season\n*/\n, period_begin as (\n\n    select\n          performance_period_end\n        , \n\n    dateadd(\n        day,\n        1,\n        \n\n    dateadd(\n        month,\n        -3,\n        performance_period_end\n        )\n\n\n        )\n\n as performance_period_begin\n    from period_end\n\n)\n\n/*\n    lookback_period for august of either current or previous year\n    for immunization qualifying date\n*/\n, lookback_period as (\n\n  select\n      *\n        , case\n            when date_part('month', performance_period_end) between 1 and 8\n            then (cast(date_part('year', performance_period_end) as integer) - 1) || '-08-01'\n            else date_part('year', performance_period_end) || '-08-01'\n        end as lookback_period_august\n  from period_begin\n\n)\n\nselect\n      cast((select id\nfrom dev_tom.quality_measures._value_set_measures\nwhere id = 'NQF0041') as TEXT) as measure_id\n    , cast((select name\nfrom dev_tom.quality_measures._value_set_measures\nwhere id = 'NQF0041') as TEXT) as measure_name\n    , cast((select version\nfrom dev_tom.quality_measures._value_set_measures\nwhere id = 'NQF0041') as TEXT) as measure_version\n    , cast(performance_period_begin as date) as performance_period_begin\n    , cast(performance_period_end as date) as performance_period_end\n    , cast(lookback_period_august as date) as lookback_period_august\nfrom lookback_period", "relation_name": "dev_tom.quality_measures._int_nqf0041__performance_period"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.708931Z", "completed_at": "2024-08-23T19:21:32.713185Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.716919Z", "completed_at": "2024-08-23T19:21:32.716923Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.00917196273803711, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_nqf0059__performance_period", "compiled": true, "compiled_code": "/*\n    set performance period end to the end of the current calendar year\n    or use the quality_measures_period_end variable if provided\n*/\nwith period_end as (\n\n    select\n        cast(\n        \n\n    dateadd(\n        day,\n        -1,\n        \n\n    dateadd(\n        year,\n        1,\n        date_trunc('year', convert_timezone('UTC', current_timestamp()))\n        )\n\n\n        )\n\n\n        as date)\n        \n         as performance_period_end\n)\n\n/*\n    set performance period begin to a year and a day prior\n    for a complete calendar year\n*/\n, period_begin as (\n\n    select\n          performance_period_end\n        , \n\n    dateadd(\n        day,\n        1,\n        \n\n    dateadd(\n        year,\n        -1,\n        performance_period_end\n        )\n\n\n        )\n\n as performance_period_begin\n    from period_end\n\n)\n\nselect\n      cast((select id\nfrom dev_tom.quality_measures._value_set_measures\nwhere id = 'NQF0059') as TEXT) as measure_id\n    , cast((select name\nfrom dev_tom.quality_measures._value_set_measures\nwhere id = 'NQF0059') as TEXT) as measure_name\n    , cast((select version\nfrom dev_tom.quality_measures._value_set_measures\nwhere id = 'NQF0059') as TEXT) as measure_version\n    , cast(performance_period_begin as date) as performance_period_begin\n    , cast(performance_period_end as date) as performance_period_end\nfrom period_begin", "relation_name": "dev_tom.quality_measures._int_nqf0059__performance_period"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.713508Z", "completed_at": "2024-08-23T19:21:32.721164Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.721648Z", "completed_at": "2024-08-23T19:21:32.721651Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.009032011032104492, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_nqf0097__performance_period", "compiled": true, "compiled_code": "/*\n    set performance period end to the end of the current calendar year\n    or use the quality_measures_period_end variable if provided\n*/\nwith period_end as (\n\n    select\n        cast(\n        \n\n    dateadd(\n        day,\n        -1,\n        \n\n    dateadd(\n        year,\n        1,\n        date_trunc('year', convert_timezone('UTC', current_timestamp()))\n        )\n\n\n        )\n\n\n        as date)\n        \n         as performance_period_end\n         \n)\n\n/*\n    set performance period begin to a year and a day prior\n    for a complete calendar year\n*/\n, period_begin as (\n\n    select\n          performance_period_end\n        , \n\n    dateadd(\n        day,\n        1,\n        \n\n    dateadd(\n        year,\n        -1,\n        performance_period_end\n        )\n\n\n        )\n\n as performance_period_begin\n    from period_end\n\n)\n\nselect\n      cast((select id\nfrom dev_tom.quality_measures._value_set_measures\nwhere id = 'NQF0097') as TEXT) as measure_id\n    , cast((select name\nfrom dev_tom.quality_measures._value_set_measures\nwhere id = 'NQF0097') as TEXT) as measure_name\n    , cast((select version\nfrom dev_tom.quality_measures._value_set_measures\nwhere id = 'NQF0097') as TEXT) as measure_version\n    , cast(performance_period_begin as date) as performance_period_begin\n    , cast(performance_period_end as date) as performance_period_end\nfrom period_begin", "relation_name": "dev_tom.quality_measures._int_nqf0097__performance_period"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.717199Z", "completed_at": "2024-08-23T19:21:32.721487Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.723916Z", "completed_at": "2024-08-23T19:21:32.723919Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.01109623908996582, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_nqf2372__performance_period", "compiled": true, "compiled_code": "/*\n    set performance period end to the end of the current calendar year\n    or use the quality_measures_period_end variable if provided\n*/\nwith period_end as (\n\n    select\n        cast(\n        \n\n    dateadd(\n        day,\n        -1,\n        \n\n    dateadd(\n        year,\n        1,\n        date_trunc('year', convert_timezone('UTC', current_timestamp()))\n        )\n\n\n        )\n\n\n        as date)\n        \n         as performance_period_end\n)\n\n/*\n    set performance period begin to a year and a day prior\n    for a complete calendar year\n*/\n, period_begin as (\n\n    select\n          performance_period_end\n        , \n\n    dateadd(\n        day,\n        1,\n        \n\n    dateadd(\n        year,\n        -1,\n        performance_period_end\n        )\n\n\n        )\n\n as performance_period_begin\n    from period_end\n\n)\n\n/*\n    set performance lookback period to 27 months prior to the end of the\n    performance period\n*/\n, period_lookback as (\n\n    select\n          performance_period_end\n        , performance_period_begin\n        , \n\n    dateadd(\n        month,\n        -27,\n        performance_period_end\n        )\n\n as performance_period_lookback\n    from period_begin\n\n\n)\n\nselect\n      cast((select id\nfrom dev_tom.quality_measures._value_set_measures\nwhere id = 'NQF2372') as TEXT) as measure_id\n    , cast((select name\nfrom dev_tom.quality_measures._value_set_measures\nwhere id = 'NQF2372') as TEXT) as measure_name\n    , cast((select version\nfrom dev_tom.quality_measures._value_set_measures\nwhere id = 'NQF2372') as TEXT) as measure_version\n    , cast(performance_period_end as date) as performance_period_end\n    , cast(performance_period_begin as date) as performance_period_begin\n    , cast(performance_period_lookback as date) as performance_period_lookback\nfrom period_lookback", "relation_name": "dev_tom.quality_measures._int_nqf2372__performance_period"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.721919Z", "completed_at": "2024-08-23T19:21:32.724971Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.725456Z", "completed_at": "2024-08-23T19:21:32.725459Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.004489898681640625, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.mart_review__calendar_month", "compiled": true, "compiled_code": "\n\n\nselect distinct\ncast(year_month_int as TEXT) as year_month\n, full_date\n, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.reference_data.calendar c\nwhere day = 1", "relation_name": "dev_tom.data_quality.mart_review__calendar_month"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.725728Z", "completed_at": "2024-08-23T19:21:32.729831Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.730338Z", "completed_at": "2024-08-23T19:21:32.730342Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.005761146545410156, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__condition_normalized_code_type", "compiled": true, "compiled_code": "\n\nSELECT\n      m.data_source\n    , coalesce(m.recorded_date,cast('1900-01-01' as date)) as source_date\n    , 'CONDITION' AS table_name\n    , 'Condition ID' as drill_down_key\n    , coalesce(condition_id, 'NULL') AS drill_down_value\n    , 'NORMALIZED_CODE_TYPE' AS field_name\n    , case when term.code_type is not null then 'valid'\n           when m.normalized_code_type is not null then 'invalid'\n           else 'null'\n    end as bucket_name\n    , case when m.normalized_code_type is not null and term.code_type is null\n           then 'Normalized Code Type does not join to Terminology code_type table'\n           else null end as invalid_reason\n    , cast(normalized_code_type as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.condition m\nleft join dev_tom.reference_data.code_type as term on m.normalized_code_type = term.code_type", "relation_name": "dev_tom.data_quality.condition_normalized_code_type"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.727593Z", "completed_at": "2024-08-23T19:21:32.730164Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.732459Z", "completed_at": "2024-08-23T19:21:32.732463Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.007687807083129883, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__encounter_primary_diagnosis_code_type", "compiled": true, "compiled_code": "\n\nSELECT\n      m.data_source\n    , coalesce(m.encounter_start_date,cast('1900-01-01' as date)) as source_date\n    , 'ENCOUNTER' AS table_name\n    , 'Encounter ID' as drill_down_key\n    , coalesce(encounter_id, 'NULL') AS drill_down_value\n    , 'PRIMARY_DIAGNOSIS_CODE_TYPE' AS field_name\n    , case when term.code_type is not null then 'valid'\n          when m.primary_diagnosis_code_type is not null then 'invalid'\n          else 'null'\n    end as bucket_name\n    , case when m.primary_diagnosis_code_type is not null and term.code_type is null\n          then 'Primary Diagnosis Code Type does not join to Terminology code_type table'\n          else null end as invalid_reason\n    , cast(primary_diagnosis_code_type as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.encounter m\nleft join dev_tom.reference_data.code_type term on m.primary_diagnosis_code_type = term.code_type", "relation_name": "dev_tom.data_quality.encounter_primary_diagnosis_code_type"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.730623Z", "completed_at": "2024-08-23T19:21:32.733341Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.733953Z", "completed_at": "2024-08-23T19:21:32.733956Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.0043299198150634766, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__lab_result_normalized_code_type", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.result_date,cast('1900-01-01' as date)) as source_date\n    , 'LAB_RESULT' AS table_name\n    , 'Lab Result ID' as drill_down_key\n    , coalesce(lab_result_id, 'NULL') AS drill_down_value\n    , 'NORMALIZED_CODE_TYPE' as field_name\n    , case when term.code_type is not null then 'valid'\n          when m.normalized_code_type is not null then 'invalid'\n          else 'null'\n    end as bucket_name\n    , case when m.normalized_code_type is not null and term.code_type is null\n           then 'Normalized code type does not join to Terminology code_type table'\n           else null end as invalid_reason\n    , cast(normalized_code_type as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.lab_result m\nleft join dev_tom.reference_data.code_type term on m.normalized_code_type = term.code_type", "relation_name": "dev_tom.data_quality.lab_result_normalized_code_type"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.734377Z", "completed_at": "2024-08-23T19:21:32.739273Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.739600Z", "completed_at": "2024-08-23T19:21:32.739603Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.006465911865234375, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__procedure_normalized_code_type", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.procedure_date,cast('1900-01-01' as date)) as source_date\n    , 'PROCEDURE' AS table_name\n    , 'Procedure ID' as drill_down_key\n    , coalesce(procedure_id, 'NULL') AS drill_down_value\n    , 'NORMALIZED_CODE_TYPE' as field_name\n    , case when term.code_type is not null then 'valid'\n           when m.normalized_code_type is not null then 'invalid'\n           else 'null'\n    end as bucket_name\n    , case when m.normalized_code_type is not null and term.code_type is null\n           then 'Normalized code type does not join to Terminology code_type table'\n           else null end as invalid_reason\n    , cast(normalized_code_type as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.procedure m\nleft join dev_tom.reference_data.code_type term on m.normalized_code_type = term.code_type", "relation_name": "dev_tom.data_quality.procedure_normalized_code_type"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.737199Z", "completed_at": "2024-08-23T19:21:32.739857Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.742034Z", "completed_at": "2024-08-23T19:21:32.742037Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.008543968200683594, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__encounter_admit_source_code", "compiled": true, "compiled_code": "\n\nSELECT\n      m.data_source\n    , coalesce(m.encounter_start_date,cast('1900-01-01' as date)) as source_date\n    , 'ENCOUNTER' AS table_name\n    , 'Encounter ID' as drill_down_key\n    , coalesce(encounter_id, 'NULL') AS drill_down_value\n    , 'ADMIT_SOURCE_CODE' AS field_name\n    , case when term.admit_source_code is not null then 'valid'\n           when m.admit_source_code is not null then 'invalid'\n           else 'null'\n    end as bucket_name\n    , case when m.admit_source_code is not null and term.admit_source_code is null\n           then 'Admit source code does not join to Terminology admit source table'\n           else null end as invalid_reason\n    , cast(m.admit_source_code as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.encounter m\nleft join dev_tom.terminology.admit_source term on m.admit_source_code = term.admit_source_code", "relation_name": "dev_tom.data_quality.encounter_admit_source_code"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.740031Z", "completed_at": "2024-08-23T19:21:32.742721Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.743245Z", "completed_at": "2024-08-23T19:21:32.743248Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.004231929779052734, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__encounter_admit_type_code", "compiled": true, "compiled_code": "\n\nSELECT\n      m.data_source\n    , coalesce(m.encounter_start_date,cast('1900-01-01' as date)) as source_date\n    , 'ENCOUNTER' AS table_name\n    , 'Encounter ID' as drill_down_key\n    , coalesce(encounter_id, 'NULL') AS drill_down_value\n    , 'ADMIT_TYPE_CODE' AS field_name\n    , case when term.admit_type_code is not null then 'valid'\n          when m.admit_type_code is not null then 'invalid'\n          else 'null'\n    end as bucket_name\n    , case when m.admit_type_code is not null and term.admit_type_code is null\n          then 'Admit Type Code does not join to Terminology admit_type table'\n          else null end as invalid_reason\n    , cast(m.admit_type_code as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.encounter m\nleft join dev_tom.terminology.admit_type term on m.admit_type_code = term.admit_type_code", "relation_name": "dev_tom.data_quality.encounter_admit_type_code"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.743519Z", "completed_at": "2024-08-23T19:21:32.747737Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.748102Z", "completed_at": "2024-08-23T19:21:32.748105Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.005803823471069336, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__encounter_apr_drg_code", "compiled": true, "compiled_code": "\n\nSELECT\n    m.data_source\n    ,coalesce(m.encounter_start_date,cast('1900-01-01' as date)) as source_date\n    ,'ENCOUNTER' AS table_name\n    ,'Encounter ID' as drill_down_key\n    , coalesce(encounter_id, 'NULL') AS drill_down_value\n    ,'APR_DRG_CODE' AS field_name\n    ,case when term.apr_drg_code is not null then 'valid'\n          when m.apr_drg_code is not null then 'invalid'\n          else 'null'\n    end as bucket_name\n    ,case when m.apr_drg_code is not null and term.apr_drg_code is null\n          then 'APR DRG Code does not join to Terminology apr_drg table'\n          else null end as invalid_reason\n    ,cast(m.apr_drg_code as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.encounter m\nleft join dev_tom.terminology.apr_drg term on m.apr_drg_code = term.apr_drg_code", "relation_name": "dev_tom.data_quality.encounter_apr_drg_code"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.745756Z", "completed_at": "2024-08-23T19:21:32.750156Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.750542Z", "completed_at": "2024-08-23T19:21:32.750545Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.007523059844970703, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__encounter_discharge_disposition_code", "compiled": true, "compiled_code": "\n\nSELECT\n      m.data_source\n    , coalesce(m.encounter_start_date,cast('1900-01-01' as date)) as source_date\n    , 'ENCOUNTER' AS table_name\n    , 'Encounter ID' as drill_down_key\n    , coalesce(encounter_id, 'NULL') AS drill_down_value\n    , 'DISCHARGE_DISPOSITION_CODE' AS field_name\n    , case when term.discharge_disposition_code is not null then 'valid'\n           when m.discharge_disposition_code is not null then 'invalid'\n           else 'null'\n    end as bucket_name\n    , case when m.discharge_disposition_code is not null and term.discharge_disposition_code is null\n           then 'Discharge Disposition Code does not join to Terminology discharge_disposition table'\n           else null end as invalid_reason\n    , cast(m.discharge_disposition_code as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.encounter m\nleft join dev_tom.terminology.discharge_disposition term on m.discharge_disposition_code = term.discharge_disposition_code", "relation_name": "dev_tom.data_quality.encounter_discharge_disposition_code"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.748376Z", "completed_at": "2024-08-23T19:21:32.751184Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.751680Z", "completed_at": "2024-08-23T19:21:32.751682Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.004138946533203125, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__encounter_encounter_type", "compiled": true, "compiled_code": "\n\nSELECT\n      m.data_source\n    , coalesce(m.encounter_start_date,cast('1900-01-01' as date)) as source_date\n    , 'ENCOUNTER' AS table_name\n    , 'Encounter ID' as drill_down_key\n    , coalesce(encounter_id, 'NULL') AS drill_down_value\n    , 'ENCOUNTER_TYPE' AS field_name\n    , case when term.encounter_type is not null then 'valid'\n          when m.encounter_type is not null then 'invalid'\n          else 'null'\n    end as bucket_name\n    , case when m.encounter_type is not null and term.encounter_type is null\n          then 'Encounter type does not join to Terminology encounter_type table'\n          else null end as invalid_reason\n    , cast(m.encounter_type as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.encounter m\nleft join dev_tom.terminology.encounter_type term on m.encounter_type = term.encounter_type", "relation_name": "dev_tom.data_quality.encounter_encounter_type"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.751950Z", "completed_at": "2024-08-23T19:21:32.756553Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.756928Z", "completed_at": "2024-08-23T19:21:32.756931Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.006133079528808594, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__patient_sex", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    \n        , cast(coalesce(convert_timezone('UTC', current_timestamp()), cast('1900-01-01' as date)) as date) as source_date\n    \n    , 'PATIENT' AS table_name\n    , 'Patient ID' as drill_down_key\n    , coalesce(patient_id, 'NULL') AS drill_down_value\n    , 'SEX' as field_name\n    , case when term.gender is not null then 'valid'\n           when m.sex is not null then 'invalid'\n           else 'null'\n    end as bucket_name\n    , case when m.sex is not null and term.gender is null\n           then 'Sex does not join to Terminology gender table'\n           else null end as invalid_reason\n    , cast(sex as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.patient m\nleft join dev_tom.terminology.gender term on m.sex = term.gender", "relation_name": "dev_tom.data_quality.patient_sex"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.754466Z", "completed_at": "2024-08-23T19:21:32.758993Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.759409Z", "completed_at": "2024-08-23T19:21:32.759412Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.007929086685180664, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__procedure_modifier_1", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.procedure_date,cast('1900-01-01' as date)) as SOURCE_DATE\n    , 'PROCEDURE' AS table_name\n    , 'Procedure ID' as drill_down_key\n    , coalesce(procedure_id, 'NULL') AS drill_down_value\n    , 'MODIFIER_1' as field_name\n    , case when term.hcpcs is not null then 'valid'\n           when m.modifier_1 is not null then 'invalid'\n           else 'null'\n    end as bucket_name\n    , case when m.modifier_1 is not null and term.hcpcs is null\n           then 'Modifier 1 does not join to Terminology hcpcs_level_2 table'\n           else null end as invalid_reason\n    , cast(modifier_1 as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.procedure m\nleft join dev_tom.terminology.hcpcs_level_2 term on m.modifier_1 = term.hcpcs", "relation_name": "dev_tom.data_quality.procedure_modifier_1"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.757210Z", "completed_at": "2024-08-23T19:21:32.760054Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.760523Z", "completed_at": "2024-08-23T19:21:32.760527Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.004171133041381836, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__procedure_modifier_2", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.procedure_date,cast('1900-01-01' as date)) as source_date\n    , 'PROCEDURE' AS table_name\n    , 'Procedure ID' as drill_down_key\n    , coalesce(procedure_id, 'NULL') AS drill_down_value\n    , 'MODIFIER_2' as field_name\n    , case when term.hcpcs is not null then 'valid'\n           when m.modifier_2 is not null then 'invalid'\n           else 'null'\n    end as bucket_name\n    , case when m.modifier_2 is not null and term.hcpcs is null\n           then 'Modifier 2 does not join to Terminology hcpcs_level_2 table'\n           else null end as invalid_reason\n    , cast(modifier_2 as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.procedure m\nleft join dev_tom.terminology.hcpcs_level_2 term on m.modifier_2 = term.hcpcs", "relation_name": "dev_tom.data_quality.procedure_modifier_2"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.760793Z", "completed_at": "2024-08-23T19:21:32.765858Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.766212Z", "completed_at": "2024-08-23T19:21:32.766215Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.006554841995239258, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__procedure_modifier_3", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.procedure_date,cast('1900-01-01' as date)) as source_date\n    , 'PROCEDURE' AS table_name\n    , 'Procedure ID' as drill_down_key\n    , coalesce(procedure_id, 'NULL') AS drill_down_value\n    , 'MODIFIER_3' as field_name\n    , case when term.hcpcs is not null then 'valid'\n           when m.modifier_3 is not null then 'invalid'\n           else 'null'\n    end as bucket_name\n    , case when m.modifier_3 is not null and term.hcpcs is null\n           then 'Modifier 3 does not join to Terminology hcpcs_level_2 table'\n           else null end as invalid_reason\n    , cast(modifier_3 as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.procedure m\nleft join dev_tom.terminology.hcpcs_level_2 term on m.modifier_3 = term.hcpcs", "relation_name": "dev_tom.data_quality.procedure_modifier_3"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.762950Z", "completed_at": "2024-08-23T19:21:32.766468Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.768662Z", "completed_at": "2024-08-23T19:21:32.768665Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.00833272933959961, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__procedure_modifier_4", "compiled": true, "compiled_code": "\n\n\nSELECT\n    m.data_source\n    ,coalesce(m.procedure_date,cast('1900-01-01' as date)) as source_date\n    ,'PROCEDURE' AS table_name\n    ,'Procedure ID' as drill_down_key\n    , coalesce(procedure_id, 'NULL') AS drill_down_value\n    ,'MODIFIER_4' as field_name\n    ,case when term.hcpcs is not null then 'valid'\n          when m.modifier_4 is not null then 'invalid'\n          else 'null'\n    end as bucket_name\n    ,case when m.modifier_4 is not null and term.hcpcs is null\n          then 'Modifier 4 does not join to Terminology hcpcs_level_2 table'\n    else null end as invalid_reason\n    ,cast(modifier_4 as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.procedure m\nleft join dev_tom.terminology.hcpcs_level_2 term on m.modifier_4 = term.hcpcs", "relation_name": "dev_tom.data_quality.procedure_modifier_4"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.766634Z", "completed_at": "2024-08-23T19:21:32.769355Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.769850Z", "completed_at": "2024-08-23T19:21:32.769853Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.004219770431518555, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__procedure_modifier_5", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.procedure_date,cast('1900-01-01' as date)) as source_date\n    , 'PROCEDURE' AS table_name\n    , 'Procedure ID' as drill_down_key\n    , coalesce(procedure_id, 'NULL') AS drill_down_value\n    , 'MODIFIER_5' as field_name\n    , case when term.hcpcs is not null then 'valid'\n           when m.modifier_5 is not null then 'invalid'\n           else 'null'\n    end as bucket_name\n    , case when m.modifier_5 is not null and term.hcpcs is null\n           then 'Modifier 5 does not join to Terminology hcpcs_level_2 table'\n           else null end as invalid_reason\n    , cast(modifier_5 as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.procedure m\nleft join dev_tom.terminology.hcpcs_level_2 term on m.modifier_5 = term.hcpcs", "relation_name": "dev_tom.data_quality.procedure_modifier_5"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.770109Z", "completed_at": "2024-08-23T19:21:32.774263Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.774596Z", "completed_at": "2024-08-23T19:21:32.774599Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.005654096603393555, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__condition_normalized_code", "compiled": true, "compiled_code": "\n\nSELECT\n      m.data_source\n    , coalesce(m.recorded_date,cast('1900-01-01' as date)) as source_date\n    , 'CONDITION' AS table_name\n    , 'Condition ID' as drill_down_key\n    , coalesce(condition_id, 'NULL') AS drill_down_value\n    , 'NORMALIZED_CODE' AS field_name\n    , case when term.icd_10_cm is not null then 'valid'\n          when m.normalized_code is not null then 'invalid'\n          else 'null'\n    end as bucket_name\n    , case when m.normalized_code is not null and term.icd_10_cm is null\n           then 'Normalized code does not join to Terminology icd_10_cm table'\n           else null end as invalid_reason\n    , cast(normalized_code as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.condition m\nleft join dev_tom.terminology.icd_10_cm term on m.normalized_code = term.icd_10_cm", "relation_name": "dev_tom.data_quality.condition_normalized_code"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.772262Z", "completed_at": "2024-08-23T19:21:32.778608Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.779013Z", "completed_at": "2024-08-23T19:21:32.779016Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.009372711181640625, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__encounter_primary_diagnosis_code", "compiled": true, "compiled_code": "\n\nSELECT\n      m.data_source\n    , coalesce(m.encounter_start_date,cast('1900-01-01' as date)) as source_date\n    , 'ENCOUNTER' AS table_name\n    , 'Encounter ID' as drill_down_key\n    , coalesce(encounter_id, 'NULL') AS drill_down_value\n    , 'PRIMARY_DIAGNOSIS_CODE' AS field_name\n    , case when term.icd_10_cm is not null then 'valid'\n          when m.primary_diagnosis_code is not null then 'invalid'\n          else 'null'\n    end as bucket_name\n    , case when m.primary_diagnosis_code is not null and term.icd_10_cm is null\n          then 'Primary diagnosis code does not join to Terminology icd_10_cm table'\n    else null end as invalid_reason\n    , cast(primary_diagnosis_code as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.encounter m\nleft join dev_tom.terminology.icd_10_cm term on m.primary_diagnosis_code = term.icd_10_cm", "relation_name": "dev_tom.data_quality.encounter_primary_diagnosis_code"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.774875Z", "completed_at": "2024-08-23T19:21:32.779661Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.780178Z", "completed_at": "2024-08-23T19:21:32.780181Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.006142854690551758, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__procedure_normalized_code", "compiled": true, "compiled_code": "\n\nwith icd9 as (\n    SELECT\n          m.data_source\n        , coalesce(m.procedure_date,cast('1900-01-01' as date)) as source_date\n        , 'PROCEDURE' AS table_name\n        , 'Procedure ID' as drill_down_key\n        , coalesce(procedure_id, 'NULL') AS drill_down_value\n        , 'NORMALIZED_CODE' as field_name\n        , case when term.icd_9_pcs is not null then 'valid'\n               when m.normalized_code is not null then 'invalid'\n               else 'null'\n        end as bucket_name\n        , case when m.normalized_code is not null and term.icd_9_pcs is null\n               then 'Normalized code does not join to Terminology icd_9_pcs table'\n               else null end as invalid_reason\n        , cast(normalized_code as TEXT) as field_value\n    from tuva.input_layer.procedure m\n    left join dev_tom.terminology.icd_9_pcs term on m.normalized_code = term.icd_9_pcs\n    where\n        m.normalized_code_type = 'icd-9-pcs'\n),\nicd10 as (\n    SELECT\n      m.data_source\n    , coalesce(m.procedure_date,cast('1900-01-01' as date)) as source_date\n    , 'PROCEDURE' AS table_name\n    , 'Procedure ID' as drill_down_key\n    , coalesce(procedure_id, 'NULL') AS drill_down_value\n    , 'NORMALIZED_CODE' as field_name\n    , case when term.icd_10_pcs is not null then 'valid'\n           when m.normalized_code is not null then 'invalid'\n           else 'null'\n    end as bucket_name\n    , case when m.normalized_code is not null and term.icd_10_pcs is null\n           then 'Normalized code does not join to Terminology icd_10_pcs table'\n           else null end as invalid_reason\n    , cast(normalized_code as TEXT) as field_value\nfrom tuva.input_layer.procedure m\nleft join dev_tom.terminology.icd_10_pcs term on m.normalized_code = term.icd_10_pcs\nwhere\n    m.normalized_code_type = 'icd_10_pcs'\n),\nhcpcs_level_2 as (\n    SELECT\n      m.data_source\n    , coalesce(m.procedure_date,cast('1900-01-01' as date)) as source_date\n    , 'PROCEDURE' AS table_name\n    , 'Procedure ID' as drill_down_key\n    , coalesce(procedure_id, 'NULL') AS drill_down_value\n    , 'NORMALIZED_CODE' as field_name\n    , case when term.hcpcs is not null then 'valid'\n           when m.normalized_code is not null then 'invalid'\n           else 'null'\n    end as bucket_name\n    , case when m.normalized_code is not null and term.hcpcs is null\n           then 'Normalized code does not join to Terminology hcpcs_level_2 table'\n           else null end as invalid_reason\n    , cast(normalized_code as TEXT) as field_value\nfrom tuva.input_layer.procedure m\nleft join dev_tom.terminology.hcpcs_level_2 term on m.normalized_code = term.hcpcs\nwhere\n    m.normalized_code_type = 'hcpcs_level_2'\n),\n\nothers as (\n    SELECT\n      m.data_source\n    , coalesce(m.procedure_date,cast('1900-01-01' as date)) as source_date\n    , 'PROCEDURE' AS table_name\n    , 'Procedure ID' as drill_down_key\n    , coalesce(procedure_id, 'NULL') AS drill_down_value\n    , 'NORMALIZED_CODE' as field_name\n    , 'null' as bucket_name\n    , 'code type does not have a matching code terminology table' as invalid_reason\n    , cast(normalized_code as TEXT) as field_value\nfrom tuva.input_layer.procedure m\nwhere\n    m.normalized_code_type not in ('icd-9-pcs', 'icd-10-pcs','hcpcs_level_2')\n)\n\nSELECT *, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run FROM icd9\n\nunion all\n\nSELECT * , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run FROM icd10\n\nunion all\n\nSELECT * , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run FROM hcpcs_level_2\n\nunion all\n\nSELECT * , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run FROM others", "relation_name": "dev_tom.data_quality.procedure_normalized_code"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.780430Z", "completed_at": "2024-08-23T19:21:32.784577Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.784973Z", "completed_at": "2024-08-23T19:21:32.784976Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.005712032318115234, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__lab_result_normalized_code", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.result_date,cast('1900-01-01' as date)) as source_date\n    , 'LAB_RESULT' AS table_name\n    , 'Lab Result ID' as drill_down_key\n    , coalesce(lab_result_id, 'NULL') AS drill_down_value\n    , 'NORMALIZED_CODE' as field_name\n    , case when term.loinc is not null then 'valid'\n          when m.normalized_code is not null then 'invalid'\n          else 'null'\n    end as bucket_name\n    , case when m.normalized_code is not null and term.loinc is null\n           then 'Normalized code does not join to Terminology loinc table'\n           else null end as invalid_reason\n    , cast(normalized_code as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.lab_result m\nleft join dev_tom.terminology.loinc term on m.normalized_code = term.loinc", "relation_name": "dev_tom.data_quality.lab_result_normalized_code"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.782628Z", "completed_at": "2024-08-23T19:21:32.785229Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.787429Z", "completed_at": "2024-08-23T19:21:32.787431Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.007462978363037109, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__lab_result_normalized_component", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.result_date,cast('1900-01-01' as date)) as source_date\n    , 'LAB_RESULT' AS table_name\n    , 'Lab Result ID' as drill_down_key\n    , coalesce(lab_result_id, 'NULL') AS drill_down_value\n    , 'NORMALIZED_COMPONENT' as field_name\n    , case when term.loinc is not null then 'valid'\n          when m.normalized_component is not null then 'invalid'\n          else 'null'\n    end as bucket_name\n    , case when m.normalized_component is not null and term.loinc is null\n           then 'Normalized component does not join to Terminology loinc table'\n           else null end as invalid_reason\n    , cast(normalized_component as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.lab_result m\nleft join dev_tom.terminology.loinc term on m.normalized_component = term.loinc", "relation_name": "dev_tom.data_quality.lab_result_normalized_component"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.785396Z", "completed_at": "2024-08-23T19:21:32.788111Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.788613Z", "completed_at": "2024-08-23T19:21:32.788615Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.004225015640258789, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__encounter_ms_drg_code", "compiled": true, "compiled_code": "\n\nSELECT\n      m.data_source\n    , coalesce(m.encounter_start_date,cast('1900-01-01' as date)) as source_date\n    , 'ENCOUNTER' AS table_name\n    , 'Encounter ID' as drill_down_key\n    , coalesce(encounter_id, 'NULL') AS drill_down_value\n    , 'MS_DRG_CODE' AS field_name\n    , case when term.ms_drg_code is not null then 'valid'\n          when m.ms_drg_code is not null then 'invalid'\n          else 'null'\n    end as bucket_name\n    , case when m.ms_drg_code is not null and term.ms_drg_code is null\n          then 'MS DRG Code does not join to Terminology ms_drg table'\n          else null end as invalid_reason\n    , cast(m.ms_drg_code as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.encounter m\nleft join dev_tom.terminology.ms_drg term on m.ms_drg_code = term.ms_drg_code", "relation_name": "dev_tom.data_quality.encounter_ms_drg_code"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.788881Z", "completed_at": "2024-08-23T19:21:32.793871Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.794244Z", "completed_at": "2024-08-23T19:21:32.794247Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.006551980972290039, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__medication_ndc_description", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.dispensing_date,cast('1900-01-01' as date)) as source_date\n    , 'MEDICATION' AS table_name\n    , 'Medication ID' as drill_down_key\n    , coalesce(medication_id, 'NULL') AS drill_down_value\n    , 'NDC_DESCRIPTION' as field_name\n    , case when term.ndc is not null then 'valid'\n           when m.ndc_code is not null then 'invalid'\n           else 'null'\n    end as bucket_name\n    , case when m.ndc_code is not null and term.ndc is null\n           then 'NDC code type does not join to Terminology ndc table'\n           else null end as invalid_reason\n    , cast(substring(ndc_description, 1, 255) as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.medication m\nleft join dev_tom.terminology.ndc term on m.ndc_code = term.ndc", "relation_name": "dev_tom.data_quality.medication_ndc_description"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.791043Z", "completed_at": "2024-08-23T19:21:32.796339Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.796742Z", "completed_at": "2024-08-23T19:21:32.796744Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.00833892822265625, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__condition_present_on_admit_code", "compiled": true, "compiled_code": "\n\nSELECT\n    m.data_source\n    ,coalesce(m.recorded_date,cast('1900-01-01' as date)) as source_date\n    ,'CONDITION' AS table_name\n    ,'Condition ID' as drill_down_key\n    , coalesce(condition_id, 'NULL') AS drill_down_value\n    ,'PRESENT_ON_ADMIT_CODE' AS field_name\n    ,case when term.present_on_admit_code is not null then 'valid'\n          when m.present_on_admit_code is not null then 'invalid'\n          else 'null'\n    end as bucket_name\n    ,case when m.present_on_admit_code is not null and term.present_on_admit_code is null\n          then 'Present On Admit Code does not join to Terminology present_on_admission table'\n          else null\n    end as invalid_reason\n    ,cast(m.present_on_admit_code as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.condition m\nleft join dev_tom.terminology.present_on_admission term on m.present_on_admit_code = term.present_on_admit_code", "relation_name": "dev_tom.data_quality.condition_present_on_admit_code"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.794520Z", "completed_at": "2024-08-23T19:21:32.797371Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.797889Z", "completed_at": "2024-08-23T19:21:32.797892Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.00421595573425293, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__encounter_attending_provider_id", "compiled": true, "compiled_code": "\n\nSELECT\n      m.data_source\n    , coalesce(m.encounter_start_date,cast('1900-01-01' as date)) as source_date\n    , 'ENCOUNTER' AS table_name\n    , 'Encounter ID' as drill_down_key\n    , coalesce(encounter_id, 'NULL') AS drill_down_value\n    , 'ATTENDING_PROVIDER_ID' AS field_name\n    , case when term.npi is not null then 'valid'\n          when m.attending_provider_id is not null then 'invalid'\n          else 'null'\n    end as bucket_name\n    , case when m.attending_provider_id is not null and term.npi is null\n          then 'Attending provider ID does not join to Terminology provider table'\n          else null end as invalid_reason\n    , cast(attending_provider_id as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.encounter m\nleft join dev_tom.terminology.provider term on m.attending_provider_id = term.npi", "relation_name": "dev_tom.data_quality.encounter_attending_provider_id"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.798153Z", "completed_at": "2024-08-23T19:21:32.802873Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.804180Z", "completed_at": "2024-08-23T19:21:32.804183Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.007194042205810547, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__encounter_facility_id", "compiled": true, "compiled_code": "\n\nSELECT\n      m.data_source\n    , coalesce(m.encounter_start_date,cast('1900-01-01' as date)) as source_date\n    , 'ENCOUNTER' AS table_name\n    , 'Encounter ID' as drill_down_key\n    , coalesce(encounter_id, 'NULL') AS drill_down_value\n    , 'FACILITY_ID' AS field_name\n    , case when term.npi is not null then 'valid'\n          when m.facility_id is not null then 'invalid'\n          else 'null'\n    end as bucket_name\n    , case when m.facility_id is not null and term.npi is null\n          then 'Facility NPI does not join to Terminology provider table'\n          else null end as invalid_reason\n    , cast(facility_id as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.encounter m\nleft join dev_tom.terminology.provider term on m.facility_id = term.npi", "relation_name": "dev_tom.data_quality.encounter_facility_id"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.800377Z", "completed_at": "2024-08-23T19:21:32.804012Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.806810Z", "completed_at": "2024-08-23T19:21:32.806813Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.009135007858276367, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__lab_result_ordering_practitioner_id", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.result_date,cast('1900-01-01' as date)) as source_date\n    , 'LAB_RESULT' AS table_name\n    , 'Lab Result ID' as drill_down_key\n    , coalesce(lab_result_id, 'NULL') AS drill_down_value\n    , 'ORDERING_PRACTITIONER_ID' as field_name\n    , case when term.npi is not null then 'valid'\n          when m.ordering_practitioner_id is not null then 'invalid'\n          else 'null'\n    end as bucket_name\n    , case when m.ordering_practitioner_id is not null and term.npi is null\n           then 'Ordering practitioner ID does not join to Terminology provider table'\n           else null end as invalid_reason\n    , cast(ordering_practitioner_id as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.lab_result m\nleft join dev_tom.terminology.provider term on m.ordering_practitioner_id = term.npi", "relation_name": "dev_tom.data_quality.lab_result_ordering_practitioner_id"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.804451Z", "completed_at": "2024-08-23T19:21:32.807841Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.808378Z", "completed_at": "2024-08-23T19:21:32.808381Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.006062030792236328, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__location_npi", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    \n        , cast(coalesce(convert_timezone('UTC', current_timestamp()), cast('1900-01-01' as date)) as date) as source_date\n    \n    , 'LOCATION' AS table_name\n    , 'Location ID' as drill_down_key\n    , coalesce(location_id, 'NULL') AS drill_down_value\n    , 'NPI' as field_name\n    , case when term.npi is not null then 'valid'\n          when m.npi is not null then 'invalid'\n          else 'null'\n    end as bucket_name\n    , case when m.npi is not null and term.npi is null\n          then 'NPI does not join to Terminology provider table'\n    else null end as invalid_reason\n    , cast(m.npi as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.location m\nleft join dev_tom.terminology.provider term on m.npi = term.npi", "relation_name": "dev_tom.data_quality.location_npi"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.811413Z", "completed_at": "2024-08-23T19:21:32.816322Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.816663Z", "completed_at": "2024-08-23T19:21:32.816666Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.008502960205078125, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__patient_race", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    \n        , cast(coalesce(convert_timezone('UTC', current_timestamp()), cast('1900-01-01' as date)) as date) as source_date\n    \n    , 'PATIENT' AS table_name\n    , 'Patient ID' as drill_down_key\n    , coalesce(patient_id, 'NULL') AS drill_down_value\n    , 'RACE' as field_name\n    , case when term.description is not null then 'valid'\n           when m.race is not null then 'invalid'\n           else 'null'\n    end as bucket_name\n    , case when m.race is not null and term.description is null\n           then 'Race description does not join to Terminology race table'\n           else null end as invalid_reason\n    , cast(race as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.patient m\nleft join dev_tom.terminology.race term on m.race = term.description", "relation_name": "dev_tom.data_quality.patient_race"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.809146Z", "completed_at": "2024-08-23T19:21:32.816471Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.816954Z", "completed_at": "2024-08-23T19:21:32.816957Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.008995771408081055, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__practitioner_npi", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    \n        , cast(coalesce(convert_timezone('UTC', current_timestamp()), cast('1900-01-01' as date)) as date) as source_date\n    \n    , 'PRACTITIONER' AS table_name\n    , 'Practitioner ID' as drill_down_key\n    , coalesce(practitioner_id, 'NULL') AS drill_down_value\n    , 'NPI' as field_name\n    , case when term.npi is not null then 'valid'\n           when m.npi is not null then 'invalid'\n           else 'null'\n    end as bucket_name\n    , case when m.npi is not null and term.npi is null\n           then 'NPI does not join to Terminology provider table'\n           else null end as invalid_reason\n    , cast(m.npi as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.practitioner m\nleft join dev_tom.terminology.provider term on m.npi = term.npi", "relation_name": "dev_tom.data_quality.practitioner_npi"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.814256Z", "completed_at": "2024-08-23T19:21:32.817388Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.817942Z", "completed_at": "2024-08-23T19:21:32.817945Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.004313230514526367, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__medication_atc_code", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.dispensing_date,cast('1900-01-01' as date)) as source_date\n    , 'MEDICATION' AS table_name\n    , 'Medication ID' as drill_down_key\n    , coalesce(medication_id, 'NULL') AS drill_down_value\n    , 'ATC_CODE' as field_name\n    , case when coalesce(term_1.atc_1_name,term_2.atc_2_name,term_3.atc_3_name,term_4.atc_4_name) is not null then 'valid'\n           when m.atc_code is not null then 'invalid'\n           else 'null'\n    end as bucket_name\n    , case when m.atc_code is not null and coalesce(term_1.atc_1_name,term_2.atc_2_name,term_3.atc_3_name,term_4.atc_4_name) is null\n           then 'ATC Code does not join to Terminology rxnorm_to_atc table on any atc level'\n           else null end as invalid_reason\n    , cast(atc_code as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.medication m\nleft join dev_tom.terminology.rxnorm_to_atc term_1 on m.atc_code = term_1.atc_1_name\nleft join dev_tom.terminology.rxnorm_to_atc term_2 on m.atc_code = term_2.atc_2_name\nleft join dev_tom.terminology.rxnorm_to_atc term_3 on m.atc_code = term_3.atc_3_name\nleft join dev_tom.terminology.rxnorm_to_atc term_4 on m.atc_code = term_4.atc_4_name", "relation_name": "dev_tom.data_quality.medication_atc_code"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.818929Z", "completed_at": "2024-08-23T19:21:32.826629Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.826846Z", "completed_at": "2024-08-23T19:21:32.826849Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.009121894836425781, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__medication_rxnorm_code", "compiled": true, "compiled_code": "\n\n\nSELECT\n      m.data_source\n    , coalesce(m.dispensing_date,cast('1900-01-01' as date)) as source_date\n    , 'MEDICATION' AS table_name\n    , 'Medication ID' as drill_down_key\n    , coalesce(medication_id, 'NULL') AS drill_down_value\n    , 'RXNORM_CODE' as field_name\n    , case when term.rxcui is not null then 'valid'\n           when m.rxnorm_code is not null then 'invalid'\n           else 'null'\n    end as bucket_name\n    , case when m.rxnorm_code is not null and term.rxcui is null\n           then 'RX norm code does not join to Terminology rxnorm_to_atc table'\n           else null end as invalid_reason\n    , cast(rxnorm_code as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.medication m\nleft join dev_tom.terminology.rxnorm_to_atc term on m.rxnorm_code = term.rxcui", "relation_name": "dev_tom.data_quality.medication_rxnorm_code"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.821047Z", "completed_at": "2024-08-23T19:21:32.827129Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.827522Z", "completed_at": "2024-08-23T19:21:32.827525Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.009335994720458984, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__primary_keys_encounter_encounter_id", "compiled": true, "compiled_code": "\n\nWITH valid_conditions AS (\n    SELECT\n        *\n    FROM\n        dev_tom.data_quality.encounter_encounter_id\n    WHERE\n        bucket_name = 'valid'\n)\n, uniqueness_check as (\n        SELECT\n                field_value,\n                COUNT(*) AS duplicate_count\n        FROM\n                valid_conditions\n        GROUP BY\n                field_value\n        HAVING\n                COUNT(*) > 1\n)\n\n, random_sample AS (\n    SELECT\n        data_source,\n        source_date,\n        table_name,\n        drill_down_key,\n        drill_down_value,\n        field_name,\n        field_value,\n        bucket_name,\n        row_number() over (order by drill_down_key) as row_number_value\n    FROM\n        dev_tom.data_quality.encounter_encounter_id\n    WHERE\n        bucket_name = 'valid'\n\n)\n\n, duplicates_summary AS (\n    SELECT\n        a.data_source,\n        a.source_date,\n        a.table_name,\n        a.drill_down_key,\n        a.drill_down_value,\n        a.field_name,\n        a.field_value,\n        a.bucket_name,\n        b.duplicate_count,\n        row_number() over (order by drill_down_key) as row_number_value\n    FROM\n        dev_tom.data_quality.encounter_encounter_id a\n    JOIN\n        uniqueness_check b on a.field_value = b.field_value\n)\n\nSELECT\n    *\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nFROM\n    duplicates_summary\nwhere row_number_value <= 5\n\nunion all\n\nSELECT\n    *,\n    0 as duplicate_count\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nFROM\n    random_sample\nWHERE\n    row_number_value <= 5\n    and NOT EXISTS (SELECT 1 FROM duplicates_summary)", "relation_name": "dev_tom.data_quality.primary_keys_encounter_encounter_id"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.824422Z", "completed_at": "2024-08-23T19:21:32.827800Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.828331Z", "completed_at": "2024-08-23T19:21:32.828334Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.0075109004974365234, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__primary_keys_condition_condition_id", "compiled": true, "compiled_code": "\n\nWITH valid_conditions AS (\n    SELECT\n        *\n    FROM\n        dev_tom.data_quality.condition_condition_id\n    WHERE\n        bucket_name = 'valid'\n)\n, uniqueness_check as (\n        SELECT\n                field_value,\n                COUNT(*) AS duplicate_count\n        FROM\n                valid_conditions\n        GROUP BY\n                field_value\n        HAVING\n                COUNT(*) > 1\n)\n\n, random_sample AS (\n    SELECT\n        data_source,\n        source_date,\n        table_name,\n        drill_down_key,\n        drill_down_value,\n        field_name,\n        field_value,\n        bucket_name,\n        row_number() over (order by drill_down_key) as row_number_value\n    FROM\n        dev_tom.data_quality.condition_condition_id\n    WHERE\n        bucket_name = 'valid'\n\n)\n\n, duplicates_summary AS (\n    SELECT\n        a.data_source,\n        a.source_date,\n        a.table_name,\n        a.drill_down_key,\n        a.drill_down_value,\n        a.field_name,\n        a.field_value,\n        a.bucket_name,\n        b.duplicate_count,\n        row_number() over (order by drill_down_key) as row_number_value\n    FROM\n        dev_tom.data_quality.condition_condition_id a\n    inner JOIN\n        uniqueness_check b on a.field_value = b.field_value\n)\n\nSELECT\n    *\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nFROM\n    duplicates_summary\nwhere row_number_value <= 5\n\nunion all\n\nSELECT\n    *,\n    0 as duplicate_count\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nFROM\n    random_sample\nWHERE\n    row_number_value <= 5\n    and NOT EXISTS (SELECT 1 FROM duplicates_summary)", "relation_name": "dev_tom.data_quality.primary_keys_condition_condition_id"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.829128Z", "completed_at": "2024-08-23T19:21:32.834044Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.836486Z", "completed_at": "2024-08-23T19:21:32.836489Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.00857400894165039, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__primary_keys_location_location_id", "compiled": true, "compiled_code": "\n\nWITH valid_conditions AS (\n    SELECT\n        *\n    FROM\n        dev_tom.data_quality.location_location_id\n    WHERE\n        bucket_name = 'valid'\n)\n, uniqueness_check as (\n        SELECT\n                field_value,\n                COUNT(*) AS duplicate_count\n        FROM\n                valid_conditions\n        GROUP BY\n                field_value\n        HAVING\n                COUNT(*) > 1\n)\n\n, random_sample AS (\n    SELECT\n        data_source,\n        source_date,\n        table_name,\n        drill_down_key,\n        drill_down_value,\n        field_name,\n        field_value,\n        bucket_name,\n        row_number() over (order by drill_down_key) as row_number_value\n    FROM\n        dev_tom.data_quality.location_location_id\n    WHERE\n        bucket_name = 'valid'\n\n)\n\n, duplicates_summary AS (\n    SELECT\n        a.data_source,\n        a.source_date,\n        a.table_name,\n        a.drill_down_key,\n        a.drill_down_value,\n        a.field_name,\n        a.field_value,\n        a.bucket_name,\n        b.duplicate_count,\n        row_number() over (order by drill_down_key) as row_number_value\n    FROM\n        dev_tom.data_quality.location_location_id a\n    JOIN\n        uniqueness_check b on a.field_value = b.field_value\n)\n\nSELECT\n    *\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nFROM\n    duplicates_summary\nwhere row_number_value <= 5\n\nunion all\n\nSELECT\n    *,\n    0 as duplicate_count\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nFROM\n    random_sample\nWHERE\n    row_number_value <= 5\n    and NOT EXISTS (SELECT 1 FROM duplicates_summary)", "relation_name": "dev_tom.data_quality.primary_keys_location_location_id"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.831625Z", "completed_at": "2024-08-23T19:21:32.836748Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.837154Z", "completed_at": "2024-08-23T19:21:32.837157Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.008426904678344727, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.core__lab_result", "compiled": true, "compiled_code": "\n\n\n\n\nselect\n      labs.lab_result_id\n    , labs.patient_id\n    , labs.encounter_id\n    , labs.accession_number\n    , labs.source_code_type\n    , labs.source_code\n    , labs.source_description\n    , labs.source_component\n    , case\n        when labs.normalized_code_type is not null then labs.normalized_code_type\n        when loinc.loinc is not null then 'loinc'\n        when snomed_ct.snomed_ct is not null then 'snomed-ct'\n        else null end as normalized_code_type\n    , coalesce(\n        labs.normalized_code\n        , loinc.loinc\n        , snomed_ct.snomed_ct\n        ) as normalized_code\n    , coalesce(\n        labs.normalized_description\n        , loinc.long_common_name\n        , snomed_ct.description\n        ) normalized_description\n    , case when coalesce(labs.normalized_code, labs.normalized_description) is not null then 'manual'\n         when coalesce(loinc.loinc,snomed_ct.snomed_ct) is not null then 'automatic'\n         end as mapping_method\n    , labs.normalized_component\n    , labs.status\n    , labs.result\n    , labs.result_date\n    , labs.collection_date\n    , labs.source_units\n    , labs.normalized_units\n    , labs.source_reference_range_low\n    , labs.source_reference_range_high\n    , labs.normalized_reference_range_low\n    , labs.normalized_reference_range_high\n    , labs.source_abnormal_flag\n    , labs.normalized_abnormal_flag\n    , labs.specimen\n    , labs.ordering_practitioner_id\n    , labs.data_source\n    , labs.tuva_last_run\nFrom dev_tom.core._stg_clinical_lab_result as labs\nleft join dev_tom.terminology.loinc loinc\n    on labs.source_code_type = 'loinc'\n        and labs.source_code = loinc.loinc\nleft join dev_tom.terminology.snomed_ct snomed_ct\n    on labs.source_code_type = 'snomed-ct'\n        and labs.source_code = snomed_ct.snomed_ct\n\n ", "relation_name": "dev_tom.core.lab_result"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.834241Z", "completed_at": "2024-08-23T19:21:32.837418Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.838010Z", "completed_at": "2024-08-23T19:21:32.838013Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.0066280364990234375, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__primary_keys_lab_result_lab_result_id", "compiled": true, "compiled_code": "\n\nWITH valid_conditions AS (\n    SELECT\n        *\n    FROM\n        dev_tom.data_quality.lab_result_lab_result_id\n    WHERE\n        bucket_name = 'valid'\n)\n, uniqueness_check as (\n        SELECT\n                field_value,\n                COUNT(*) AS duplicate_count\n        FROM\n                valid_conditions\n        GROUP BY\n                field_value\n        HAVING\n                COUNT(*) > 1\n)\n\n, random_sample AS (\n    SELECT\n        data_source,\n        source_date,\n        table_name,\n        drill_down_key,\n        drill_down_value,\n        field_name,\n        field_value,\n        bucket_name,\n        row_number() over (order by drill_down_key) as row_number_value\n    FROM\n        dev_tom.data_quality.lab_result_lab_result_id\n    WHERE\n        bucket_name = 'valid'\n)\n\n, duplicates_summary AS (\n    SELECT\n        a.data_source,\n        a.source_date,\n        a.table_name,\n        a.drill_down_key,\n        a.drill_down_value,\n        a.field_name,\n        a.field_value,\n        a.bucket_name,\n        b.duplicate_count,\n        row_number() over (order by drill_down_key) as row_number_value\n    FROM\n        dev_tom.data_quality.lab_result_lab_result_id a\n    JOIN\n        uniqueness_check b on a.field_value = b.field_value\n)\n\nSELECT\n    *\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nFROM\n    duplicates_summary\nwhere row_number_value <= 5\n\nunion all\n\nSELECT\n    *,\n    0 as duplicate_count\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nFROM\n    random_sample\nWHERE\n    row_number_value <= 5\n    and NOT EXISTS (SELECT 1 FROM duplicates_summary)", "relation_name": "dev_tom.data_quality.primary_keys_lab_result_lab_result_id"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.838802Z", "completed_at": "2024-08-23T19:21:32.844311Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.847611Z", "completed_at": "2024-08-23T19:21:32.847614Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.01006627082824707, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.core__medication", "compiled": true, "compiled_code": "\n\n\nwith source_mapping as (\n\n    select\n     meds.medication_id\n   , meds.patient_id\n   , meds.encounter_id\n   , meds.dispensing_date\n   , meds.prescribing_date\n   , meds.source_code_type\n   , meds.source_code\n   , meds.source_description\n   , coalesce(\n       meds.ndc_code\n       , ndc.ndc\n       ) as ndc_code\n   ,  coalesce(\n       meds.ndc_description\n       , ndc.fda_description\n       , ndc.rxnorm_description\n       ) as ndc_description\n   , case\n        when meds.ndc_code is not null then 'manual'\n        when ndc.ndc is not null then 'automatic'\n        end as ndc_mapping_method\n   , coalesce(\n        meds.rxnorm_code\n        , rxatc.rxcui\n        ) as rxnorm_code\n   , coalesce(\n       meds.rxnorm_description\n       , rxatc.rxnorm_description\n       ) as rxnorm_description\n   , case\n        when meds.rxnorm_code is not null then 'manual'\n        when rxatc.rxcui is not null then 'automatic'\n        end as rxnorm_mapping_method\n   , coalesce(\n        meds.atc_code\n        , rxatc.atc_3_code\n        ) as atc_code\n   , coalesce(\n        meds.atc_description\n        , rxatc.atc_4_name\n        ) as atc_description\n   , case\n        when meds.atc_code is not null then 'manual'\n        when rxatc.atc_3_name is not null then 'automatic'\n        end as atc_mapping_method\n   , meds.route\n   , meds.strength\n   , meds.quantity\n   , meds.quantity_unit\n   , meds.days_supply\n   , meds.practitioner_id\n   , meds.data_source\n   , meds.tuva_last_run\nfrom dev_tom.core._stg_clinical_medication meds\n    left join dev_tom.terminology.ndc ndc\n        on meds.source_code_type = 'ndc'\n        and meds.source_code = ndc.ndc\n    left join dev_tom.terminology.rxnorm_to_atc rxatc\n        on meds.source_code_type = 'rxnorm'\n        and meds.source_code = rxatc.rxcui\n\n\n\n   )\n\n\n-- add auto rxnorm + atc\nselect\n     sm.medication_id\n   , sm.patient_id\n   , sm.encounter_id\n   , sm.dispensing_date\n   , sm.prescribing_date\n   , sm.source_code_type\n   , sm.source_code\n   , sm.source_description\n   , sm.ndc_code\n   , sm.ndc_description\n   , sm.ndc_mapping_method\n   , coalesce(\n        sm.rxnorm_code\n        , ndc.rxcui\n        ) as rxnorm_code\n   , coalesce(\n        sm.rxnorm_description\n        , ndc.rxnorm_description\n        ) as rxnorm_description\n   , case\n        when sm.rxnorm_mapping_method is not null then sm.rxnorm_mapping_method\n        when ndc.rxcui is not null then 'automatic'\n        end as rxnorm_mapping_method\n   , coalesce(\n        sm.atc_code\n        , rxatc.atc_3_code\n        ) as atc_code\n   , coalesce(\n        sm.atc_description\n        , rxatc.atc_3_name\n        ) as atc_description\n   , case\n        when sm.atc_mapping_method is not null then sm.atc_mapping_method\n        when rxatc.atc_3_name is not null then 'automatic'\n        end as atc_mapping_method\n   , sm.route\n   , sm.strength\n   , sm.quantity\n   , sm.quantity_unit\n   , sm.days_supply\n   , sm.practitioner_id\n   , sm.data_source\n   , sm.tuva_last_run\nfrom source_mapping sm\n    left join dev_tom.terminology.ndc ndc\n        on sm.ndc_code = ndc.ndc\n    left join dev_tom.terminology.rxnorm_to_atc rxatc\n        on coalesce( sm.rxnorm_code, ndc.rxcui ) = rxatc.rxcui", "relation_name": "dev_tom.core.medication"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.841940Z", "completed_at": "2024-08-23T19:21:32.847920Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.848486Z", "completed_at": "2024-08-23T19:21:32.848489Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.01007986068725586, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__primary_keys_medication_medication_id", "compiled": true, "compiled_code": "\n\nWITH valid_conditions AS (\n    SELECT\n        *\n    FROM\n        dev_tom.data_quality.medication_medication_id\n    WHERE\n        bucket_name = 'valid'\n)\n, uniqueness_check as (\n        SELECT\n                field_value,\n                COUNT(*) AS duplicate_count\n        FROM\n                valid_conditions\n        GROUP BY\n                field_value\n        HAVING\n                COUNT(*) > 1\n)\n\n, random_sample AS (\n    SELECT\n        data_source,\n        source_date,\n        table_name,\n        drill_down_key,\n        drill_down_value,\n        field_name,\n        field_value,\n        bucket_name,\n        row_number() over (order by drill_down_key) as row_number_value\n    FROM\n        dev_tom.data_quality.medication_medication_id\n    WHERE\n        bucket_name = 'valid'\n)\n\n, duplicates_summary AS (\n    SELECT\n        a.data_source,\n        a.source_date,\n        a.table_name,\n        a.drill_down_key,\n        a.drill_down_value,\n        a.field_name,\n        a.field_value,\n        a.bucket_name,\n        b.duplicate_count,\n        row_number() over (order by drill_down_key) as row_number_value\n    FROM\n        dev_tom.data_quality.medication_medication_id a\n    JOIN\n        uniqueness_check b on a.field_value = b.field_value\n)\n\nSELECT\n    *\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nFROM\n    duplicates_summary\nwhere row_number_value <= 5\n\nunion all\n\nSELECT\n    *,\n    0 as duplicate_count\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nFROM\n    random_sample\nWHERE\n    row_number_value <= 5\n    and NOT EXISTS (SELECT 1 FROM duplicates_summary)", "relation_name": "dev_tom.data_quality.primary_keys_medication_medication_id"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.844467Z", "completed_at": "2024-08-23T19:21:32.848342Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.848949Z", "completed_at": "2024-08-23T19:21:32.848952Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.007256984710693359, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.core__observation", "compiled": true, "compiled_code": "\n\n\nselect\n      obs.observation_id\n    , obs.patient_id\n    , obs.encounter_id\n    , obs.panel_id\n    , obs.observation_date\n    , obs.observation_type\n    , obs.source_code_type\n    , obs.source_code\n    , obs.source_description\n    , case\n        when obs.normalized_code_type is not null then obs.normalized_code_type\n        when icd10cm.icd_10_cm is not null then 'icd-10-cm'\n        when icd9cm.icd_9_cm is not null then 'icd-9-cm'\n        when icd10pcs.icd_10_pcs is not null then 'icd-10-pcs'\n        when icd9pcs.icd_9_pcs is not null then 'icd-10-pcs'\n        when hcpcs.hcpcs is not null then 'hcpcs'\n        when snomed_ct.snomed_ct is not null then 'snomed-ct'\n        when loinc.loinc is not null then 'loinc'\n        end as normalized_code_type\n  , coalesce(\n        obs.normalized_code\n      , icd10cm.icd_10_cm\n      , icd9cm.icd_9_cm\n      , icd10pcs.icd_10_pcs\n      , icd9pcs.icd_9_pcs\n      , hcpcs.hcpcs\n      , snomed_ct.snomed_ct\n      , loinc.loinc\n      ) as normalized_code\n      , coalesce(\n        obs.normalized_description\n      , icd10cm.short_description\n      , icd9cm.short_description\n      , icd10pcs.description\n      , icd9pcs.short_description\n      , hcpcs.short_description\n      , snomed_ct.description\n      , loinc.long_common_name\n      ) as normalized_description\n     , case\n         when coalesce(obs.normalized_code, obs.normalized_description) is not null then 'manual'\n         when coalesce(\n            icd10cm.icd_10_cm\n          , icd9cm.icd_9_cm\n          , icd10pcs.icd_10_pcs\n          , icd9pcs.icd_9_pcs\n          , hcpcs.hcpcs\n          , snomed_ct.snomed_ct\n          , loinc.loinc) is not null then 'automatic'\n         end as mapping_method\n    , obs.result\n    , obs.source_units\n    , obs.normalized_units\n    , obs.source_reference_range_low\n    , obs.source_reference_range_high\n    , obs.normalized_reference_range_low\n    , obs.normalized_reference_range_high\n    , obs.data_source\n    , obs.tuva_last_run\nfrom dev_tom.core._stg_clinical_observation obs\nleft join dev_tom.terminology.icd_10_cm icd10cm\n    on obs.source_code_type = 'icd-10-cm'\n        and replace(obs.source_code,'.','') = icd10cm.icd_10_cm\nleft join dev_tom.terminology.icd_9_cm icd9cm\n    on obs.source_code_type = 'icd-9-cm'\n        and replace(obs.source_code,'.','') = icd9cm.icd_9_cm\nleft join dev_tom.terminology.icd_10_pcs icd10pcs\n    on obs.source_code_type = 'icd-10-pcs'\n        and obs.source_code = icd10pcs.icd_10_pcs\nleft join dev_tom.terminology.icd_9_pcs icd9pcs\n    on obs.source_code_type = 'icd-9-pcs'\n        and replace(obs.source_code,'.','') = icd9pcs.icd_9_pcs\nleft join dev_tom.terminology.hcpcs_level_2 hcpcs\n    on obs.source_code_type = 'hcpcs'\n        and obs.source_code = hcpcs.hcpcs\nleft join dev_tom.terminology.snomed_ct snomed_ct\n    on obs.source_code_type = 'snomed-ct'\n        and obs.source_code = snomed_ct.snomed_ct\nleft join dev_tom.terminology.loinc loinc\n    on obs.source_code_type = 'loinc'\n        and obs.source_code = loinc.loinc\n\n", "relation_name": "dev_tom.core.observation"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.849983Z", "completed_at": "2024-08-23T19:21:32.857979Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.858211Z", "completed_at": "2024-08-23T19:21:32.858214Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.009485244750976562, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__primary_keys_observation_observation_id", "compiled": true, "compiled_code": "\n\nWITH valid_conditions AS (\n    SELECT\n        *\n    FROM\n        dev_tom.data_quality.observation_observation_id\n    WHERE\n        bucket_name = 'valid'\n)\n, uniqueness_check as (\n        SELECT\n                field_value,\n                COUNT(*) AS duplicate_count\n        FROM\n                valid_conditions\n        GROUP BY\n                field_value\n        HAVING\n                COUNT(*) > 1\n)\n\n, random_sample AS (\n    SELECT\n        data_source,\n        source_date,\n        table_name,\n        drill_down_key,\n        drill_down_value,\n        field_name,\n        field_value,\n        bucket_name,\n        row_number() over (order by drill_down_key) as row_number_value\n    FROM\n        dev_tom.data_quality.observation_observation_id\n    WHERE\n        bucket_name = 'valid'\n)\n\n, duplicates_summary AS (\n    SELECT\n        a.data_source,\n        a.source_date,\n        a.table_name,\n        a.drill_down_key,\n        a.drill_down_value,\n        a.field_name,\n        a.field_value,\n        a.bucket_name,\n        b.duplicate_count,\n        row_number() over (order by drill_down_key) as row_number_value\n    FROM\n        dev_tom.data_quality.observation_observation_id a\n    JOIN\n        uniqueness_check b on a.field_value = b.field_value\n)\n\nSELECT\n    *\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nFROM\n    duplicates_summary\nwhere row_number_value <= 5\n\nunion all\n\nSELECT\n    *,\n    0 as duplicate_count\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nFROM\n    random_sample\nWHERE\n    row_number_value <= 5\n    and NOT EXISTS (SELECT 1 FROM duplicates_summary)", "relation_name": "dev_tom.data_quality.primary_keys_observation_observation_id"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.852678Z", "completed_at": "2024-08-23T19:21:32.858689Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.859185Z", "completed_at": "2024-08-23T19:21:32.859188Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.009423017501831055, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__primary_keys_practitioner_practitioner_id", "compiled": true, "compiled_code": "\n\nWITH valid_conditions AS (\n    SELECT\n        *\n    FROM\n        dev_tom.data_quality.practitioner_practitioner_id\n    WHERE\n        bucket_name = 'valid'\n)\n, uniqueness_check as (\n        SELECT\n                field_value,\n                COUNT(*) AS duplicate_count\n        FROM\n                valid_conditions\n        GROUP BY\n                field_value\n        HAVING\n                COUNT(*) > 1\n)\n\n, random_sample AS (\n    SELECT\n        data_source,\n        source_date,\n        table_name,\n        drill_down_key,\n        drill_down_value,\n        field_name,\n        field_value,\n        bucket_name,\n        row_number() over (order by drill_down_key) as row_number_value\n    FROM\n        dev_tom.data_quality.practitioner_practitioner_id\n    WHERE\n        bucket_name = 'valid'\n)\n\n, duplicates_summary AS (\n    SELECT\n        a.data_source,\n        a.source_date,\n        a.table_name,\n        a.drill_down_key,\n        a.drill_down_value,\n        a.field_name,\n        a.field_value,\n        a.bucket_name,\n        b.duplicate_count,\n        row_number() over (order by drill_down_key) as row_number_value\n    FROM\n        dev_tom.data_quality.practitioner_practitioner_id a\n    JOIN\n        uniqueness_check b on a.field_value = b.field_value\n)\n\nSELECT\n    *\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nFROM\n    duplicates_summary\nwhere row_number_value <= 5\n\nunion all\n\nSELECT\n    *,\n    0 as duplicate_count\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nFROM\n    random_sample\nWHERE\n    row_number_value <= 5\n    and NOT EXISTS (SELECT 1 FROM duplicates_summary)", "relation_name": "dev_tom.data_quality.primary_keys_practitioner_practitioner_id"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.854872Z", "completed_at": "2024-08-23T19:21:32.859025Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.859611Z", "completed_at": "2024-08-23T19:21:32.859614Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.007511138916015625, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__primary_keys_patient_patient_id", "compiled": true, "compiled_code": "\n\nWITH valid_conditions AS (\n    SELECT\n        *\n    FROM\n        dev_tom.data_quality.patient_patient_id\n    WHERE\n        bucket_name = 'valid'\n)\n, uniqueness_check as (\n        SELECT\n                field_value,\n                COUNT(*) AS duplicate_count\n        FROM\n                valid_conditions\n        GROUP BY\n                field_value\n        HAVING\n                COUNT(*) > 1\n)\n\n, random_sample AS (\n    SELECT\n        data_source,\n        source_date,\n        table_name,\n        drill_down_key,\n        drill_down_value,\n        field_name,\n        field_value,\n        bucket_name,\n        row_number() over (order by drill_down_key) as row_number_value\n    FROM\n        dev_tom.data_quality.patient_patient_id\n    WHERE\n        bucket_name = 'valid'\n\n)\n\n, duplicates_summary AS (\n    SELECT\n        a.data_source,\n        a.source_date,\n        a.table_name,\n        a.drill_down_key,\n        a.drill_down_value,\n        a.field_name,\n        a.field_value,\n        a.bucket_name,\n        b.duplicate_count,\n        row_number() over (order by drill_down_key) as row_number_value\n    FROM\n        dev_tom.data_quality.patient_patient_id a\n    JOIN\n        uniqueness_check b on a.field_value = b.field_value\n)\n\nSELECT\n    *\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nFROM\n    duplicates_summary\nwhere row_number_value <= 5\n\nunion all\n\nSELECT\n    *,\n    0 as duplicate_count\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nFROM\n    random_sample\nWHERE\n    row_number_value <= 5\n    and NOT EXISTS (SELECT 1 FROM duplicates_summary)", "relation_name": "dev_tom.data_quality.primary_keys_patient_patient_id"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.860062Z", "completed_at": "2024-08-23T19:21:32.862998Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.865383Z", "completed_at": "2024-08-23T19:21:32.865385Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.006556987762451172, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__primary_keys_procedure_procedure_id", "compiled": true, "compiled_code": "\n\nWITH valid_conditions AS (\n    SELECT\n        *\n    FROM\n        dev_tom.data_quality.procedure_procedure_id\n    WHERE\n        bucket_name = 'valid'\n)\n, uniqueness_check as (\n        SELECT\n                field_value,\n                COUNT(*) AS duplicate_count\n        FROM\n                valid_conditions\n        GROUP BY\n                field_value\n        HAVING\n                COUNT(*) > 1\n)\n\n, random_sample AS (\n    SELECT\n        data_source,\n        source_date,\n        table_name,\n        drill_down_key,\n        drill_down_value,\n        field_name,\n        field_value,\n        bucket_name,\n        row_number() over (order by drill_down_key) as row_number_value\n    FROM\n        dev_tom.data_quality.procedure_procedure_id\n    WHERE\n        bucket_name = 'valid'\n)\n\n, duplicates_summary AS (\n    SELECT\n        a.data_source,\n        a.source_date,\n        a.table_name,\n        a.drill_down_key,\n        a.drill_down_value,\n        a.field_name,\n        a.field_value,\n        a.bucket_name,\n        b.duplicate_count,\n        row_number() over (order by drill_down_key) as row_number_value\n    FROM\n        dev_tom.data_quality.procedure_procedure_id a\n    JOIN\n        uniqueness_check b on a.field_value = b.field_value\n)\n\nSELECT\n    *\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nFROM\n    duplicates_summary\nwhere row_number_value <= 5\n\nunion all\n\nSELECT\n    *,\n    0 as duplicate_count\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nFROM\n    random_sample\nWHERE\n    row_number_value <= 5\n    and NOT EXISTS (SELECT 1 FROM duplicates_summary)", "relation_name": "dev_tom.data_quality.primary_keys_procedure_procedure_id"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.863322Z", "completed_at": "2024-08-23T19:21:32.871384Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.871759Z", "completed_at": "2024-08-23T19:21:32.871762Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.009351015090942383, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__eligibility_address", "compiled": true, "compiled_code": "\n\nSELECT DISTINCT \n    m.data_source\n    ,coalesce(cast(m.enrollment_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    ,'eligibility' as table_name\n    ,'Member ID | Enrollment Start Date' AS drill_down_key\n    ,coalesce(m.member_id, 'NULL') as drill_down_value\n    ,'ELIGIBILITY' AS claim_type\n    ,'ADDRESS' AS field_name\n    ,case when m.address is  null then 'null'\n                             else 'valid' end as bucket_name\n    ,cast(null as TEXT) as invalid_reason\n    ,CAST(address as TEXT) AS field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nFROM tuva.input_layer.eligibility m", "relation_name": "dev_tom.data_quality.eligibility_address"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.865632Z", "completed_at": "2024-08-23T19:21:32.872038Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.872549Z", "completed_at": "2024-08-23T19:21:32.872552Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.009936094284057617, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__eligibility_birth_date", "compiled": true, "compiled_code": "\n\nWITH base as (\n    SELECT * \n    FROM tuva.input_layer.eligibility\n\n),\nunique_field as (\n    SELECT DISTINCT member_id\n        ,cast(birth_date as TEXT) as field\n        ,data_source\n    FROM base\n),\nclaim_grain as (\n    SELECT member_id\n        ,data_source\n        ,count(*) as frequency\n    from unique_field\n    GROUP BY member_id\n        ,data_source\n),\nclaim_agg as (\nSELECT\n    member_id,\n    data_source,\n    \n    listagg(\n        coalesce(field, 'null'),\n        ', '\n        )\n        within group (order by field desc) AS field_aggregated\nFROM\n    unique_field\nGROUP BY\n    data_source,\n    member_id\n)\nSELECT DISTINCT\n    m.data_source\n    ,coalesce(cast(m.enrollment_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    ,'ELIGIBILITY' AS table_name\n    ,'Member ID' AS drill_down_key\n    ,coalesce(m.member_id, 'NULL') as drill_down_value\n    ,'ELIGIBILITY' AS claim_type\n    ,'BIRTH_DATE' AS field_name\n    ,CASE \n        WHEN cg.frequency > 1 THEN 'multiple'\n        WHEN m.birth_date > cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) THEN 'invalid'\n        WHEN m.birth_date <= cast('1901-01-01' as date) THEN 'invalid'\n        WHEN m.birth_date IS NULL THEN 'null'\n        ELSE 'valid' \n    END AS bucket_name\n    ,CASE \n        WHEN cg.frequency > 1 THEN 'multiple'\n        WHEN m.birth_date > cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) THEN 'future'\n        WHEN m.birth_date <= cast('1901-01-01' as date) THEN 'too old'\n        else null\n    END AS invalid_reason\n,CAST(\n  substr(agg.field_aggregated, 1, 255)\n as TEXT) AS field_value\n, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nFROM base m\nleft join claim_grain cg on m.member_id = cg.member_id and m.data_source = cg.data_source\nleft join claim_agg agg on m.member_id = agg.member_id and m.data_source = agg.data_source", "relation_name": "dev_tom.data_quality.eligibility_birth_date"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.872828Z", "completed_at": "2024-08-23T19:21:32.875573Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.877923Z", "completed_at": "2024-08-23T19:21:32.877926Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.006405830383300781, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__eligibility_city", "compiled": true, "compiled_code": "\n\nSELECT DISTINCT \n    m.data_source\n    ,coalesce(cast(m.enrollment_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    ,'ELIGIBILITY' AS table_name\n    ,'Member ID | Enrollment Start Date' AS drill_down_key\n        ,coalesce(m.member_id, 'NULL') as drill_down_value\n    ,'ELIGIBILITY' AS claim_type\n    ,'CITY' AS field_name\n    ,case when m.race is  null then 'null'\n                             else 'valid' end as bucket_name\n    ,cast(null as TEXT) as invalid_reason\n    ,CAST(city as TEXT) AS field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nFROM tuva.input_layer.eligibility m", "relation_name": "dev_tom.data_quality.eligibility_city"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.875745Z", "completed_at": "2024-08-23T19:21:32.881571Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.881951Z", "completed_at": "2024-08-23T19:21:32.881954Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.007167816162109375, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__eligibility_data_source", "compiled": true, "compiled_code": "\n\nSELECT DISTINCT -- to bring to claim_ID grain \n    m.data_source\n    ,coalesce(cast(m.enrollment_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    ,'ELIGIBILITY' AS table_name\n    ,'Member ID | Enrollment Start Date' AS drill_down_key\n        ,coalesce(m.member_id, 'NULL') as drill_down_value\n    ,'ELIGIBILITY' AS claim_type\n    ,'DATA_SOURCE' AS field_name\n    ,case when m.data_source is not null then 'valid' else 'null' end as bucket_name\n    ,cast(null as TEXT) as invalid_reason\n    ,cast(data_source as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nFROM tuva.input_layer.eligibility m", "relation_name": "dev_tom.data_quality.eligibility_data_source"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.878207Z", "completed_at": "2024-08-23T19:21:32.882209Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.882724Z", "completed_at": "2024-08-23T19:21:32.882727Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.007352113723754883, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__eligibility_death_date", "compiled": true, "compiled_code": "\n\nWITH base as (\n    SELECT * \n    FROM tuva.input_layer.eligibility\n\n),\nunique_field as (\n    select distinct member_id\n        ,cast(death_date as TEXT) as field\n        ,data_source\n    from base\n),\nclaim_grain as (\n    select member_id\n        ,data_source\n        ,count(*) as frequency\n    from unique_field\n    group by member_id\n        ,data_source\n),\nclaim_agg as (\nselect\n    member_id,\n    data_source,\n    \n    listagg(\n        coalesce(field, 'null'),\n        ', '\n        )\n        within group (order by field desc) as field_aggregated\nfrom\n    unique_field\ngroup by\n    data_source,\n    member_id\n)\nselect distinct\n    m.data_source\n    ,coalesce(cast(m.enrollment_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    ,'ELIGIBILITY' AS table_name\n    ,'Member ID' AS drill_down_key\n    ,coalesce(m.member_id, 'NULL') as drill_down_value\n    ,'ELIGIBILITY' AS claim_type\n    ,'DEATH_DATE' AS field_name\n    ,case\n        when cg.frequency > 1 then 'multiple'\n        when m.death_date > cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) then 'invalid'\n        when m.death_date <= cast('1901-01-01' as date) then 'invalid'\n        when m.death_date <= m.birth_date then 'invalid'\n        when m.death_date is null then 'null'\n        else 'valid'\n    end as bucket_name\n    ,case\n        when cg.frequency > 1 then 'multiple'\n        when m.death_date > cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) then 'future'\n        when m.death_date <= cast('1901-01-01' as date) then 'too old'\n        when m.death_date <= m.birth_date then 'death date before birth date'\n        else null\n    end as invalid_reason\n    ,cast(\n  substr(agg.field_aggregated, 1, 255)\n as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom base m\nleft join claim_grain cg on m.member_id = cg.member_id and m.data_source = cg.data_source\nleft join claim_agg agg on m.member_id = agg.member_id and m.data_source = agg.data_source", "relation_name": "dev_tom.data_quality.eligibility_death_date"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.882994Z", "completed_at": "2024-08-23T19:21:32.885786Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.889002Z", "completed_at": "2024-08-23T19:21:32.889005Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.007282733917236328, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__eligibility_death_flag", "compiled": true, "compiled_code": "\n\nSELECT DISTINCT\n    m.data_source\n    ,coalesce(cast(m.enrollment_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    ,'ELIGIBILITY' AS table_name\n    ,'Member ID' AS drill_down_key\n    ,coalesce(m.member_id, 'NULL') as drill_down_value\n    ,'ELIGIBILITY' AS claim_type\n    ,'DEATH_FLAG' AS field_name\n    ,case\n        when m.death_flag in (1,0) then 'valid'\n        when m.death_flag is null then 'null'\n        else 'invalid'\n        end as bucket_name\n    ,cast(null as TEXT) as invalid_reason\n    ,cast(death_flag as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.eligibility m", "relation_name": "dev_tom.data_quality.eligibility_death_flag"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.885960Z", "completed_at": "2024-08-23T19:21:32.937966Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.939116Z", "completed_at": "2024-08-23T19:21:32.939121Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.05411505699157715, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__eligibility_dual_status_code", "compiled": true, "compiled_code": "\n\nSELECT DISTINCT\n    m.data_source\n    ,coalesce(cast(m.enrollment_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    ,'ELIGIBILITY' AS table_name\n    ,'Member ID | Enrollment Start Date' AS drill_down_key\n        ,coalesce(m.member_id, 'NULL') as drill_down_value\n    ,'ELIGIBILITY' AS claim_type\n    ,'DUAL_STATUS_CODE' AS field_name\n    ,case when m.dual_status_code is null then 'null'\n          when term.dual_status_code is null then 'invalid'\n                             else 'valid' end as bucket_name\n    ,case\n        when m.dual_status_code is not null and term.dual_status_code is null then 'Dual Status Code does not join to Terminology Medicare Dual Eligibility table'\n        else null\n    end as invalid_reason\n    , m.dual_status_code || '|' || coalesce(term.dual_status_description,'') as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.eligibility m\nleft join dev_tom.terminology.medicare_dual_eligibility term on m.dual_status_code = term.dual_status_code", "relation_name": "dev_tom.data_quality.eligibility_dual_status_code"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.889311Z", "completed_at": "2024-08-23T19:21:32.939554Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.940263Z", "completed_at": "2024-08-23T19:21:32.940266Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.054666996002197266, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__eligibility_end_date", "compiled": true, "compiled_code": "\n\nSELECT DISTINCT\n    m.data_source\n    ,coalesce(cast(m.enrollment_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    ,'ELIGIBILITY' AS table_name\n    ,'Member ID' AS drill_down_key\n    ,coalesce(m.member_id,'NULL') AS drill_down_value\n    ,'ELIGIBILITY' AS claim_type\n    ,'ENROLLMENT_END_DATE' AS field_name\n    ,case\n        when m.enrollment_end_date <= cast('1901-01-01' as date) then 'invalid'\n        when m.enrollment_end_date < m.enrollment_start_date then 'invalid'\n        when m.enrollment_end_date is null then 'null'\n        else 'valid'\n    end as bucket_name\n    ,case\n\n        when m.enrollment_end_date <= cast('1901-01-01' as date) then 'too old'\n        when m.enrollment_end_date < m.enrollment_start_date then 'end date before start date'\n        else null\n    end as invalid_reason\n    ,cast(enrollment_end_date as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.eligibility m", "relation_name": "dev_tom.data_quality.eligibility_end_date"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.941015Z", "completed_at": "2024-08-23T19:21:32.946433Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.948690Z", "completed_at": "2024-08-23T19:21:32.948694Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.009337186813354492, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__eligibility_first_name", "compiled": true, "compiled_code": "\n\nSELECT DISTINCT \n    m.data_source\n    ,coalesce(cast(m.enrollment_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    ,'ELIGIBILITY' AS table_name\n    ,'Member ID | Enrollment Start Date' AS drill_down_key\n    ,coalesce(m.member_id, 'NULL') as drill_down_value\n    ,'ELIGIBILITY' AS claim_type\n    ,'FIRST_NAME' AS field_name\n    ,case when m.first_name is null then 'null'\n                             else 'valid' end as bucket_name\n    ,cast(null as TEXT) as invalid_reason\n    ,cast(first_name as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.eligibility m", "relation_name": "dev_tom.data_quality.eligibility_first_name"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.944189Z", "completed_at": "2024-08-23T19:21:32.948958Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.949391Z", "completed_at": "2024-08-23T19:21:32.949393Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.00863504409790039, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__eligibility_gender", "compiled": true, "compiled_code": "\n\nSELECT DISTINCT \n    m.data_source\n    ,coalesce(cast(m.enrollment_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    ,'ELIGIBILITY' AS table_name\n    ,'Member ID | Enrollment Start Date' AS drill_down_key\n    ,coalesce(m.member_id, 'NULL') as drill_down_value\n    ,'ELIGIBILITY' AS claim_type\n    ,'GENDER' AS field_name\n    ,case when m.gender is  null then 'null'\n          when term.gender is null then 'invalid'\n                             else 'valid' end as bucket_name\n    ,case\n        when m.gender is not null and term.gender is null then 'Gender does not join to Terminology Gender table'\n        else null\n    end as invalid_reason\n    ,cast(m.gender as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.eligibility m\nleft join dev_tom.terminology.gender term on m.gender = term.gender", "relation_name": "dev_tom.data_quality.eligibility_gender"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.946637Z", "completed_at": "2024-08-23T19:21:32.949727Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.950305Z", "completed_at": "2024-08-23T19:21:32.950308Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.006382942199707031, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__eligibility_last_name", "compiled": true, "compiled_code": "\n\nSELECT DISTINCT \n    m.data_source\n    ,coalesce(cast(m.enrollment_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    ,'ELIGIBILITY' AS table_name\n    ,'Member ID | Enrollment Start Date' AS drill_down_key\n    ,coalesce(m.member_id, 'NULL') as drill_down_value\n    ,'ELIGIBILITY' AS claim_type\n    ,'LAST_NAME' AS field_name\n    ,case when m.last_name is null then 'null'\n                             else 'valid' end as bucket_name\n    ,cast(null as TEXT) as invalid_reason\n    ,cast(last_name as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.eligibility m", "relation_name": "dev_tom.data_quality.eligibility_last_name"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.951160Z", "completed_at": "2024-08-23T19:21:32.955978Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.958369Z", "completed_at": "2024-08-23T19:21:32.958372Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.008491754531860352, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__eligibility_medicare_status_code", "compiled": true, "compiled_code": "\n\nSELECT DISTINCT \n    m.data_source\n    ,coalesce(cast(m.enrollment_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    ,'ELIGIBILITY' AS table_name\n    ,'Member ID | Enrollment Start Date' AS drill_down_key\n    ,coalesce(m.member_id, 'NULL') as drill_down_value\n    ,'ELIGIBILITY' AS claim_type\n    ,'MEDICARE_STATUS_CODE' AS field_name\n    ,case when m.medicare_status_code is null then 'null'\n          when term.medicare_status_code is null then 'invalid'\n                             else 'valid' end as bucket_name\n    ,case\n        when m.medicare_status_code is not null and term.medicare_status_code is null then 'Medicare Status Code does not join to Terminology Medicare Status table'\n        else null\n    end as invalid_reason\n    , m.medicare_status_code || '|' || coalesce(term.medicare_status_description,'') as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.eligibility m\nleft join dev_tom.terminology.medicare_status term on m.medicare_status_code = term.medicare_status_code", "relation_name": "dev_tom.data_quality.eligibility_medicare_status_code"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.953748Z", "completed_at": "2024-08-23T19:21:32.958626Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.959033Z", "completed_at": "2024-08-23T19:21:32.959036Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.008298158645629883, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__eligibility_member_id", "compiled": true, "compiled_code": "\n\nSELECT DISTINCT -- to bring to claim_ID grain \n    m.data_source\n    ,coalesce(cast(m.enrollment_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    ,'ELIGIBILITY' AS table_name\n    ,'Member ID | Enrollment Start Date' AS drill_down_key\n    ,coalesce(m.member_id, 'NULL') as drill_down_value\n    ,'ELIGIBILITY' AS claim_type\n    ,'MEMBER_ID' AS field_name\n    ,case when m.member_id is not null then 'valid' else 'null' end as bucket_name\n    ,cast(null as TEXT) as invalid_reason\n    ,cast(member_id as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.eligibility m", "relation_name": "dev_tom.data_quality.eligibility_member_id"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.956176Z", "completed_at": "2024-08-23T19:21:32.959279Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.959819Z", "completed_at": "2024-08-23T19:21:32.959822Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.006328105926513672, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__eligibility_original_reason_entitlement_code", "compiled": true, "compiled_code": "\n\nSELECT DISTINCT \n    m.data_source\n    ,coalesce(cast(m.enrollment_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    ,'ELIGIBILITY' AS table_name\n    ,'Member ID | Enrollment Start Date' AS drill_down_key\n    ,coalesce(m.member_id, 'NULL') as drill_down_value\n    ,'ELIGIBILITY' AS claim_type\n    ,'ORIGINAL_REASON_ENTITLEMENT_CODE' AS field_name\n    ,case when m.original_reason_entitlement_code is null then 'null'\n          when term.original_reason_entitlement_code is null then 'invalid'\n                             else 'valid' end as bucket_name\n    ,case\n        when m.original_reason_entitlement_code is not null and term.original_reason_entitlement_code is null then 'Original Reason Entitlement Code does not join to Terminology Original Reason Entitlement Code table'\n        else null\n    end as invalid_reason\n    , m.original_reason_entitlement_code || '|' || coalesce(term.original_reason_entitlement_description,'') as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.eligibility m\nleft join dev_tom.terminology.medicare_orec term on m.original_reason_entitlement_code = term.original_reason_entitlement_code", "relation_name": "dev_tom.data_quality.eligibility_original_reason_entitlement_code"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.960633Z", "completed_at": "2024-08-23T19:21:32.966078Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.968273Z", "completed_at": "2024-08-23T19:21:32.968276Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.008858919143676758, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__eligibility_patient_id", "compiled": true, "compiled_code": "\n\nSELECT DISTINCT\n    m.data_source\n    ,coalesce(cast(m.enrollment_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    ,'ELIGIBILITY' AS table_name\n    ,'Member ID | Enrollment Start Date' AS drill_down_key\n    ,coalesce(m.member_id, 'NULL') as drill_down_value\n    ,'ELIGIBILITY' AS claim_type\n    ,'PATIENT_ID' AS field_name\n    ,case when m.patient_id is not null then 'valid' else 'null' end as bucket_name\n    ,cast(null as TEXT) as invalid_reason\n    ,cast(patient_id as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.eligibility m", "relation_name": "dev_tom.data_quality.eligibility_patient_id"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.963066Z", "completed_at": "2024-08-23T19:21:32.968538Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.968944Z", "completed_at": "2024-08-23T19:21:32.968947Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.008719205856323242, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__eligibility_payer", "compiled": true, "compiled_code": "\n\nSELECT DISTINCT\n    m.data_source\n    ,coalesce(cast(m.enrollment_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    ,'ELIGIBILITY' AS table_name\n    ,'Member ID | Enrollment Start Date' AS drill_down_key\n    ,coalesce(m.member_id, 'NULL') as drill_down_value\n    ,'ELIGIBILITY' AS claim_type\n    ,'PAYER' AS field_name\n    ,case when m.payer is not null then 'valid' else 'null' end as bucket_name\n    ,cast(null as TEXT) as invalid_reason\n    ,cast(payer as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.eligibility m", "relation_name": "dev_tom.data_quality.eligibility_payer"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.966273Z", "completed_at": "2024-08-23T19:21:32.969375Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.969882Z", "completed_at": "2024-08-23T19:21:32.969885Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.0070650577545166016, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__eligibility_payer_type", "compiled": true, "compiled_code": "\n\nSELECT DISTINCT \n    m.data_source\n    ,coalesce(cast(m.enrollment_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    ,'ELIGIBILITY' AS table_name\n    ,'Member ID | Enrollment Start Date' AS drill_down_key\n    ,coalesce(m.member_id, 'NULL') as drill_down_value\n    ,'ELIGIBILITY' AS claim_type\n    ,'PAYER_TYPE' AS field_name\n    ,case when m.payer_type is  null then 'null'\n          when term.payer_type is null then 'invalid'\n                             else 'valid' end as bucket_name\n    ,case\n        when m.payer_type is not null and term.payer_type is null then 'Payer Type does not join to Terminology Payer Type table'\n        else null\n    end as invalid_reason\n    ,cast(m.payer_type as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.eligibility m\nleft join dev_tom.terminology.payer_type term on m.payer_type = term.payer_type", "relation_name": "dev_tom.data_quality.eligibility_payer_type"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.970319Z", "completed_at": "2024-08-23T19:21:32.975790Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.978054Z", "completed_at": "2024-08-23T19:21:32.978058Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.00888514518737793, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__eligibility_phone", "compiled": true, "compiled_code": "\n\nSELECT DISTINCT \n    m.data_source\n    ,coalesce(cast(m.enrollment_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    ,'ELIGIBILITY' AS table_name\n    ,'Member ID | Enrollment Start Date' AS drill_down_key\n    ,coalesce(m.member_id, 'NULL') as drill_down_value\n    ,'ELIGIBILITY' AS claim_type\n    ,'PHONE' AS field_name\n    ,case when m.phone is null then 'null'\n                             else 'valid' end as bucket_name\n    ,cast(null as TEXT) as invalid_reason\n    ,cast(phone as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.eligibility m", "relation_name": "dev_tom.data_quality.eligibility_phone"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.972910Z", "completed_at": "2024-08-23T19:21:32.978340Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.978714Z", "completed_at": "2024-08-23T19:21:32.978717Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.008608102798461914, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__eligibility_plan", "compiled": true, "compiled_code": "\n\nSELECT DISTINCT\n    m.data_source\n    ,coalesce(cast(m.enrollment_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    ,'ELIGIBILITY' AS table_name\n    ,'Member ID | Enrollment Start Date' AS drill_down_key\n    ,coalesce(m.member_id, 'NULL') as drill_down_value\n    ,'ELIGIBILITY' AS claim_type\n    ,'PLAN' AS field_name\n    ,case when m.plan is not null then 'valid' else 'null' end as bucket_name\n    ,cast(null as TEXT) as invalid_reason\n    ,cast(m.plan as TEXT) as field_value\n, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.eligibility m", "relation_name": "dev_tom.data_quality.eligibility_plan"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.976000Z", "completed_at": "2024-08-23T19:21:32.979158Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.979695Z", "completed_at": "2024-08-23T19:21:32.979698Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.0070018768310546875, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__eligibility_race", "compiled": true, "compiled_code": "\n\nSELECT DISTINCT -- to bring to claim_ID grain \n    m.data_source\n    ,coalesce(cast(m.enrollment_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    ,'ELIGIBILITY' AS table_name\n    ,'Member ID | Enrollment Start Date' AS drill_down_key\n    ,coalesce(m.member_id, 'NULL') as drill_down_value\n    ,'ELIGIBILITY' AS claim_type\n    ,'RACE' AS field_name\n    ,case when m.race is  null then 'null'\n          when r.description is  null then 'invalid'\n                             else 'valid' end as bucket_name\n    ,case\n        when m.race is not null and r.description is null then 'Race does not join to terminology race table'\n        else null\n    end as invalid_reason\n    ,cast(race as TEXT) as field_value\n, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.eligibility m\nleft join dev_tom.terminology.race r on m.race=r.description", "relation_name": "dev_tom.data_quality.eligibility_race"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.980147Z", "completed_at": "2024-08-23T19:21:32.985961Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.986359Z", "completed_at": "2024-08-23T19:21:32.986362Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.007415771484375, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__eligibility_start_date", "compiled": true, "compiled_code": "\n\nSELECT DISTINCT\n    m.data_source\n    ,coalesce(cast(m.enrollment_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    ,'ELIGIBILITY' AS table_name\n    ,'Member ID' AS drill_down_key\n    ,coalesce(m.member_id, 'NULL') as drill_down_value\n    ,'ELIGIBILITY' AS claim_type\n    ,'ENROLLMENT_START_DATE' AS field_name\n    ,case\n        when m.enrollment_start_date > cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) then 'invalid'\n        when m.enrollment_start_date <= cast('1901-01-01' as date) then 'invalid'\n        when m.enrollment_start_date is null then 'null'\n        else 'valid'\n    end as bucket_name\n    ,case\n        when m.enrollment_start_date > cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) then 'future'\n        when m.enrollment_start_date <= cast('1901-01-01' as date) then 'too old'\n    else null\n    end as invalid_reason\n    ,cast(enrollment_start_date as TEXT) as field_value\n, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.eligibility m", "relation_name": "dev_tom.data_quality.eligibility_start_date"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.983593Z", "completed_at": "2024-08-23T19:21:32.988975Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.989415Z", "completed_at": "2024-08-23T19:21:32.989418Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.009493112564086914, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__eligibility_state", "compiled": true, "compiled_code": "\n\nSELECT DISTINCT \n    m.data_source\n    ,coalesce(cast(m.enrollment_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    ,'ELIGIBILITY' AS table_name\n    ,'Member ID | Enrollment Start Date' AS drill_down_key\n    ,coalesce(m.member_id, 'NULL') as drill_down_value\n    ,'ELIGIBILITY' AS claim_type\n    ,'STATE' AS field_name\n    ,case when m.state is  null then 'null'\n          when term.ssa_fips_state_name is null then 'invalid'\n                             else 'valid' end as bucket_name\n    ,case\n        when m.state is not null and term.ssa_fips_state_name is null then 'State does not join to Terminology SSA_FIPS_STATE table'\n        else null\n    end as invalid_reason\n    ,cast(state as TEXT) as field_value\n, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.eligibility m\nleft join dev_tom.reference_data.ssa_fips_state as term on m.state = term.ssa_fips_state_name", "relation_name": "dev_tom.data_quality.eligibility_state"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.986663Z", "completed_at": "2024-08-23T19:21:32.989890Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:32.990410Z", "completed_at": "2024-08-23T19:21:32.990413Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.007061958312988281, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__eligibility_zip_code", "compiled": true, "compiled_code": "\n\nSELECT DISTINCT -- to bring to claim_ID grain\n    m.data_source\n    ,coalesce(cast(m.enrollment_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    ,'ELIGIBILITY' AS table_name\n    ,'Member ID | Enrollment Start Date' AS drill_down_key\n    ,coalesce(m.member_id, 'NULL') as drill_down_value\n    ,'ELIGIBILITY' AS claim_type\n    ,'ZIP_CODE' AS field_name\n    \n    ,case when m.zip_code is  null then 'null'\n          when length(m.zip_code) in  (5,9,10) then 'valid'\n                             else 'invalid' end as bucket_name\n    ,case\n        when m.zip_code is not null and length(m.zip_code) NOT IN (5,9,10) then 'Invalid Zip Code Length'\n        else null\n     end as invalid_reason\n    \n    ,cast(zip_code as TEXT) as field_value\n, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.eligibility m", "relation_name": "dev_tom.data_quality.eligibility_zip_code"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.000325Z", "completed_at": "2024-08-23T19:21:33.006131Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.008640Z", "completed_at": "2024-08-23T19:21:33.008645Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.009564876556396484, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__claim_allowed_amount", "compiled": true, "compiled_code": "\n\nSELECT\n      m.data_source\n    , coalesce(cast(m.claim_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    , 'MEDICAL_CLAIM' AS table_name\n    , 'Claim ID | Claim Line Number' AS drill_down_key\n    , coalesce(cast(m.claim_id as TEXT), 'null') || '|' || coalesce(cast(m.claim_line_number as TEXT), 'null') as drill_down_value\n    , m.claim_type as claim_type\n    , 'ALLOWED_AMOUNT' AS field_name\n    , case when m.allowed_amount is null then 'null'\n                                    else 'valid' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(allowed_amount as TEXT) as field_value\n, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.medical_claim m", "relation_name": "dev_tom.data_quality.claim_allowed_amount"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.003364Z", "completed_at": "2024-08-23T19:21:33.008991Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.009415Z", "completed_at": "2024-08-23T19:21:33.009418Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.009499073028564453, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__claim_charge_amount", "compiled": true, "compiled_code": "\n\nSELECT\n      m.data_source\n    , coalesce(cast(m.claim_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    , 'MEDICAL_CLAIM' AS table_name\n    , 'Claim ID | Claim Line Number' AS drill_down_key\n    , coalesce(cast(m.claim_id as TEXT), 'null') || '|' || coalesce(cast(m.claim_line_number as TEXT), 'null') as drill_down_value\n    , m.claim_type as claim_type\n    , 'CHARGE_AMOUNT' AS field_name\n    , case when m.charge_amount is null then 'null'\n                                    else 'valid' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(charge_amount as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.medical_claim m", "relation_name": "dev_tom.data_quality.claim_charge_amount"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.006337Z", "completed_at": "2024-08-23T19:21:33.009892Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.010415Z", "completed_at": "2024-08-23T19:21:33.010418Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.007310152053833008, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__claim_claim_id", "compiled": true, "compiled_code": "\n\nSELECT DISTINCT -- to bring to claim_ID grain \n    m.data_source\n    ,coalesce(cast(m.claim_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    ,'MEDICAL_CLAIM' AS table_name\n    ,'Claim ID' as drill_down_key\n    ,coalesce(m.claim_id, 'NULL') AS drill_down_value\n    ,m.claim_type as claim_type\n    ,'CLAIM_ID' AS field_name\n    ,case when m.claim_id is not null then 'valid' else 'null' end as bucket_name\n    ,cast(null as TEXT) as invalid_reason\n    ,cast(member_id as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.medical_claim m", "relation_name": "dev_tom.data_quality.claim_claim_id"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.010863Z", "completed_at": "2024-08-23T19:21:33.017012Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.021144Z", "completed_at": "2024-08-23T19:21:33.021147Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.011486053466796875, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__claim_claim_line_end_date", "compiled": true, "compiled_code": "\n\nwith tuva_last_run as(\n\n    select cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) as tuva_last_run\n\n)\n\nSELECT\n      m.data_source\n    , coalesce(cast(m.claim_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    , 'MEDICAL_CLAIM' AS table_name\n    , 'Claim ID | Claim Line Number' AS drill_down_key\n    , coalesce(cast(m.claim_id as TEXT), 'null') || '|' || coalesce(cast(m.claim_line_number as TEXT), 'null') as drill_down_value\n    , m.claim_type as claim_type\n    , 'CLAIM_LINE_END_DATE' AS field_name\n    , case\n        when m.claim_line_end_date > tuva_last_run then 'invalid'\n        when m.claim_line_end_date < \n\n    dateadd(\n        year,\n        -10,\n        cte.tuva_last_run\n        )\n\n then 'invalid'\n        when m.claim_line_end_date > m.claim_line_end_date then 'invalid'\n        when m.claim_line_end_date is null then 'null'\n        else 'valid'\n    end as bucket_name\n    , case\n        when m.claim_line_end_date > tuva_last_run then 'future'\n        when m.claim_line_end_date < \n\n    dateadd(\n        year,\n        -10,\n        cte.tuva_last_run\n        )\n\n then 'too old'\n        when m.claim_line_end_date > m.claim_end_date then 'line date greater than claim date'\n        else null\n    end as invalid_reason\n    , cast(claim_line_end_date as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.medical_claim m\ncross join tuva_last_run cte", "relation_name": "dev_tom.data_quality.claim_claim_line_end_date"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.014734Z", "completed_at": "2024-08-23T19:21:33.021457Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.021846Z", "completed_at": "2024-08-23T19:21:33.021849Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.011182785034179688, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__claim_claim_line_number", "compiled": true, "compiled_code": "\n\nSELECT\n    m.data_source\n    ,coalesce(cast(m.claim_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    ,'MEDICAL_CLAIM' AS table_name\n    ,'Claim ID' as drill_down_key\n    ,coalesce(claim_id, 'NULL') AS drill_down_value\n    ,m.claim_type as claim_type\n    ,'CLAIM_LINE_NUMBER' AS field_name\n    ,case when m.claim_line_number is not null then 'valid' else 'null' end as bucket_name\n    ,cast(null as TEXT) as invalid_reason\n    ,cast(member_id as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.medical_claim m", "relation_name": "dev_tom.data_quality.claim_claim_line_number"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.017219Z", "completed_at": "2024-08-23T19:21:33.022105Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.022649Z", "completed_at": "2024-08-23T19:21:33.022652Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.008143186569213867, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__claim_claim_line_start_date", "compiled": true, "compiled_code": "\n\nwith tuva_last_run as(\n\n    select cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) as tuva_last_run\n\n)\nSELECT\n      m.data_source\n    , coalesce(cast(m.claim_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    , 'MEDICAL_CLAIM' AS table_name\n    , 'Claim ID | Claim Line Number' AS drill_down_key\n    , coalesce(cast(m.claim_id as TEXT), 'null') || '|' || coalesce(cast(m.claim_line_number as TEXT), 'null') as drill_down_value\n    , m.claim_type as claim_type\n    , 'CLAIM_LINE_START_DATE' AS field_name\n    , case\n        when m.claim_line_start_date > tuva_last_run then 'invalid'\n        when m.claim_line_start_date < \n\n    dateadd(\n        year,\n        -10,\n        cte.tuva_last_run\n        )\n\n then 'invalid'\n        when m.claim_line_start_date < m.claim_start_date then 'invalid'\n        when m.claim_line_start_date is null then 'null'\n        else 'valid'\n    end as bucket_name\n    , case\n        when m.claim_line_start_date > tuva_last_run then 'future'\n        when m.claim_line_start_date < \n\n    dateadd(\n        year,\n        -10,\n        cte.tuva_last_run\n        )\n\n then 'too old'\n        when m.claim_line_start_date < m.claim_start_date then 'line date less than than claim date'\n        else null\n    end as invalid_reason\n    , cast(claim_line_start_date as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.medical_claim m\ncross join tuva_last_run cte", "relation_name": "dev_tom.data_quality.claim_claim_line_start_date"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.023526Z", "completed_at": "2024-08-23T19:21:33.028698Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.031615Z", "completed_at": "2024-08-23T19:21:33.031619Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.009382963180541992, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__claim_claim_type", "compiled": true, "compiled_code": "\n\nSELECT DISTINCT -- to bring to claim_ID grain \n    m.data_source\n    ,coalesce(cast(m.claim_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    ,'MEDICAL_CLAIM' AS table_name\n    ,'Claim ID' as drill_down_key\n,coalesce(claim_id, 'NULL') AS drill_down_value\n    ,m.claim_type as claim_type\n    ,'CLAIM_TYPE' AS field_name\n    ,case when m.claim_type is null then 'null'\n          when term.claim_type is null then 'invalid'\n                             else 'valid' end as bucket_name\n    ,case\n        when m.claim_type is not null and term.claim_type is null then 'Claim Type does not join to Terminology Claim Type table'\n        else null\n    end as invalid_reason\n    ,cast(m.claim_type as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.medical_claim m\nleft join dev_tom.terminology.claim_type term on m.claim_type = term.claim_type", "relation_name": "dev_tom.data_quality.claim_claim_type"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.025933Z", "completed_at": "2024-08-23T19:21:33.031886Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.032335Z", "completed_at": "2024-08-23T19:21:33.032338Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.00929403305053711, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__claim_coinsurance_amount", "compiled": true, "compiled_code": "\n\nSELECT\n      m.data_source\n    , coalesce(cast(m.claim_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    , 'MEDICAL_CLAIM' AS table_name\n    , 'Claim ID | Claim Line Number' AS drill_down_key\n    , coalesce(cast(m.claim_id as TEXT), 'null') || '|' || coalesce(cast(m.claim_line_number as TEXT), 'null') as drill_down_value\n    , m.claim_type as claim_type\n    , 'COINSURANCE_AMOUNT' AS field_name\n    , case when m.coinsurance_amount is null then 'null'\n                                    else 'valid' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(coinsurance_amount as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.medical_claim m", "relation_name": "dev_tom.data_quality.claim_coninsurance_amount"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.028888Z", "completed_at": "2024-08-23T19:21:33.032593Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.033135Z", "completed_at": "2024-08-23T19:21:33.033138Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.0074520111083984375, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__claim_copayment_amount", "compiled": true, "compiled_code": "\n\nSELECT\n      m.data_source\n    , coalesce(cast(m.claim_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    , 'MEDICAL_CLAIM' AS table_name\n    , 'Claim ID | Claim Line Number' AS drill_down_key\n    , coalesce(cast(m.claim_id as TEXT), 'null') || '|' || coalesce(cast(m.claim_line_number as TEXT), 'null') as drill_down_value\n    , m.claim_type as claim_type\n    , 'COPAYMENT_AMOUNT' AS field_name\n    , case when m.copayment_amount is null then 'null'\n                                    else 'valid' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(copayment_amount as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.medical_claim m", "relation_name": "dev_tom.data_quality.claim_copayment_amount"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.034007Z", "completed_at": "2024-08-23T19:21:33.039043Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.041346Z", "completed_at": "2024-08-23T19:21:33.041349Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.008615970611572266, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__claim_data_source", "compiled": true, "compiled_code": "\n\nSELECT DISTINCT -- to bring to claim_ID grain \n    m.data_source\n    ,coalesce(cast(m.claim_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    ,'MEDICAL_CLAIM' AS table_name\n    ,'Claim ID' as drill_down_key\n    ,coalesce(m.claim_id, 'NULL') AS drill_down_value\n    ,m.claim_type as claim_type\n    ,'DATA_SOURCE' AS field_name\n    ,case when m.data_source is not null then 'valid' else 'null' end as bucket_name\n    ,cast(null as TEXT) as invalid_reason\n    ,cast(data_source as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.medical_claim m", "relation_name": "dev_tom.data_quality.claim_data_source"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.036488Z", "completed_at": "2024-08-23T19:21:33.041635Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.042033Z", "completed_at": "2024-08-23T19:21:33.042036Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.008497953414916992, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__claim_deductible_amount", "compiled": true, "compiled_code": "\n\nSELECT\n      m.data_source\n    , coalesce(cast(m.claim_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    , 'MEDICAL_CLAIM' AS table_name\n    , 'Claim ID | Claim Line Number' AS drill_down_key\n     , coalesce(cast(m.claim_id as TEXT), 'null') || '|' || coalesce(cast(m.claim_line_number as TEXT), 'null') as drill_down_value\n    , m.claim_type as claim_type\n    , 'DEDUCTIBLE_AMOUNT' AS field_name\n    , case when m.deductible_amount is null then 'null'\n                                    else 'valid' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(deductible_amount as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.medical_claim m", "relation_name": "dev_tom.data_quality.claim_deductible_amount"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.039246Z", "completed_at": "2024-08-23T19:21:33.042291Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.042825Z", "completed_at": "2024-08-23T19:21:33.042828Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.006577253341674805, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__claim_diagnosis_code_type", "compiled": true, "compiled_code": "\n\nSELECT DISTINCT -- to bring to claim_ID grain \n    m.data_source\n    ,coalesce(cast(m.claim_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    ,'MEDICAL_CLAIM' AS table_name\n    ,'Claim ID' as drill_down_key\n    ,coalesce(m.claim_id, 'NULL') AS drill_down_value\n    ,m.claim_type as claim_type\n    ,'DIAGNOSIS_CODE_TYPE' AS field_name\n    ,case when m.diagnosis_code_type is null then 'null'\n          when term.code_type is null then 'invalid'\n                             else 'valid' end as bucket_name\n    ,case\n        when m.diagnosis_code_type is not null and term.code_type is null then 'Diagnosis Code Type does not join to Terminology Code Type table'\n        else null\n    end as invalid_reason\n    ,cast(m.diagnosis_code_type as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.medical_claim m\nleft join dev_tom.reference_data.code_type term on m.diagnosis_code_type = term.code_type", "relation_name": "dev_tom.data_quality.claim_diagnosis_code_type"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.043627Z", "completed_at": "2024-08-23T19:21:33.049475Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.052034Z", "completed_at": "2024-08-23T19:21:33.052037Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.009618043899536133, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__claim_hcpcs_code", "compiled": true, "compiled_code": "\n\nSELECT\n      m.data_source\n    , coalesce(cast(m.claim_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    , 'MEDICAL_CLAIM' AS table_name\n    , 'Claim ID | Claim Line Number' AS drill_down_key\n    , coalesce(cast(m.claim_id as TEXT), 'null') || '|' || coalesce(cast(m.claim_line_number as TEXT), 'null') as drill_down_value\n    , m.claim_type as claim_type\n    , 'HCPCS_CODE' AS field_name\n    , case\n          when term.hcpcs is not null then 'valid'\n          when m.hcpcs_code is not null then 'invalid'\n          else 'null'\n    end as bucket_name\n    , case\n        when m.hcpcs_code is not null and term.hcpcs is null then 'HCPCS does not join to Terminology HCPCS_LEVEL_2 table'\n        else null\n     end as invalid_reason\n    , m.hcpcs_code || '|' || coalesce(term.short_description, '') as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\n    from tuva.input_layer.medical_claim m\nleft join dev_tom.terminology.hcpcs_level_2 as term on m.hcpcs_code = term.hcpcs", "relation_name": "dev_tom.data_quality.claim_hcpcs_code"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.046549Z", "completed_at": "2024-08-23T19:21:33.052295Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.052706Z", "completed_at": "2024-08-23T19:21:33.052708Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.009485960006713867, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__claim_member_id", "compiled": true, "compiled_code": "\n\nSELECT DISTINCT -- to bring to claim_ID grain \n    m.data_source\n    ,coalesce(cast(m.claim_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    ,'MEDICAL_CLAIM' AS table_name\n    ,'Claim ID' AS drill_down_key\n    ,coalesce(m.claim_id, 'NULL') AS drill_down_value\n    ,m.claim_type as claim_type\n    ,'MEMBER_ID' AS field_name\n    ,case when m.member_id is not null then 'valid' else 'null' end as bucket_name\n    ,cast(null as TEXT) as invalid_reason\n    ,cast(member_id as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.medical_claim m", "relation_name": "dev_tom.data_quality.claim_member_id"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.049670Z", "completed_at": "2024-08-23T19:21:33.052963Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.053503Z", "completed_at": "2024-08-23T19:21:33.053506Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.007203817367553711, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__claim_paid_amount", "compiled": true, "compiled_code": "\n\nSELECT\n      m.data_source\n    , coalesce(cast(m.claim_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    , 'MEDICAL_CLAIM' AS table_name\n    , 'Claim ID | Claim Line Number' AS drill_down_key\n    , coalesce(cast(m.claim_id as TEXT), 'null') || '|' || coalesce(cast(m.claim_line_number as TEXT), 'null') as drill_down_value\n    , m.claim_type as claim_type\n    , 'PAID_AMOUNT' AS field_name\n    , case when m.paid_amount is null then 'null'\n                                    else 'valid' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(paid_amount as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.medical_claim m", "relation_name": "dev_tom.data_quality.claim_paid_amount"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.054322Z", "completed_at": "2024-08-23T19:21:33.060049Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.062353Z", "completed_at": "2024-08-23T19:21:33.062356Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.009260177612304688, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__claim_paid_date", "compiled": true, "compiled_code": "\n\nwith tuva_last_run as(\n\n     select cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) as tuva_last_run\n\n)\nSELECT\n      m.data_source\n    , coalesce(cast(m.claim_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    , 'MEDICAL_CLAIM' AS table_name\n    , 'Claim ID | Claim Line Number' AS drill_down_key\n    , coalesce(cast(m.claim_id as TEXT), 'null') || '|' || coalesce(cast(m.claim_line_number as TEXT), 'null') as drill_down_value\n    , m.claim_type as claim_type\n    , 'PAID_DATE' AS field_name\n    , case\n        when m.paid_date > tuva_last_run then 'invalid'\n        when m.paid_date < \n\n    dateadd(\n        year,\n        -10,\n        cte.tuva_last_run\n        )\n\n then 'invalid'\n        when m.paid_date < m.claim_start_date then 'invalid'\n        when m.paid_date is null then 'null'\n        else 'valid'\n    end as bucket_name\n    , case\n        when m.paid_date > tuva_last_run then 'future'\n        when m.paid_date < \n\n    dateadd(\n        year,\n        -10,\n        cte.tuva_last_run\n        )\n\n then 'too old'\n        when m.paid_date < m.claim_start_date then 'paid date before claim start date'\n        else null\n    end as invalid_reason\n    , cast(claim_line_start_date as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.medical_claim m\ncross join tuva_last_run cte", "relation_name": "dev_tom.data_quality.claim_paid_date"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.057881Z", "completed_at": "2024-08-23T19:21:33.062601Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.063000Z", "completed_at": "2024-08-23T19:21:33.063003Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.009086132049560547, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__claim_patient_id", "compiled": true, "compiled_code": "\n\nSELECT DISTINCT -- to bring to claim_ID grain \n    m.data_source\n    ,coalesce(cast(m.claim_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    ,'MEDICAL_CLAIM' AS table_name\n    ,'Claim ID' AS drill_down_key\n,coalesce(claim_id, 'NULL') AS drill_down_value\n    ,m.claim_type as claim_type\n    ,'PATIENT_ID' AS field_name\n    ,case when m.patient_id is not null then 'valid' else 'null' end as bucket_name\n    ,cast(null as TEXT) as invalid_reason\n    ,cast(patient_id as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.medical_claim m", "relation_name": "dev_tom.data_quality.claim_patient_id"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.060250Z", "completed_at": "2024-08-23T19:21:33.063253Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.063788Z", "completed_at": "2024-08-23T19:21:33.063791Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.0061588287353515625, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__claim_payer", "compiled": true, "compiled_code": "\n\nSELECT DISTINCT -- to bring to claim_ID grain \n    m.data_source\n    ,coalesce(cast(m.claim_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    ,'MEDICAL_CLAIM' AS table_name\n    ,'Claim ID' AS drill_down_key\n,coalesce(claim_id, 'NULL') AS drill_down_value\n    ,m.claim_type as claim_type\n    ,'PAYER' AS field_name\n    ,case when m.payer is not null then 'valid' else 'null' end as bucket_name\n    ,cast(null as TEXT) as invalid_reason\n    ,cast(payer as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.medical_claim m", "relation_name": "dev_tom.data_quality.claim_payer"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.064805Z", "completed_at": "2024-08-23T19:21:33.071258Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.073346Z", "completed_at": "2024-08-23T19:21:33.073349Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0099639892578125, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__claim_plan", "compiled": true, "compiled_code": "\n\nSELECT DISTINCT -- to bring to claim_ID grain\n    m.data_source\n    ,coalesce(cast(m.claim_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    ,'MEDICAL_CLAIM' AS table_name\n    ,'Claim ID' AS drill_down_key\n,coalesce(claim_id, 'NULL') AS drill_down_value\n    ,m.claim_type as claim_type\n    ,'PLAN' AS field_name\n    ,case when m.plan is not null then 'valid' else 'null' end as bucket_name\n    ,cast(null as TEXT) as invalid_reason\n    ,cast(plan as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.medical_claim m", "relation_name": "dev_tom.data_quality.claim_plan"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.068541Z", "completed_at": "2024-08-23T19:21:33.073614Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.074378Z", "completed_at": "2024-08-23T19:21:33.074381Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.010174989700317383, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__claim_total_cost_amount", "compiled": true, "compiled_code": "\n\nSELECT\n      m.data_source\n    , coalesce(cast(m.claim_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    , 'MEDICAL_CLAIM' AS table_name\n    , 'Claim ID | Claim Line Number' AS drill_down_key\n    , coalesce(cast(m.claim_id as TEXT), 'null') || '|' || coalesce(cast(m.claim_line_number as TEXT), 'null') as drill_down_value\n    , m.claim_type as claim_type\n    , 'TOTAL_COST_AMOUNT' AS field_name\n    , case when m.total_cost_amount is null then 'null'\n                                    else 'valid' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(total_cost_amount as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.medical_claim m", "relation_name": "dev_tom.data_quality.claim_total_cost_amount"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.071631Z", "completed_at": "2024-08-23T19:21:33.074636Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.075194Z", "completed_at": "2024-08-23T19:21:33.075197Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.0076830387115478516, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__claim_type_summary", "compiled": true, "compiled_code": "select\n    data_source\n    ,claim_type\n    ,count(distinct claim_id) as claim_count\n    ,sum(paid_amount) as paid_amount\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.medical_claim\ngroup by\n    data_source\n    ,claim_type\n\n", "relation_name": "dev_tom.data_quality.claim_type_summary"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.076020Z", "completed_at": "2024-08-23T19:21:33.086891Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.087109Z", "completed_at": "2024-08-23T19:21:33.087113Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.012341022491455078, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__institutional_bill_type_code", "compiled": true, "compiled_code": "\n\nwith base as (\n    select *\n    from tuva.input_layer.medical_claim\n    where claim_type = 'institutional'\n),\n\nunique_field as (\n    select distinct claim_id\n        , base.bill_type_code || '|' || coalesce(term.bill_type_description, '') as field\n        , data_source\n    from base\n    left join dev_tom.terminology.bill_type as term on base.bill_type_code = term.bill_type_code\n),\n\nclaim_grain as (\n    select claim_id\n        , data_source\n        , count(*) as frequency\n    from unique_field\n    group by claim_id\n        , data_source\n),\n\nclaim_agg as (\nselect\n      claim_id\n    , data_source\n    , \n    listagg(\n        coalesce(field, 'null'),\n        ', '\n        )\n        within group (order by field desc) as field_aggregated\nfrom\n    unique_field\ngroup by\n      claim_id\n    , data_source\n\t)\n\nselect distinct -- to bring to claim_id grain\n      m.data_source\n    , coalesce(cast(m.claim_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    , 'MEDICAL_CLAIM' AS table_name\n    , 'Claim ID' AS drill_down_key\n    , coalesce(m.claim_id, 'NULL') AS drill_down_value\n    , 'institutional' AS claim_type\n    , 'BILL_TYPE_CODE' AS field_name\n    , case when cg.frequency > 1                then 'multiple'\n          when term.bill_type_code is not null then 'valid'\n          when m.bill_type_code is not null    then 'invalid'\n                                               else 'null' end as bucket_name\n    , case\n        when m.bill_type_code is not null\n            and term.bill_type_code is null\n            and cg.frequency = 1\n            then 'Bill Type Code does not join to Terminology Bill_Type table'\n        else null\n    end as invalid_reason\n    , cast(\n  substr(agg.field_aggregated, 1, 255)\n as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom base m\nleft join claim_grain cg on m.claim_id = cg.claim_id and m.data_source = cg.data_source\nleft join dev_tom.terminology.bill_type as term on m.bill_type_code = term.bill_type_code\nleft join claim_agg agg on m.claim_id = agg.claim_id and m.data_source = agg.data_source", "relation_name": "dev_tom.data_quality.institutional_bill_type_code"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.080192Z", "completed_at": "2024-08-23T19:21:33.087369Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.087898Z", "completed_at": "2024-08-23T19:21:33.087902Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.012305021286010742, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__institutional_billing_npi", "compiled": true, "compiled_code": "\n\nwith base as (\n    select *\n    from tuva.input_layer.medical_claim\n    where claim_type = 'institutional'\n),\nunique_field as (\n    select distinct claim_id\n        ,cast(billing_npi as TEXT) as field\n        ,data_source\n    from base\n),\nclaim_grain as (\n    select claim_id\n        ,data_source\n        ,count(*) as frequency\n    from unique_field\n    group by claim_id\n        ,data_source\n),\nclaim_agg as (\nselect\n    claim_id,\n    data_source,\n    \n    listagg(\n        coalesce(field, 'null'),\n        ', '\n        )\n        within group (order by field desc) as field_aggregated\nfrom\n    unique_field\ngroup by\n    claim_id,\n    data_source\n\t)\nselect distinct -- to bring to claim_id grain\n    m.data_source\n    ,coalesce(cast(m.claim_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    ,'MEDICAL_CLAIM' AS table_name\n    ,'Claim ID' AS drill_down_key\n    ,coalesce(m.claim_id, 'NULL') AS drill_down_value\n    ,'institutional' AS claim_type\n    ,'BILLING_NPI' AS field_name\n    ,case when cg.frequency > 1                then 'multiple'\n          when term.npi is not null            then 'valid'\n          when m.billing_npi is not null      then 'invalid'\n                                               else 'null' end as bucket_name\n    ,case\n        when cg.frequency = 1\n            and m.billing_npi is not null\n            and term.npi is null\n            then 'NPI is not in Terminology Provider table'\n        else null\n    end as invalid_reason\n    ,cast(\n  substr(agg.field_aggregated, 1, 255)\n as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom base m\nleft join claim_grain cg on m.claim_id = cg.claim_id and m.data_source = cg.data_source\nleft join dev_tom.terminology.provider as term on m.billing_npi = term.npi\nleft join claim_agg agg on m.claim_id = agg.claim_id and m.data_source = agg.data_source", "relation_name": "dev_tom.data_quality.institutional_billing_npi"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.082972Z", "completed_at": "2024-08-23T19:21:33.087736Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.088379Z", "completed_at": "2024-08-23T19:21:33.088382Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.008529186248779297, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__institutional_claim_end_date", "compiled": true, "compiled_code": "\n\nwith base as (\n    select *\n    from tuva.input_layer.medical_claim\n    where claim_type = 'institutional'\n)\n, tuva_last_run as(\n    select cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) as tuva_last_run\n)\n,unique_field as (\n    select distinct claim_id\n        ,cast(claim_end_date as TEXT) as field\n        ,data_source\n    from base\n),\nclaim_grain as (\n    select claim_id\n        ,data_source\n        ,count(*) as frequency\n    from unique_field\n    group by claim_id\n        ,data_source\n),\nclaim_agg as (\nselect\n    claim_id,\n    data_source,\n    \n    listagg(\n        coalesce(field, 'null'),\n        ', '\n        )\n        within group (order by field desc) as field_aggregated\nfrom\n    unique_field\ngroup by\n    claim_id,\n    data_source\n\t)\nselect distinct -- to bring to claim_id grain\n    m.data_source\n    ,coalesce(cast(m.claim_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    ,'MEDICAL_CLAIM' AS table_name\n    ,'Claim ID' AS drill_down_key\n    ,coalesce(m.claim_id, 'NULL') AS drill_down_value\n    ,'institutional' AS claim_type\n    ,'CLAIM_END_DATE' AS field_name\n    ,case\n        when cg.frequency > 1 then 'multiple'\n        when m.claim_end_date > cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) then 'invalid'\n        when m.claim_end_date < \n\n    dateadd(\n        year,\n        -10,\n        cte.tuva_last_run\n        )\n\n then 'invalid'\n        when m.claim_end_date < m.claim_start_date then 'invalid'\n        when m.claim_end_date is null then 'null'\n        else 'valid'\n    end as bucket_name\n    ,case\n        when cg.frequency > 1 then 'multiple'\n        when m.claim_end_date > cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) then 'future'\n        when m.claim_end_date < \n\n    dateadd(\n        year,\n        -10,\n        cte.tuva_last_run\n        )\n\n then 'too old'\n        when m.claim_end_date < m.claim_start_date then 'claim end date before claim start date'\n        else null\n        end as invalid_reason\n    ,cast(\n  substr(agg.field_aggregated, 1, 255)\n as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom base m\nleft join claim_grain cg on m.claim_id = cg.claim_id and m.data_source = cg.data_source\nleft join claim_agg agg on m.claim_id = agg.claim_id and m.data_source = agg.data_source\ncross join tuva_last_run cte", "relation_name": "dev_tom.data_quality.institutional_claim_end_date"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.089379Z", "completed_at": "2024-08-23T19:21:33.099208Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.099455Z", "completed_at": "2024-08-23T19:21:33.099458Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.011303186416625977, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__institutional_claim_start_date", "compiled": true, "compiled_code": "\n\nwith base as (\n    select *\n    from tuva.input_layer.medical_claim\n    where claim_type = 'institutional'\n)\n, tuva_last_run as(\n    select cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) as tuva_last_run\n)\n,unique_field as (\n    select distinct claim_id\n        ,cast(claim_start_date as TEXT) as field\n        ,data_source\n    from base\n),\nclaim_grain as (\n    select claim_id\n        ,data_source\n        ,count(*) as frequency\n    from unique_field\n    group by claim_id\n        ,data_source\n),\nclaim_agg as (\nselect\n    claim_id,\n    data_source,\n    \n    listagg(\n        coalesce(field, 'null'),\n        ', '\n        )\n        within group (order by field desc) as field_aggregated\nfrom\n    unique_field\ngroup by\n    claim_id,\n    data_source\n\t)\nselect distinct -- to bring to claim_id grain\n    m.data_source\n    ,coalesce(cast(m.claim_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    ,'MEDICAL_CLAIM' AS table_name\n    ,'Claim ID' AS drill_down_key\n    ,coalesce(m.claim_id, 'NULL') AS drill_down_value\n    ,'institutional' AS claim_type\n    ,'CLAIM_START_DATE' AS field_name\n    ,case\n        when cg.frequency > 1 then 'multiple'\n        when m.claim_start_date > cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) then 'invalid'\n        when m.claim_start_date < \n\n    dateadd(\n        year,\n        -10,\n        cte.tuva_last_run\n        )\n\n then 'invalid'\n        when m.claim_start_date is null then 'null'\n        else 'valid'\n    end as bucket_name\n    ,case\n        when cg.frequency > 1 then 'multiple'\n        when m.claim_start_date > cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) then 'future'\n        when m.claim_start_date < \n\n    dateadd(\n        year,\n        -10,\n        cte.tuva_last_run\n        )\n\n then 'too old'\n        else null\n        end as invalid_reason\n    ,cast(\n  substr(agg.field_aggregated, 1, 255)\n as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom base m\nleft join claim_grain cg on m.claim_id = cg.claim_id and m.data_source = cg.data_source\nleft join claim_agg agg on m.claim_id = agg.claim_id and m.data_source = agg.data_source\ncross join tuva_last_run cte", "relation_name": "dev_tom.data_quality.institutional_claim_start_date"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.093895Z", "completed_at": "2024-08-23T19:21:33.099911Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.100270Z", "completed_at": "2024-08-23T19:21:33.100273Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.011100053787231445, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__institutional_diagnosis_code_1", "compiled": true, "compiled_code": "\n\nwith base as (\n    select *\n    from tuva.input_layer.medical_claim\n    where claim_type = 'institutional'\n),\n\nunique_field as (\n    select distinct claim_id\n        , diagnosis_code_1 || '|' || coalesce(term.short_description, '') as field\n        , data_source\n    from base\n    left join dev_tom.terminology.icd_10_cm as term on base.diagnosis_code_1 = term.icd_10_cm\n),\n\nclaim_grain as (\n    select claim_id\n        , data_source\n        , count(*) as frequency\n    from unique_field\n    group by claim_id\n        , data_source\n),\n\nclaim_agg as (\nselect\n      claim_id\n    , data_source\n    , \n    listagg(\n        coalesce(field, 'null'),\n        ', '\n        )\n        within group (order by field desc) as field_aggregated\nfrom\n    unique_field\ngroup by\n      claim_id\n    , data_source\n\t)\n\nselect distinct -- to bring to claim_id grain\n      m.data_source\n    , coalesce(cast(m.claim_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    , 'MEDICAL_CLAIM' AS table_name\n    , 'Claim ID' AS drill_down_key\n    , coalesce(m.claim_id, 'NULL') AS drill_down_value\n    , 'institutional' AS claim_type\n    , 'DIAGNOSIS_CODE_1' AS field_name\n    , case when cg.frequency > 1                then 'multiple'\n          when term.icd_10_cm is not null      then 'valid'\n          when m.diagnosis_code_1 is not null  then 'invalid'\n        else 'null'\n    end as bucket_name\n    , case\n        when cg.frequency = 1\n            and m.diagnosis_code_1 is not null\n            and term.icd_10_cm is null\n            then 'Diagnosis Code is not in Terminology ICD_10_CM table'\n        else null\n    end as invalid_reason\n    , cast(\n  substr(agg.field_aggregated, 1, 255)\n as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom base m\nleft join claim_grain cg on m.claim_id = cg.claim_id and m.data_source = cg.data_source\nleft join dev_tom.terminology.icd_10_cm as term on m.diagnosis_code_1 = term.icd_10_cm\nleft join claim_agg agg on m.claim_id = agg.claim_id and m.data_source = agg.data_source", "relation_name": "dev_tom.data_quality.institutional_diagnosis_code_1"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.096535Z", "completed_at": "2024-08-23T19:21:33.100533Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.101055Z", "completed_at": "2024-08-23T19:21:33.101058Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.007737636566162109, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__institutional_diagnosis_code_2", "compiled": true, "compiled_code": "\n\nwith base as (\n    select *\n    from tuva.input_layer.medical_claim\n    where claim_type = 'institutional'\n),\n\nunique_field as (\n    select distinct claim_id\n        , diagnosis_code_2 || '|' || coalesce(term.short_description, '') as field\n        , data_source\n    from base\n    left join dev_tom.terminology.icd_10_cm as term on base.diagnosis_code_2 = term.icd_10_cm\n),\n\nclaim_grain as (\n    select claim_id\n        , data_source\n        , count(*) as frequency\n    from unique_field\n    group by claim_id\n        , data_source\n),\n\nclaim_agg as (\nselect\n      claim_id\n    , data_source\n    , \n    listagg(\n        coalesce(field, 'null'),\n        ', '\n        )\n        within group (order by field desc) as field_aggregated\nfrom\n    unique_field\ngroup by\n      claim_id\n    , data_source\n\t)\n\nselect distinct -- to bring to claim_id grain\n      m.data_source\n    , coalesce(cast(m.claim_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    , 'MEDICAL_CLAIM' AS table_name\n    , 'Claim ID' AS drill_down_key\n    , coalesce(m.claim_id, 'NULL') AS drill_down_value\n    , 'institutional' AS claim_type\n    , 'DIAGNOSIS_CODE_2' AS field_name\n    , case when cg.frequency > 1                then 'multiple'\n          when term.icd_10_cm is not null      then 'valid'\n          when m.diagnosis_code_2 is not null  then 'invalid'\n                                               else 'null' end as bucket_name\n    , case\n        when cg.frequency = 1\n            and m.diagnosis_code_2 is not null\n            and term.icd_10_cm is null\n            then 'Diagnosis Code is not in Terminology ICD_10_CM table'\n        else null\n    end as invalid_reason\n    , cast(\n  substr(agg.field_aggregated, 1, 255)\n as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom base m\nleft join claim_grain cg on m.claim_id = cg.claim_id and m.data_source = cg.data_source\nleft join dev_tom.terminology.icd_10_cm as term on m.diagnosis_code_2 = term.icd_10_cm\nleft join claim_agg agg on m.claim_id = agg.claim_id and m.data_source = agg.data_source", "relation_name": "dev_tom.data_quality.institutional_diagnosis_code_2"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.101339Z", "completed_at": "2024-08-23T19:21:33.104889Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.108700Z", "completed_at": "2024-08-23T19:21:33.108703Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.00864410400390625, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__institutional_diagnosis_code_3", "compiled": true, "compiled_code": "\n\nwith base as (\n    select *\n    from tuva.input_layer.medical_claim\n    where claim_type = 'institutional'\n),\n\nunique_field as (\n    select distinct claim_id\n        , diagnosis_code_3 || '|' || coalesce(term.short_description, '') as field\n        , data_source\n    from base\n    left join dev_tom.terminology.icd_10_cm as term on base.diagnosis_code_3 = term.icd_10_cm\n),\n\nclaim_grain as (\n    select claim_id\n        , data_source\n        , count(*) as frequency\n    from unique_field\n    group by claim_id\n        , data_source\n),\n\nclaim_agg as (\nselect\n      claim_id\n    , data_source\n    , \n    listagg(\n        coalesce(field, 'null'),\n        ', '\n        )\n        within group (order by field desc) as field_aggregated\nfrom\n    unique_field\ngroup by\n      claim_id\n    , data_source\n\t)\n\nselect distinct -- to bring to claim_id grain\n      m.data_source\n    , coalesce(cast(m.claim_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    , 'MEDICAL_CLAIM' AS table_name\n    , 'Claim ID' AS drill_down_key\n    , coalesce(m.claim_id, 'NULL') AS drill_down_value\n    , 'institutional' AS claim_type\n    , 'DIAGNOSIS_CODE_3' AS field_name\n    , case when cg.frequency > 1                then 'multiple'\n          when term.icd_10_cm is not null      then 'valid'\n          when m.diagnosis_code_3 is not null  then 'invalid'\n                                               else 'null' end as bucket_name\n    , case\n        when cg.frequency = 1\n            and m.diagnosis_code_3 is not null\n            and term.icd_10_cm is null\n            then 'Diagnosis Code is not in Terminology ICD_10_CM table'\n        else null\n    end as invalid_reason\n    , cast(\n  substr(agg.field_aggregated, 1, 255)\n as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom base m\nleft join claim_grain cg on m.claim_id = cg.claim_id and m.data_source = cg.data_source\nleft join dev_tom.terminology.icd_10_cm as term on m.diagnosis_code_3 = term.icd_10_cm\nleft join claim_agg agg on m.claim_id = agg.claim_id and m.data_source = agg.data_source", "relation_name": "dev_tom.data_quality.institutional_diagnosis_code_3"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.105053Z", "completed_at": "2024-08-23T19:21:33.111697Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.112100Z", "completed_at": "2024-08-23T19:21:33.112102Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.008028984069824219, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__institutional_discharge_disposition_code", "compiled": true, "compiled_code": "\n\nwith base as (\n    select *\n    from tuva.input_layer.medical_claim\n    where claim_type = 'institutional'\n),\n\nunique_field as (\n    select distinct claim_id\n        , base.discharge_disposition_code || '|' || coalesce(term.discharge_disposition_description, '') as field\n        , data_source\n    from base\n    left join dev_tom.terminology.discharge_disposition as term on base.discharge_disposition_code = term.discharge_disposition_code\n),\n\nclaim_grain as (\n    select claim_id\n        , data_source\n        , count(*) as frequency\n    from unique_field\n    group by claim_id\n        , data_source\n),\n\nclaim_agg as (\nselect\n      claim_id\n    , data_source\n    , \n    listagg(\n        coalesce(field, 'null'),\n        ', '\n        )\n        within group (order by field desc) as field_aggregated\nfrom\n    unique_field\ngroup by\n      claim_id\n    , data_source\n\t)\n\nselect distinct -- to bring to claim_id grain\n      m.data_source\n    , coalesce(cast(m.claim_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    , 'MEDICAL_CLAIM' AS table_name\n    , 'Claim ID' AS drill_down_key\n    , coalesce(m.claim_id, 'NULL') AS drill_down_value\n    , 'institutional' AS claim_type\n    , 'DISCHARGE_DISPOSITION_CODE' AS field_name\n    , case when cg.frequency > 1                then 'multiple'\n          when term.discharge_disposition_code is not null then 'valid'\n          when m.discharge_disposition_code is not null    then 'invalid'\n                                               else 'null' end as bucket_name\n    , case\n        when cg.frequency = 1\n            and m.discharge_disposition_code is not null\n            and term.discharge_disposition_code is null\n            then 'Discharge Disposition Code does not join to Terminology Discharge_Disposition Table'\n        else null\n    end as invalid_reason\n    , cast(\n  substr(agg.field_aggregated, 1, 255)\n as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom base m\nleft join claim_grain cg on m.claim_id = cg.claim_id and m.data_source = cg.data_source\nleft join dev_tom.terminology.discharge_disposition as term on m.discharge_disposition_code = term.discharge_disposition_code\nleft join claim_agg agg on m.claim_id = agg.claim_id and m.data_source = agg.data_source", "relation_name": "dev_tom.data_quality.institutional_discharge_disposition_code"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.109013Z", "completed_at": "2024-08-23T19:21:33.112362Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.112880Z", "completed_at": "2024-08-23T19:21:33.112883Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.008193016052246094, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__institutional_facility_npi", "compiled": true, "compiled_code": "\n\nwith base as (\n    select *\n    from tuva.input_layer.medical_claim\n    where claim_type = 'institutional'\n),\nunique_field as (\n    select distinct claim_id\n        ,cast(facility_npi as TEXT) as field\n        ,data_source\n    from base\n),\nclaim_grain as (\n    select claim_id\n        ,data_source\n        ,count(*) as frequency\n    from unique_field\n    group by claim_id\n        ,data_source\n),\nclaim_agg as (\nselect\n    claim_id,\n    data_source,\n    \n    listagg(\n        coalesce(field, 'null'),\n        ', '\n        )\n        within group (order by field desc) as field_aggregated\nfrom\n    unique_field\ngroup by\n    claim_id,\n    data_source\n\t)\nselect distinct -- to bring to claim_id grain\n    m.data_source\n    ,coalesce(cast(m.claim_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    ,'MEDICAL_CLAIM' AS table_name\n    ,'Claim ID' AS drill_down_key\n    ,coalesce(m.claim_id, 'NULL') AS drill_down_value\n    ,'institutional' AS claim_type\n    ,'FACILITY_NPI' AS field_name\n    ,case when cg.frequency > 1                then 'multiple'\n          when term.npi is not null then 'valid'\n          when m.facility_npi is not null    then 'invalid'\n                                               else 'null' end as bucket_name\n    ,case\n        when cg.frequency = 1\n            and m.facility_npi is not null\n            and term.npi is null\n            then 'NPI not in Terminology Provider Table'\n        else null\n    end as invalid_reason\n    ,cast(\n  substr(agg.field_aggregated, 1, 255)\n as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom base m\nleft join claim_grain cg on m.claim_id = cg.claim_id and m.data_source = cg.data_source\nleft join dev_tom.terminology.provider as term on m.facility_npi = term.npi\nleft join claim_agg agg on m.claim_id = agg.claim_id and m.data_source = agg.data_source", "relation_name": "dev_tom.data_quality.institutional_facility_npi"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.113157Z", "completed_at": "2024-08-23T19:21:33.116441Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.119342Z", "completed_at": "2024-08-23T19:21:33.119345Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.007473945617675781, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__institutional_present_on_admission_1", "compiled": true, "compiled_code": "\n\nwith base as (\n    select *\n    from tuva.input_layer.medical_claim\n    where claim_type = 'institutional'\n\n),\nunique_field as (\n    select distinct claim_id\n        ,cast(diagnosis_poa_1 as TEXT)  as field\n        ,data_source\n    from base\n\n),\nclaim_grain as (\n    select claim_id\n        ,data_source\n        ,count(*) as frequency\n    from unique_field\n    group by claim_id\n        ,data_source\n),\nclaim_agg as (\nselect\n    claim_id,\n    data_source,\n    \n    listagg(\n        coalesce(field, 'null'),\n        ', '\n        )\n        within group (order by field desc) as field_aggregated\nfrom\n    unique_field\ngroup by\n    claim_id,\n    data_source\n\t)\nselect distinct -- to bring to claim_id grain\n    m.data_source\n    ,coalesce(cast(m.claim_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    ,'MEDICAL_CLAIM' AS table_name\n    ,'Claim ID' AS drill_down_key\n    ,coalesce(m.claim_id, 'NULL') AS drill_down_value\n    ,'institutional' AS claim_type\n    ,'DIAGNOSIS_POA_1' AS field_name\n       ,case when cg.frequency > 1                then 'multiple'\n        when m.diagnosis_poa_1 in ('y','n')       then 'valid'\n        when m.diagnosis_poa_1 is null            then 'null'\n                                                  else 'invalid' end as bucket_name\n    ,cast(null as TEXT) as invalid_reason\n    ,cast(\n  substr(agg.field_aggregated, 1, 255)\n as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom base m\nleft join claim_grain cg on m.claim_id = cg.claim_id and m.data_source = cg.data_source\nleft join claim_agg agg on m.claim_id = agg.claim_id and m.data_source = agg.data_source", "relation_name": "dev_tom.data_quality.institutional_present_on_admission_1"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.116613Z", "completed_at": "2024-08-23T19:21:33.122295Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.122693Z", "completed_at": "2024-08-23T19:21:33.122696Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.007055997848510742, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__institutional_present_on_admission_2", "compiled": true, "compiled_code": "\n\nwith base as (\n    select *\n    from tuva.input_layer.medical_claim\n    where claim_type = 'institutional'\n),\nunique_field as (\n    select distinct claim_id\n        ,cast(diagnosis_poa_2 as TEXT)  as field\n        ,data_source\n    from base\n\n),\nclaim_grain as (\n    select claim_id\n        ,data_source\n        ,count(*) as frequency\n    from unique_field\n    group by claim_id\n        ,data_source\n),\nclaim_agg as (\nselect\n    claim_id,\n    data_source,\n    \n    listagg(\n        coalesce(field, 'null'),\n        ', '\n        )\n        within group (order by field desc) as field_aggregated\nfrom\n    unique_field\ngroup by\n    claim_id,\n    data_source\n\t)\nselect distinct -- to bring to claim_id grain\n    m.data_source\n    ,coalesce(cast(m.claim_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    ,'MEDICAL_CLAIM' AS table_name\n    ,'Claim ID' AS drill_down_key\n    ,coalesce(m.claim_id, 'NULL') AS drill_down_value\n    ,'institutional' AS claim_type\n    ,'DIAGNOSIS_POA_2' AS field_name\n       ,case when cg.frequency > 1                then 'multiple'\n        when m.diagnosis_poa_2 in ('y','n')       then 'valid'\n        when m.diagnosis_poa_2 is null            then 'null'\n                                                  else 'invalid' end as bucket_name\n    ,cast(null as TEXT) as invalid_reason\n    ,cast(\n  substr(agg.field_aggregated, 1, 255)\n as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom base m\nleft join claim_grain cg on m.claim_id = cg.claim_id and m.data_source = cg.data_source\nleft join claim_agg agg on m.claim_id = agg.claim_id and m.data_source = agg.data_source", "relation_name": "dev_tom.data_quality.institutional_present_on_admission_2"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.119658Z", "completed_at": "2024-08-23T19:21:33.123127Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.126017Z", "completed_at": "2024-08-23T19:21:33.126020Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.009778976440429688, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__institutional_present_on_admission_3", "compiled": true, "compiled_code": "\n\nwith base as (\n    select *\n    from tuva.input_layer.medical_claim\n    where claim_type = 'institutional'\n),\nunique_field as (\n    select distinct claim_id\n        ,cast(diagnosis_poa_3 as TEXT)  as field\n        ,data_source\n    from base\n\n),\nclaim_grain as (\n    select claim_id\n        ,data_source\n        ,count(*) as frequency\n    from unique_field\n    group by claim_id\n        ,data_source\n),\nclaim_agg as (\nselect\n    claim_id,\n    data_source,\n    \n    listagg(\n        coalesce(field, 'null'),\n        ', '\n        )\n        within group (order by field desc) as field_aggregated\nfrom\n    unique_field\ngroup by\n    claim_id,\n    data_source\n\t)\nselect distinct -- to bring to claim_id grain\n    m.data_source\n    ,coalesce(cast(m.claim_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    ,'MEDICAL_CLAIM' AS table_name\n    ,'Claim ID' AS drill_down_key\n    ,coalesce(m.claim_id, 'NULL') AS drill_down_value\n    ,'institutional' AS claim_type\n    ,'DIAGNOSIS_POA_3' AS field_name\n       ,case when cg.frequency > 1                then 'multiple'\n        when m.diagnosis_poa_3 in ('y','n')       then 'valid'\n        when m.diagnosis_poa_3 is null            then 'null'\n                                                  else 'invalid' end as bucket_name\n    ,cast(null as TEXT) as invalid_reason\n    ,cast(\n  substr(agg.field_aggregated, 1, 255)\n as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom base m\nleft join claim_grain cg on m.claim_id = cg.claim_id and m.data_source = cg.data_source\nleft join claim_agg agg on m.claim_id = agg.claim_id and m.data_source = agg.data_source", "relation_name": "dev_tom.data_quality.institutional_present_on_admission_3"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.123479Z", "completed_at": "2024-08-23T19:21:33.126911Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.129739Z", "completed_at": "2024-08-23T19:21:33.129743Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0072820186614990234, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__institutional_rendering_npi", "compiled": true, "compiled_code": "\n\nwith base as (\n    select *\n    from tuva.input_layer.medical_claim\n    where claim_type = 'institutional'\n),\nunique_field as (\n    select distinct claim_id\n        ,cast(facility_npi as TEXT) as field\n        ,data_source\n    from base\n),\nclaim_grain as (\n    select claim_id\n        ,data_source\n        ,count(*) as frequency\n    from unique_field\n    group by claim_id\n        ,data_source\n),\nclaim_agg as (\nselect\n    claim_id,\n    data_source,\n    \n    listagg(\n        coalesce(field, 'null'),\n        ', '\n        )\n        within group (order by field desc) as field_aggregated\nfrom\n    unique_field\ngroup by\n    claim_id,\n    data_source\n\t)\nselect distinct -- to bring to claim_id grain\n    m.data_source\n    ,coalesce(cast(m.claim_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    ,'MEDICAL_CLAIM' AS table_name\n    ,'Claim ID' AS drill_down_key\n    ,coalesce(m.claim_id, 'NULL') AS drill_down_value\n    ,'institutional' AS claim_type\n    ,'RENDERING_NPI' AS field_name\n    ,case when cg.frequency > 1                then 'multiple'\n          when term.npi is not null            then 'valid'\n          when m.rendering_npi is not null      then 'invalid'\n                                               else 'null' end as bucket_name\n    ,case\n        when cg.frequency = 1\n            and m.rendering_npi is not null\n            and term.npi is null\n        then 'provider npi does not join to terminology provider table'\n        else null\n    end as invalid_reason\n    ,cast(\n  substr(agg.field_aggregated, 1, 255)\n as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom base m\nleft join claim_grain cg on m.claim_id = cg.claim_id and m.data_source = cg.data_source\nleft join dev_tom.terminology.provider as term on m.rendering_npi = term.npi\nleft join claim_agg agg on m.claim_id = agg.claim_id and m.data_source = agg.data_source", "relation_name": "dev_tom.data_quality.institutional_rendering_npi"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.127264Z", "completed_at": "2024-08-23T19:21:33.133057Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.133435Z", "completed_at": "2024-08-23T19:21:33.133438Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.007166862487792969, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__institutional_revenue_center_code", "compiled": true, "compiled_code": "\n\nSELECT\n      m.data_source\n    , coalesce(cast(m.claim_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    , 'MEDICAL_CLAIM' AS table_name\n    , 'Claim ID | Claim Line Number' AS drill_down_key\n    , coalesce(cast(m.claim_id as TEXT), 'null') || '|' || coalesce(cast(m.claim_line_number as TEXT), 'null') as drill_down_value\n    , 'institutional' AS claim_type\n    , 'REVENUE_CENTER_CODE' AS field_name\n    , case\n          when term.revenue_center_code is not null then 'valid'\n          when m.revenue_center_code is not null    then 'invalid'\n                                                    else 'null' end as bucket_name\n    , case\n        when m.revenue_center_code is not null\n            and term.revenue_center_code is null\n            then 'Revenue center code does not join to Terminology Revenue Center table'\n        else null\n    end as invalid_reason\n    , m.revenue_center_code || '|' || coalesce(term.revenue_center_description, '') as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\n    from tuva.input_layer.medical_claim m\nleft join dev_tom.terminology.revenue_center as term on m.revenue_center_code = term.revenue_center_code", "relation_name": "dev_tom.data_quality.institutional_revenue_center_code"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.130426Z", "completed_at": "2024-08-23T19:21:33.133691Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.137262Z", "completed_at": "2024-08-23T19:21:33.137265Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.010215044021606445, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__institutional_service_unit_quantity", "compiled": true, "compiled_code": "\n\nSELECT\n      m.data_source\n    , coalesce(cast(m.claim_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    , 'MEDICAL_CLAIM' AS table_name\n    , 'Claim ID | Claim Line Number' AS drill_down_key\n    , coalesce(cast(m.claim_id as TEXT), 'null') || '|' || coalesce(cast(m.claim_line_number as TEXT), 'null') as drill_down_value\n    , m.claim_type as claim_type\n    , 'service_unit_quantity' as field_name\n    , case when m.service_unit_quantity is null then 'null'\n                                    else 'valid' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(service_unit_quantity as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.medical_claim m", "relation_name": "dev_tom.data_quality.institutional_service_unit_quantity"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.133857Z", "completed_at": "2024-08-23T19:21:33.137938Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.138483Z", "completed_at": "2024-08-23T19:21:33.138486Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0056951045989990234, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__professional_billing_npi", "compiled": true, "compiled_code": "\n\nwith base as (\n    select *\n    from tuva.input_layer.medical_claim\n    where claim_type = 'professional'\n)\n\nselect\n      m.data_source\n    , coalesce(cast(m.claim_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    , 'MEDICAL_CLAIM' AS table_name\n    , 'Claim ID | Claim Line Number' AS drill_down_key\n    , coalesce(cast(m.claim_id as TEXT), 'null') || '|' || coalesce(cast(m.claim_line_number as TEXT), 'null') as drill_down_value\n    , 'professional' AS claim_type\n    , 'BILLING_NPI' AS field_name\n    , case when term.npi is not null          then        'valid'\n          when m.billing_npi is not null    then 'invalid'\n                                             else 'null' end as bucket_name\n    , case\n        when m.billing_npi is not null\n            and term.npi is null\n            then 'Billing NPI does not join to Terminology Provider Table'\n        else null\n    end as invalid_reason\n    , cast(m.billing_npi as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom base m\nleft join dev_tom.terminology.provider as term on m.billing_npi = term.npi", "relation_name": "dev_tom.data_quality.professional_billing_npi"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.138834Z", "completed_at": "2024-08-23T19:21:33.147259Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.147615Z", "completed_at": "2024-08-23T19:21:33.147618Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.010094165802001953, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__professional_claim_end_date", "compiled": true, "compiled_code": "\n\nwith base as (\n    select *\n    from tuva.input_layer.medical_claim\n    where claim_type = 'institutional'\n)\n, tuva_last_run as(\n    select cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) as tuva_last_run\n)\n ,unique_field as (\n    select distinct claim_id\n        ,cast(claim_end_date as TEXT) as field\n        ,data_source\n    from base\n),\nclaim_grain as (\n    select claim_id\n        ,data_source\n        ,count(*) as frequency\n    from unique_field\n    group by claim_id\n        ,data_source\n),\nclaim_agg as (\nselect\n    claim_id,\n    data_source,\n    \n    listagg(\n        coalesce(field, 'null'),\n        ', '\n        )\n        within group (order by field desc) as field_aggregated\nfrom\n    unique_field\ngroup by\n    claim_id,\n    data_source\n\t)\nselect\n    m.data_source\n    ,coalesce(cast(m.claim_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    ,'MEDICAL_CLAIM' AS table_name\n    ,'Claim ID' AS drill_down_key\n    ,coalesce(m.claim_id,'NULL') AS drill_down_value\n    ,'professional' AS claim_type\n    ,'CLAIM_END_DATE' AS field_name\n    ,case\n        when cg.frequency > 1 then 'multiple'\n        when m.claim_end_date > cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) then 'invalid'\n        when m.claim_end_date < \n\n    dateadd(\n        year,\n        -10,\n        cte.tuva_last_run\n        )\n\n then 'invalid'\n        when m.claim_end_date < m.claim_start_date then 'invalid'\n        when m.claim_end_date is null then 'null'\n        else 'valid'\n    end as bucket_name\n    ,case\n        when cg.frequency > 1 then 'multiple'\n        when m.claim_end_date > cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) then 'future'\n        when m.claim_end_date < \n\n    dateadd(\n        year,\n        -10,\n        cte.tuva_last_run\n        )\n\n then 'too old'\n        when m.claim_end_date < m.claim_start_date then 'claim end date before start date'\n        when m.claim_end_date is null then null\n        else 'valid'\n    end as invalid_reason\n    ,cast(\n  substr(agg.field_aggregated, 1, 255)\n as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom base m\nleft join claim_grain cg on m.claim_id = cg.claim_id and m.data_source = cg.data_source\nleft join claim_agg agg on m.claim_id = agg.claim_id and m.data_source = agg.data_source\ncross join tuva_last_run cte", "relation_name": "dev_tom.data_quality.professional_claim_end_date"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.143156Z", "completed_at": "2024-08-23T19:21:33.150417Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.150825Z", "completed_at": "2024-08-23T19:21:33.150829Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.012573003768920898, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__professional_claim_start_date", "compiled": true, "compiled_code": "\n\nwith base as (\n    select *\n    from tuva.input_layer.medical_claim\n    where claim_type = 'professional'\n)\n, tuva_last_run as(\n    select cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) as tuva_last_run\n)\n, unique_field as (\n    select distinct claim_id\n        ,cast(claim_start_date as TEXT) as field\n        ,data_source\n    from base\n),\nclaim_grain as (\n    select claim_id\n        ,data_source\n        ,count(*) as frequency\n    from unique_field\n    group by claim_id\n        ,data_source\n),\nclaim_agg as (\nselect\n    claim_id,\n    data_source,\n    \n    listagg(\n        coalesce(field, 'null'),\n        ', '\n        )\n        within group (order by field desc) as field_aggregated\nfrom\n    unique_field\ngroup by\n    claim_id,\n    data_source\n\t)\nselect\n    m.data_source\n    ,coalesce(cast(m.claim_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    ,'MEDICAL_CLAIM' AS table_name\n    ,'Claim ID' AS drill_down_key\n    ,coalesce(m.claim_id,'NULL') AS drill_down_value\n    ,'professional' AS claim_type\n    ,'CLAIM_START_DATE' AS field_name\n    ,case\n        when cg.frequency > 1 then 'multiple'\n        when m.claim_start_date > cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) then 'invalid'\n        when m.claim_start_date < \n\n    dateadd(\n        year,\n        -10,\n        cte.tuva_last_run\n        )\n\n then 'invalid'\n        when m.claim_start_date is null then 'null'\n        else 'valid'\n    end as bucket_name\n    ,case\n        when cg.frequency > 1 then 'multiple'\n        when m.claim_start_date > cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) then 'future'\n        when m.claim_start_date < \n\n    dateadd(\n        year,\n        -10,\n        cte.tuva_last_run\n        )\n\n then 'too old'\n        else null\n    end as invalid_reason\n    ,cast(\n  substr(agg.field_aggregated, 1, 255)\n as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom base m\nleft join claim_grain cg on m.claim_id = cg.claim_id and m.data_source = cg.data_source\nleft join claim_agg agg on m.claim_id = agg.claim_id and m.data_source = agg.data_source\ncross join tuva_last_run cte", "relation_name": "dev_tom.data_quality.professional_claim_start_date"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.147893Z", "completed_at": "2024-08-23T19:21:33.151282Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.151796Z", "completed_at": "2024-08-23T19:21:33.151799Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0047719478607177734, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__professional_diagnosis_code_1", "compiled": true, "compiled_code": "\n\nwith base as (\n    select *\n    from tuva.input_layer.medical_claim\n    where claim_type = 'professional'\n)\n\nselect\n      m.data_source\n    , coalesce(cast(m.claim_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    , 'MEDICAL_CLAIM' AS table_name\n    , 'Claim ID | Claim Line Number' AS drill_down_key\n    , coalesce(cast(m.claim_id as TEXT), 'null') || '|' || coalesce(cast(m.claim_line_number as TEXT), 'null') as drill_down_value\n    , 'professional' AS claim_type\n    , 'DIAGNOSIS_CODE_1' AS field_name\n    , case when term.icd_10_cm is not null          then 'valid'\n          when m.diagnosis_code_1 is not null      then 'invalid'\n                                                   else 'null' end as bucket_name\n    , case\n        when m.diagnosis_code_1 is not null\n            and term.icd_10_cm is null\n            then 'Diagnosis Code does not join to Terminology ICD_10_CM table'\n        else null\n    end as invalid_reason\n    , m.diagnosis_code_1 || '|' || coalesce(term.short_description, '') as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom base m\nleft join dev_tom.terminology.icd_10_cm as term on m.diagnosis_code_1 = term.icd_10_cm", "relation_name": "dev_tom.data_quality.professional_diagnosis_code_1"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.152237Z", "completed_at": "2024-08-23T19:21:33.157885Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.158261Z", "completed_at": "2024-08-23T19:21:33.158263Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.007180929183959961, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__professional_diagnosis_code_2", "compiled": true, "compiled_code": "\n\nwith base as (\n    select *\n    from tuva.input_layer.medical_claim\n    where claim_type = 'professional'\n)\n\nselect\n      m.data_source\n    , coalesce(cast(m.claim_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    , 'MEDICAL_CLAIM' AS table_name\n    , 'Claim ID | Claim Line Number' AS drill_down_key\n    , coalesce(cast(m.claim_id as TEXT), 'null') || '|' || coalesce(cast(m.claim_line_number as TEXT), 'null') as drill_down_value\n    , 'professional' AS claim_type\n    , 'DIAGNOSIS_CODE_2' AS field_name\n    , case when term.icd_10_cm is not null          then 'valid'\n          when m.diagnosis_code_2 is not null      then 'invalid'\n                                                   else 'null' end as bucket_name\n    , case\n        when m.diagnosis_code_2 is not null\n            and term.icd_10_cm is null\n            then 'Diagnosis Code does not join to Terminology ICD_10_CM table'\n        else null\n    end as invalid_reason\n    , m.diagnosis_code_2 || '|' || coalesce(term.short_description, '') as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom base m\nleft join dev_tom.terminology.icd_10_cm as term on m.diagnosis_code_2 = term.icd_10_cm", "relation_name": "dev_tom.data_quality.professional_diagnosis_code_2"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.155404Z", "completed_at": "2024-08-23T19:21:33.161104Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.161492Z", "completed_at": "2024-08-23T19:21:33.161495Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.009460926055908203, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__professional_diagnosis_code_3", "compiled": true, "compiled_code": "\n\nwith base as (\n    select *\n    from tuva.input_layer.medical_claim\n    where claim_type = 'professional'\n)\n\nselect\n      m.data_source\n    , coalesce(cast(m.claim_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    , 'MEDICAL_CLAIM' AS table_name\n    , 'Claim ID | Claim Line Number' AS drill_down_key\n    , coalesce(cast(m.claim_id as TEXT), 'null') || '|' || coalesce(cast(m.claim_line_number as TEXT), 'null') as drill_down_value\n    , 'professional' AS claim_type\n    , 'DIAGNOSIS_CODE_3' AS field_name\n    , case when term.icd_10_cm is not null          then 'valid'\n          when m.diagnosis_code_3 is not null      then 'invalid'\n                                                   else 'null' end as bucket_name\n    , case\n        when m.diagnosis_code_3 is not null\n            and term.icd_10_cm is null\n            then 'Diagnosis Code does not join to Terminology ICD_10_CM table'\n        else null\n    end as invalid_reason\n    , m.diagnosis_code_3 || '|' || coalesce(term.short_description, '') as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom base m\nleft join dev_tom.terminology.icd_10_cm as term on m.diagnosis_code_3 = term.icd_10_cm", "relation_name": "dev_tom.data_quality.professional_diagnosis_code_3"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.158535Z", "completed_at": "2024-08-23T19:21:33.161746Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.162276Z", "completed_at": "2024-08-23T19:21:33.162279Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.007120847702026367, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__professional_facility_npi", "compiled": true, "compiled_code": "\n\nwith base as (\n    select *\n    from tuva.input_layer.medical_claim\n    where claim_type = 'professional'\n)\n\nselect\n      m.data_source\n    , coalesce(cast(m.claim_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    , 'MEDICAL_CLAIM' AS table_name\n    , 'Claim ID | Claim Line Number' AS drill_down_key\n    , coalesce(cast(m.claim_id as TEXT), 'null') || '|' || coalesce(cast(m.claim_line_number as TEXT), 'null') as drill_down_value\n    , 'professional' AS claim_type\n    , 'FACILITY_NPI' AS field_name\n    , case when term.npi is not null          then        'valid'\n          when m.facility_npi is not null    then 'invalid'\n                                             else 'null' end as bucket_name\n    , case\n        when m.facility_npi is not null\n            and term.npi is null\n            then 'Facility NPI does not join to Terminology Provider Table'\n        else null\n    end as invalid_reason\n    , cast(m.facility_npi as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom base m\nleft join dev_tom.terminology.provider as term on m.facility_npi = term.npi", "relation_name": "dev_tom.data_quality.professional_facility_npi"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.162564Z", "completed_at": "2024-08-23T19:21:33.168967Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.169331Z", "completed_at": "2024-08-23T19:21:33.169334Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.008068084716796875, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__professional_place_of_service_code", "compiled": true, "compiled_code": "\n\nwith base as (\n    select *\n    from tuva.input_layer.medical_claim\n    where claim_type = 'professional'\n)\n\nselect\n      m.data_source\n    , coalesce(cast(m.claim_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    , 'MEDICAL_CLAIM' AS table_name\n    , 'Claim ID | Claim Line Number' AS drill_down_key\n    , coalesce(cast(m.claim_id as TEXT), 'null') || '|' || coalesce(cast(m.claim_line_number as TEXT), 'null') as drill_down_value\n    , 'professional' AS claim_type\n    , 'PLACE_OF_SERVICE_CODE' AS field_name\n    , case when term.place_of_service_code is not null then 'valid'\n          when m.place_of_service_code is not null    then 'invalid'\n                                               else 'null' end as bucket_name\n    , case\n        when m.place_of_service_code is not null\n            and term.place_of_service_code is null\n            then 'Place of Service Code does not join to Terminology Place of Service table'\n        else null\n    end as invalid_reason\n    , m.place_of_service_code || '|' || coalesce(term.place_of_service_description, '') as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom base m\nleft join dev_tom.terminology.place_of_service as term on m.place_of_service_code = term.place_of_service_code", "relation_name": "dev_tom.data_quality.professional_place_of_service_code"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.166564Z", "completed_at": "2024-08-23T19:21:33.171346Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.171734Z", "completed_at": "2024-08-23T19:21:33.171737Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.005984783172607422, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__professional_rendering_npi", "compiled": true, "compiled_code": "\n\nwith base as (\n    select *\n    from tuva.input_layer.medical_claim\n    where claim_type = 'professional'\n)\n\nselect\n      m.data_source\n    , coalesce(cast(m.claim_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    , 'MEDICAL_CLAIM' AS table_name\n    , 'Claim ID | Claim Line Number' AS drill_down_key\n    , coalesce(cast(m.claim_id as TEXT), 'null') || '|' || coalesce(cast(m.claim_line_number as TEXT), 'null') as drill_down_value\n    , 'professional' AS claim_type\n    , 'RENDERING_NPI' AS field_name\n    , case when term.npi is not null          then        'valid'\n          when m.rendering_npi is not null    then 'invalid'\n                                             else 'null' end as bucket_name\n    , case\n        when m.rendering_npi is not null\n            and term.npi is null\n            then 'Rendering Provider NPI does not join to Terminology Provider table'\n        else null\n    end as invalid_reason\n    , cast(m.rendering_npi as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom base m\nleft join dev_tom.terminology.provider as term on m.rendering_npi = term.npi", "relation_name": "dev_tom.data_quality.professional_rendering_npi"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.175153Z", "completed_at": "2024-08-23T19:21:33.179153Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.180498Z", "completed_at": "2024-08-23T19:21:33.180501Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.0063588619232177734, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.medical_claim_expanded", "compiled": true, "compiled_code": "\n\n\nselect *\nfrom tuva.input_layer.medical_claim", "relation_name": "dev_tom.claims_expanded.medical_claim_expanded"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.184780Z", "completed_at": "2024-08-23T19:21:33.190474Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.194022Z", "completed_at": "2024-08-23T19:21:33.194025Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.010440349578857422, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__pharmacy_allowed_amount", "compiled": true, "compiled_code": "\n\nSELECT DISTINCT -- to bring to claim_ID grain\n      m.data_source\n    , coalesce(cast(m.paid_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    , 'PHARMACY_CLAIM' AS table_name\n    , 'Claim ID | Claim Line Number' AS drill_down_key\n    , coalesce(cast(m.claim_id as TEXT), 'null') || '|' || coalesce(cast(m.claim_line_number as TEXT), 'null') as drill_down_value\n    , 'PHARMACY' AS claim_type\n    , 'ALLOWED_AMOUNT' AS field_name\n    , case when m.allowed_amount is null          then        'null'\n                                              else 'valid' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(allowed_amount as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.pharmacy_claim m", "relation_name": "dev_tom.data_quality.pharmacy_allowed_amount"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.187659Z", "completed_at": "2024-08-23T19:21:33.194287Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.194713Z", "completed_at": "2024-08-23T19:21:33.194717Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.010687828063964844, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__pharmacy_claim_id", "compiled": true, "compiled_code": "\n\nSELECT\n      m.data_source\n    , coalesce(cast(m.paid_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    , 'PHARMACY_CLAIM' AS table_name\n    , 'Claim ID | Claim Line Number' AS drill_down_key\n    , coalesce(cast(m.claim_id as TEXT), 'null') || '|' || coalesce(cast(m.claim_line_number as TEXT), 'null') as drill_down_value\n    , 'PHARMACY' AS claim_type\n    , 'CLAIM_ID' AS field_name\n    , case\n        when m.claim_id is null then 'null' else 'valid' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(member_id as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.pharmacy_claim m", "relation_name": "dev_tom.data_quality.pharmacy_claim_id"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.190648Z", "completed_at": "2024-08-23T19:21:33.194973Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.195529Z", "completed_at": "2024-08-23T19:21:33.195532Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.008249044418334961, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__pharmacy_claim_line_number", "compiled": true, "compiled_code": "\n\nSELECT\n      m.data_source\n    , coalesce(cast(m.paid_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    , 'PHARMACY_CLAIM' AS table_name\n    , 'Claim ID | Claim Line Number' AS drill_down_key\n    , coalesce(cast(m.claim_id as TEXT), 'null') || '|' || coalesce(cast(m.claim_line_number as TEXT), 'null') as drill_down_value\n    , 'PHARMACY' AS claim_type\n    , 'CLAIM_LINE_NUMBER' AS field_name\n    , case\n        when m.claim_line_number is null then 'null' else 'valid' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(member_id as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.pharmacy_claim m", "relation_name": "dev_tom.data_quality.pharmacy_claim_line_number"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.196359Z", "completed_at": "2024-08-23T19:21:33.201869Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.204522Z", "completed_at": "2024-08-23T19:21:33.204525Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.009405851364135742, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__pharmacy_coinsurance_amount", "compiled": true, "compiled_code": "\n\nSELECT DISTINCT -- to bring to claim_ID grain\n      m.data_source\n    , coalesce(cast(m.paid_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    , 'PHARMACY_CLAIM' AS table_name\n    , 'Claim ID | Claim Line Number' AS drill_down_key\n    , coalesce(cast(m.claim_id as TEXT), 'null') || '|' || coalesce(cast(m.claim_line_number as TEXT), 'null') as drill_down_value\n    , 'PHARMACY' AS claim_type\n    , 'COINSURANCE_AMOUNT' AS field_name\n    , case when m.coinsurance_amount is null          then        'null'\n                                              else 'valid' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(coinsurance_amount as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.pharmacy_claim m", "relation_name": "dev_tom.data_quality.pharmacy_coinsurance_amount"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.199307Z", "completed_at": "2024-08-23T19:21:33.204803Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.205181Z", "completed_at": "2024-08-23T19:21:33.205184Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.009239912033081055, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__pharmacy_copayment_amount", "compiled": true, "compiled_code": "\n\nSELECT DISTINCT -- to bring to claim_ID grain\n      m.data_source\n    , coalesce(cast(m.paid_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    , 'PHARMACY_CLAIM' AS table_name\n    , 'Claim ID | Claim Line Number' AS drill_down_key\n    , coalesce(cast(m.claim_id as TEXT), 'null') || '|' || coalesce(cast(m.claim_line_number as TEXT), 'null') as drill_down_value\n    , 'PHARMACY' AS claim_type\n    , 'COPAYMENT_AMOUNT' AS field_name\n    , case when m.copayment_amount is null then 'null'\n                                           else 'valid' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(copayment_amount as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.pharmacy_claim m", "relation_name": "dev_tom.data_quality.pharmacy_copayment_amount"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.202040Z", "completed_at": "2024-08-23T19:21:33.205627Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.206142Z", "completed_at": "2024-08-23T19:21:33.206145Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.007099151611328125, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__pharmacy_data_source", "compiled": true, "compiled_code": "\n\nSELECT\n      m.data_source\n    , coalesce(cast(m.paid_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    , 'PHARMACY_CLAIM' AS table_name\n    , 'Claim ID | Claim Line Number' AS drill_down_key\n    , coalesce(cast(m.claim_id as TEXT), 'null') || '|' || coalesce(cast(m.claim_line_number as TEXT), 'null') as drill_down_value\n    , 'PHARMACY' AS claim_type\n    , 'DATA_SOURCE' AS field_name\n    , case\n        when m.data_source is null then 'null' else 'valid' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(data_source as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.pharmacy_claim m", "relation_name": "dev_tom.data_quality.pharmacy_data_source"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.206576Z", "completed_at": "2024-08-23T19:21:33.211998Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.212381Z", "completed_at": "2024-08-23T19:21:33.212384Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.006953001022338867, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__pharmacy_days_supply", "compiled": true, "compiled_code": "\n\nSELECT\n      m.data_source\n    , coalesce(cast(m.paid_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    , 'PHARMACY_CLAIM' AS table_name\n    , 'Claim ID | Claim Line Number' AS drill_down_key\n    , coalesce(cast(m.claim_id as TEXT), 'null') || '|' || coalesce(cast(m.claim_line_number as TEXT), 'null') as drill_down_value\n    , 'PHARMACY' AS claim_type\n    , 'DAYS_SUPPLY' AS field_name\n    , case\n        when m.days_supply is null then 'null' else 'valid' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(days_supply as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.pharmacy_claim m", "relation_name": "dev_tom.data_quality.pharmacy_days_supply"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.209509Z", "completed_at": "2024-08-23T19:21:33.215969Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.216361Z", "completed_at": "2024-08-23T19:21:33.216364Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.009993314743041992, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__pharmacy_deductible_amount", "compiled": true, "compiled_code": "\n\nSELECT DISTINCT -- to bring to claim_ID grain\n      m.data_source\n    , coalesce(cast(m.paid_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    , 'PHARMACY_CLAIM' AS table_name\n    , 'Claim ID | Claim Line Number' AS drill_down_key\n    , coalesce(cast(m.claim_id as TEXT), 'null') || '|' || coalesce(cast(m.claim_line_number as TEXT), 'null') as drill_down_value\n    , 'PHARMACY' AS claim_type\n    , 'DEDUCTIBLE_AMOUNT' AS field_name\n    , case when m.deductible_amount is null then 'null'\n                                            else 'valid' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(deductible_amount as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.pharmacy_claim m", "relation_name": "dev_tom.data_quality.pharmacy_deductible_amount"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.212655Z", "completed_at": "2024-08-23T19:21:33.216783Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.220230Z", "completed_at": "2024-08-23T19:21:33.220232Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.010949850082397461, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__pharmacy_dispensing_date", "compiled": true, "compiled_code": "\nwith tuva_last_run as(\n    select cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) as tuva_last_run\n)\n\nSELECT\n      m.data_source\n    , coalesce(cast(m.paid_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    , 'PHARMACY_CLAIM' AS table_name\n    , 'Claim ID | Claim Line Number' AS drill_down_key\n    , coalesce(cast(m.claim_id as TEXT), 'null') || '|' || coalesce(cast(m.claim_line_number as TEXT), 'null') as drill_down_value\n    , 'PHARMACY' AS claim_type\n    , 'DISPENSING_DATE' AS field_name\n    , case\n        when m.dispensing_date > tuva_last_run then 'invalid'\n        when m.dispensing_date < \n\n    dateadd(\n        year,\n        -10,\n        cte.tuva_last_run\n        )\n\n then 'invalid'\n        when m.dispensing_date is null then 'null'\n        else 'valid'\n    end as bucket_name\n    , case\n        when m.dispensing_date > tuva_last_run then 'future'\n        when m.dispensing_date < \n\n    dateadd(\n        year,\n        -10,\n        cte.tuva_last_run\n        )\n\n then 'too old'\n        else null\n        end as invalid_reason\n    , cast(dispensing_date as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.pharmacy_claim m\ncross join tuva_last_run cte", "relation_name": "dev_tom.data_quality.pharmacy_dispensing_date"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.217136Z", "completed_at": "2024-08-23T19:21:33.221042Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.223876Z", "completed_at": "2024-08-23T19:21:33.223880Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.007739067077636719, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__pharmacy_dispensing_provider_npi", "compiled": true, "compiled_code": "\n\nSELECT DISTINCT -- to bring to claim_ID grain\n      m.data_source\n    , coalesce(cast(m.paid_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    , 'PHARMACY_CLAIM' AS table_name\n    , 'Claim ID | Claim Line Number' AS drill_down_key\n    , coalesce(cast(m.claim_id as TEXT), 'null') || '|' || coalesce(cast(m.claim_line_number as TEXT), 'null') as drill_down_value\n    , 'PHARMACY' AS claim_type\n    , 'DISPENSING_PROVIDER_NPI' AS field_name\n    , case when term.npi is not null                     then        'valid'\n          when m.dispensing_provider_npi is not null    then 'invalid'\n                                                        else 'null'\n                                                        end as bucket_name\n    , case\n        when m.dispensing_provider_npi is not null\n            and term.npi is null\n            then 'dispensing provider npi does not join to terminology provider table'\n        else null\n    end as invalid_reason\n    , cast(m.dispensing_provider_npi as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.pharmacy_claim m\nleft join dev_tom.terminology.provider as term on m.dispensing_provider_npi = term.npi", "relation_name": "dev_tom.data_quality.pharmacy_dispensing_provider_npi"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.221401Z", "completed_at": "2024-08-23T19:21:33.227165Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.227536Z", "completed_at": "2024-08-23T19:21:33.227539Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.0070819854736328125, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__pharmacy_member_id", "compiled": true, "compiled_code": "\n\nSELECT\n      m.data_source\n    , coalesce(cast(m.paid_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    , 'PHARMACY_CLAIM' AS table_name\n    , 'Claim ID | Claim Line Number' AS drill_down_key\n    , coalesce(cast(m.claim_id as TEXT), 'null') || '|' || coalesce(cast(m.claim_line_number as TEXT), 'null') as drill_down_value\n    , 'PHARMACY' AS claim_type\n    , 'MEMBER_ID' AS field_name\n    , case\n        when m.member_id is null then 'null' else 'valid' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(member_id as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.pharmacy_claim m", "relation_name": "dev_tom.data_quality.pharmacy_member_id"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.224547Z", "completed_at": "2024-08-23T19:21:33.230202Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.230630Z", "completed_at": "2024-08-23T19:21:33.230633Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.009449005126953125, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__pharmacy_ndc_code", "compiled": true, "compiled_code": "\n\nSELECT DISTINCT -- to bring to claim_ID grain\n      m.data_source\n    , coalesce(cast(m.paid_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    , 'PHARMACY_CLAIM' AS table_name\n    , 'Claim ID | Claim Line Number' AS drill_down_key\n    , coalesce(cast(m.claim_id as TEXT), 'null') || '|' || coalesce(cast(m.claim_line_number as TEXT), 'null') as drill_down_value\n    , 'PHARMACY' AS claim_type\n    , 'NDC_CODE' AS field_name\n    , case when term.ndc is not null          then        'valid'\n          when m.ndc_code is not null        then 'invalid'\n                                             else 'null' end as bucket_name\n    , case\n        when m.ndc_code is not null\n            and term.ndc is null\n            then 'NDC Code does not join to Terminology NDC table'\n        else null\n    end as invalid_reason\n    , m.ndc_code || '|' || coalesce(term.rxnorm_description, term.fda_description, '') as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.pharmacy_claim m\nleft join dev_tom.terminology.ndc as term on m.ndc_code = term.ndc", "relation_name": "dev_tom.data_quality.pharmacy_ndc_code"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.227802Z", "completed_at": "2024-08-23T19:21:33.231259Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.231780Z", "completed_at": "2024-08-23T19:21:33.231782Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.004807949066162109, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__pharmacy_paid_amount", "compiled": true, "compiled_code": "\n\nSELECT DISTINCT -- to bring to claim_ID grain\n      m.data_source\n    , coalesce(cast(m.paid_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    , 'PHARMACY_CLAIM' AS table_name\n    , 'Claim ID | Claim Line Number' AS drill_down_key\n    , coalesce(cast(m.claim_id as TEXT), 'null') || '|' || coalesce(cast(m.claim_line_number as TEXT), 'null') as drill_down_value\n    , 'PHARMACY' AS claim_type\n    , 'PAID_AMOUNT' AS field_name\n    , case when m.paid_amount is null          then        'null'\n                                              else 'valid' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(paid_amount as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.pharmacy_claim m", "relation_name": "dev_tom.data_quality.pharmacy_paid_amount"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.232045Z", "completed_at": "2024-08-23T19:21:33.238288Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.238653Z", "completed_at": "2024-08-23T19:21:33.238655Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.007776021957397461, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__pharmacy_paid_date", "compiled": true, "compiled_code": "\nwith tuva_last_run as(\n     select cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) as tuva_last_run\n)\n\nSELECT\n      m.data_source\n    , coalesce(cast(m.paid_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    , 'PHARMACY_CLAIM' AS table_name\n    , 'Claim ID | Claim Line Number' AS drill_down_key\n    , coalesce(cast(m.claim_id as TEXT), 'null') || '|' || coalesce(cast(m.claim_line_number as TEXT), 'null') as drill_down_value\n    , 'PHARMACY' AS claim_type\n    , 'PAID_DATE' AS field_name\n    , case\n        when m.paid_date > tuva_last_run then 'invalid'\n        when m.paid_date < \n\n    dateadd(\n        year,\n        -10,\n        cte.tuva_last_run\n        )\n\n then 'invalid'\n        when m.paid_date is null then 'null'\n        else 'valid'\n    end as bucket_name\n    , case\n        when m.paid_date > tuva_last_run then 'future'\n        when m.paid_date < \n\n    dateadd(\n        year,\n        -10,\n        cte.tuva_last_run\n        )\n\n then 'too old'\n        else null\n        end as invalid_reason\n    , cast(paid_date as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.pharmacy_claim m\ncross join tuva_last_run cte", "relation_name": "dev_tom.data_quality.pharmacy_paid_date"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.235683Z", "completed_at": "2024-08-23T19:21:33.241346Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.241755Z", "completed_at": "2024-08-23T19:21:33.241758Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.01019906997680664, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__pharmacy_patient_id", "compiled": true, "compiled_code": "\n\nSELECT\n      m.data_source\n    , coalesce(cast(m.paid_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    , 'PHARMACY_CLAIM' AS table_name\n    , 'Claim ID | Claim Line Number' AS drill_down_key\n    , coalesce(cast(m.claim_id as TEXT), 'null') || '|' || coalesce(cast(m.claim_line_number as TEXT), 'null') as drill_down_value\n    , 'PHARMACY' AS claim_type\n    , 'PATIENT_ID' AS field_name\n    , case\n        when m.patient_id is null then 'null' else 'valid' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(patient_id as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.pharmacy_claim m", "relation_name": "dev_tom.data_quality.pharmacy_patient_id"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.238931Z", "completed_at": "2024-08-23T19:21:33.242204Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.242740Z", "completed_at": "2024-08-23T19:21:33.242742Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.004645109176635742, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__pharmacy_payer", "compiled": true, "compiled_code": "\n\nSELECT\n      m.data_source\n    , coalesce(cast(m.paid_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    , 'PHARMACY_CLAIM' AS table_name\n    , 'Claim ID | Claim Line Number' AS drill_down_key\n    , coalesce(cast(m.claim_id as TEXT), 'null') || '|' || coalesce(cast(m.claim_line_number as TEXT), 'null') as drill_down_value\n    , 'PHARMACY' AS claim_type\n    , 'PAYER' AS field_name\n    , case\n        when m.payer is null then 'null' else 'valid' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(payer as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.pharmacy_claim m", "relation_name": "dev_tom.data_quality.pharmacy_payer"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.243179Z", "completed_at": "2024-08-23T19:21:33.249670Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.252281Z", "completed_at": "2024-08-23T19:21:33.252284Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.010277748107910156, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__pharmacy_plan", "compiled": true, "compiled_code": "\n\nSELECT\n      m.data_source\n    , coalesce(cast(m.paid_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    , 'PHARMACY_CLAIM' AS table_name\n    , 'Claim ID | Claim Line Number' AS drill_down_key\n    , coalesce(cast(m.claim_id as TEXT), 'null') || '|' || coalesce(cast(m.claim_line_number as TEXT), 'null') as drill_down_value\n    , 'PHARMACY' AS claim_type\n    , 'PLAN' AS field_name\n    , case\n        when m.plan is null then 'null' else 'valid' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(plan as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.pharmacy_claim m", "relation_name": "dev_tom.data_quality.pharmacy_plan"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.246270Z", "completed_at": "2024-08-23T19:21:33.252582Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.253038Z", "completed_at": "2024-08-23T19:21:33.253041Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.010068893432617188, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__pharmacy_prescribing_provider_npi", "compiled": true, "compiled_code": "\n\nSELECT DISTINCT -- to bring to claim_ID grain\n      m.data_source\n    , coalesce(cast(m.paid_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    , 'PHARMACY_CLAIM' AS table_name\n    , 'Claim ID | Claim Line Number' AS drill_down_key\n    , coalesce(cast(m.claim_id as TEXT), 'null') || '|' || coalesce(cast(m.claim_line_number as TEXT), 'null') as drill_down_value\n    , 'PHARMACY' AS claim_type\n    , 'PRESCRIBING_PROVIDER_NPI' AS field_name\n    , case when term.npi is not null          then        'valid'\n          when m.prescribing_provider_npi is not null    then 'invalid'\n                                             else 'null' end as bucket_name\n    , case\n        when m.prescribing_provider_npi is not null\n            and term.npi is null\n            then 'Prescribing Provider NPI does not join to Terminology Provider table'\n        else null\n    end as invalid_reason\n    , cast(m.prescribing_provider_npi as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.pharmacy_claim m\nleft join dev_tom.terminology.provider as term on m.prescribing_provider_npi = term.npi", "relation_name": "dev_tom.data_quality.pharmacy_prescribing_provider_npi"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.249909Z", "completed_at": "2024-08-23T19:21:33.253302Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.253907Z", "completed_at": "2024-08-23T19:21:33.253910Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.007862091064453125, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__pharmacy_quantity", "compiled": true, "compiled_code": "\n\nSELECT\n      m.data_source\n    , coalesce(cast(m.paid_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    , 'PHARMACY_CLAIM' AS table_name\n    , 'Claim ID | Claim Line Number' AS drill_down_key\n    , coalesce(cast(m.claim_id as TEXT), 'null') || '|' || coalesce(cast(m.claim_line_number as TEXT), 'null') as drill_down_value\n    , 'PHARMACY' AS claim_type\n    , 'PAID_DATE' AS field_name\n    , case\n        when m.quantity is null then 'null' else 'valid' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(quantity as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.pharmacy_claim m", "relation_name": "dev_tom.data_quality.pharmacy_quantity"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.254693Z", "completed_at": "2024-08-23T19:21:33.259742Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.261285Z", "completed_at": "2024-08-23T19:21:33.261288Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.007851839065551758, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__pharmacy_refills", "compiled": true, "compiled_code": "\n\nSELECT\n      m.data_source\n    , coalesce(cast(m.paid_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    , 'PHARMACY_CLAIM' AS table_name\n    , 'Claim ID | Claim Line Number' AS drill_down_key\n    , coalesce(cast(m.claim_id as TEXT), 'null') || '|' || coalesce(cast(m.claim_line_number as TEXT), 'null') as drill_down_value\n    , 'PHARMACY' AS claim_type\n    , 'REFILLS' AS field_name\n    , case\n        when m.refills is null then 'null' else 'valid' end as bucket_name\n    , cast(null as TEXT) as invalid_reason\n    , cast(refills as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.pharmacy_claim m", "relation_name": "dev_tom.data_quality.pharmacy_refills"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.257447Z", "completed_at": "2024-08-23T19:21:33.261546Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.261960Z", "completed_at": "2024-08-23T19:21:33.261962Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.007719993591308594, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__raw_summary", "compiled": true, "compiled_code": "\n\nwith cte as (\n    select \n        'input_layer' as source\n      , 'eligibility' as table_name\n      , count(*) as row_count\n      , count(distinct patient_id) as unique_check\n      , 'Unique Patient Count' as unique_check_desc\n      , 2 as table_order\n    from tuva.input_layer.eligibility\n\n    union all\n\n    select \n        'raw_data' as source\n      , 'eligibility' as table_name\n      , null as row_count\n      , null as unique_check\n      , 'Unique Patient Count' as unique_check_desc\n      , 1 as table_order\n    from tuva.input_layer.eligibility\n\n    union all\n\n    select \n        'input_layer' as source\n      , 'medical_claim' as table_name\n      , count(*) as row_count\n      , count(distinct claim_id) as unique_check\n      , 'Unique Claim Count' as unique_check_desc\n      , 4 as table_order\n    from tuva.input_layer.medical_claim\n\n    union all\n\n    select \n        'raw_data' as source\n      , 'medical_claim' as table_name\n      , null as row_count\n      , null as unique_check\n      , 'Unique Claim Count' as unique_check_desc\n      , 3 as table_order\n    from tuva.input_layer.medical_claim\n\n    union all\n\n    select \n        'input_layer' as source\n      , 'pharmacy_claim' as table_name\n      , count(*) as row_count\n      , count(distinct claim_id) as unique_check\n      , 'Unique Claim Count' as unique_check_desc\n      , 6 as table_order\n    from tuva.input_layer.pharmacy_claim\n\n    union all\n\n    select \n        'raw_data' as source\n      , 'pharmacy_claim' as table_name\n      , null as row_count\n      , null as unique_check\n      , 'Unique Claim Count' as unique_check_desc\n      , 5 as table_order\n    from tuva.input_layer.pharmacy_claim\n)\n\nselect\n    cte.*\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom cte", "relation_name": "dev_tom.data_quality.raw_summary"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.265438Z", "completed_at": "2024-08-23T19:21:33.286587Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.287158Z", "completed_at": "2024-08-23T19:21:33.287161Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.023968935012817383, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__data_quality_clinical_detail", "compiled": true, "compiled_code": "\n\nWITH CTE as (\nSELECT * FROM dev_tom.data_quality.condition_claim_id\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.condition_condition_id\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.condition_condition_rank\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.condition_condition_type\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.condition_data_source\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.condition_encounter_id\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.condition_normalized_code_type\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.condition_normalized_code\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.condition_normalized_description\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.condition_onset_date\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.condition_patient_id\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.condition_present_on_admit_code\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.condition_present_on_admit_description\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.condition_recorded_date\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.condition_resolved_date\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.condition_source_code\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.condition_source_code_type\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.condition_source_description\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.condition_status\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.encounter_admit_source_code\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.encounter_admit_source_description\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.encounter_admit_type_code\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.encounter_admit_type_description\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.encounter_allowed_amount\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.encounter_apr_drg_code\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.encounter_apr_drg_description\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.encounter_attending_provider_id\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.encounter_charge_amount\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.encounter_data_source\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.encounter_discharge_disposition_code\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.encounter_discharge_disposition_description\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.encounter_encounter_end_date\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.encounter_encounter_id\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.encounter_encounter_start_date\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.encounter_encounter_type\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.encounter_facility_id\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.encounter_length_of_stay\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.encounter_ms_drg_code\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.encounter_ms_drg_description\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.encounter_paid_amount\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.encounter_patient_id\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.encounter_primary_diagnosis_code\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.encounter_primary_diagnosis_code_type\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.encounter_primary_diagnosis_description\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.practitioner_practice_affiliation\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.practitioner_sub_specialty\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.practitioner_last_name\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.practitioner_practitioner_id\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.practitioner_data_source\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.practitioner_npi\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.practitioner_first_name\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.practitioner_specialty\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.location_parent_organization\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.location_latitude\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.location_facility_type\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.location_zip_code\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.location_data_source\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.location_city\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.location_npi\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.location_location_id\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.location_longitude\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.location_address\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.location_state\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.location_name\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.procedure_normalized_code_type\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.procedure_normalized_description\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.procedure_procedure_id\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.procedure_claim_id\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.procedure_source_code\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.procedure_source_code_type\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.procedure_source_description\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.procedure_practitioner_id\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.procedure_data_source\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.procedure_patient_id\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.procedure_procedure_date\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.procedure_encounter_id\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.procedure_modifier_5\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.procedure_modifier_4\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.procedure_normalized_code\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.procedure_modifier_1\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.procedure_modifier_3\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.procedure_modifier_2\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.lab_result_source_abnormal_flag\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.lab_result_specimen\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.lab_result_source_reference_range_low\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.lab_result_source_units\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.lab_result_lab_result_id\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.lab_result_collection_date\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.lab_result_normalized_component\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.lab_result_ordering_practitioner_id\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.lab_result_result\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.lab_result_source_code_type\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.lab_result_normalized_description\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.lab_result_normalized_reference_range_low\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.lab_result_normalized_reference_range_high\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.lab_result_normalized_code\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.lab_result_source_description\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.lab_result_status\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.lab_result_accession_number\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.lab_result_result_date\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.lab_result_normalized_abnormal_flag\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.lab_result_data_source\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.lab_result_normalized_units\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.lab_result_normalized_code_type\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.lab_result_source_reference_range_high\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.lab_result_source_code\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.lab_result_patient_id\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.lab_result_source_component\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.lab_result_encounter_id\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.patient_sex\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.patient_state\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.patient_city\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.patient_longitude\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.patient_county\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.patient_race\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.patient_death_flag\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.patient_address\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.patient_data_source\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.patient_zip_code\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.patient_first_name\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.patient_last_name\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.patient_latitude\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.patient_birth_date\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.patient_death_date\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.patient_patient_id\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.medication_rxnorm_code\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.medication_source_code\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.medication_atc_code\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.medication_dispensing_date\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.medication_prescribing_date\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.medication_days_supply\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.medication_strength\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.medication_patient_id\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.medication_rxnorm_description\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.medication_encounter_id\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.medication_data_source\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.medication_atc_description\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.medication_quantity_unit\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.medication_source_description\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.medication_ndc_code\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.medication_medication_id\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.medication_source_code_type\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.medication_ndc_description\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.medication_quantity\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.medication_practitioner_id\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.medication_route\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.observation_source_code\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.observation_normalized_reference_range_high\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.observation_source_units\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.observation_observation_type\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.observation_normalized_code\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.observation_normalized_description\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.observation_data_source\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.observation_panel_id\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.observation_observation_id\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.observation_source_reference_range_low\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.observation_result\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.observation_source_code_type\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.observation_normalized_reference_range_low\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.observation_observation_date\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.observation_encounter_id\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.observation_source_description\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.observation_source_reference_range_high\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.observation_normalized_units\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.observation_normalized_code_type\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.observation_patient_id\n\n)\n\nSELECT\n    data_source,\n    cast(source_date as TEXT) as source_date,\n    table_name,\n    drill_down_key,\n    drill_down_value,\n    field_name,\n    bucket_name,\n    invalid_reason,\n    field_value,\n    tuva_last_run,\n    dense_rank() over (order by data_source, table_name, field_name) + 100000 as summary_sk\nFROM CTE", "relation_name": "dev_tom.data_quality.data_quality_clinical_detail"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.293549Z", "completed_at": "2024-08-23T19:21:33.300759Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.301506Z", "completed_at": "2024-08-23T19:21:33.301509Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.008975744247436523, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.the_tuva_project.unique_core__lab_result_lab_result_id.0ee4fe47af", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    lab_result_id as unique_field,\n    count(*) as n_records\n\nfrom dev_tom.core.lab_result\nwhere lab_result_id is not null\ngroup by lab_result_id\nhaving count(*) > 1\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.307993Z", "completed_at": "2024-08-23T19:21:33.314051Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.314466Z", "completed_at": "2024-08-23T19:21:33.314469Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.007486104965209961, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.the_tuva_project.unique_core__medication_medication_id.124fd11fa1", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    medication_id as unique_field,\n    count(*) as n_records\n\nfrom dev_tom.core.medication\nwhere medication_id is not null\ngroup by medication_id\nhaving count(*) > 1\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.321247Z", "completed_at": "2024-08-23T19:21:33.331207Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.332259Z", "completed_at": "2024-08-23T19:21:33.332263Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.012202978134155273, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.the_tuva_project.unique_core__observation_observation_id.ff5f21de59", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    observation_id as unique_field,\n    count(*) as n_records\n\nfrom dev_tom.core.observation\nwhere observation_id is not null\ngroup by observation_id\nhaving count(*) > 1\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.323003Z", "completed_at": "2024-08-23T19:21:33.332536Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.332984Z", "completed_at": "2024-08-23T19:21:33.332987Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.012513160705566406, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__unique_value_examples", "compiled": true, "compiled_code": "\n\nSELECT * FROM dev_tom.data_quality.primary_keys_condition_condition_id\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.primary_keys_encounter_encounter_id\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.primary_keys_lab_result_lab_result_id\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.primary_keys_location_location_id\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.primary_keys_medication_medication_id\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.primary_keys_observation_observation_id\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.primary_keys_patient_patient_id\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.primary_keys_practitioner_practitioner_id\n\nunion all\n\nSELECT * FROM dev_tom.data_quality.primary_keys_procedure_procedure_id", "relation_name": "dev_tom.data_quality.unique_value_examples"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.325159Z", "completed_at": "2024-08-23T19:21:33.333244Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.333785Z", "completed_at": "2024-08-23T19:21:33.333788Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.01099395751953125, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.normalized_input__int_eligibility_dates_normalize", "compiled": true, "compiled_code": "\n\n\nwith __dbt__cte__normalized_input__stg_eligibility as (\n\n\n\nselect\n      patient_id\n    , patient_id || coalesce(data_source,'') || coalesce(payer,'') || coalesce(plan,'') || coalesce(cast(enrollment_start_date as TEXT),'') || coalesce(cast(enrollment_end_date as TEXT),'') as patient_id_key\n    , member_id\n    , subscriber_id\n    , gender\n    , race\n    , birth_date\n    , death_date\n    , death_flag\n    , enrollment_start_date\n    , enrollment_end_date\n    , payer\n    , payer_type\n    , plan\n    , subscriber_relation\n    , original_reason_entitlement_code\n    , dual_status_code\n    , medicare_status_code\n    , first_name\n    , last_name\n    , social_security_number\n    , address\n    , city\n    , state\n    , zip_code\n    , phone\n    , data_source\n    , file_name\n    , ingest_datetime\nfrom tuva.input_layer.eligibility\n) select distinct\n    elig.patient_id\n  , elig.patient_id || coalesce(elig.data_source,'') || coalesce(elig.payer,'') || coalesce(elig.plan,'') || coalesce(cast(elig.enrollment_start_date as TEXT),'') || coalesce(cast(elig.enrollment_end_date as TEXT),'') as patient_id_key\n  , cal_dob.full_date as normalized_birth_date\n  , cal_death.full_date as normalized_death_date\n  , cal_enroll_start.full_date as normalized_enrollment_start_date\n  , cal_enroll_end.full_date as normalized_enrollment_end_date\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom __dbt__cte__normalized_input__stg_eligibility elig\nleft join dev_tom.reference_data.calendar cal_dob\n    on elig.birth_date = cal_dob.full_date\nleft join dev_tom.reference_data.calendar cal_death\n    on elig.death_date = cal_death.full_date\nleft join dev_tom.reference_data.calendar cal_enroll_start\n    on elig.enrollment_start_date = cal_enroll_start.full_date\nleft join dev_tom.reference_data.calendar cal_enroll_end\n    on elig.enrollment_end_date = cal_enroll_end.full_date", "relation_name": "dev_tom.claims_preprocessing._int_normalized_input_eligibility_dates_normalize"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.334607Z", "completed_at": "2024-08-23T19:21:33.356812Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.366763Z", "completed_at": "2024-08-23T19:21:33.366768Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.03339791297912598, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__institutional_admission_date", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__data_quality__stg_institutional_inpatient as (\n\n\n\n    SELECT *\n    FROM tuva.input_layer.medical_claim\n    WHERE claim_type = 'institutional'\n    AND \n  substr(bill_type_code, 1, 2)\n = '11'\n), base as (\nselect *\nfrom __dbt__cte__data_quality__stg_institutional_inpatient\n)\n, tuva_last_run as(\n\n    select cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) as tuva_last_run\n\n)\n,unique_field as (\n    select distinct claim_id\n        ,cast(admission_date as TEXT) as field\n        ,data_source\n    from base\n),\nclaim_grain as (\n    select claim_id\n        ,data_source\n        ,count(*) as frequency\n    from unique_field\n    group by claim_id\n        ,data_source\n),\nclaim_agg as (\nselect\n    claim_id,\n    data_source,\n    \n    listagg(\n        coalesce(field, 'null'),\n        ', '\n        )\n        within group (order by field desc) as field_aggregated\nfrom\n    unique_field\ngroup by\n    claim_id,\n    data_source\n)\nselect distinct -- to bring to claim_id grain\n    m.data_source\n    ,coalesce(cast(m.claim_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    ,'MEDICAL_CLAIM' AS table_name\n    ,'Claim ID' AS drill_down_key\n    ,coalesce(m.claim_id, 'NULL') AS drill_down_value\n    ,'institutional' AS claim_type\n    ,'ADMISSION_DATE' AS field_name\n    ,case\n        when cg.frequency > 1 then 'multiple'\n        when m.admission_date > cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) then 'invalid'\n        when m.admission_date < \n\n    dateadd(\n        year,\n        -10,\n        cte.tuva_last_run\n        )\n\n then 'invalid'\n        when m.admission_date is null then 'null'\n        else 'valid'\n    end as bucket_name\n    ,case\n        when cg.frequency > 1 then 'multiple'\n        when m.admission_date > cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) then 'future'\n        when m.admission_date < \n\n    dateadd(\n        year,\n        -10,\n        cte.tuva_last_run\n        )\n\n then 'too old'\n        else null\n    end as invalid_reason\n    ,cast(substring(agg.field_aggregated, 1, 255) as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom base m\nleft join claim_grain cg on m.claim_id = cg.claim_id and m.data_source = cg.data_source\nleft join claim_agg agg on m.claim_id = agg.claim_id and m.data_source = agg.data_source\ncross join tuva_last_run cte", "relation_name": "dev_tom.data_quality.institutional_admission_date"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.346591Z", "completed_at": "2024-08-23T19:21:33.367059Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.367515Z", "completed_at": "2024-08-23T19:21:33.367518Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0333409309387207, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__institutional_admit_source_code", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__data_quality__stg_institutional_inpatient as (\n\n\n\n    SELECT *\n    FROM tuva.input_layer.medical_claim\n    WHERE claim_type = 'institutional'\n    AND \n  substr(bill_type_code, 1, 2)\n = '11'\n), base as (\nselect *\nfrom __dbt__cte__data_quality__stg_institutional_inpatient\n),\n\nunique_field as (\n    select distinct claim_id\n        , base.admit_source_code || '|' || coalesce(term.admit_source_description, '') as field\n        , data_source\n    from base\n    left join dev_tom.terminology.admit_source as term on base.admit_source_code = term.admit_source_code\n),\n\nclaim_grain as (\n    select claim_id\n        , data_source\n        , count(*) as frequency\n    from unique_field\n    group by claim_id\n        , data_source\n),\n\nclaim_agg as (\nselect\n      claim_id\n    , data_source\n    , \n    listagg(\n        coalesce(field, 'null'),\n        ', '\n        )\n        within group (order by field desc) as field_aggregated\nfrom\n    unique_field\ngroup by\n      claim_id\n    , data_source\n)\n\nselect distinct -- to bring to claim_id grain\n      m.data_source\n    , coalesce(cast(m.claim_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    , 'MEDICAL_CLAIM' AS table_name\n    , 'Claim ID' AS drill_down_key\n    , coalesce(m.claim_id, 'NULL') AS drill_down_value\n    , 'institutional' AS claim_type\n    , 'ADMIT_SOURCE_CODE' AS field_name\n    , case when cg.frequency > 1                then 'multiple'\n          when term.admit_source_code is not null then 'valid'\n          when m.admit_source_code is not null    then 'invalid'\n                                               else 'null' end as bucket_name\n    , case\n        when m.admit_source_code is not null\n            and term.admit_source_code is null\n            and cg. frequency = 1\n            then 'Admit source code does not join to Terminology Admit Source table'\n        else null\n    end as invalid_reason\n    , cast(\n  substr(agg.field_aggregated, 1, 255)\n as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom base m\nleft join claim_grain cg on m.claim_id = cg.claim_id and m.data_source = cg.data_source\nleft join dev_tom.terminology.admit_source as term on m.admit_source_code = term.admit_source_code\nleft join claim_agg agg on m.claim_id = agg.claim_id and m.data_source = agg.data_source", "relation_name": "dev_tom.data_quality.institutional_admit_source_code"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.357059Z", "completed_at": "2024-08-23T19:21:33.367802Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.368358Z", "completed_at": "2024-08-23T19:21:33.368361Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.022017955780029297, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__institutional_admit_type_code", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__data_quality__stg_institutional_inpatient as (\n\n\n\n    SELECT *\n    FROM tuva.input_layer.medical_claim\n    WHERE claim_type = 'institutional'\n    AND \n  substr(bill_type_code, 1, 2)\n = '11'\n), base as (\nselect *\nfrom __dbt__cte__data_quality__stg_institutional_inpatient\n),\n\nunique_field as (\n    select distinct claim_id\n        , base.admit_type_code || '|' || coalesce(term.admit_type_description, '') as field\n        , data_source\n    from base\n    left join dev_tom.terminology.admit_type as term on base.admit_type_code = term.admit_type_code\n),\n\nclaim_grain as (\n    select claim_id\n        , data_source\n        , count(*) as frequency\n    from unique_field\n    group by claim_id\n        , data_source\n),\n\nclaim_agg as (\nselect\n      claim_id\n    , data_source\n    , \n    listagg(\n        coalesce(field, 'null'),\n        ', '\n        )\n        within group (order by field desc) as field_aggregated\nfrom\n    unique_field\ngroup by\n      claim_id\n    , data_source\n\t)\n\nselect distinct -- to bring to claim_id grain\n      m.data_source\n    , coalesce(cast(m.claim_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    , 'MEDICAL_CLAIM' AS table_name\n    , 'Member ID' AS drill_down_key\n    , coalesce(m.claim_id, 'NULL') AS drill_down_value\n    , 'institutional' AS claim_type\n    , 'ADMIT_TYPE_CODE' AS field_name\n    , case when cg.frequency > 1                then 'multiple'\n          when term.admit_type_code is not null then 'valid'\n          when m.admit_type_code is not null    then 'invalid'\n                                               else 'null' end as bucket_name\n    , case\n        when m.admit_type_code is not null\n            and term.admit_type_code is null\n            and cg.frequency = 1\n            then 'Admit Type Code does not join to Terminology Admit Type table'\n        else null\n    end as invalid_reason\n    , cast(\n  substr(agg.field_aggregated, 1, 255)\n as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom base m\nleft join claim_grain cg on m.claim_id = cg.claim_id and m.data_source = cg.data_source\nleft join dev_tom.terminology.admit_type as term on m.admit_type_code = term.admit_type_code\nleft join claim_agg agg on m.claim_id = agg.claim_id and m.data_source = agg.data_source", "relation_name": "dev_tom.data_quality.institutional_admit_type_code"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.369174Z", "completed_at": "2024-08-23T19:21:33.391971Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.401903Z", "completed_at": "2024-08-23T19:21:33.401907Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.03397560119628906, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__institutional_apr_drg_code", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__data_quality__stg_institutional_inpatient as (\n\n\n\n    SELECT *\n    FROM tuva.input_layer.medical_claim\n    WHERE claim_type = 'institutional'\n    AND \n  substr(bill_type_code, 1, 2)\n = '11'\n), base as (\nselect *\nfrom __dbt__cte__data_quality__stg_institutional_inpatient\n),\n\nunique_field as (\n    select distinct claim_id\n        , base.apr_drg_code || '|' || coalesce(term.apr_drg_description, '') as field\n        , data_source\n    from base\n    left join dev_tom.terminology.apr_drg as term on base.apr_drg_code = term.apr_drg_code\n),\n\nclaim_grain as (\n    select claim_id\n        , data_source\n        , count(*) as frequency\n    from unique_field\n    group by claim_id\n        , data_source\n),\n\nclaim_agg as (\nselect\n      claim_id\n    , data_source\n    , \n    listagg(\n        coalesce(field, 'null'),\n        ', '\n        )\n        within group (order by field desc) as field_aggregated\nfrom\n    unique_field\ngroup by\n      claim_id\n    , data_source\n\t)\n\nselect distinct -- to bring to claim_id grain\n      m.data_source\n    , coalesce(cast(m.claim_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    , 'MEDICAL_CLAIM' AS table_name\n    , 'Claim ID' AS drill_down_key\n    , coalesce(m.claim_id, 'NULL') AS drill_down_value\n    , 'institutional' AS claim_type\n    , 'APR_DRG_CODE' AS field_name\n    , case when cg.frequency > 1                then 'multiple'\n          when term.apr_drg_code is not null then 'valid'\n          when m.apr_drg_code is not null    then 'invalid'\n                                               else 'null' end as bucket_name\n    , case\n        when cg.frequency = 1\n            and m.apr_drg_code is not null\n            and term.apr_drg_code is null\n            then 'APR DRG Code does not join to Terminology APR DRG table'\n        else null\n    end as invalid_reason\n    , cast(\n  substr(agg.field_aggregated, 1, 255)\n as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom base m\nleft join claim_grain cg on m.claim_id = cg.claim_id and m.data_source = cg.data_source\nleft join dev_tom.terminology.apr_drg as term on m.apr_drg_code = term.apr_drg_code\nleft join claim_agg agg on m.claim_id = agg.claim_id and m.data_source = agg.data_source", "relation_name": "dev_tom.data_quality.institutional_apr_drg_code"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.379757Z", "completed_at": "2024-08-23T19:21:33.401745Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.402571Z", "completed_at": "2024-08-23T19:21:33.402574Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.03380990028381348, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__institutional_discharge_date", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__data_quality__stg_institutional_inpatient as (\n\n\n\n    SELECT *\n    FROM tuva.input_layer.medical_claim\n    WHERE claim_type = 'institutional'\n    AND \n  substr(bill_type_code, 1, 2)\n = '11'\n), base as (\nselect *\nfrom __dbt__cte__data_quality__stg_institutional_inpatient\n)\n, tuva_last_run as(\n    select cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) as tuva_last_run\n)\n,unique_field as (\n    select distinct claim_id\n        ,cast(discharge_date as TEXT) as field\n        ,data_source\n    from base\n),\nclaim_grain as (\n    select claim_id\n        ,data_source\n        ,count(*) as frequency\n    from unique_field\n    group by claim_id\n        ,data_source\n),\nclaim_agg as (\nselect\n    claim_id,\n    data_source,\n    \n    listagg(\n        coalesce(field, 'null'),\n        ', '\n        )\n        within group (order by field desc) as field_aggregated\nfrom\n    unique_field\ngroup by\n    claim_id,\n    data_source\n)\nselect distinct -- to bring to claim_id grain\n    m.data_source\n    ,coalesce(cast(m.claim_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    ,'MEDICAL_CLAIM' AS table_name\n    ,'Claim ID' AS drill_down_key\n    ,coalesce(m.claim_id, 'NULL') AS drill_down_value\n    ,'institutional' AS claim_type\n    ,'DISCHARGE_DATE' AS field_name\n    ,case\n        when cg.frequency > 1 then 'multiple'\n        when m.discharge_date > cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) then 'invalid'\n        when m.discharge_date < \n\n    dateadd(\n        year,\n        -10,\n        cte.tuva_last_run\n        )\n\n then 'invalid'\n        when m.discharge_date < m.admission_date then 'invalid'\n        when m.discharge_date is null then 'null'\n        else 'valid'\n    end as bucket_name\n    ,case\n        when cg.frequency > 1 then 'multiple'\n        when m.discharge_date > cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) then 'future'\n        when m.discharge_date < \n\n    dateadd(\n        year,\n        -10,\n        cte.tuva_last_run\n        )\n\n then 'too old'\n        when m.discharge_date < m.admission_date then 'discharge date before admission date'\n        else null\n    end as invalid_reason\n    ,cast(\n  substr(agg.field_aggregated, 1, 255)\n as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom base m\nleft join claim_grain cg on m.claim_id = cg.claim_id and m.data_source = cg.data_source\nleft join claim_agg agg on m.claim_id = agg.claim_id and m.data_source = agg.data_source\ncross join tuva_last_run cte", "relation_name": "dev_tom.data_quality.institutional_discharge_date"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.392194Z", "completed_at": "2024-08-23T19:21:33.403848Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.404633Z", "completed_at": "2024-08-23T19:21:33.404636Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.025113821029663086, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__institutional_ms_drg_code", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__data_quality__stg_institutional_inpatient as (\n\n\n\n    SELECT *\n    FROM tuva.input_layer.medical_claim\n    WHERE claim_type = 'institutional'\n    AND \n  substr(bill_type_code, 1, 2)\n = '11'\n), base as (\nselect *\nfrom __dbt__cte__data_quality__stg_institutional_inpatient\n),\n\nunique_field as (\n    select distinct claim_id\n        , base.ms_drg_code || '|' || coalesce(term.ms_drg_description, '') as field\n        , data_source\n    from base\n    left join dev_tom.terminology.ms_drg as term on base.ms_drg_code = term.ms_drg_code\n),\n\nclaim_grain as (\n    select claim_id\n        , data_source\n        , count(*) as frequency\n    from unique_field\n    group by claim_id\n        , data_source\n),\n\nclaim_agg as (\nselect\n      claim_id\n    , data_source\n    , \n    listagg(\n        coalesce(field, 'null'),\n        ', '\n        )\n        within group (order by field desc) as field_aggregated\nfrom\n    unique_field\ngroup by\n      claim_id\n    , data_source\n\n)\n\nselect distinct -- to bring to claim_id grain\n      m.data_source\n    , coalesce(cast(m.claim_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    , 'MEDICAL_CLAIM' AS table_name\n    , 'Claim ID' AS drill_down_key\n    , coalesce(m.claim_id, 'NULL') AS drill_down_value\n    , 'institutional' AS claim_type\n    , 'MS_DRG_CODE' AS field_name\n    , case when cg.frequency > 1                then 'multiple'\n          when term.ms_drg_code is not null then 'valid'\n          when m.ms_drg_code is not null    then 'invalid'\n                                               else 'null' end as bucket_name\n    , case\n        when cg.frequency = 1\n            and m.ms_drg_code is not null\n            and term.ms_drg_code is null\n            then 'MS DRG does not join to Terminology MS DRG table'\n        else null\n    end as invalid_reason\n    , cast(\n  substr(agg.field_aggregated, 1, 255)\n as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom base m\nleft join claim_grain cg on m.claim_id = cg.claim_id and m.data_source = cg.data_source\nleft join dev_tom.terminology.ms_drg as term on m.ms_drg_code = term.ms_drg_code\nleft join claim_agg agg on m.claim_id = agg.claim_id and m.data_source = agg.data_source", "relation_name": "dev_tom.data_quality.institutional_ms_drg_code"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.405974Z", "completed_at": "2024-08-23T19:21:33.433176Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.437074Z", "completed_at": "2024-08-23T19:21:33.437079Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.03288102149963379, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__institutional_procedure_code_1", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__data_quality__stg_institutional_inpatient as (\n\n\n\n    SELECT *\n    FROM tuva.input_layer.medical_claim\n    WHERE claim_type = 'institutional'\n    AND \n  substr(bill_type_code, 1, 2)\n = '11'\n), base as (\nselect *\nfrom __dbt__cte__data_quality__stg_institutional_inpatient\n),\n\nunique_field as (\n    select distinct claim_id\n        , procedure_code_1 || '|' || coalesce(term.description, '') as field\n        , data_source\n    from base\n    left join dev_tom.terminology.icd_10_pcs as term on base.procedure_code_1 = term.icd_10_pcs\n),\n\nclaim_grain as (\n    select claim_id\n        , data_source\n        , count(*) as frequency\n    from unique_field\n    group by claim_id\n        , data_source\n),\n\nclaim_agg as (\nselect\n      claim_id\n    , data_source\n    , \n    listagg(\n        coalesce(field, 'null'),\n        ', '\n        )\n        within group (order by field desc) as field_aggregated\nfrom\n    unique_field\ngroup by\n      claim_id\n    , data_source\n\t)\n\nselect distinct -- to bring to claim_id grain\n      m.data_source\n    , coalesce(cast(m.claim_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    , 'MEDICAL_CLAIM' AS table_name\n    , 'Claim ID' AS drill_down_key\n    , coalesce(m.claim_id, 'NULL') AS drill_down_value\n    , 'institutional' AS claim_type\n    , 'PROCEDURE_CODE_1' AS field_name\n    , case when cg.frequency > 1                then 'multiple'\n          when term.icd_10_pcs is not null      then 'valid'\n          when m.procedure_code_1 is not null  then 'invalid'\n                                               else 'null' end as bucket_name\n    , case\n        when cg.frequency = 1\n            and m.procedure_code_1 is not null\n            and term.icd_10_pcs is null\n            then 'procedure code does not join to terminology procedure code table'\n        else null\n    end as invalid_reason\n    , cast(\n  substr(agg.field_aggregated, 1, 255)\n as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom base m\nleft join claim_grain cg on m.claim_id = cg.claim_id and m.data_source = cg.data_source\nleft join dev_tom.terminology.icd_10_pcs as term on m.procedure_code_1 = term.icd_10_pcs\nleft join claim_agg agg on m.claim_id = agg.claim_id and m.data_source = agg.data_source", "relation_name": "dev_tom.data_quality.institutional_procedure_code_1"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.417182Z", "completed_at": "2024-08-23T19:21:33.437344Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.437806Z", "completed_at": "2024-08-23T19:21:33.437810Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.03293919563293457, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__institutional_procedure_code_2", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__data_quality__stg_institutional_inpatient as (\n\n\n\n    SELECT *\n    FROM tuva.input_layer.medical_claim\n    WHERE claim_type = 'institutional'\n    AND \n  substr(bill_type_code, 1, 2)\n = '11'\n), base as (\nselect *\nfrom __dbt__cte__data_quality__stg_institutional_inpatient\n),\n\nunique_field as (\n    select distinct claim_id\n        , procedure_code_2 || '|' || coalesce(term.description, '') as field\n        , data_source\n    from base\n    left join dev_tom.terminology.icd_10_pcs as term on base.procedure_code_1 = term.icd_10_pcs\n),\n\nclaim_grain as (\n    select claim_id\n        , data_source\n        , count(*) as frequency\n    from unique_field\n    group by claim_id\n        , data_source\n),\n\nclaim_agg as (\nselect\n      claim_id\n    , data_source\n    , \n    listagg(\n        coalesce(field, 'null'),\n        ', '\n        )\n        within group (order by field desc) as field_aggregated\nfrom\n    unique_field\ngroup by\n      claim_id\n    , data_source\n\t)\n\nselect distinct -- to bring to claim_id grain\n      m.data_source\n    , coalesce(cast(m.claim_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    , 'MEDICAL_CLAIM' AS table_name\n    , 'Claim ID' AS drill_down_key\n    , coalesce(m.claim_id, 'NULL') AS drill_down_value\n    , 'institutional' AS claim_type\n    , 'PROCEDURE_CODE_2' AS field_name\n    , case when cg.frequency > 1                then 'multiple'\n          when term.icd_10_pcs is not null      then 'valid'\n          when m.procedure_code_2 is not null  then 'invalid'\n                                               else 'null' end as bucket_name\n    , case\n        when cg.frequency = 1\n            and m.procedure_code_2 is not null\n            and term.icd_10_pcs is null\n            then 'Procedure Code does not join to Terminology Procedure Code Table'\n        else null\n    end as invalid_reason\n    , cast(\n  substr(agg.field_aggregated, 1, 255)\n as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom base m\nleft join claim_grain cg on m.claim_id = cg.claim_id and m.data_source = cg.data_source\nleft join dev_tom.terminology.icd_10_pcs as term on m.procedure_code_2 = term.icd_10_pcs\nleft join claim_agg agg on m.claim_id = agg.claim_id and m.data_source = agg.data_source", "relation_name": "dev_tom.data_quality.institutional_procedure_code_2"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.427241Z", "completed_at": "2024-08-23T19:21:33.438252Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.438786Z", "completed_at": "2024-08-23T19:21:33.438789Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.02184319496154785, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__institutional_procedure_code_3", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__data_quality__stg_institutional_inpatient as (\n\n\n\n    SELECT *\n    FROM tuva.input_layer.medical_claim\n    WHERE claim_type = 'institutional'\n    AND \n  substr(bill_type_code, 1, 2)\n = '11'\n), base as (\nselect *\nfrom __dbt__cte__data_quality__stg_institutional_inpatient\n),\n\nunique_field as (\n    select distinct claim_id\n        , procedure_code_3 || '|' || coalesce(term.description, '') as field\n        , data_source\n    from base\n    left join dev_tom.terminology.icd_10_pcs as term on base.procedure_code_3 = term.icd_10_pcs\n),\n\nclaim_grain as (\n    select claim_id\n        , data_source\n        , count(*) as frequency\n    from unique_field\n    group by claim_id\n        , data_source\n),\n\nclaim_agg as (\nselect\n      claim_id\n    , data_source\n    , \n    listagg(\n        coalesce(field, 'null'),\n        ', '\n        )\n        within group (order by field desc) as field_aggregated\nfrom\n    unique_field\ngroup by\n      claim_id\n    , data_source\n)\n\nselect distinct -- to bring to claim_id grain\n      m.data_source\n    , coalesce(cast(m.claim_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    , 'MEDICAL_CLAIM' AS table_name\n    , 'Claim ID' AS drill_down_key\n    , coalesce(m.claim_id, 'NULL') AS drill_down_value\n    , 'institutional' AS claim_type\n    , 'PROCEDURE_CODE_3' AS field_name\n    , case when cg.frequency > 1                then 'multiple'\n          when term.icd_10_pcs is not null      then 'valid'\n          when m.procedure_code_3 is not null  then 'invalid'\n                                               else 'null' end as bucket_name\n    , case\n        when cg.frequency = 1\n            and m.procedure_code_3 is not null\n            and term.icd_10_pcs is null\n            then 'Procedure Code does not join to Terminology Procedure Code Table'\n        else null\n    end as invalid_reason\n    , cast(\n  substr(agg.field_aggregated, 1, 255)\n as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom base m\nleft join claim_grain cg on m.claim_id = cg.claim_id and m.data_source = cg.data_source\nleft join dev_tom.terminology.icd_10_pcs as term on m.procedure_code_3 = term.icd_10_pcs\nleft join claim_agg agg on m.claim_id = agg.claim_id and m.data_source = agg.data_source", "relation_name": "dev_tom.data_quality.institutional_procedure_code_3"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.439214Z", "completed_at": "2024-08-23T19:21:33.465142Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.466665Z", "completed_at": "2024-08-23T19:21:33.466669Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.02862691879272461, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__institutional_procedure_date_1", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__data_quality__stg_institutional_inpatient as (\n\n\n\n    SELECT *\n    FROM tuva.input_layer.medical_claim\n    WHERE claim_type = 'institutional'\n    AND \n  substr(bill_type_code, 1, 2)\n = '11'\n), base as (\nselect *\nfrom __dbt__cte__data_quality__stg_institutional_inpatient\n)\n, tuva_last_run as(\n    select cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) as tuva_last_run\n)\n, unique_field as (\n    select distinct claim_id\n        ,cast(procedure_date_1 as TEXT)  as field\n        ,data_source\n    from base\n\n),\nclaim_grain as (\n    select claim_id\n        ,data_source\n        ,count(*) as frequency\n    from unique_field\n    group by claim_id\n        ,data_source\n),\nclaim_agg as (\nselect\n    claim_id,\n    data_source,\n    \n    listagg(\n        coalesce(field, 'null'),\n        ', '\n        )\n        within group (order by field desc) as field_aggregated\nfrom\n    unique_field\ngroup by\n    claim_id,\n    data_source\n\t)\nselect distinct -- to bring to claim_id grain\n    m.data_source\n    ,coalesce(cast(m.claim_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    ,'MEDICAL_CLAIM' AS table_name\n    ,'Claim ID' AS drill_down_key\n    ,coalesce(m.claim_id, 'NULL') AS drill_down_value\n    ,'institutional' AS claim_type\n    ,'PROCEDURE_DATE_1' AS field_name\n    ,case\n        when cg.frequency > 1 then 'multiple'\n        when m.procedure_date_1 > cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) then 'invalid'\n        when m.procedure_date_1 < \n\n    dateadd(\n        year,\n        -10,\n        cte.tuva_last_run\n        )\n\n then 'invalid'\n        when not (m.procedure_date_1 between m.claim_start_date and m.claim_end_date) then 'invalid'\n        when m.procedure_date_1 is null then 'null'\n        else 'valid'\n    end as bucket_name\n    ,case\n        when cg.frequency > 1 then 'multiple'\n        when m.procedure_date_1 > cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) then 'future'\n        when m.procedure_date_1 < \n\n    dateadd(\n        year,\n        -10,\n        cte.tuva_last_run\n        )\n\n then 'too old'\n        when not (m.procedure_date_1 between m.claim_start_date and m.claim_end_date) then 'procedure date not between claim start and end dates'\n        else null\n        end as invalid_reason\n    ,cast(\n  substr(agg.field_aggregated, 1, 255)\n as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom base m\nleft join claim_grain cg on m.claim_id = cg.claim_id and m.data_source = cg.data_source\nleft join claim_agg agg on m.claim_id = agg.claim_id and m.data_source = agg.data_source\ncross join tuva_last_run cte", "relation_name": "dev_tom.data_quality.institutional_procedure_date_1"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.452618Z", "completed_at": "2024-08-23T19:21:33.479613Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.480063Z", "completed_at": "2024-08-23T19:21:33.480067Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.04105687141418457, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__institutional_procedure_date_2", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__data_quality__stg_institutional_inpatient as (\n\n\n\n    SELECT *\n    FROM tuva.input_layer.medical_claim\n    WHERE claim_type = 'institutional'\n    AND \n  substr(bill_type_code, 1, 2)\n = '11'\n), base as (\nselect *\nfrom __dbt__cte__data_quality__stg_institutional_inpatient\n)\n, tuva_last_run as(\n\n    select cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) as tuva_last_run\n\n)\n,unique_field as (\n    select distinct claim_id\n        ,cast(procedure_date_2 as TEXT)  as field\n        ,data_source\n    from base\n\n),\nclaim_grain as (\n    select claim_id\n        ,data_source\n        ,count(*) as frequency\n    from unique_field\n    group by claim_id\n        ,data_source\n),\nclaim_agg as (\nselect\n    claim_id,\n    data_source,\n    \n    listagg(\n        coalesce(field, 'null'),\n        ', '\n        )\n        within group (order by field desc) as field_aggregated\nfrom\n    unique_field\ngroup by\n    claim_id,\n    data_source\n\t)\nselect distinct -- to bring to claim_id grain\n    m.data_source\n    ,coalesce(cast(m.claim_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    ,'MEDICAL_CLAIM' AS table_name\n    ,'Claim ID' AS drill_down_key\n    ,coalesce(m.claim_id, 'NULL') AS drill_down_value\n    ,'institutional' AS claim_type\n    ,'PROCEDURE_DATE_2' AS field_name\n    ,case\n        when cg.frequency > 1 then 'multiple'\n        when m.procedure_date_2 > cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) then 'invalid'\n        when m.procedure_date_2 < \n\n    dateadd(\n        year,\n        -10,\n        cte.tuva_last_run\n        )\n\n then 'invalid'\n        when not (m.procedure_date_2 between m.claim_start_date and m.claim_end_date) then 'invalid'\n        when m.procedure_date_2 is null then 'null'\n        else 'valid'\n    end as bucket_name\n    ,case\n        when cg.frequency > 1 then 'multiple'\n        when m.procedure_date_2 > cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) then 'future'\n        when m.procedure_date_2 < \n\n    dateadd(\n        year,\n        -10,\n        cte.tuva_last_run\n        )\n\n then 'too old'\n        when not (m.procedure_date_2 between m.claim_start_date and m.claim_end_date) then 'procedure date not between claim start and end dates'\n        when m.procedure_date_2 is null then null\n        else 'valid'\n    end as invalid_reason\n    ,cast(\n  substr(agg.field_aggregated, 1, 255)\n as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom base m\nleft join claim_grain cg on m.claim_id = cg.claim_id and m.data_source = cg.data_source\nleft join claim_agg agg on m.claim_id = agg.claim_id and m.data_source = agg.data_source\ncross join tuva_last_run cte", "relation_name": "dev_tom.data_quality.institutional_procedure_date_2"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.466990Z", "completed_at": "2024-08-23T19:21:33.480317Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.480866Z", "completed_at": "2024-08-23T19:21:33.480869Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.028478145599365234, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__institutional_procedure_date_3", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__data_quality__stg_institutional_inpatient as (\n\n\n\n    SELECT *\n    FROM tuva.input_layer.medical_claim\n    WHERE claim_type = 'institutional'\n    AND \n  substr(bill_type_code, 1, 2)\n = '11'\n), base as (\nselect *\nfrom __dbt__cte__data_quality__stg_institutional_inpatient\n)\n, tuva_last_run as(\n\n    select cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) as tuva_last_run\n\n)\n\n,unique_field as (\n    select distinct claim_id\n        ,cast(procedure_date_3 as TEXT)  as field\n        ,data_source\n    from base\n\n),\nclaim_grain as (\n    select claim_id\n        ,data_source\n        ,count(*) as frequency\n    from unique_field\n    group by claim_id\n        ,data_source\n),\nclaim_agg as (\nselect\n    claim_id,\n    data_source,\n    \n    listagg(\n        coalesce(field, 'null'),\n        ', '\n        )\n        within group (order by field desc) as field_aggregated\nfrom\n    unique_field\ngroup by\n    claim_id,\n    data_source\n\t)\nselect distinct -- to bring to claim_id grain\n    m.data_source\n    ,coalesce(cast(m.claim_start_date as TEXT),cast('1900-01-01' as TEXT)) as source_date\n    ,'MEDICAL_CLAIM' AS table_name\n    ,'Claim ID' AS drill_down_key\n    ,coalesce(m.claim_id, 'NULL') AS drill_down_value\n    ,'institutional' AS claim_type\n    ,'PROCEDURE_DATE_3' AS field_name\n    ,case\n        when cg.frequency > 1 then 'multiple'\n        when m.procedure_date_3 > cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) then 'invalid'\n        when m.procedure_date_3 < \n\n    dateadd(\n        year,\n        -10,\n        cte.tuva_last_run\n        )\n\n then 'invalid'\n        when not (m.procedure_date_3 between m.claim_start_date and m.claim_end_date) then 'invalid'\n        when m.procedure_date_3 is null then 'null'\n        else 'valid'\n    end as bucket_name\n    ,case\n        when cg.frequency > 1 then 'multiple'\n        when m.procedure_date_3 > cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) then 'future'\n        when m.procedure_date_3 < \n\n    dateadd(\n        year,\n        -10,\n        cte.tuva_last_run\n        )\n\n then 'too old'\n        when not (m.procedure_date_3 between m.claim_start_date and m.claim_end_date) then 'procedure date not between claim start and end dates'\n        else null\n        end as invalid_reason\n    ,cast(\n  substr(agg.field_aggregated, 1, 255)\n as TEXT) as field_value\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom base m\nleft join claim_grain cg on m.claim_id = cg.claim_id and m.data_source = cg.data_source\nleft join claim_agg agg on m.claim_id = agg.claim_id and m.data_source = agg.data_source\ncross join tuva_last_run cte", "relation_name": "dev_tom.data_quality.institutional_procedure_date_3"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.481123Z", "completed_at": "2024-08-23T19:21:33.493642Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.495544Z", "completed_at": "2024-08-23T19:21:33.495547Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.01573491096496582, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.normalized_input__int_admit_source_voting", "compiled": true, "compiled_code": "\n\n\n\nwith  __dbt__cte__normalized_input__stg_medical_claim as (\n\n\nselect\n      claim_id\n    , claim_line_number\n    , claim_type\n    , patient_id\n    , member_id\n    , payer\n    , plan\n    , claim_start_date\n    , claim_end_date\n    , claim_line_start_date\n    , claim_line_end_date\n    , admission_date\n    , discharge_date\n    , admit_source_code\n    , admit_type_code\n    , discharge_disposition_code\n    , place_of_service_code\n    , bill_type_code\n    , ms_drg_code\n    , apr_drg_code\n    , revenue_center_code\n    , service_unit_quantity\n    , hcpcs_code\n    , hcpcs_modifier_1\n    , hcpcs_modifier_2\n    , hcpcs_modifier_3\n    , hcpcs_modifier_4\n    , hcpcs_modifier_5\n    , rendering_npi\n    , rendering_tin\n    , billing_npi\n    , billing_tin\n    , facility_npi\n    , paid_date\n    , paid_amount\n    , allowed_amount\n    , charge_amount\n    , coinsurance_amount\n    , copayment_amount\n    , deductible_amount\n    , total_cost_amount\n    , diagnosis_code_type\n    , diagnosis_code_1\n    , diagnosis_code_2\n    , diagnosis_code_3\n    , diagnosis_code_4\n    , diagnosis_code_5\n    , diagnosis_code_6\n    , diagnosis_code_7\n    , diagnosis_code_8\n    , diagnosis_code_9\n    , diagnosis_code_10\n    , diagnosis_code_11\n    , diagnosis_code_12\n    , diagnosis_code_13\n    , diagnosis_code_14\n    , diagnosis_code_15\n    , diagnosis_code_16\n    , diagnosis_code_17\n    , diagnosis_code_18\n    , diagnosis_code_19\n    , diagnosis_code_20\n    , diagnosis_code_21\n    , diagnosis_code_22\n    , diagnosis_code_23\n    , diagnosis_code_24\n    , diagnosis_code_25\n    , diagnosis_poa_1\n    , diagnosis_poa_2\n    , diagnosis_poa_3\n    , diagnosis_poa_4\n    , diagnosis_poa_5\n    , diagnosis_poa_6\n    , diagnosis_poa_7\n    , diagnosis_poa_8\n    , diagnosis_poa_9\n    , diagnosis_poa_10\n    , diagnosis_poa_11\n    , diagnosis_poa_12\n    , diagnosis_poa_13\n    , diagnosis_poa_14\n    , diagnosis_poa_15\n    , diagnosis_poa_16\n    , diagnosis_poa_17\n    , diagnosis_poa_18\n    , diagnosis_poa_19\n    , diagnosis_poa_20\n    , diagnosis_poa_21\n    , diagnosis_poa_22\n    , diagnosis_poa_23\n    , diagnosis_poa_24\n    , diagnosis_poa_25\n    , procedure_code_type\n    , procedure_code_1\n    , procedure_code_2\n    , procedure_code_3\n    , procedure_code_4\n    , procedure_code_5\n    , procedure_code_6\n    , procedure_code_7\n    , procedure_code_8\n    , procedure_code_9\n    , procedure_code_10\n    , procedure_code_11\n    , procedure_code_12\n    , procedure_code_13\n    , procedure_code_14\n    , procedure_code_15\n    , procedure_code_16\n    , procedure_code_17\n    , procedure_code_18\n    , procedure_code_19\n    , procedure_code_20\n    , procedure_code_21\n    , procedure_code_22\n    , procedure_code_23\n    , procedure_code_24\n    , procedure_code_25\n    , procedure_date_1\n    , procedure_date_2\n    , procedure_date_3\n    , procedure_date_4\n    , procedure_date_5\n    , procedure_date_6\n    , procedure_date_7\n    , procedure_date_8\n    , procedure_date_9\n    , procedure_date_10\n    , procedure_date_11\n    , procedure_date_12\n    , procedure_date_13\n    , procedure_date_14\n    , procedure_date_15\n    , procedure_date_16\n    , procedure_date_17\n    , procedure_date_18\n    , procedure_date_19\n    , procedure_date_20\n    , procedure_date_21\n    , procedure_date_22\n    , procedure_date_23\n    , procedure_date_24\n    , procedure_date_25\n    , in_network_flag\n    , data_source\nfrom tuva.input_layer.medical_claim\n), normalize_cte as(\n    select \n        med.claim_id\n        , med.data_source\n        , admit.admit_source_code\n\n        , admit.admit_source_description\n    from __dbt__cte__normalized_input__stg_medical_claim med\n    inner join dev_tom.terminology.admit_source admit\n        on med.admit_source_code = admit.admit_source_code\n    where claim_type = 'institutional'\n)\n, distinct_counts as(\n    select \n        claim_id\n        , data_source\n        , admit_source_code\n        , admit_source_description\n        , count(*) as admit_source_occurrence_count\n    from normalize_cte\n    where admit_source_code is not null\n    group by \n        claim_id\n        , data_source\n        , admit_source_code\n        , admit_source_description\n)\n\n, occurence_comparison as(\n    select\n        claim_id\n        , data_source\n        , 'admit_source_code' as column_name\n        , admit_source_code as normalized_code\n        , admit_source_description as normalized_description\n        , admit_source_occurrence_count as occurrence_count\n        , coalesce(lead(admit_source_occurrence_count) \n            over (partition by claim_id, data_source order by admit_source_occurrence_count desc),0) as next_occurrence_count\n        , row_number() over (partition by claim_id, data_source order by admit_source_occurrence_count desc) as occurrence_row_count\n    from distinct_counts dist\n)\n\nselect\n    claim_id\n    , data_source\n    , column_name\n    , normalized_code\n    , normalized_description\n    , occurrence_count\n    , next_occurrence_count\n    , occurrence_row_count\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom occurence_comparison", "relation_name": "dev_tom.claims_preprocessing._int_normalized_input_admit_source_voting"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.488542Z", "completed_at": "2024-08-23T19:21:33.503723Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.504124Z", "completed_at": "2024-08-23T19:21:33.504128Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.016455888748168945, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.normalized_input__int_admit_type_voting", "compiled": true, "compiled_code": "\n\n\nwith  __dbt__cte__normalized_input__stg_medical_claim as (\n\n\nselect\n      claim_id\n    , claim_line_number\n    , claim_type\n    , patient_id\n    , member_id\n    , payer\n    , plan\n    , claim_start_date\n    , claim_end_date\n    , claim_line_start_date\n    , claim_line_end_date\n    , admission_date\n    , discharge_date\n    , admit_source_code\n    , admit_type_code\n    , discharge_disposition_code\n    , place_of_service_code\n    , bill_type_code\n    , ms_drg_code\n    , apr_drg_code\n    , revenue_center_code\n    , service_unit_quantity\n    , hcpcs_code\n    , hcpcs_modifier_1\n    , hcpcs_modifier_2\n    , hcpcs_modifier_3\n    , hcpcs_modifier_4\n    , hcpcs_modifier_5\n    , rendering_npi\n    , rendering_tin\n    , billing_npi\n    , billing_tin\n    , facility_npi\n    , paid_date\n    , paid_amount\n    , allowed_amount\n    , charge_amount\n    , coinsurance_amount\n    , copayment_amount\n    , deductible_amount\n    , total_cost_amount\n    , diagnosis_code_type\n    , diagnosis_code_1\n    , diagnosis_code_2\n    , diagnosis_code_3\n    , diagnosis_code_4\n    , diagnosis_code_5\n    , diagnosis_code_6\n    , diagnosis_code_7\n    , diagnosis_code_8\n    , diagnosis_code_9\n    , diagnosis_code_10\n    , diagnosis_code_11\n    , diagnosis_code_12\n    , diagnosis_code_13\n    , diagnosis_code_14\n    , diagnosis_code_15\n    , diagnosis_code_16\n    , diagnosis_code_17\n    , diagnosis_code_18\n    , diagnosis_code_19\n    , diagnosis_code_20\n    , diagnosis_code_21\n    , diagnosis_code_22\n    , diagnosis_code_23\n    , diagnosis_code_24\n    , diagnosis_code_25\n    , diagnosis_poa_1\n    , diagnosis_poa_2\n    , diagnosis_poa_3\n    , diagnosis_poa_4\n    , diagnosis_poa_5\n    , diagnosis_poa_6\n    , diagnosis_poa_7\n    , diagnosis_poa_8\n    , diagnosis_poa_9\n    , diagnosis_poa_10\n    , diagnosis_poa_11\n    , diagnosis_poa_12\n    , diagnosis_poa_13\n    , diagnosis_poa_14\n    , diagnosis_poa_15\n    , diagnosis_poa_16\n    , diagnosis_poa_17\n    , diagnosis_poa_18\n    , diagnosis_poa_19\n    , diagnosis_poa_20\n    , diagnosis_poa_21\n    , diagnosis_poa_22\n    , diagnosis_poa_23\n    , diagnosis_poa_24\n    , diagnosis_poa_25\n    , procedure_code_type\n    , procedure_code_1\n    , procedure_code_2\n    , procedure_code_3\n    , procedure_code_4\n    , procedure_code_5\n    , procedure_code_6\n    , procedure_code_7\n    , procedure_code_8\n    , procedure_code_9\n    , procedure_code_10\n    , procedure_code_11\n    , procedure_code_12\n    , procedure_code_13\n    , procedure_code_14\n    , procedure_code_15\n    , procedure_code_16\n    , procedure_code_17\n    , procedure_code_18\n    , procedure_code_19\n    , procedure_code_20\n    , procedure_code_21\n    , procedure_code_22\n    , procedure_code_23\n    , procedure_code_24\n    , procedure_code_25\n    , procedure_date_1\n    , procedure_date_2\n    , procedure_date_3\n    , procedure_date_4\n    , procedure_date_5\n    , procedure_date_6\n    , procedure_date_7\n    , procedure_date_8\n    , procedure_date_9\n    , procedure_date_10\n    , procedure_date_11\n    , procedure_date_12\n    , procedure_date_13\n    , procedure_date_14\n    , procedure_date_15\n    , procedure_date_16\n    , procedure_date_17\n    , procedure_date_18\n    , procedure_date_19\n    , procedure_date_20\n    , procedure_date_21\n    , procedure_date_22\n    , procedure_date_23\n    , procedure_date_24\n    , procedure_date_25\n    , in_network_flag\n    , data_source\nfrom tuva.input_layer.medical_claim\n), normalize_cte as(\n    select \n        med.claim_id\n        , med.data_source\n        , admit.admit_type_code\n        , admit.admit_type_description\n    from __dbt__cte__normalized_input__stg_medical_claim med\n    inner join dev_tom.terminology.admit_type admit\n        on med.admit_type_code = admit.admit_type_code\n    where claim_type = 'institutional'\n)\n, distinct_counts as(\n    select \n        claim_id\n        , data_source\n        , admit_type_code\n        , admit_type_description\n        , count(*) as admit_type_occurrence_count\n    from normalize_cte\n\n    where admit_type_code is not null\n    group by \n        claim_id\n        , data_source\n        , admit_type_code\n        , admit_type_description\n)\n\n, occurence_comparison as(\n    select\n        claim_id\n        , data_source\n        , 'admit_type_code' as column_name\n        , admit_type_code as normalized_code\n        , admit_type_description as normalized_description\n        , admit_type_occurrence_count as occurrence_count\n        , coalesce(lead(admit_type_occurrence_count) \n            over (partition by claim_id, data_source order by admit_type_occurrence_count desc),0) as next_occurrence_count\n        , row_number() over (partition by claim_id, data_source order by admit_type_occurrence_count desc) as occurrence_row_count\n    from distinct_counts dist\n)\n\nselect\n    claim_id\n    , data_source\n    , column_name\n    , normalized_code\n    , normalized_description\n    , occurrence_count\n    , next_occurrence_count\n    , occurrence_row_count\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom occurence_comparison", "relation_name": "dev_tom.claims_preprocessing._int_normalized_input_admit_type_normalize_voting"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.495884Z", "completed_at": "2024-08-23T19:21:33.504402Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.504927Z", "completed_at": "2024-08-23T19:21:33.504931Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.016614913940429688, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.normalized_input__int_apr_drg_voting", "compiled": true, "compiled_code": "\n\n\nwith  __dbt__cte__normalized_input__stg_medical_claim as (\n\n\nselect\n      claim_id\n    , claim_line_number\n    , claim_type\n    , patient_id\n    , member_id\n    , payer\n    , plan\n    , claim_start_date\n    , claim_end_date\n    , claim_line_start_date\n    , claim_line_end_date\n    , admission_date\n    , discharge_date\n    , admit_source_code\n    , admit_type_code\n    , discharge_disposition_code\n    , place_of_service_code\n    , bill_type_code\n    , ms_drg_code\n    , apr_drg_code\n    , revenue_center_code\n    , service_unit_quantity\n    , hcpcs_code\n    , hcpcs_modifier_1\n    , hcpcs_modifier_2\n    , hcpcs_modifier_3\n    , hcpcs_modifier_4\n    , hcpcs_modifier_5\n    , rendering_npi\n    , rendering_tin\n    , billing_npi\n    , billing_tin\n    , facility_npi\n    , paid_date\n    , paid_amount\n    , allowed_amount\n    , charge_amount\n    , coinsurance_amount\n    , copayment_amount\n    , deductible_amount\n    , total_cost_amount\n    , diagnosis_code_type\n    , diagnosis_code_1\n    , diagnosis_code_2\n    , diagnosis_code_3\n    , diagnosis_code_4\n    , diagnosis_code_5\n    , diagnosis_code_6\n    , diagnosis_code_7\n    , diagnosis_code_8\n    , diagnosis_code_9\n    , diagnosis_code_10\n    , diagnosis_code_11\n    , diagnosis_code_12\n    , diagnosis_code_13\n    , diagnosis_code_14\n    , diagnosis_code_15\n    , diagnosis_code_16\n    , diagnosis_code_17\n    , diagnosis_code_18\n    , diagnosis_code_19\n    , diagnosis_code_20\n    , diagnosis_code_21\n    , diagnosis_code_22\n    , diagnosis_code_23\n    , diagnosis_code_24\n    , diagnosis_code_25\n    , diagnosis_poa_1\n    , diagnosis_poa_2\n    , diagnosis_poa_3\n    , diagnosis_poa_4\n    , diagnosis_poa_5\n    , diagnosis_poa_6\n    , diagnosis_poa_7\n    , diagnosis_poa_8\n    , diagnosis_poa_9\n    , diagnosis_poa_10\n    , diagnosis_poa_11\n    , diagnosis_poa_12\n    , diagnosis_poa_13\n    , diagnosis_poa_14\n    , diagnosis_poa_15\n    , diagnosis_poa_16\n    , diagnosis_poa_17\n    , diagnosis_poa_18\n    , diagnosis_poa_19\n    , diagnosis_poa_20\n    , diagnosis_poa_21\n    , diagnosis_poa_22\n    , diagnosis_poa_23\n    , diagnosis_poa_24\n    , diagnosis_poa_25\n    , procedure_code_type\n    , procedure_code_1\n    , procedure_code_2\n    , procedure_code_3\n    , procedure_code_4\n    , procedure_code_5\n    , procedure_code_6\n    , procedure_code_7\n    , procedure_code_8\n    , procedure_code_9\n    , procedure_code_10\n    , procedure_code_11\n    , procedure_code_12\n    , procedure_code_13\n    , procedure_code_14\n    , procedure_code_15\n    , procedure_code_16\n    , procedure_code_17\n    , procedure_code_18\n    , procedure_code_19\n    , procedure_code_20\n    , procedure_code_21\n    , procedure_code_22\n    , procedure_code_23\n    , procedure_code_24\n    , procedure_code_25\n    , procedure_date_1\n    , procedure_date_2\n    , procedure_date_3\n    , procedure_date_4\n    , procedure_date_5\n    , procedure_date_6\n    , procedure_date_7\n    , procedure_date_8\n    , procedure_date_9\n    , procedure_date_10\n    , procedure_date_11\n    , procedure_date_12\n    , procedure_date_13\n    , procedure_date_14\n    , procedure_date_15\n    , procedure_date_16\n    , procedure_date_17\n    , procedure_date_18\n    , procedure_date_19\n    , procedure_date_20\n    , procedure_date_21\n    , procedure_date_22\n    , procedure_date_23\n    , procedure_date_24\n    , procedure_date_25\n    , in_network_flag\n    , data_source\nfrom tuva.input_layer.medical_claim\n), normalize_cte as(\n\n    select \n        med.claim_id\n        , med.data_source\n        , apr.apr_drg_code\n        , apr.apr_drg_description\n    from __dbt__cte__normalized_input__stg_medical_claim med\n    inner join dev_tom.terminology.apr_drg apr\n        on med.apr_drg_code = apr.apr_drg_code\n    where claim_type = 'institutional'\n)\n, distinct_counts as(\n    select \n        claim_id\n        , data_source\n        , apr_drg_code\n        , apr_drg_description\n        , count(*) as apr_drg_occurrence_count\n    from normalize_cte\n    where apr_drg_code is not null\n    group by \n        claim_id\n        , data_source\n        , apr_drg_code\n        , apr_drg_description\n)\n\n, occurence_comparison as(\n    select\n        claim_id\n        , data_source\n        , 'apr_drg_code' as column_name\n        , apr_drg_code as normalized_code\n        , apr_drg_description as normalized_description\n        , apr_drg_occurrence_count as occurrence_count\n        , coalesce(lead(apr_drg_occurrence_count) \n            over (partition by claim_id, data_source order by apr_drg_occurrence_count desc),0) as next_occurrence_count\n        , row_number() over (partition by claim_id, data_source order by apr_drg_occurrence_count desc) as occurrence_row_count\n    from distinct_counts dist\n)\n\nselect\n    claim_id\n    , data_source\n    , column_name\n    , normalized_code\n    , normalized_description\n    , occurrence_count\n    , next_occurrence_count\n    , occurrence_row_count\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom occurence_comparison", "relation_name": "dev_tom.claims_preprocessing._int_normalized_input_apr_drg_voting"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.505212Z", "completed_at": "2024-08-23T19:21:33.514949Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.538753Z", "completed_at": "2024-08-23T19:21:33.538758Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.03489518165588379, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.normalized_input__int_bill_type_voting", "compiled": true, "compiled_code": "\n\n\nwith  __dbt__cte__normalized_input__stg_medical_claim as (\n\n\nselect\n      claim_id\n    , claim_line_number\n    , claim_type\n    , patient_id\n    , member_id\n    , payer\n    , plan\n    , claim_start_date\n    , claim_end_date\n    , claim_line_start_date\n    , claim_line_end_date\n    , admission_date\n    , discharge_date\n    , admit_source_code\n    , admit_type_code\n    , discharge_disposition_code\n    , place_of_service_code\n    , bill_type_code\n    , ms_drg_code\n    , apr_drg_code\n    , revenue_center_code\n    , service_unit_quantity\n    , hcpcs_code\n    , hcpcs_modifier_1\n    , hcpcs_modifier_2\n    , hcpcs_modifier_3\n    , hcpcs_modifier_4\n    , hcpcs_modifier_5\n    , rendering_npi\n    , rendering_tin\n    , billing_npi\n    , billing_tin\n    , facility_npi\n    , paid_date\n    , paid_amount\n    , allowed_amount\n    , charge_amount\n    , coinsurance_amount\n    , copayment_amount\n    , deductible_amount\n    , total_cost_amount\n    , diagnosis_code_type\n    , diagnosis_code_1\n    , diagnosis_code_2\n    , diagnosis_code_3\n    , diagnosis_code_4\n    , diagnosis_code_5\n    , diagnosis_code_6\n    , diagnosis_code_7\n    , diagnosis_code_8\n    , diagnosis_code_9\n    , diagnosis_code_10\n    , diagnosis_code_11\n    , diagnosis_code_12\n    , diagnosis_code_13\n    , diagnosis_code_14\n    , diagnosis_code_15\n    , diagnosis_code_16\n    , diagnosis_code_17\n    , diagnosis_code_18\n    , diagnosis_code_19\n    , diagnosis_code_20\n    , diagnosis_code_21\n    , diagnosis_code_22\n    , diagnosis_code_23\n    , diagnosis_code_24\n    , diagnosis_code_25\n    , diagnosis_poa_1\n    , diagnosis_poa_2\n    , diagnosis_poa_3\n    , diagnosis_poa_4\n    , diagnosis_poa_5\n    , diagnosis_poa_6\n    , diagnosis_poa_7\n    , diagnosis_poa_8\n    , diagnosis_poa_9\n    , diagnosis_poa_10\n    , diagnosis_poa_11\n    , diagnosis_poa_12\n    , diagnosis_poa_13\n    , diagnosis_poa_14\n    , diagnosis_poa_15\n    , diagnosis_poa_16\n    , diagnosis_poa_17\n    , diagnosis_poa_18\n    , diagnosis_poa_19\n    , diagnosis_poa_20\n    , diagnosis_poa_21\n    , diagnosis_poa_22\n    , diagnosis_poa_23\n    , diagnosis_poa_24\n    , diagnosis_poa_25\n    , procedure_code_type\n    , procedure_code_1\n    , procedure_code_2\n    , procedure_code_3\n    , procedure_code_4\n    , procedure_code_5\n    , procedure_code_6\n    , procedure_code_7\n    , procedure_code_8\n    , procedure_code_9\n    , procedure_code_10\n    , procedure_code_11\n    , procedure_code_12\n    , procedure_code_13\n    , procedure_code_14\n    , procedure_code_15\n    , procedure_code_16\n    , procedure_code_17\n    , procedure_code_18\n    , procedure_code_19\n    , procedure_code_20\n    , procedure_code_21\n    , procedure_code_22\n    , procedure_code_23\n    , procedure_code_24\n    , procedure_code_25\n    , procedure_date_1\n    , procedure_date_2\n    , procedure_date_3\n    , procedure_date_4\n    , procedure_date_5\n    , procedure_date_6\n    , procedure_date_7\n    , procedure_date_8\n    , procedure_date_9\n    , procedure_date_10\n    , procedure_date_11\n    , procedure_date_12\n    , procedure_date_13\n    , procedure_date_14\n    , procedure_date_15\n    , procedure_date_16\n    , procedure_date_17\n    , procedure_date_18\n    , procedure_date_19\n    , procedure_date_20\n    , procedure_date_21\n    , procedure_date_22\n    , procedure_date_23\n    , procedure_date_24\n    , procedure_date_25\n    , in_network_flag\n    , data_source\nfrom tuva.input_layer.medical_claim\n), normalize_cte as(\n    select \n        med.claim_id\n        , med.data_source\n        , bill.bill_type_code\n        , bill.bill_type_description\n    from __dbt__cte__normalized_input__stg_medical_claim med\n    inner join dev_tom.terminology.bill_type bill\n        on ltrim(med.bill_type_code, '0') = bill.bill_type_code\n    where claim_type = 'institutional'\n)\n, distinct_counts as(\n    select \n        claim_id\n        , data_source\n        , bill_type_code\n        , bill_type_description\n        , count(*) as bill_type_occurrence_count\n    from normalize_cte\n    where bill_type_code is not null\n    group by \n        claim_id\n        , data_source\n        , bill_type_code\n        , bill_type_description\n)\n\n, occurence_comparison as(\n    select\n        claim_id\n        , data_source\n        , 'bill_type_code' as column_name\n        , bill_type_code as normalized_code\n        , bill_type_description as normalized_description\n        , bill_type_occurrence_count as occurrence_count\n        , coalesce(lead(bill_type_occurrence_count) \n            over (partition by claim_id, data_source order by bill_type_occurrence_count desc),0) as next_occurrence_count\n        , row_number() over (partition by claim_id, data_source order by bill_type_occurrence_count desc) as occurrence_row_count\n    from distinct_counts dist\n)\n\nselect\n    claim_id\n    , data_source\n    , column_name\n    , normalized_code\n    , normalized_description\n    , occurrence_count\n    , next_occurrence_count\n    , occurrence_row_count\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom occurence_comparison", "relation_name": "dev_tom.claims_preprocessing._int_normalized_input_bill_type_voting"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.515286Z", "completed_at": "2024-08-23T19:21:33.546713Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.547187Z", "completed_at": "2024-08-23T19:21:33.547192Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.03386068344116211, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.normalized_input__int_diagnosis_code_normalize", "compiled": true, "compiled_code": "\n\n\nwith  __dbt__cte__normalized_input__stg_medical_claim as (\n\n\nselect\n      claim_id\n    , claim_line_number\n    , claim_type\n    , patient_id\n    , member_id\n    , payer\n    , plan\n    , claim_start_date\n    , claim_end_date\n    , claim_line_start_date\n    , claim_line_end_date\n    , admission_date\n    , discharge_date\n    , admit_source_code\n    , admit_type_code\n    , discharge_disposition_code\n    , place_of_service_code\n    , bill_type_code\n    , ms_drg_code\n    , apr_drg_code\n    , revenue_center_code\n    , service_unit_quantity\n    , hcpcs_code\n    , hcpcs_modifier_1\n    , hcpcs_modifier_2\n    , hcpcs_modifier_3\n    , hcpcs_modifier_4\n    , hcpcs_modifier_5\n    , rendering_npi\n    , rendering_tin\n    , billing_npi\n    , billing_tin\n    , facility_npi\n    , paid_date\n    , paid_amount\n    , allowed_amount\n    , charge_amount\n    , coinsurance_amount\n    , copayment_amount\n    , deductible_amount\n    , total_cost_amount\n    , diagnosis_code_type\n    , diagnosis_code_1\n    , diagnosis_code_2\n    , diagnosis_code_3\n    , diagnosis_code_4\n    , diagnosis_code_5\n    , diagnosis_code_6\n    , diagnosis_code_7\n    , diagnosis_code_8\n    , diagnosis_code_9\n    , diagnosis_code_10\n    , diagnosis_code_11\n    , diagnosis_code_12\n    , diagnosis_code_13\n    , diagnosis_code_14\n    , diagnosis_code_15\n    , diagnosis_code_16\n    , diagnosis_code_17\n    , diagnosis_code_18\n    , diagnosis_code_19\n    , diagnosis_code_20\n    , diagnosis_code_21\n    , diagnosis_code_22\n    , diagnosis_code_23\n    , diagnosis_code_24\n    , diagnosis_code_25\n    , diagnosis_poa_1\n    , diagnosis_poa_2\n    , diagnosis_poa_3\n    , diagnosis_poa_4\n    , diagnosis_poa_5\n    , diagnosis_poa_6\n    , diagnosis_poa_7\n    , diagnosis_poa_8\n    , diagnosis_poa_9\n    , diagnosis_poa_10\n    , diagnosis_poa_11\n    , diagnosis_poa_12\n    , diagnosis_poa_13\n    , diagnosis_poa_14\n    , diagnosis_poa_15\n    , diagnosis_poa_16\n    , diagnosis_poa_17\n    , diagnosis_poa_18\n    , diagnosis_poa_19\n    , diagnosis_poa_20\n    , diagnosis_poa_21\n    , diagnosis_poa_22\n    , diagnosis_poa_23\n    , diagnosis_poa_24\n    , diagnosis_poa_25\n    , procedure_code_type\n    , procedure_code_1\n    , procedure_code_2\n    , procedure_code_3\n    , procedure_code_4\n    , procedure_code_5\n    , procedure_code_6\n    , procedure_code_7\n    , procedure_code_8\n    , procedure_code_9\n    , procedure_code_10\n    , procedure_code_11\n    , procedure_code_12\n    , procedure_code_13\n    , procedure_code_14\n    , procedure_code_15\n    , procedure_code_16\n    , procedure_code_17\n    , procedure_code_18\n    , procedure_code_19\n    , procedure_code_20\n    , procedure_code_21\n    , procedure_code_22\n    , procedure_code_23\n    , procedure_code_24\n    , procedure_code_25\n    , procedure_date_1\n    , procedure_date_2\n    , procedure_date_3\n    , procedure_date_4\n    , procedure_date_5\n    , procedure_date_6\n    , procedure_date_7\n    , procedure_date_8\n    , procedure_date_9\n    , procedure_date_10\n    , procedure_date_11\n    , procedure_date_12\n    , procedure_date_13\n    , procedure_date_14\n    , procedure_date_15\n    , procedure_date_16\n    , procedure_date_17\n    , procedure_date_18\n    , procedure_date_19\n    , procedure_date_20\n    , procedure_date_21\n    , procedure_date_22\n    , procedure_date_23\n    , procedure_date_24\n    , procedure_date_25\n    , in_network_flag\n    , data_source\nfrom tuva.input_layer.medical_claim\n), pivot_diagnosis as(\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , diagnosis_code_type\n        , 'diagnosis_code_1'  as diagnosis_column\n        ,  diagnosis_code_1  as diagnosis_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , diagnosis_code_type\n        , 'diagnosis_code_2'  as diagnosis_column\n        ,  diagnosis_code_2  as diagnosis_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , diagnosis_code_type\n        , 'diagnosis_code_3'  as diagnosis_column\n        ,  diagnosis_code_3  as diagnosis_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , diagnosis_code_type\n        , 'diagnosis_code_4'  as diagnosis_column\n        ,  diagnosis_code_4  as diagnosis_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , diagnosis_code_type\n        , 'diagnosis_code_5'  as diagnosis_column\n        ,  diagnosis_code_5  as diagnosis_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , diagnosis_code_type\n        , 'diagnosis_code_6'  as diagnosis_column\n        ,  diagnosis_code_6  as diagnosis_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , diagnosis_code_type\n        , 'diagnosis_code_7'  as diagnosis_column\n        ,  diagnosis_code_7  as diagnosis_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , diagnosis_code_type\n        , 'diagnosis_code_8'  as diagnosis_column\n        ,  diagnosis_code_8  as diagnosis_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , diagnosis_code_type\n        , 'diagnosis_code_9'  as diagnosis_column\n        ,  diagnosis_code_9  as diagnosis_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , diagnosis_code_type\n        , 'diagnosis_code_10'  as diagnosis_column\n        ,  diagnosis_code_10  as diagnosis_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , diagnosis_code_type\n        , 'diagnosis_code_11'  as diagnosis_column\n        ,  diagnosis_code_11  as diagnosis_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , diagnosis_code_type\n        , 'diagnosis_code_12'  as diagnosis_column\n        ,  diagnosis_code_12  as diagnosis_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , diagnosis_code_type\n        , 'diagnosis_code_13'  as diagnosis_column\n        ,  diagnosis_code_13  as diagnosis_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , diagnosis_code_type\n        , 'diagnosis_code_14'  as diagnosis_column\n        ,  diagnosis_code_14  as diagnosis_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , diagnosis_code_type\n        , 'diagnosis_code_15'  as diagnosis_column\n        ,  diagnosis_code_15  as diagnosis_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , diagnosis_code_type\n        , 'diagnosis_code_16'  as diagnosis_column\n        ,  diagnosis_code_16  as diagnosis_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , diagnosis_code_type\n        , 'diagnosis_code_17'  as diagnosis_column\n        ,  diagnosis_code_17  as diagnosis_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , diagnosis_code_type\n        , 'diagnosis_code_18'  as diagnosis_column\n        ,  diagnosis_code_18  as diagnosis_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , diagnosis_code_type\n        , 'diagnosis_code_19'  as diagnosis_column\n        ,  diagnosis_code_19  as diagnosis_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , diagnosis_code_type\n        , 'diagnosis_code_20'  as diagnosis_column\n        ,  diagnosis_code_20  as diagnosis_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , diagnosis_code_type\n        , 'diagnosis_code_21'  as diagnosis_column\n        ,  diagnosis_code_21  as diagnosis_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , diagnosis_code_type\n        , 'diagnosis_code_22'  as diagnosis_column\n        ,  diagnosis_code_22  as diagnosis_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , diagnosis_code_type\n        , 'diagnosis_code_23'  as diagnosis_column\n        ,  diagnosis_code_24  as diagnosis_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , diagnosis_code_type\n        , 'diagnosis_code_24'  as diagnosis_column\n        ,  diagnosis_code_24  as diagnosis_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , diagnosis_code_type\n        , 'diagnosis_code_25'  as diagnosis_column\n        ,  diagnosis_code_25  as diagnosis_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n)\n\nselect\n    claim_id\n    , data_source\n    , diagnosis_code_type\n    , diagnosis_column\n    , coalesce(icd_9.icd_9_cm,icd_10.icd_10_cm) as normalized_diagnosis_code\n    , count(*) as diagnosis_code_occurrence_count\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom pivot_diagnosis piv\nleft join dev_tom.terminology.icd_10_cm icd_10\n    on replace(piv.diagnosis_code,'.','') = icd_10.icd_10_cm\n    and piv.diagnosis_code_type = 'icd-10-cm'\nleft join dev_tom.terminology.icd_9_cm icd_9\n    on replace(piv.diagnosis_code,'.','') = icd_9.icd_9_cm\n    and piv.diagnosis_code_type = 'icd-9-cm'\nwhere claim_type <> 'undetermined'\ngroup by \n    claim_id\n    , data_source\n    , diagnosis_code_type\n    , diagnosis_column\n    , coalesce(icd_9.icd_9_cm,icd_10.icd_10_cm)", "relation_name": "dev_tom.claims_preprocessing._int_normalized_input_diagnosis_code_normalize"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.539421Z", "completed_at": "2024-08-23T19:21:33.547664Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.554117Z", "completed_at": "2024-08-23T19:21:33.554121Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.03938794136047363, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.normalized_input__int_discharge_disposition_voting", "compiled": true, "compiled_code": "\n\n\nwith  __dbt__cte__normalized_input__stg_medical_claim as (\n\n\nselect\n      claim_id\n    , claim_line_number\n    , claim_type\n    , patient_id\n    , member_id\n    , payer\n    , plan\n    , claim_start_date\n    , claim_end_date\n    , claim_line_start_date\n    , claim_line_end_date\n    , admission_date\n    , discharge_date\n    , admit_source_code\n    , admit_type_code\n    , discharge_disposition_code\n    , place_of_service_code\n    , bill_type_code\n    , ms_drg_code\n    , apr_drg_code\n    , revenue_center_code\n    , service_unit_quantity\n    , hcpcs_code\n    , hcpcs_modifier_1\n    , hcpcs_modifier_2\n    , hcpcs_modifier_3\n    , hcpcs_modifier_4\n    , hcpcs_modifier_5\n    , rendering_npi\n    , rendering_tin\n    , billing_npi\n    , billing_tin\n    , facility_npi\n    , paid_date\n    , paid_amount\n    , allowed_amount\n    , charge_amount\n    , coinsurance_amount\n    , copayment_amount\n    , deductible_amount\n    , total_cost_amount\n    , diagnosis_code_type\n    , diagnosis_code_1\n    , diagnosis_code_2\n    , diagnosis_code_3\n    , diagnosis_code_4\n    , diagnosis_code_5\n    , diagnosis_code_6\n    , diagnosis_code_7\n    , diagnosis_code_8\n    , diagnosis_code_9\n    , diagnosis_code_10\n    , diagnosis_code_11\n    , diagnosis_code_12\n    , diagnosis_code_13\n    , diagnosis_code_14\n    , diagnosis_code_15\n    , diagnosis_code_16\n    , diagnosis_code_17\n    , diagnosis_code_18\n    , diagnosis_code_19\n    , diagnosis_code_20\n    , diagnosis_code_21\n    , diagnosis_code_22\n    , diagnosis_code_23\n    , diagnosis_code_24\n    , diagnosis_code_25\n    , diagnosis_poa_1\n    , diagnosis_poa_2\n    , diagnosis_poa_3\n    , diagnosis_poa_4\n    , diagnosis_poa_5\n    , diagnosis_poa_6\n    , diagnosis_poa_7\n    , diagnosis_poa_8\n    , diagnosis_poa_9\n    , diagnosis_poa_10\n    , diagnosis_poa_11\n    , diagnosis_poa_12\n    , diagnosis_poa_13\n    , diagnosis_poa_14\n    , diagnosis_poa_15\n    , diagnosis_poa_16\n    , diagnosis_poa_17\n    , diagnosis_poa_18\n    , diagnosis_poa_19\n    , diagnosis_poa_20\n    , diagnosis_poa_21\n    , diagnosis_poa_22\n    , diagnosis_poa_23\n    , diagnosis_poa_24\n    , diagnosis_poa_25\n    , procedure_code_type\n    , procedure_code_1\n    , procedure_code_2\n    , procedure_code_3\n    , procedure_code_4\n    , procedure_code_5\n    , procedure_code_6\n    , procedure_code_7\n    , procedure_code_8\n    , procedure_code_9\n    , procedure_code_10\n    , procedure_code_11\n    , procedure_code_12\n    , procedure_code_13\n    , procedure_code_14\n    , procedure_code_15\n    , procedure_code_16\n    , procedure_code_17\n    , procedure_code_18\n    , procedure_code_19\n    , procedure_code_20\n    , procedure_code_21\n    , procedure_code_22\n    , procedure_code_23\n    , procedure_code_24\n    , procedure_code_25\n    , procedure_date_1\n    , procedure_date_2\n    , procedure_date_3\n    , procedure_date_4\n    , procedure_date_5\n    , procedure_date_6\n    , procedure_date_7\n    , procedure_date_8\n    , procedure_date_9\n    , procedure_date_10\n    , procedure_date_11\n    , procedure_date_12\n    , procedure_date_13\n    , procedure_date_14\n    , procedure_date_15\n    , procedure_date_16\n    , procedure_date_17\n    , procedure_date_18\n    , procedure_date_19\n    , procedure_date_20\n    , procedure_date_21\n    , procedure_date_22\n    , procedure_date_23\n    , procedure_date_24\n    , procedure_date_25\n    , in_network_flag\n    , data_source\nfrom tuva.input_layer.medical_claim\n), normalize_cte as(\n    select \n        med.claim_id\n        , med.data_source\n        , disch.discharge_disposition_code\n        , disch.discharge_disposition_description\n    from __dbt__cte__normalized_input__stg_medical_claim med\n    inner join dev_tom.terminology.discharge_disposition disch\n        on med.discharge_disposition_code = disch.discharge_disposition_code\n    where claim_type = 'institutional'\n)\n, distinct_counts as(\n    select \n        claim_id\n        , data_source\n        , discharge_disposition_code\n        , discharge_disposition_description\n        , count(*) as discharge_disposition_occurrence_count\n    from normalize_cte\n    where discharge_disposition_code is not null\n    group by \n        claim_id\n        , data_source\n        , discharge_disposition_code\n        , discharge_disposition_description\n)\n\n, occurence_comparison as(\n    select\n        claim_id\n        , data_source\n        , 'discharge_disposition_code' as column_name\n        , discharge_disposition_code as normalized_code\n        , discharge_disposition_description as normalized_description\n        , discharge_disposition_occurrence_count as occurrence_count\n        , coalesce(lead(discharge_disposition_occurrence_count) \n            over (partition by claim_id, data_source order by discharge_disposition_occurrence_count desc),0) as next_occurrence_count\n        , row_number() over (partition by claim_id, data_source order by discharge_disposition_occurrence_count desc) as occurrence_row_count\n    from distinct_counts dist\n)\n\nselect\n    claim_id\n    , data_source\n    , column_name\n    , normalized_code\n    , normalized_description\n    , occurrence_count\n    , next_occurrence_count\n    , occurrence_row_count\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom occurence_comparison", "relation_name": "dev_tom.claims_preprocessing._int_normalized_input_discharge_disposition_voting"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.548038Z", "completed_at": "2024-08-23T19:21:33.555422Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.562289Z", "completed_at": "2024-08-23T19:21:33.562293Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.015362024307250977, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.normalized_input__int_medical_claim_date_normalize", "compiled": true, "compiled_code": "\n\n\nwith __dbt__cte__normalized_input__stg_medical_claim as (\n\n\nselect\n      claim_id\n    , claim_line_number\n    , claim_type\n    , patient_id\n    , member_id\n    , payer\n    , plan\n    , claim_start_date\n    , claim_end_date\n    , claim_line_start_date\n    , claim_line_end_date\n    , admission_date\n    , discharge_date\n    , admit_source_code\n    , admit_type_code\n    , discharge_disposition_code\n    , place_of_service_code\n    , bill_type_code\n    , ms_drg_code\n    , apr_drg_code\n    , revenue_center_code\n    , service_unit_quantity\n    , hcpcs_code\n    , hcpcs_modifier_1\n    , hcpcs_modifier_2\n    , hcpcs_modifier_3\n    , hcpcs_modifier_4\n    , hcpcs_modifier_5\n    , rendering_npi\n    , rendering_tin\n    , billing_npi\n    , billing_tin\n    , facility_npi\n    , paid_date\n    , paid_amount\n    , allowed_amount\n    , charge_amount\n    , coinsurance_amount\n    , copayment_amount\n    , deductible_amount\n    , total_cost_amount\n    , diagnosis_code_type\n    , diagnosis_code_1\n    , diagnosis_code_2\n    , diagnosis_code_3\n    , diagnosis_code_4\n    , diagnosis_code_5\n    , diagnosis_code_6\n    , diagnosis_code_7\n    , diagnosis_code_8\n    , diagnosis_code_9\n    , diagnosis_code_10\n    , diagnosis_code_11\n    , diagnosis_code_12\n    , diagnosis_code_13\n    , diagnosis_code_14\n    , diagnosis_code_15\n    , diagnosis_code_16\n    , diagnosis_code_17\n    , diagnosis_code_18\n    , diagnosis_code_19\n    , diagnosis_code_20\n    , diagnosis_code_21\n    , diagnosis_code_22\n    , diagnosis_code_23\n    , diagnosis_code_24\n    , diagnosis_code_25\n    , diagnosis_poa_1\n    , diagnosis_poa_2\n    , diagnosis_poa_3\n    , diagnosis_poa_4\n    , diagnosis_poa_5\n    , diagnosis_poa_6\n    , diagnosis_poa_7\n    , diagnosis_poa_8\n    , diagnosis_poa_9\n    , diagnosis_poa_10\n    , diagnosis_poa_11\n    , diagnosis_poa_12\n    , diagnosis_poa_13\n    , diagnosis_poa_14\n    , diagnosis_poa_15\n    , diagnosis_poa_16\n    , diagnosis_poa_17\n    , diagnosis_poa_18\n    , diagnosis_poa_19\n    , diagnosis_poa_20\n    , diagnosis_poa_21\n    , diagnosis_poa_22\n    , diagnosis_poa_23\n    , diagnosis_poa_24\n    , diagnosis_poa_25\n    , procedure_code_type\n    , procedure_code_1\n    , procedure_code_2\n    , procedure_code_3\n    , procedure_code_4\n    , procedure_code_5\n    , procedure_code_6\n    , procedure_code_7\n    , procedure_code_8\n    , procedure_code_9\n    , procedure_code_10\n    , procedure_code_11\n    , procedure_code_12\n    , procedure_code_13\n    , procedure_code_14\n    , procedure_code_15\n    , procedure_code_16\n    , procedure_code_17\n    , procedure_code_18\n    , procedure_code_19\n    , procedure_code_20\n    , procedure_code_21\n    , procedure_code_22\n    , procedure_code_23\n    , procedure_code_24\n    , procedure_code_25\n    , procedure_date_1\n    , procedure_date_2\n    , procedure_date_3\n    , procedure_date_4\n    , procedure_date_5\n    , procedure_date_6\n    , procedure_date_7\n    , procedure_date_8\n    , procedure_date_9\n    , procedure_date_10\n    , procedure_date_11\n    , procedure_date_12\n    , procedure_date_13\n    , procedure_date_14\n    , procedure_date_15\n    , procedure_date_16\n    , procedure_date_17\n    , procedure_date_18\n    , procedure_date_19\n    , procedure_date_20\n    , procedure_date_21\n    , procedure_date_22\n    , procedure_date_23\n    , procedure_date_24\n    , procedure_date_25\n    , in_network_flag\n    , data_source\nfrom tuva.input_layer.medical_claim\n) select distinct\n  med.claim_id\n  , med.claim_line_number\n  , med.claim_type\n  , med.data_source\n  , cal_claim_start.full_date as normalized_claim_start_date\n  , cal_claim_end.full_date as normalized_claim_end_date\n  , cal_claim_line_start.full_date as normalized_claim_line_start_date\n  , cal_claim_line_end.full_date as normalized_claim_line_end_date\n  , cal_admission.full_date as normalized_admission_date\n  , cal_discharge.full_date as normalized_discharge_date\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom __dbt__cte__normalized_input__stg_medical_claim med\nleft join dev_tom.reference_data.calendar cal_claim_start\n    on med.claim_start_date = cal_claim_start.full_date\nleft join dev_tom.reference_data.calendar cal_claim_end\n    on med.claim_end_date = cal_claim_end.full_date\nleft join dev_tom.reference_data.calendar cal_claim_line_start\n    on med.claim_line_start_date = cal_claim_line_start.full_date\nleft join dev_tom.reference_data.calendar cal_claim_line_end\n    on med.claim_line_end_date = cal_claim_line_end.full_date\nleft join dev_tom.reference_data.calendar cal_admission\n    on med.admission_date = cal_admission.full_date\nleft join dev_tom.reference_data.calendar cal_discharge\n    on med.discharge_date = cal_discharge.full_date", "relation_name": "dev_tom.claims_preprocessing._int_normalized_input_medical_claim_date_normalize"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.555789Z", "completed_at": "2024-08-23T19:21:33.569807Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.570185Z", "completed_at": "2024-08-23T19:21:33.570189Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.015655040740966797, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.normalized_input__int_medical_npi_normalize", "compiled": true, "compiled_code": "\n\n\nwith __dbt__cte__normalized_input__stg_medical_claim as (\n\n\nselect\n      claim_id\n    , claim_line_number\n    , claim_type\n    , patient_id\n    , member_id\n    , payer\n    , plan\n    , claim_start_date\n    , claim_end_date\n    , claim_line_start_date\n    , claim_line_end_date\n    , admission_date\n    , discharge_date\n    , admit_source_code\n    , admit_type_code\n    , discharge_disposition_code\n    , place_of_service_code\n    , bill_type_code\n    , ms_drg_code\n    , apr_drg_code\n    , revenue_center_code\n    , service_unit_quantity\n    , hcpcs_code\n    , hcpcs_modifier_1\n    , hcpcs_modifier_2\n    , hcpcs_modifier_3\n    , hcpcs_modifier_4\n    , hcpcs_modifier_5\n    , rendering_npi\n    , rendering_tin\n    , billing_npi\n    , billing_tin\n    , facility_npi\n    , paid_date\n    , paid_amount\n    , allowed_amount\n    , charge_amount\n    , coinsurance_amount\n    , copayment_amount\n    , deductible_amount\n    , total_cost_amount\n    , diagnosis_code_type\n    , diagnosis_code_1\n    , diagnosis_code_2\n    , diagnosis_code_3\n    , diagnosis_code_4\n    , diagnosis_code_5\n    , diagnosis_code_6\n    , diagnosis_code_7\n    , diagnosis_code_8\n    , diagnosis_code_9\n    , diagnosis_code_10\n    , diagnosis_code_11\n    , diagnosis_code_12\n    , diagnosis_code_13\n    , diagnosis_code_14\n    , diagnosis_code_15\n    , diagnosis_code_16\n    , diagnosis_code_17\n    , diagnosis_code_18\n    , diagnosis_code_19\n    , diagnosis_code_20\n    , diagnosis_code_21\n    , diagnosis_code_22\n    , diagnosis_code_23\n    , diagnosis_code_24\n    , diagnosis_code_25\n    , diagnosis_poa_1\n    , diagnosis_poa_2\n    , diagnosis_poa_3\n    , diagnosis_poa_4\n    , diagnosis_poa_5\n    , diagnosis_poa_6\n    , diagnosis_poa_7\n    , diagnosis_poa_8\n    , diagnosis_poa_9\n    , diagnosis_poa_10\n    , diagnosis_poa_11\n    , diagnosis_poa_12\n    , diagnosis_poa_13\n    , diagnosis_poa_14\n    , diagnosis_poa_15\n    , diagnosis_poa_16\n    , diagnosis_poa_17\n    , diagnosis_poa_18\n    , diagnosis_poa_19\n    , diagnosis_poa_20\n    , diagnosis_poa_21\n    , diagnosis_poa_22\n    , diagnosis_poa_23\n    , diagnosis_poa_24\n    , diagnosis_poa_25\n    , procedure_code_type\n    , procedure_code_1\n    , procedure_code_2\n    , procedure_code_3\n    , procedure_code_4\n    , procedure_code_5\n    , procedure_code_6\n    , procedure_code_7\n    , procedure_code_8\n    , procedure_code_9\n    , procedure_code_10\n    , procedure_code_11\n    , procedure_code_12\n    , procedure_code_13\n    , procedure_code_14\n    , procedure_code_15\n    , procedure_code_16\n    , procedure_code_17\n    , procedure_code_18\n    , procedure_code_19\n    , procedure_code_20\n    , procedure_code_21\n    , procedure_code_22\n    , procedure_code_23\n    , procedure_code_24\n    , procedure_code_25\n    , procedure_date_1\n    , procedure_date_2\n    , procedure_date_3\n    , procedure_date_4\n    , procedure_date_5\n    , procedure_date_6\n    , procedure_date_7\n    , procedure_date_8\n    , procedure_date_9\n    , procedure_date_10\n    , procedure_date_11\n    , procedure_date_12\n    , procedure_date_13\n    , procedure_date_14\n    , procedure_date_15\n    , procedure_date_16\n    , procedure_date_17\n    , procedure_date_18\n    , procedure_date_19\n    , procedure_date_20\n    , procedure_date_21\n    , procedure_date_22\n    , procedure_date_23\n    , procedure_date_24\n    , procedure_date_25\n    , in_network_flag\n    , data_source\nfrom tuva.input_layer.medical_claim\n) select distinct\n  med.claim_id\n  , med.claim_line_number\n  , med.claim_type\n  , med.data_source\n  , rend_prov.npi as normalized_rendering_npi\n  , cast(coalesce(rend_prov.provider_last_name || ', ' || rend_prov.provider_first_name, rend_prov.provider_organization_name) as TEXT ) as normalized_rendering_name\n  , bill_prov.npi as normalized_billing_npi\n  , cast(coalesce(bill_prov.provider_last_name || ', ' || bill_prov.provider_first_name, bill_prov.provider_organization_name) as TEXT ) as normalized_billing_name\n  , fac_prov.npi as normalized_facility_npi\n  , cast(coalesce(fac_prov.provider_last_name || ', ' || fac_prov.provider_first_name, fac_prov.provider_organization_name) as TEXT ) as normalized_facility_name\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom __dbt__cte__normalized_input__stg_medical_claim med\nleft join dev_tom.terminology.provider rend_prov\n    on med.rendering_npi = rend_prov.npi\n    and rend_prov.entity_type_description = 'Individual'\nleft join dev_tom.terminology.provider bill_prov\n    on med.billing_npi = bill_prov.npi\nleft join dev_tom.terminology.provider fac_prov\n    on med.facility_npi = fac_prov.npi\n    and fac_prov.entity_type_description = 'Organization'\n    and med.claim_type = 'institutional'", "relation_name": "dev_tom.claims_preprocessing._int_normalized_input_medical_npi_normalize"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.563043Z", "completed_at": "2024-08-23T19:21:33.570850Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.574636Z", "completed_at": "2024-08-23T19:21:33.574640Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.019083023071289062, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.normalized_input__int_ms_drg_voting", "compiled": true, "compiled_code": "\n\n\nwith  __dbt__cte__normalized_input__stg_medical_claim as (\n\n\nselect\n      claim_id\n    , claim_line_number\n    , claim_type\n    , patient_id\n    , member_id\n    , payer\n    , plan\n    , claim_start_date\n    , claim_end_date\n    , claim_line_start_date\n    , claim_line_end_date\n    , admission_date\n    , discharge_date\n    , admit_source_code\n    , admit_type_code\n    , discharge_disposition_code\n    , place_of_service_code\n    , bill_type_code\n    , ms_drg_code\n    , apr_drg_code\n    , revenue_center_code\n    , service_unit_quantity\n    , hcpcs_code\n    , hcpcs_modifier_1\n    , hcpcs_modifier_2\n    , hcpcs_modifier_3\n    , hcpcs_modifier_4\n    , hcpcs_modifier_5\n    , rendering_npi\n    , rendering_tin\n    , billing_npi\n    , billing_tin\n    , facility_npi\n    , paid_date\n    , paid_amount\n    , allowed_amount\n    , charge_amount\n    , coinsurance_amount\n    , copayment_amount\n    , deductible_amount\n    , total_cost_amount\n    , diagnosis_code_type\n    , diagnosis_code_1\n    , diagnosis_code_2\n    , diagnosis_code_3\n    , diagnosis_code_4\n    , diagnosis_code_5\n    , diagnosis_code_6\n    , diagnosis_code_7\n    , diagnosis_code_8\n    , diagnosis_code_9\n    , diagnosis_code_10\n    , diagnosis_code_11\n    , diagnosis_code_12\n    , diagnosis_code_13\n    , diagnosis_code_14\n    , diagnosis_code_15\n    , diagnosis_code_16\n    , diagnosis_code_17\n    , diagnosis_code_18\n    , diagnosis_code_19\n    , diagnosis_code_20\n    , diagnosis_code_21\n    , diagnosis_code_22\n    , diagnosis_code_23\n    , diagnosis_code_24\n    , diagnosis_code_25\n    , diagnosis_poa_1\n    , diagnosis_poa_2\n    , diagnosis_poa_3\n    , diagnosis_poa_4\n    , diagnosis_poa_5\n    , diagnosis_poa_6\n    , diagnosis_poa_7\n    , diagnosis_poa_8\n    , diagnosis_poa_9\n    , diagnosis_poa_10\n    , diagnosis_poa_11\n    , diagnosis_poa_12\n    , diagnosis_poa_13\n    , diagnosis_poa_14\n    , diagnosis_poa_15\n    , diagnosis_poa_16\n    , diagnosis_poa_17\n    , diagnosis_poa_18\n    , diagnosis_poa_19\n    , diagnosis_poa_20\n    , diagnosis_poa_21\n    , diagnosis_poa_22\n    , diagnosis_poa_23\n    , diagnosis_poa_24\n    , diagnosis_poa_25\n    , procedure_code_type\n    , procedure_code_1\n    , procedure_code_2\n    , procedure_code_3\n    , procedure_code_4\n    , procedure_code_5\n    , procedure_code_6\n    , procedure_code_7\n    , procedure_code_8\n    , procedure_code_9\n    , procedure_code_10\n    , procedure_code_11\n    , procedure_code_12\n    , procedure_code_13\n    , procedure_code_14\n    , procedure_code_15\n    , procedure_code_16\n    , procedure_code_17\n    , procedure_code_18\n    , procedure_code_19\n    , procedure_code_20\n    , procedure_code_21\n    , procedure_code_22\n    , procedure_code_23\n    , procedure_code_24\n    , procedure_code_25\n    , procedure_date_1\n    , procedure_date_2\n    , procedure_date_3\n    , procedure_date_4\n    , procedure_date_5\n    , procedure_date_6\n    , procedure_date_7\n    , procedure_date_8\n    , procedure_date_9\n    , procedure_date_10\n    , procedure_date_11\n    , procedure_date_12\n    , procedure_date_13\n    , procedure_date_14\n    , procedure_date_15\n    , procedure_date_16\n    , procedure_date_17\n    , procedure_date_18\n    , procedure_date_19\n    , procedure_date_20\n    , procedure_date_21\n    , procedure_date_22\n    , procedure_date_23\n    , procedure_date_24\n    , procedure_date_25\n    , in_network_flag\n    , data_source\nfrom tuva.input_layer.medical_claim\n), normalize_cte as(\n    select \n        med.claim_id\n        , med.data_source\n        , ms.ms_drg_code\n        , ms.ms_drg_description\n    from __dbt__cte__normalized_input__stg_medical_claim med\n    inner join dev_tom.terminology.ms_drg ms\n        on med.ms_drg_code = ms.ms_drg_code\n    where claim_type = 'institutional'\n)\n, distinct_counts as(\n    select \n        claim_id\n        , data_source\n        , ms_drg_code\n        , ms_drg_description\n        , count(*) as ms_drg_occurrence_count\n    from normalize_cte\n    where ms_drg_code is not null\n    group by \n        claim_id\n        , data_source\n        , ms_drg_code\n        , ms_drg_description\n)\n\n, occurence_comparison as(\n    select\n        claim_id\n        , data_source\n        , 'ms_drg_code' as column_name\n        , ms_drg_code as normalized_code\n        , ms_drg_description as normalized_description\n        , ms_drg_occurrence_count as occurrence_count\n        , coalesce(lead(ms_drg_occurrence_count) \n            over (partition by claim_id, data_source order by ms_drg_occurrence_count desc),0) as next_occurrence_count\n        , row_number() over (partition by claim_id, data_source order by ms_drg_occurrence_count desc) as occurrence_row_count\n    from distinct_counts dist\n)\n\nselect\n    claim_id\n    , data_source\n    , column_name\n    , normalized_code\n    , normalized_description\n    , occurrence_count\n    , next_occurrence_count\n    , occurrence_row_count\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom occurence_comparison", "relation_name": "dev_tom.claims_preprocessing._int_normalized_input_ms_drg_voting"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.571015Z", "completed_at": "2024-08-23T19:21:33.575350Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.597593Z", "completed_at": "2024-08-23T19:21:33.597598Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.02767014503479004, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.normalized_input__int_place_of_service_normalize", "compiled": true, "compiled_code": "\n\n\nwith __dbt__cte__normalized_input__stg_medical_claim as (\n\n\nselect\n      claim_id\n    , claim_line_number\n    , claim_type\n    , patient_id\n    , member_id\n    , payer\n    , plan\n    , claim_start_date\n    , claim_end_date\n    , claim_line_start_date\n    , claim_line_end_date\n    , admission_date\n    , discharge_date\n    , admit_source_code\n    , admit_type_code\n    , discharge_disposition_code\n    , place_of_service_code\n    , bill_type_code\n    , ms_drg_code\n    , apr_drg_code\n    , revenue_center_code\n    , service_unit_quantity\n    , hcpcs_code\n    , hcpcs_modifier_1\n    , hcpcs_modifier_2\n    , hcpcs_modifier_3\n    , hcpcs_modifier_4\n    , hcpcs_modifier_5\n    , rendering_npi\n    , rendering_tin\n    , billing_npi\n    , billing_tin\n    , facility_npi\n    , paid_date\n    , paid_amount\n    , allowed_amount\n    , charge_amount\n    , coinsurance_amount\n    , copayment_amount\n    , deductible_amount\n    , total_cost_amount\n    , diagnosis_code_type\n    , diagnosis_code_1\n    , diagnosis_code_2\n    , diagnosis_code_3\n    , diagnosis_code_4\n    , diagnosis_code_5\n    , diagnosis_code_6\n    , diagnosis_code_7\n    , diagnosis_code_8\n    , diagnosis_code_9\n    , diagnosis_code_10\n    , diagnosis_code_11\n    , diagnosis_code_12\n    , diagnosis_code_13\n    , diagnosis_code_14\n    , diagnosis_code_15\n    , diagnosis_code_16\n    , diagnosis_code_17\n    , diagnosis_code_18\n    , diagnosis_code_19\n    , diagnosis_code_20\n    , diagnosis_code_21\n    , diagnosis_code_22\n    , diagnosis_code_23\n    , diagnosis_code_24\n    , diagnosis_code_25\n    , diagnosis_poa_1\n    , diagnosis_poa_2\n    , diagnosis_poa_3\n    , diagnosis_poa_4\n    , diagnosis_poa_5\n    , diagnosis_poa_6\n    , diagnosis_poa_7\n    , diagnosis_poa_8\n    , diagnosis_poa_9\n    , diagnosis_poa_10\n    , diagnosis_poa_11\n    , diagnosis_poa_12\n    , diagnosis_poa_13\n    , diagnosis_poa_14\n    , diagnosis_poa_15\n    , diagnosis_poa_16\n    , diagnosis_poa_17\n    , diagnosis_poa_18\n    , diagnosis_poa_19\n    , diagnosis_poa_20\n    , diagnosis_poa_21\n    , diagnosis_poa_22\n    , diagnosis_poa_23\n    , diagnosis_poa_24\n    , diagnosis_poa_25\n    , procedure_code_type\n    , procedure_code_1\n    , procedure_code_2\n    , procedure_code_3\n    , procedure_code_4\n    , procedure_code_5\n    , procedure_code_6\n    , procedure_code_7\n    , procedure_code_8\n    , procedure_code_9\n    , procedure_code_10\n    , procedure_code_11\n    , procedure_code_12\n    , procedure_code_13\n    , procedure_code_14\n    , procedure_code_15\n    , procedure_code_16\n    , procedure_code_17\n    , procedure_code_18\n    , procedure_code_19\n    , procedure_code_20\n    , procedure_code_21\n    , procedure_code_22\n    , procedure_code_23\n    , procedure_code_24\n    , procedure_code_25\n    , procedure_date_1\n    , procedure_date_2\n    , procedure_date_3\n    , procedure_date_4\n    , procedure_date_5\n    , procedure_date_6\n    , procedure_date_7\n    , procedure_date_8\n    , procedure_date_9\n    , procedure_date_10\n    , procedure_date_11\n    , procedure_date_12\n    , procedure_date_13\n    , procedure_date_14\n    , procedure_date_15\n    , procedure_date_16\n    , procedure_date_17\n    , procedure_date_18\n    , procedure_date_19\n    , procedure_date_20\n    , procedure_date_21\n    , procedure_date_22\n    , procedure_date_23\n    , procedure_date_24\n    , procedure_date_25\n    , in_network_flag\n    , data_source\nfrom tuva.input_layer.medical_claim\n) select\n    claim_id\n    , claim_line_number\n    , data_source\n    , pos.place_of_service_code as normalized_code\n    , pos.place_of_service_description as normalized_description\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom __dbt__cte__normalized_input__stg_medical_claim med\nleft join dev_tom.terminology.place_of_service pos\n    \n        on lpad(med.place_of_service_code, 2, '0') = pos.place_of_service_code\n    \nwhere claim_type = 'professional'", "relation_name": "dev_tom.claims_preprocessing._int_normalized_input_place_of_service_normalize"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.575540Z", "completed_at": "2024-08-23T19:21:33.603649Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.621488Z", "completed_at": "2024-08-23T19:21:33.621492Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.047061920166015625, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.normalized_input__int_present_on_admit_normalize", "compiled": true, "compiled_code": "\n\n\nwith  __dbt__cte__normalized_input__stg_medical_claim as (\n\n\nselect\n      claim_id\n    , claim_line_number\n    , claim_type\n    , patient_id\n    , member_id\n    , payer\n    , plan\n    , claim_start_date\n    , claim_end_date\n    , claim_line_start_date\n    , claim_line_end_date\n    , admission_date\n    , discharge_date\n    , admit_source_code\n    , admit_type_code\n    , discharge_disposition_code\n    , place_of_service_code\n    , bill_type_code\n    , ms_drg_code\n    , apr_drg_code\n    , revenue_center_code\n    , service_unit_quantity\n    , hcpcs_code\n    , hcpcs_modifier_1\n    , hcpcs_modifier_2\n    , hcpcs_modifier_3\n    , hcpcs_modifier_4\n    , hcpcs_modifier_5\n    , rendering_npi\n    , rendering_tin\n    , billing_npi\n    , billing_tin\n    , facility_npi\n    , paid_date\n    , paid_amount\n    , allowed_amount\n    , charge_amount\n    , coinsurance_amount\n    , copayment_amount\n    , deductible_amount\n    , total_cost_amount\n    , diagnosis_code_type\n    , diagnosis_code_1\n    , diagnosis_code_2\n    , diagnosis_code_3\n    , diagnosis_code_4\n    , diagnosis_code_5\n    , diagnosis_code_6\n    , diagnosis_code_7\n    , diagnosis_code_8\n    , diagnosis_code_9\n    , diagnosis_code_10\n    , diagnosis_code_11\n    , diagnosis_code_12\n    , diagnosis_code_13\n    , diagnosis_code_14\n    , diagnosis_code_15\n    , diagnosis_code_16\n    , diagnosis_code_17\n    , diagnosis_code_18\n    , diagnosis_code_19\n    , diagnosis_code_20\n    , diagnosis_code_21\n    , diagnosis_code_22\n    , diagnosis_code_23\n    , diagnosis_code_24\n    , diagnosis_code_25\n    , diagnosis_poa_1\n    , diagnosis_poa_2\n    , diagnosis_poa_3\n    , diagnosis_poa_4\n    , diagnosis_poa_5\n    , diagnosis_poa_6\n    , diagnosis_poa_7\n    , diagnosis_poa_8\n    , diagnosis_poa_9\n    , diagnosis_poa_10\n    , diagnosis_poa_11\n    , diagnosis_poa_12\n    , diagnosis_poa_13\n    , diagnosis_poa_14\n    , diagnosis_poa_15\n    , diagnosis_poa_16\n    , diagnosis_poa_17\n    , diagnosis_poa_18\n    , diagnosis_poa_19\n    , diagnosis_poa_20\n    , diagnosis_poa_21\n    , diagnosis_poa_22\n    , diagnosis_poa_23\n    , diagnosis_poa_24\n    , diagnosis_poa_25\n    , procedure_code_type\n    , procedure_code_1\n    , procedure_code_2\n    , procedure_code_3\n    , procedure_code_4\n    , procedure_code_5\n    , procedure_code_6\n    , procedure_code_7\n    , procedure_code_8\n    , procedure_code_9\n    , procedure_code_10\n    , procedure_code_11\n    , procedure_code_12\n    , procedure_code_13\n    , procedure_code_14\n    , procedure_code_15\n    , procedure_code_16\n    , procedure_code_17\n    , procedure_code_18\n    , procedure_code_19\n    , procedure_code_20\n    , procedure_code_21\n    , procedure_code_22\n    , procedure_code_23\n    , procedure_code_24\n    , procedure_code_25\n    , procedure_date_1\n    , procedure_date_2\n    , procedure_date_3\n    , procedure_date_4\n    , procedure_date_5\n    , procedure_date_6\n    , procedure_date_7\n    , procedure_date_8\n    , procedure_date_9\n    , procedure_date_10\n    , procedure_date_11\n    , procedure_date_12\n    , procedure_date_13\n    , procedure_date_14\n    , procedure_date_15\n    , procedure_date_16\n    , procedure_date_17\n    , procedure_date_18\n    , procedure_date_19\n    , procedure_date_20\n    , procedure_date_21\n    , procedure_date_22\n    , procedure_date_23\n    , procedure_date_24\n    , procedure_date_25\n    , in_network_flag\n    , data_source\nfrom tuva.input_layer.medical_claim\n), pivot_poa as(\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , 'diagnosis_poa_1'  as diagnosis_column\n        ,  diagnosis_poa_1  as present_on_admit_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , 'diagnosis_poa_2'  as diagnosis_column\n        ,  diagnosis_poa_2  as present_on_admit_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , 'diagnosis_poa_3'  as diagnosis_column\n        ,  diagnosis_poa_3  as present_on_admit_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , 'diagnosis_poa_4'  as diagnosis_column\n        ,  diagnosis_poa_4  as present_on_admit_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , 'diagnosis_poa_5'  as diagnosis_column\n        ,  diagnosis_poa_5  as present_on_admit_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , 'diagnosis_poa_6'  as diagnosis_column\n        ,  diagnosis_poa_6  as present_on_admit_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , 'diagnosis_poa_7'  as diagnosis_column\n        ,  diagnosis_poa_7  as present_on_admit_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , 'diagnosis_poa_8'  as diagnosis_column\n        ,  diagnosis_poa_8  as present_on_admit_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , 'diagnosis_poa_9'  as diagnosis_column\n        ,  diagnosis_poa_9  as present_on_admit_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , 'diagnosis_poa_10'  as diagnosis_column\n        ,  diagnosis_poa_10  as present_on_admit_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , 'diagnosis_poa_11'  as diagnosis_column\n        ,  diagnosis_poa_11  as present_on_admit_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , 'diagnosis_poa_12'  as diagnosis_column\n        ,  diagnosis_poa_12  as present_on_admit_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , 'diagnosis_poa_13'  as diagnosis_column\n        ,  diagnosis_poa_13  as present_on_admit_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , 'diagnosis_poa_14'  as diagnosis_column\n        ,  diagnosis_poa_14  as present_on_admit_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , 'diagnosis_poa_15'  as diagnosis_column\n        ,  diagnosis_poa_15  as present_on_admit_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , 'diagnosis_poa_16'  as diagnosis_column\n        ,  diagnosis_poa_16  as present_on_admit_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , 'diagnosis_poa_17'  as diagnosis_column\n        ,  diagnosis_poa_17  as present_on_admit_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , 'diagnosis_poa_18'  as diagnosis_column\n        ,  diagnosis_poa_18  as present_on_admit_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , 'diagnosis_poa_19'  as diagnosis_column\n        ,  diagnosis_poa_19  as present_on_admit_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , 'diagnosis_poa_20'  as diagnosis_column\n        ,  diagnosis_poa_20  as present_on_admit_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , 'diagnosis_poa_21'  as diagnosis_column\n        ,  diagnosis_poa_21  as present_on_admit_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , 'diagnosis_poa_22'  as diagnosis_column\n        ,  diagnosis_poa_22  as present_on_admit_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , 'diagnosis_poa_23'  as diagnosis_column\n        ,  diagnosis_poa_24  as present_on_admit_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , 'diagnosis_poa_24'  as diagnosis_column\n        ,  diagnosis_poa_24  as present_on_admit_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , 'diagnosis_poa_25'  as diagnosis_column\n        ,  diagnosis_poa_25  as present_on_admit_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n)\n\nselect\n    claim_id\n    , data_source\n    , diagnosis_column\n    , poa.present_on_admit_code as normalized_present_on_admit_code\n    , count(*) as present_on_admit_occurrence_count\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom pivot_poa piv\nleft join dev_tom.terminology.present_on_admission poa\n    on replace(piv.present_on_admit_code,'.','') = poa.present_on_admit_code\nwhere claim_type = 'institutional'\ngroup by \n    claim_id\n    , data_source\n    , diagnosis_column\n    , poa.present_on_admit_code", "relation_name": "dev_tom.claims_preprocessing._int_normalized_input_present_on_admit_normalize"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.598333Z", "completed_at": "2024-08-23T19:21:33.628294Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.643648Z", "completed_at": "2024-08-23T19:21:33.643651Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.046298980712890625, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.normalized_input__int_procedure_code_normalize", "compiled": true, "compiled_code": "\n\n\nwith  __dbt__cte__normalized_input__stg_medical_claim as (\n\n\nselect\n      claim_id\n    , claim_line_number\n    , claim_type\n    , patient_id\n    , member_id\n    , payer\n    , plan\n    , claim_start_date\n    , claim_end_date\n    , claim_line_start_date\n    , claim_line_end_date\n    , admission_date\n    , discharge_date\n    , admit_source_code\n    , admit_type_code\n    , discharge_disposition_code\n    , place_of_service_code\n    , bill_type_code\n    , ms_drg_code\n    , apr_drg_code\n    , revenue_center_code\n    , service_unit_quantity\n    , hcpcs_code\n    , hcpcs_modifier_1\n    , hcpcs_modifier_2\n    , hcpcs_modifier_3\n    , hcpcs_modifier_4\n    , hcpcs_modifier_5\n    , rendering_npi\n    , rendering_tin\n    , billing_npi\n    , billing_tin\n    , facility_npi\n    , paid_date\n    , paid_amount\n    , allowed_amount\n    , charge_amount\n    , coinsurance_amount\n    , copayment_amount\n    , deductible_amount\n    , total_cost_amount\n    , diagnosis_code_type\n    , diagnosis_code_1\n    , diagnosis_code_2\n    , diagnosis_code_3\n    , diagnosis_code_4\n    , diagnosis_code_5\n    , diagnosis_code_6\n    , diagnosis_code_7\n    , diagnosis_code_8\n    , diagnosis_code_9\n    , diagnosis_code_10\n    , diagnosis_code_11\n    , diagnosis_code_12\n    , diagnosis_code_13\n    , diagnosis_code_14\n    , diagnosis_code_15\n    , diagnosis_code_16\n    , diagnosis_code_17\n    , diagnosis_code_18\n    , diagnosis_code_19\n    , diagnosis_code_20\n    , diagnosis_code_21\n    , diagnosis_code_22\n    , diagnosis_code_23\n    , diagnosis_code_24\n    , diagnosis_code_25\n    , diagnosis_poa_1\n    , diagnosis_poa_2\n    , diagnosis_poa_3\n    , diagnosis_poa_4\n    , diagnosis_poa_5\n    , diagnosis_poa_6\n    , diagnosis_poa_7\n    , diagnosis_poa_8\n    , diagnosis_poa_9\n    , diagnosis_poa_10\n    , diagnosis_poa_11\n    , diagnosis_poa_12\n    , diagnosis_poa_13\n    , diagnosis_poa_14\n    , diagnosis_poa_15\n    , diagnosis_poa_16\n    , diagnosis_poa_17\n    , diagnosis_poa_18\n    , diagnosis_poa_19\n    , diagnosis_poa_20\n    , diagnosis_poa_21\n    , diagnosis_poa_22\n    , diagnosis_poa_23\n    , diagnosis_poa_24\n    , diagnosis_poa_25\n    , procedure_code_type\n    , procedure_code_1\n    , procedure_code_2\n    , procedure_code_3\n    , procedure_code_4\n    , procedure_code_5\n    , procedure_code_6\n    , procedure_code_7\n    , procedure_code_8\n    , procedure_code_9\n    , procedure_code_10\n    , procedure_code_11\n    , procedure_code_12\n    , procedure_code_13\n    , procedure_code_14\n    , procedure_code_15\n    , procedure_code_16\n    , procedure_code_17\n    , procedure_code_18\n    , procedure_code_19\n    , procedure_code_20\n    , procedure_code_21\n    , procedure_code_22\n    , procedure_code_23\n    , procedure_code_24\n    , procedure_code_25\n    , procedure_date_1\n    , procedure_date_2\n    , procedure_date_3\n    , procedure_date_4\n    , procedure_date_5\n    , procedure_date_6\n    , procedure_date_7\n    , procedure_date_8\n    , procedure_date_9\n    , procedure_date_10\n    , procedure_date_11\n    , procedure_date_12\n    , procedure_date_13\n    , procedure_date_14\n    , procedure_date_15\n    , procedure_date_16\n    , procedure_date_17\n    , procedure_date_18\n    , procedure_date_19\n    , procedure_date_20\n    , procedure_date_21\n    , procedure_date_22\n    , procedure_date_23\n    , procedure_date_24\n    , procedure_date_25\n    , in_network_flag\n    , data_source\nfrom tuva.input_layer.medical_claim\n), pivot_procedure as(\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , procedure_code_type\n        , 'procedure_code_1'  as procedure_column\n        ,  procedure_code_1  as procedure_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , procedure_code_type\n        , 'procedure_code_2'  as procedure_column\n        ,  procedure_code_2  as procedure_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , procedure_code_type\n        , 'procedure_code_3'  as procedure_column\n        ,  procedure_code_3  as procedure_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , procedure_code_type\n        , 'procedure_code_4'  as procedure_column\n        ,  procedure_code_4  as procedure_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , procedure_code_type\n        , 'procedure_code_5'  as procedure_column\n        ,  procedure_code_5  as procedure_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , procedure_code_type\n        , 'procedure_code_6'  as procedure_column\n        ,  procedure_code_6  as procedure_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , procedure_code_type\n        , 'procedure_code_7'  as procedure_column\n        ,  procedure_code_7  as procedure_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , procedure_code_type\n        , 'procedure_code_8'  as procedure_column\n        ,  procedure_code_8  as procedure_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , procedure_code_type\n        , 'procedure_code_9'  as procedure_column\n        ,  procedure_code_9  as procedure_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , procedure_code_type\n        , 'procedure_code_10'  as procedure_column\n        ,  procedure_code_10  as procedure_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , procedure_code_type\n        , 'procedure_code_11'  as procedure_column\n        ,  procedure_code_11  as procedure_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , procedure_code_type\n        , 'procedure_code_12'  as procedure_column\n        ,  procedure_code_12  as procedure_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , procedure_code_type\n        , 'procedure_code_13'  as procedure_column\n        ,  procedure_code_13  as procedure_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , procedure_code_type\n        , 'procedure_code_14'  as procedure_column\n        ,  procedure_code_14  as procedure_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , procedure_code_type\n        , 'procedure_code_15'  as procedure_column\n        ,  procedure_code_15  as procedure_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , procedure_code_type\n        , 'procedure_code_16'  as procedure_column\n        ,  procedure_code_16  as procedure_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , procedure_code_type\n        , 'procedure_code_17'  as procedure_column\n        ,  procedure_code_17  as procedure_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , procedure_code_type\n        , 'procedure_code_18'  as procedure_column\n        ,  procedure_code_18  as procedure_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , procedure_code_type\n        , 'procedure_code_19'  as procedure_column\n        ,  procedure_code_19  as procedure_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , procedure_code_type\n        , 'procedure_code_20'  as procedure_column\n        ,  procedure_code_20  as procedure_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , procedure_code_type\n        , 'procedure_code_21'  as procedure_column\n        ,  procedure_code_21  as procedure_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , procedure_code_type\n        , 'procedure_code_22'  as procedure_column\n        ,  procedure_code_22  as procedure_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , procedure_code_type\n        , 'procedure_code_23'  as procedure_column\n        ,  procedure_code_24  as procedure_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , procedure_code_type\n        , 'procedure_code_24'  as procedure_column\n        ,  procedure_code_24  as procedure_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , procedure_code_type\n        , 'procedure_code_25'  as procedure_column\n        ,  procedure_code_25  as procedure_code\n    from __dbt__cte__normalized_input__stg_medical_claim\n)\n\nselect\n    claim_id\n    , data_source\n    , procedure_code_type\n    , procedure_column\n    , coalesce(icd_9.icd_9_pcs,icd_10.icd_10_pcs) as normalized_procedure_code\n    , count(*) as procedure_code_occurrence_count\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom pivot_procedure piv\nleft join dev_tom.terminology.icd_10_pcs icd_10\n    on replace(piv.procedure_code,'.','') = icd_10.icd_10_pcs\n    and piv.procedure_code_type = 'icd-10-pcs'\nleft join dev_tom.terminology.icd_9_pcs icd_9\n    on replace(piv.procedure_code,'.','') = icd_9.icd_9_pcs\n    and piv.procedure_code_type = 'icd-9-pcs'\nwhere claim_type = 'institutional'\ngroup by \n    claim_id\n    , data_source\n    , procedure_code_type\n    , procedure_column\n    , coalesce(icd_9.icd_9_pcs,icd_10.icd_10_pcs)", "relation_name": "dev_tom.claims_preprocessing._int_normalized_input_procedure_code_normalize"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.622227Z", "completed_at": "2024-08-23T19:21:33.647606Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.648025Z", "completed_at": "2024-08-23T19:21:33.648029Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.0267791748046875, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.normalized_input__int_procedure_date_normalize", "compiled": true, "compiled_code": "\n\n\nwith  __dbt__cte__normalized_input__stg_medical_claim as (\n\n\nselect\n      claim_id\n    , claim_line_number\n    , claim_type\n    , patient_id\n    , member_id\n    , payer\n    , plan\n    , claim_start_date\n    , claim_end_date\n    , claim_line_start_date\n    , claim_line_end_date\n    , admission_date\n    , discharge_date\n    , admit_source_code\n    , admit_type_code\n    , discharge_disposition_code\n    , place_of_service_code\n    , bill_type_code\n    , ms_drg_code\n    , apr_drg_code\n    , revenue_center_code\n    , service_unit_quantity\n    , hcpcs_code\n    , hcpcs_modifier_1\n    , hcpcs_modifier_2\n    , hcpcs_modifier_3\n    , hcpcs_modifier_4\n    , hcpcs_modifier_5\n    , rendering_npi\n    , rendering_tin\n    , billing_npi\n    , billing_tin\n    , facility_npi\n    , paid_date\n    , paid_amount\n    , allowed_amount\n    , charge_amount\n    , coinsurance_amount\n    , copayment_amount\n    , deductible_amount\n    , total_cost_amount\n    , diagnosis_code_type\n    , diagnosis_code_1\n    , diagnosis_code_2\n    , diagnosis_code_3\n    , diagnosis_code_4\n    , diagnosis_code_5\n    , diagnosis_code_6\n    , diagnosis_code_7\n    , diagnosis_code_8\n    , diagnosis_code_9\n    , diagnosis_code_10\n    , diagnosis_code_11\n    , diagnosis_code_12\n    , diagnosis_code_13\n    , diagnosis_code_14\n    , diagnosis_code_15\n    , diagnosis_code_16\n    , diagnosis_code_17\n    , diagnosis_code_18\n    , diagnosis_code_19\n    , diagnosis_code_20\n    , diagnosis_code_21\n    , diagnosis_code_22\n    , diagnosis_code_23\n    , diagnosis_code_24\n    , diagnosis_code_25\n    , diagnosis_poa_1\n    , diagnosis_poa_2\n    , diagnosis_poa_3\n    , diagnosis_poa_4\n    , diagnosis_poa_5\n    , diagnosis_poa_6\n    , diagnosis_poa_7\n    , diagnosis_poa_8\n    , diagnosis_poa_9\n    , diagnosis_poa_10\n    , diagnosis_poa_11\n    , diagnosis_poa_12\n    , diagnosis_poa_13\n    , diagnosis_poa_14\n    , diagnosis_poa_15\n    , diagnosis_poa_16\n    , diagnosis_poa_17\n    , diagnosis_poa_18\n    , diagnosis_poa_19\n    , diagnosis_poa_20\n    , diagnosis_poa_21\n    , diagnosis_poa_22\n    , diagnosis_poa_23\n    , diagnosis_poa_24\n    , diagnosis_poa_25\n    , procedure_code_type\n    , procedure_code_1\n    , procedure_code_2\n    , procedure_code_3\n    , procedure_code_4\n    , procedure_code_5\n    , procedure_code_6\n    , procedure_code_7\n    , procedure_code_8\n    , procedure_code_9\n    , procedure_code_10\n    , procedure_code_11\n    , procedure_code_12\n    , procedure_code_13\n    , procedure_code_14\n    , procedure_code_15\n    , procedure_code_16\n    , procedure_code_17\n    , procedure_code_18\n    , procedure_code_19\n    , procedure_code_20\n    , procedure_code_21\n    , procedure_code_22\n    , procedure_code_23\n    , procedure_code_24\n    , procedure_code_25\n    , procedure_date_1\n    , procedure_date_2\n    , procedure_date_3\n    , procedure_date_4\n    , procedure_date_5\n    , procedure_date_6\n    , procedure_date_7\n    , procedure_date_8\n    , procedure_date_9\n    , procedure_date_10\n    , procedure_date_11\n    , procedure_date_12\n    , procedure_date_13\n    , procedure_date_14\n    , procedure_date_15\n    , procedure_date_16\n    , procedure_date_17\n    , procedure_date_18\n    , procedure_date_19\n    , procedure_date_20\n    , procedure_date_21\n    , procedure_date_22\n    , procedure_date_23\n    , procedure_date_24\n    , procedure_date_25\n    , in_network_flag\n    , data_source\nfrom tuva.input_layer.medical_claim\n), pivot_procedure as(\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , 'procedure_date_1'  as procedure_column\n        ,  procedure_date_1  as procedure_date\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , 'procedure_date_2'  as procedure_column\n        ,  procedure_date_2  as procedure_date\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , 'procedure_date_3'  as procedure_column\n        ,  procedure_date_3  as procedure_date\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , 'procedure_date_4'  as procedure_column\n        ,  procedure_date_4  as procedure_date\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , 'procedure_date_5'  as procedure_column\n        ,  procedure_date_5  as procedure_date\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , 'procedure_date_6'  as procedure_column\n        ,  procedure_date_6  as procedure_date\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , 'procedure_date_7'  as procedure_column\n        ,  procedure_date_7  as procedure_date\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , 'procedure_date_8'  as procedure_column\n        ,  procedure_date_8  as procedure_date\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , 'procedure_date_9'  as procedure_column\n        ,  procedure_date_9  as procedure_date\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , 'procedure_date_10'  as procedure_column\n        ,  procedure_date_10  as procedure_date\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , 'procedure_date_11'  as procedure_column\n        ,  procedure_date_11  as procedure_date\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , 'procedure_date_12'  as procedure_column\n        ,  procedure_date_12  as procedure_date\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , 'procedure_date_13'  as procedure_column\n        ,  procedure_date_13  as procedure_date\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , 'procedure_date_14'  as procedure_column\n        ,  procedure_date_14  as procedure_date\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , 'procedure_date_15'  as procedure_column\n        ,  procedure_date_15  as procedure_date\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , 'procedure_date_16'  as procedure_column\n        ,  procedure_date_16  as procedure_date\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , 'procedure_date_17'  as procedure_column\n        ,  procedure_date_17  as procedure_date\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , 'procedure_date_18'  as procedure_column\n        ,  procedure_date_18  as procedure_date\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , 'procedure_date_19'  as procedure_column\n        ,  procedure_date_19  as procedure_date\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , 'procedure_date_20'  as procedure_column\n        ,  procedure_date_20  as procedure_date\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , 'procedure_date_21'  as procedure_column\n        ,  procedure_date_21  as procedure_date\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , 'procedure_date_22'  as procedure_column\n        ,  procedure_date_22  as procedure_date\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , 'procedure_date_23'  as procedure_column\n        ,  procedure_date_24  as procedure_date\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , 'procedure_date_24'  as procedure_column\n        ,  procedure_date_24  as procedure_date\n    from __dbt__cte__normalized_input__stg_medical_claim\n\n    union all\n\n    select\n        claim_id\n        , claim_type\n        , data_source\n        , 'procedure_date_25'  as procedure_column\n        ,  procedure_date_25  as procedure_date\n    from __dbt__cte__normalized_input__stg_medical_claim\n)\n\nselect\n    claim_id\n    , data_source\n    , procedure_column\n    , cal.full_date as procedure_date\n    , count(*) as procedure_date_occurrence_count\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom pivot_procedure piv\nleft join dev_tom.reference_data.calendar cal\n    on piv.procedure_date = cal.full_date\nwhere claim_type = 'institutional'\ngroup by \n    claim_id\n    , data_source\n    , procedure_column\n    , cal.full_date", "relation_name": "dev_tom.claims_preprocessing._int_normalized_input_procedure_date_normalize"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.644337Z", "completed_at": "2024-08-23T19:21:33.648471Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.669108Z", "completed_at": "2024-08-23T19:21:33.669111Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.025683879852294922, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.normalized_input__int_revenue_center_normalize", "compiled": true, "compiled_code": "\n\n\nwith __dbt__cte__normalized_input__stg_medical_claim as (\n\n\nselect\n      claim_id\n    , claim_line_number\n    , claim_type\n    , patient_id\n    , member_id\n    , payer\n    , plan\n    , claim_start_date\n    , claim_end_date\n    , claim_line_start_date\n    , claim_line_end_date\n    , admission_date\n    , discharge_date\n    , admit_source_code\n    , admit_type_code\n    , discharge_disposition_code\n    , place_of_service_code\n    , bill_type_code\n    , ms_drg_code\n    , apr_drg_code\n    , revenue_center_code\n    , service_unit_quantity\n    , hcpcs_code\n    , hcpcs_modifier_1\n    , hcpcs_modifier_2\n    , hcpcs_modifier_3\n    , hcpcs_modifier_4\n    , hcpcs_modifier_5\n    , rendering_npi\n    , rendering_tin\n    , billing_npi\n    , billing_tin\n    , facility_npi\n    , paid_date\n    , paid_amount\n    , allowed_amount\n    , charge_amount\n    , coinsurance_amount\n    , copayment_amount\n    , deductible_amount\n    , total_cost_amount\n    , diagnosis_code_type\n    , diagnosis_code_1\n    , diagnosis_code_2\n    , diagnosis_code_3\n    , diagnosis_code_4\n    , diagnosis_code_5\n    , diagnosis_code_6\n    , diagnosis_code_7\n    , diagnosis_code_8\n    , diagnosis_code_9\n    , diagnosis_code_10\n    , diagnosis_code_11\n    , diagnosis_code_12\n    , diagnosis_code_13\n    , diagnosis_code_14\n    , diagnosis_code_15\n    , diagnosis_code_16\n    , diagnosis_code_17\n    , diagnosis_code_18\n    , diagnosis_code_19\n    , diagnosis_code_20\n    , diagnosis_code_21\n    , diagnosis_code_22\n    , diagnosis_code_23\n    , diagnosis_code_24\n    , diagnosis_code_25\n    , diagnosis_poa_1\n    , diagnosis_poa_2\n    , diagnosis_poa_3\n    , diagnosis_poa_4\n    , diagnosis_poa_5\n    , diagnosis_poa_6\n    , diagnosis_poa_7\n    , diagnosis_poa_8\n    , diagnosis_poa_9\n    , diagnosis_poa_10\n    , diagnosis_poa_11\n    , diagnosis_poa_12\n    , diagnosis_poa_13\n    , diagnosis_poa_14\n    , diagnosis_poa_15\n    , diagnosis_poa_16\n    , diagnosis_poa_17\n    , diagnosis_poa_18\n    , diagnosis_poa_19\n    , diagnosis_poa_20\n    , diagnosis_poa_21\n    , diagnosis_poa_22\n    , diagnosis_poa_23\n    , diagnosis_poa_24\n    , diagnosis_poa_25\n    , procedure_code_type\n    , procedure_code_1\n    , procedure_code_2\n    , procedure_code_3\n    , procedure_code_4\n    , procedure_code_5\n    , procedure_code_6\n    , procedure_code_7\n    , procedure_code_8\n    , procedure_code_9\n    , procedure_code_10\n    , procedure_code_11\n    , procedure_code_12\n    , procedure_code_13\n    , procedure_code_14\n    , procedure_code_15\n    , procedure_code_16\n    , procedure_code_17\n    , procedure_code_18\n    , procedure_code_19\n    , procedure_code_20\n    , procedure_code_21\n    , procedure_code_22\n    , procedure_code_23\n    , procedure_code_24\n    , procedure_code_25\n    , procedure_date_1\n    , procedure_date_2\n    , procedure_date_3\n    , procedure_date_4\n    , procedure_date_5\n    , procedure_date_6\n    , procedure_date_7\n    , procedure_date_8\n    , procedure_date_9\n    , procedure_date_10\n    , procedure_date_11\n    , procedure_date_12\n    , procedure_date_13\n    , procedure_date_14\n    , procedure_date_15\n    , procedure_date_16\n    , procedure_date_17\n    , procedure_date_18\n    , procedure_date_19\n    , procedure_date_20\n    , procedure_date_21\n    , procedure_date_22\n    , procedure_date_23\n    , procedure_date_24\n    , procedure_date_25\n    , in_network_flag\n    , data_source\nfrom tuva.input_layer.medical_claim\n) select\n    claim_id\n    , claim_line_number\n    , data_source\n    , rev.revenue_center_code as normalized_code\n    , rev.revenue_center_description as normalized_description\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom __dbt__cte__normalized_input__stg_medical_claim med\nleft join dev_tom.terminology.revenue_center rev\n    \n        on lpad(med.revenue_center_code, 4, '0') = rev.revenue_center_code\n    \nwhere claim_type = 'institutional'", "relation_name": "dev_tom.claims_preprocessing._int_normalized_input_revenue_center_normalize"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.648854Z", "completed_at": "2024-08-23T19:21:33.670128Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.683247Z", "completed_at": "2024-08-23T19:21:33.683251Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.03548574447631836, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.normalized_input__int_undetermined_claim_type", "compiled": true, "compiled_code": "\n\n\nwith __dbt__cte__normalized_input__stg_medical_claim as (\n\n\nselect\n      claim_id\n    , claim_line_number\n    , claim_type\n    , patient_id\n    , member_id\n    , payer\n    , plan\n    , claim_start_date\n    , claim_end_date\n    , claim_line_start_date\n    , claim_line_end_date\n    , admission_date\n    , discharge_date\n    , admit_source_code\n    , admit_type_code\n    , discharge_disposition_code\n    , place_of_service_code\n    , bill_type_code\n    , ms_drg_code\n    , apr_drg_code\n    , revenue_center_code\n    , service_unit_quantity\n    , hcpcs_code\n    , hcpcs_modifier_1\n    , hcpcs_modifier_2\n    , hcpcs_modifier_3\n    , hcpcs_modifier_4\n    , hcpcs_modifier_5\n    , rendering_npi\n    , rendering_tin\n    , billing_npi\n    , billing_tin\n    , facility_npi\n    , paid_date\n    , paid_amount\n    , allowed_amount\n    , charge_amount\n    , coinsurance_amount\n    , copayment_amount\n    , deductible_amount\n    , total_cost_amount\n    , diagnosis_code_type\n    , diagnosis_code_1\n    , diagnosis_code_2\n    , diagnosis_code_3\n    , diagnosis_code_4\n    , diagnosis_code_5\n    , diagnosis_code_6\n    , diagnosis_code_7\n    , diagnosis_code_8\n    , diagnosis_code_9\n    , diagnosis_code_10\n    , diagnosis_code_11\n    , diagnosis_code_12\n    , diagnosis_code_13\n    , diagnosis_code_14\n    , diagnosis_code_15\n    , diagnosis_code_16\n    , diagnosis_code_17\n    , diagnosis_code_18\n    , diagnosis_code_19\n    , diagnosis_code_20\n    , diagnosis_code_21\n    , diagnosis_code_22\n    , diagnosis_code_23\n    , diagnosis_code_24\n    , diagnosis_code_25\n    , diagnosis_poa_1\n    , diagnosis_poa_2\n    , diagnosis_poa_3\n    , diagnosis_poa_4\n    , diagnosis_poa_5\n    , diagnosis_poa_6\n    , diagnosis_poa_7\n    , diagnosis_poa_8\n    , diagnosis_poa_9\n    , diagnosis_poa_10\n    , diagnosis_poa_11\n    , diagnosis_poa_12\n    , diagnosis_poa_13\n    , diagnosis_poa_14\n    , diagnosis_poa_15\n    , diagnosis_poa_16\n    , diagnosis_poa_17\n    , diagnosis_poa_18\n    , diagnosis_poa_19\n    , diagnosis_poa_20\n    , diagnosis_poa_21\n    , diagnosis_poa_22\n    , diagnosis_poa_23\n    , diagnosis_poa_24\n    , diagnosis_poa_25\n    , procedure_code_type\n    , procedure_code_1\n    , procedure_code_2\n    , procedure_code_3\n    , procedure_code_4\n    , procedure_code_5\n    , procedure_code_6\n    , procedure_code_7\n    , procedure_code_8\n    , procedure_code_9\n    , procedure_code_10\n    , procedure_code_11\n    , procedure_code_12\n    , procedure_code_13\n    , procedure_code_14\n    , procedure_code_15\n    , procedure_code_16\n    , procedure_code_17\n    , procedure_code_18\n    , procedure_code_19\n    , procedure_code_20\n    , procedure_code_21\n    , procedure_code_22\n    , procedure_code_23\n    , procedure_code_24\n    , procedure_code_25\n    , procedure_date_1\n    , procedure_date_2\n    , procedure_date_3\n    , procedure_date_4\n    , procedure_date_5\n    , procedure_date_6\n    , procedure_date_7\n    , procedure_date_8\n    , procedure_date_9\n    , procedure_date_10\n    , procedure_date_11\n    , procedure_date_12\n    , procedure_date_13\n    , procedure_date_14\n    , procedure_date_15\n    , procedure_date_16\n    , procedure_date_17\n    , procedure_date_18\n    , procedure_date_19\n    , procedure_date_20\n    , procedure_date_21\n    , procedure_date_22\n    , procedure_date_23\n    , procedure_date_24\n    , procedure_date_25\n    , in_network_flag\n    , data_source\nfrom tuva.input_layer.medical_claim\n) select\n    claim_id\n    , claim_line_number\n    , claim_type\n    , patient_id\n    , member_id\n    , payer\n    , plan\n    , claim_start_date\n    , claim_end_date\n    , claim_line_start_date\n    , claim_line_end_date\n    , admission_date\n    , discharge_date\n    , ad_src.admit_source_code\n    , ad_src.admit_source_description\n    , ad_type.admit_type_code\n    , ad_type.admit_type_description\n    , dis.discharge_disposition_code\n    , dis.discharge_disposition_description\n    , pos.place_of_service_code\n    , pos.place_of_service_description\n    , tob.bill_type_code\n    , tob.bill_type_description\n    , msdrg.ms_drg_code\n    , msdrg.ms_drg_description\n    , aprdrg.apr_drg_code\n    , aprdrg.apr_drg_description\n    , rev.revenue_center_code\n    , rev.revenue_center_description\n    , service_unit_quantity\n    , hcpcs_code\n    , hcpcs_modifier_1\n    , hcpcs_modifier_2\n    , hcpcs_modifier_3\n    , hcpcs_modifier_4\n    , hcpcs_modifier_5\n    , rendering_npi\n    , rendnpi.npi as rendering_name\n    , billing_npi\n    , billnpi.npi as billing_name\n    , facility_npi\n    , facnpi.npi as facility_name\n    , paid_date\n    , paid_amount\n    , allowed_amount\n    , charge_amount\n    , coinsurance_amount\n    , copayment_amount\n    , deductible_amount\n    , total_cost_amount\n    , diagnosis_code_type\n    , diagnosis_code_1\n    , diagnosis_code_2\n    , diagnosis_code_3\n    , diagnosis_code_4\n    , diagnosis_code_5\n    , diagnosis_code_6\n    , diagnosis_code_7\n    , diagnosis_code_8\n    , diagnosis_code_9\n    , diagnosis_code_10\n    , diagnosis_code_11\n    , diagnosis_code_12\n    , diagnosis_code_13\n    , diagnosis_code_14\n    , diagnosis_code_15\n    , diagnosis_code_16\n    , diagnosis_code_17\n    , diagnosis_code_18\n    , diagnosis_code_19\n    , diagnosis_code_20\n    , diagnosis_code_21\n    , diagnosis_code_22\n    , diagnosis_code_23\n    , diagnosis_code_24\n    , diagnosis_code_25\n    , diagnosis_poa_1\n    , diagnosis_poa_2\n    , diagnosis_poa_3\n    , diagnosis_poa_4\n    , diagnosis_poa_5\n    , diagnosis_poa_6\n    , diagnosis_poa_7\n    , diagnosis_poa_8\n    , diagnosis_poa_9\n    , diagnosis_poa_10\n    , diagnosis_poa_11\n    , diagnosis_poa_12\n    , diagnosis_poa_13\n    , diagnosis_poa_14\n    , diagnosis_poa_15\n    , diagnosis_poa_16\n    , diagnosis_poa_17\n    , diagnosis_poa_18\n    , diagnosis_poa_19\n    , diagnosis_poa_20\n    , diagnosis_poa_21\n    , diagnosis_poa_22\n    , diagnosis_poa_23\n    , diagnosis_poa_24\n    , diagnosis_poa_25\n    , procedure_code_type\n    , procedure_code_1\n    , procedure_code_2\n    , procedure_code_3\n    , procedure_code_4\n    , procedure_code_5\n    , procedure_code_6\n    , procedure_code_7\n    , procedure_code_8\n    , procedure_code_9\n    , procedure_code_10\n    , procedure_code_11\n    , procedure_code_12\n    , procedure_code_13\n    , procedure_code_14\n    , procedure_code_15\n    , procedure_code_16\n    , procedure_code_17\n    , procedure_code_18\n    , procedure_code_19\n    , procedure_code_20\n    , procedure_code_21\n    , procedure_code_22\n    , procedure_code_23\n    , procedure_code_24\n    , procedure_code_25\n    , procedure_date_1\n    , procedure_date_2\n    , procedure_date_3\n    , procedure_date_4\n    , procedure_date_5\n    , procedure_date_6\n    , procedure_date_7\n    , procedure_date_8\n    , procedure_date_9\n    , procedure_date_10\n    , procedure_date_11\n    , procedure_date_12\n    , procedure_date_13\n    , procedure_date_14\n    , procedure_date_15\n    , procedure_date_16\n    , procedure_date_17\n    , procedure_date_18\n    , procedure_date_19\n    , procedure_date_20\n    , procedure_date_21\n    , procedure_date_22\n    , procedure_date_23\n    , procedure_date_24\n    , procedure_date_25\n    , data_source\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom __dbt__cte__normalized_input__stg_medical_claim med\nleft join dev_tom.terminology.admit_source ad_src\n    on med.admit_source_code = ad_src.admit_source_code\nleft join dev_tom.terminology.admit_type ad_type\n    on med.admit_type_code = ad_type.admit_type_code\nleft join dev_tom.terminology.discharge_disposition dis\n    on med.discharge_disposition_code = dis.discharge_disposition_code\nleft join dev_tom.terminology.place_of_service pos\n    on med.place_of_service_code = pos.place_of_service_code\nleft join dev_tom.terminology.bill_type tob\n    on med.bill_type_code = tob.bill_type_code\nleft join dev_tom.terminology.ms_drg msdrg\n    on med.ms_drg_code = msdrg.ms_drg_code\nleft join dev_tom.terminology.apr_drg aprdrg\n    on med.apr_drg_code = aprdrg.apr_drg_code\nleft join dev_tom.terminology.revenue_center rev\n    on med.revenue_center_code = rev.revenue_center_code\nleft join dev_tom.terminology.provider rendnpi\n    on med.rendering_npi = rendnpi.npi\nleft join dev_tom.terminology.provider billnpi\n    on med.billing_npi = billnpi.npi\nleft join dev_tom.terminology.provider facnpi\n    on med.facility_npi = facnpi.npi\nwhere claim_type in ('undetermined')", "relation_name": "dev_tom.claims_preprocessing._int_normalized_input_undetermined_claim_type"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.670302Z", "completed_at": "2024-08-23T19:21:33.699436Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.700155Z", "completed_at": "2024-08-23T19:21:33.700158Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.03082132339477539, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.normalized_input__pharmacy_claim", "compiled": true, "compiled_code": "\n\n\nwith __dbt__cte__normalized_input__stg_pharmacy_claim as (\n\n\n\nselect\n      claim_id\n    , claim_line_number\n    , patient_id\n    , member_id\n    , payer\n    , plan\n    , prescribing_provider_npi\n    , dispensing_provider_npi\n    , dispensing_date\n    , ndc_code\n    , quantity\n    , days_supply\n    , refills\n    , paid_date\n    , paid_amount\n    , allowed_amount\n    , charge_amount\n    , coinsurance_amount\n    , copayment_amount\n    , deductible_amount\n    , in_network_flag\n    , data_source\n    , file_name\n    , ingest_datetime\nfrom tuva.input_layer.pharmacy_claim\n) select\n      cast(claim_id as TEXT ) as claim_id\n    , cast(claim_line_number as int ) as claim_line_number\n    , cast(patient_id as TEXT ) as patient_id\n    , cast(member_id as TEXT ) as member_id\n    , cast(payer as TEXT ) as payer\n    , cast(plan as TEXT ) as plan\n    , cast(prescribing_provider_npi as TEXT ) as prescribing_provider_id\n    , cast(coalesce(pres.provider_last_name || ', ' || pres.provider_first_name, pres.provider_organization_name) as TEXT ) as prescribing_provider_name\n    , cast(dispensing_provider_npi as TEXT ) as dispensing_provider_id\n    , cast(coalesce(disp.provider_last_name || ', ' || disp.provider_first_name, disp.provider_organization_name) as TEXT ) as dispensing_provider_name    , cast(dispensing_date as date ) as dispensing_date\n    , cast(ndc_code as TEXT ) as ndc_code\n    , cast(ndc.fda_description as TEXT ) as ndc_description\n    , cast(quantity as int ) as quantity\n    , cast(days_supply as int ) as days_supply\n    , cast(refills as int ) as refills\n    , cast(paid_date as date ) as paid_date\n    , cast(paid_amount as numeric(28,6) ) as paid_amount\n    , cast(allowed_amount as numeric(28,6) ) as allowed_amount\n    , cast(charge_amount as numeric(28,6) ) as charge_amount\n    , cast(coinsurance_amount as numeric(28,6) ) as coinsurance_amount\n    , cast(copayment_amount as numeric(28,6) ) as copayment_amount\n    , cast(deductible_amount as numeric(28,6) ) as deductible_amount\n    , cast(in_network_flag as int ) as in_network_flag\n    , cast(data_source as TEXT ) as data_source\n    , cast('2024-08-23 19:21:27.787896+00:00' as TEXT ) as tuva_last_run\nfrom __dbt__cte__normalized_input__stg_pharmacy_claim pharm\nleft join dev_tom.terminology.provider pres\n      on pharm.prescribing_provider_npi = pres.npi\nleft join dev_tom.terminology.provider disp\n      on pharm.dispensing_provider_npi = disp.npi\nleft join dev_tom.terminology.ndc ndc\n      on pharm.ndc_code = ndc.ndc", "relation_name": "dev_tom.claims_preprocessing.normalized_input_pharmacy_claim"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.683537Z", "completed_at": "2024-08-23T19:21:33.701183Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.701936Z", "completed_at": "2024-08-23T19:21:33.701939Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.03200101852416992, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.hcc_suspecting__int_prep_egfr_labs", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__hcc_suspecting__stg_core__lab_result as (\n\n\nselect\n      lab_result_id\n    , patient_id\n    , lower(coalesce(normalized_code_type,source_code_type)) as code_type\n    , coalesce(normalized_code,source_code) as code\n    , status\n    , result\n    , result_date\n    , data_source\nfrom dev_tom.core.lab_result\n\n\n), lab_result as (\n\n    select\n          patient_id\n        , data_source\n        , code_type\n        , code\n        , status\n        , result\n        , result_date\n    from __dbt__cte__hcc_suspecting__stg_core__lab_result\n\n)\n\n, seed_egfr_codes as (\n\n    select\n          concept_name\n        , code\n        , code_system\n    from dev_tom.hcc_suspecting._value_set_clinical_concepts\n    where lower(concept_name) = 'estimated glomerular filtration rate'\n\n)\n\n, egfr_labs as (\n\n    select distinct\n          lab_result.patient_id\n        , lab_result.data_source\n        , lab_result.code_type\n        , lab_result.code\n        , lab_result.result_date\n        , lab_result.result\n    from lab_result\n        inner join seed_egfr_codes\n        on lab_result.code = seed_egfr_codes.code\n        and lab_result.code_type = seed_egfr_codes.code_system\n    where lab_result.result is not null\n    and lower(lab_result.status) not in ('cancelled', 'entered-in-error')\n\n)\n\n, numeric_egfr_labs as (\n\n    select\n          patient_id\n        , data_source\n        , code_type\n        , code\n        , result_date\n        , cast(result as numeric(28,6)) as result\n    from egfr_labs\n   \n        where regexp_like(result, '^[+-]?([0-9]*[.])?[0-9]+$')\n    \n\n)\n\n, clean_non_numeric_egfr_labs as (\n\n    select\n          patient_id\n        , data_source\n        , code_type\n        , code\n        , result_date\n        , result\n        , cast(case\n            when lower(result) like '%unsatisfactory specimen%' then null\n            when result like '%>%' then null\n            when result like '%<%' then null\n            when result like '%@%' then trim(replace(result,'@',''))\n            when result like '%mL/min/1.73m2%' then trim(replace(result,'mL/min/1.73m2',''))\n            else null\n          end as numeric(28,6)) as clean_result\n    from egfr_labs\n    \n        where regexp_like(result, '^[+-]?([0-9]*[.])?[0-9]+$') = False\n    \n\n)\n\n, unioned_labs as (\n\n    select\n          patient_id\n        , data_source\n        , code_type\n        , code\n        , result_date\n        , result\n    from numeric_egfr_labs\n\n    union all\n\n    select\n          patient_id\n        , data_source\n        , code_type\n        , code\n        , result_date\n        , clean_result as result\n    from clean_non_numeric_egfr_labs\n    where clean_result is not null\n\n)\n\n, add_data_types as (\n\n    select\n          cast(patient_id as TEXT) as patient_id\n        , cast(data_source as TEXT) as data_source\n        , cast(code_type as TEXT) as code_type\n        , cast(code as TEXT) as code\n        , cast(result_date as date) as result_date\n        , cast(result as numeric(28,6)) as result\n    from unioned_labs\n\n)\n\nselect\n      patient_id\n    , data_source\n    , code_type\n    , code\n    , result_date\n    , result\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.hcc_suspecting._int_prep_egfr_labs"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.702214Z", "completed_at": "2024-08-23T19:21:33.710362Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.711000Z", "completed_at": "2024-08-23T19:21:33.711003Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.011096954345703125, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__data_quality_clinical_for_pbi", "compiled": true, "compiled_code": "\n\nWITH Ranked_Examples as (\n       SELECT\n              summary_sk,\n              data_source,\n              table_name,\n              field_name,\n              bucket_name,\n              invalid_reason,\n              drill_down_key,\n              drill_down_value as drill_down_value,\n              field_value as field_value,\n              count(drill_down_value) as frequency,\n              row_number() over (partition by summary_sk, bucket_name, field_value order by field_value) as rn\n              , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\n       FROM dev_tom.data_quality.data_quality_clinical_detail\n       where bucket_name not in ('valid', 'null')\n       group by\n              data_source,\n              field_name,\n              table_name,\n              bucket_name,\n              field_value,\n              drill_down_key,\n              drill_down_value,\n              invalid_reason,\n              summary_sk\n\n),\n\npk_examples as (\n       SELECT\n              detail.summary_sk,\n              detail.data_source,\n              detail.table_name,\n              detail.field_name,\n              detail.bucket_name,\n              detail.invalid_reason,\n              detail.drill_down_key,\n              detail.drill_down_value as drill_down_value,\n              detail.field_value as field_value,\n              count(detail.drill_down_value) as frequency,\n              row_number() over (partition by detail.summary_sk order by detail.summary_sk) as rn\n              , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\n       from dev_tom.data_quality.data_quality_clinical_detail as detail\n              left join dev_tom.data_quality._value_set_crosswalk_field_info as field_info on detail.table_name = field_info.input_layer_table_name\n                     and detail.field_name = field_info.field_name\n       where detail.bucket_name = 'valid'\n              and field_info.unique_values_expected_flag = 1\n       GROUP BY\n              detail.data_source,\n              detail.field_name,\n              detail.table_name,\n              detail.bucket_name,\n              detail.field_value,\n              detail.drill_down_key,\n              detail.drill_down_value,\n              detail.invalid_reason,\n              detail.summary_sk\n\n)\n--- Null Values\n\nSELECT\n       summary_sk,\n       data_source,\n       table_name,\n       field_name,\n       bucket_name,\n       invalid_reason,\n       drill_down_key,\n       max(drill_down_value) as drill_down_value,\n       null as field_value,\n       count(drill_down_value) as frequency\n       , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.data_quality.data_quality_clinical_detail\nwhere bucket_name = 'null'\ngroup by\n       data_source,\n       field_name,\n       table_name,\n       bucket_name,\n       invalid_reason,\n       drill_down_key,\n       summary_sk\n\nunion all\n\n--- Valid Values except PKs\n\nSELECT\n       detail.summary_sk,\n       detail.data_source,\n       detail.table_name,\n       detail.field_name,\n       detail.bucket_name,\n       detail.invalid_reason,\n       detail.drill_down_key,\n       max(detail.drill_down_value) as drill_down_value,\n       detail.field_value as field_value,\n       count(detail.drill_down_value) as frequency\n       , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.data_quality.data_quality_clinical_detail as detail\nleft join dev_tom.data_quality._value_set_crosswalk_field_info as field_info on detail.table_name = field_info.input_layer_table_name\n       and detail.field_name = field_info.field_name\nWHERE\n       detail.bucket_name = 'valid'\n       and field_info.unique_values_expected_flag = 0 --- need to handle pks differently since every value is supposed to be unique\ngroup by\n       detail.data_source,\n       detail.field_name,\n       detail.table_name,\n       detail.bucket_name,\n       detail.field_value,\n       detail.invalid_reason,\n       detail.drill_down_key,\n       detail.summary_sk\n\nunion all\n\n-- 5 Examples of each invalid example\n\nSELECT\n       summary_sk,\n       data_source,\n       table_name,\n       field_name,\n       bucket_name,\n       invalid_reason,\n       drill_down_key,\n       drill_down_value as drill_down_value,\n       field_value as field_value,\n       frequency\n       , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nFROM Ranked_Examples\nWHERE rn <= 5\n\nunion all\n\n--- Aggregating all other invalid examples into single row\n\nSELECT\n       summary_sk,\n       data_source,\n       table_name,\n       field_name,\n       bucket_name,\n       invalid_reason,\n       drill_down_key,\n       'all others' as drill_down_value,\n       field_value as field_value,\n       sum(frequency) as frequency\n       , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nFROM Ranked_Examples\nWHERE rn > 5 --- Aggregating all other rows\nGROUP BY\n    summary_sk,\n    data_source,\n    table_name,\n    field_name,\n    bucket_name,\n    invalid_reason,\n    drill_down_key,\n    field_value\n\nunion all\n\n--- 5 Examples of valid primary key values\n\nSELECT\n       summary_sk,\n       data_source,\n       table_name,\n       field_name,\n       bucket_name,\n       invalid_reason,\n       drill_down_key,\n       drill_down_value as drill_down_value,\n       field_value as field_value,\n       frequency\n       , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nFROM pk_examples\nWHERE rn <= 5\n\nunion all\n\n--- Aggegating all other valid primary key value examples\n\nSELECT\n       summary_sk,\n       data_source,\n       table_name,\n       field_name,\n       bucket_name,\n       invalid_reason,\n       drill_down_key,\n       'All Others' as drill_down_value,\n       'All Others' as field_value,\n       sum(frequency) as frequency\n       , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nFROM pk_examples\nWHERE rn > 5 --- Aggregating all other rows\nGROUP BY\n    summary_sk,\n    data_source,\n    table_name,\n    field_name,\n    bucket_name,\n    invalid_reason,\n    drill_down_key,\n    field_value", "relation_name": "dev_tom.data_quality.data_quality_clinical_for_pbi"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.708265Z", "completed_at": "2024-08-23T19:21:33.713350Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.713779Z", "completed_at": "2024-08-23T19:21:33.713782Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.006690025329589844, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.the_tuva_project.not_null_quality_measures__stg_core__medication_patient_id.0aaf3a0652", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nwith __dbt__cte__quality_measures__stg_core__medication as (\n\n\nselect\n      patient_id\n    , encounter_id\n    , prescribing_date  \n    , dispensing_date\n    , source_code_type\n    , source_code\n    , ndc_code\n    , rxnorm_code\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.medication\n\n\n) select patient_id\nfrom __dbt__cte__quality_measures__stg_core__medication\nwhere patient_id is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.711350Z", "completed_at": "2024-08-23T19:21:33.714437Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.714987Z", "completed_at": "2024-08-23T19:21:33.714990Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.006945610046386719, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.the_tuva_project.not_null_quality_measures__stg_core__observation_patient_id.31e33f2d7e", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nwith __dbt__cte__quality_measures__stg_core__observation as (\n\n\nselect\n      patient_id\n    , encounter_id\n    , observation_date\n    , result\n    , source_code_type\n    , source_code\n    , normalized_code_type\n    , normalized_code\n    , normalized_description\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.observation\n\n\n) select patient_id\nfrom __dbt__cte__quality_measures__stg_core__observation\nwhere patient_id is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.715274Z", "completed_at": "2024-08-23T19:21:33.758006Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.817718Z", "completed_at": "2024-08-23T19:21:33.817727Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.10372400283813477, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.normalized_input__eligibility", "compiled": true, "compiled_code": "\n\n\nwith __dbt__cte__normalized_input__stg_eligibility as (\n\n\n\nselect\n      patient_id\n    , patient_id || coalesce(data_source,'') || coalesce(payer,'') || coalesce(plan,'') || coalesce(cast(enrollment_start_date as TEXT),'') || coalesce(cast(enrollment_end_date as TEXT),'') as patient_id_key\n    , member_id\n    , subscriber_id\n    , gender\n    , race\n    , birth_date\n    , death_date\n    , death_flag\n    , enrollment_start_date\n    , enrollment_end_date\n    , payer\n    , payer_type\n    , plan\n    , subscriber_relation\n    , original_reason_entitlement_code\n    , dual_status_code\n    , medicare_status_code\n    , first_name\n    , last_name\n    , social_security_number\n    , address\n    , city\n    , state\n    , zip_code\n    , phone\n    , data_source\n    , file_name\n    , ingest_datetime\nfrom tuva.input_layer.eligibility\n) select\n    cast(elig.patient_id as TEXT ) as patient_id\n    , cast(elig.member_id as TEXT ) as member_id\n    , cast(elig.subscriber_id as TEXT ) as subscriber_id\n    , cast(elig.gender as TEXT ) as gender\n    , cast(elig.race as TEXT ) as race\n    , cast(date_norm.normalized_birth_date as date ) as birth_date\n    , cast(date_norm.normalized_death_date as date ) as death_date\n    , cast(elig.death_flag as int ) as death_flag\n    , cast(date_norm.normalized_enrollment_start_date as date ) as enrollment_start_date\n    , cast(date_norm.normalized_enrollment_end_date as date ) as enrollment_end_date\n    , cast(elig.payer as TEXT ) as payer\n    , cast(elig.payer_type as TEXT ) as payer_type\n    , cast(elig.plan as TEXT ) as plan\n    , cast(elig.original_reason_entitlement_code as TEXT ) as original_reason_entitlement_code\n    , cast(elig.dual_status_code as TEXT ) as dual_status_code\n    , cast(elig.medicare_status_code as TEXT ) as medicare_status_code\n    , cast(elig.first_name as TEXT ) as first_name\n    , cast(elig.last_name as TEXT ) as last_name\n    , cast(elig.social_security_number as TEXT ) as social_security_number\n    , cast(elig.subscriber_relation as TEXT ) as subscriber_relation\n    , cast(elig.address as TEXT ) as address\n    , cast(elig.city as TEXT ) as city\n    , cast(elig.state as TEXT ) as state\n    , cast(elig.zip_code as TEXT ) as zip_code\n    , cast(elig.phone as TEXT ) as phone\n    , cast(elig.data_source as TEXT ) as data_source\n    , cast('2024-08-23 19:21:27.787896+00:00'  as TEXT ) as tuva_last_run\nfrom __dbt__cte__normalized_input__stg_eligibility elig\nleft join dev_tom.claims_preprocessing._int_normalized_input_eligibility_dates_normalize date_norm\n    on elig.patient_id_key = date_norm.patient_id_key", "relation_name": "dev_tom.claims_preprocessing.normalized_input_eligibility"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.843827Z", "completed_at": "2024-08-23T19:21:33.852154Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.852632Z", "completed_at": "2024-08-23T19:21:33.852637Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.10094690322875977, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.normalized_input__int_admit_source_final", "compiled": true, "compiled_code": "\n\n\nselect\n    claim_id\n    , data_source\n    , column_name\n    , normalized_code\n    , normalized_description\n    , occurrence_count\n    , next_occurrence_count\n    , occurrence_row_count\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing._int_normalized_input_admit_source_voting\nwhere (occurrence_row_count = 1\n        and occurrence_count > next_occurrence_count)", "relation_name": "dev_tom.claims_preprocessing._int_normalized_input_admit_source_final"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.726936Z", "completed_at": "2024-08-23T19:21:33.855014Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.855441Z", "completed_at": "2024-08-23T19:21:33.855444Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.1406848430633545, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__data_quality_claims_detail", "compiled": true, "compiled_code": "\n\nWITH cte as (\nSELECT\n    cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.claim_allowed_amount\n\nunion all\n\nSELECT\n    cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.claim_charge_amount\n\nunion all\n\nSELECT\n    cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.claim_claim_id\n\nunion all\n\nSELECT\n    cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.claim_claim_line_end_date\n\nunion all\n\nSELECT\n    cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.claim_claim_line_number\n\nunion all\n\nSELECT\n    cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.claim_claim_line_start_date\n\nunion all\n\nSELECT\n    cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.claim_claim_type\n\nunion all\n\nSELECT\n    cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.claim_coninsurance_amount\n\nunion all\n\nSELECT\n    cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.claim_copayment_amount\n\nunion all\n\nSELECT\n    cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.claim_data_source\n\nunion all\n\nSELECT\n    cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.claim_deductible_amount\n\nunion all\n\nSELECT\n    cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.claim_diagnosis_code_type\n\nunion all\n\nSELECT\n    cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.claim_hcpcs_code\n\nunion all\n\nSELECT\n    cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.claim_member_id\n\nunion all\n\nSELECT\n    cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.claim_paid_amount\n\nunion all\n\nSELECT\n    cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.claim_paid_date\n\nunion all\n\nSELECT\n    cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.claim_patient_id\n\nunion all\n\nSELECT\n    cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.claim_payer\n\nunion all\n\nSELECT\n    cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.claim_plan\n\nunion all\n\nSELECT\n    cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.claim_total_cost_amount\n\nunion all\n\nSELECT\n    cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.eligibility_address\n\nunion all\n\nSELECT\n    cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.eligibility_birth_date\n\nunion all\n\nSELECT\n    cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.eligibility_city\n\nunion all\n\nSELECT\n    cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.eligibility_data_source\n\nunion all\n\nSELECT\n    cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.eligibility_death_date\n\nunion all\n\nSELECT\n    cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.eligibility_death_flag\n\nunion all\n\nSELECT\n    cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.eligibility_dual_status_code\n\nunion all\n\nSELECT\n    cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.eligibility_end_date\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.eligibility_first_name\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.eligibility_gender\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.eligibility_last_name\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.eligibility_medicare_status_code\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.eligibility_member_id\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.eligibility_original_reason_entitlement_code\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.eligibility_patient_id\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.eligibility_payer_type\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.eligibility_payer\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.eligibility_phone\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.eligibility_plan\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.eligibility_race\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.eligibility_start_date\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.eligibility_state\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.eligibility_zip_code\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.institutional_ms_drg_code\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.institutional_admission_date\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.institutional_admit_source_code\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.institutional_admit_type_code\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.institutional_apr_drg_code\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.institutional_bill_type_code\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.institutional_billing_npi\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.institutional_claim_end_date\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.institutional_claim_start_date\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.institutional_diagnosis_code_1\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.institutional_diagnosis_code_2\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.institutional_diagnosis_code_3\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.institutional_discharge_date\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.institutional_discharge_disposition_code\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.institutional_facility_npi\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.institutional_present_on_admission_1\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.institutional_present_on_admission_2\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.institutional_present_on_admission_3\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.institutional_procedure_code_1\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.institutional_procedure_code_2\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.institutional_procedure_code_3\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.institutional_procedure_date_1\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.institutional_procedure_date_2\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.institutional_procedure_date_3\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.institutional_rendering_npi\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.institutional_revenue_center_code\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.institutional_service_unit_quantity\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.pharmacy_allowed_amount\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.pharmacy_claim_id\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.pharmacy_claim_line_number\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.pharmacy_coinsurance_amount\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.pharmacy_copayment_amount\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.pharmacy_data_source\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.pharmacy_days_supply\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.pharmacy_deductible_amount\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.pharmacy_dispensing_date\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.pharmacy_dispensing_provider_npi\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.pharmacy_member_id\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.pharmacy_ndc_code\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.pharmacy_paid_amount\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.pharmacy_paid_date\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.pharmacy_patient_id\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.pharmacy_payer\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.pharmacy_plan\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.pharmacy_prescribing_provider_npi\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.pharmacy_quantity\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.pharmacy_refills\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.professional_billing_npi\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.professional_facility_npi\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.professional_place_of_service_code\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.professional_rendering_npi\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.professional_claim_end_date\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.professional_claim_start_date\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.professional_diagnosis_code_1\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.professional_diagnosis_code_2\n\nunion all\n\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n\tFROM dev_tom.data_quality.professional_diagnosis_code_3\n\n)\n\n-- noinspection SqlNoDataSourceInspection\nSELECT     cast(data_source as TEXT) as data_source\n\t, cast(source_date as TEXT) as source_date\n\t, cast(table_name as TEXT) as table_name\n\t, cast(drill_down_key as TEXT) as drill_down_key\n\t, cast(drill_down_value as TEXT) as drill_down_value\n\t, cast(claim_type as TEXT) as claim_type\n\t, cast(field_name as TEXT) as field_name\n\t, cast(bucket_name as TEXT) as bucket_name\n\t, cast(invalid_reason as TEXT) as invalid_reason\n\t, cast(field_value as TEXT) as field_value\n\t, cast(tuva_last_run as TEXT) as tuva_last_run\n,DENSE_RANK() OVER (ORDER BY data_source, table_name, claim_type, field_name) as summary_sk\nFROM cte", "relation_name": "dev_tom.data_quality.data_quality_claims_detail"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.853077Z", "completed_at": "2024-08-23T19:21:33.856109Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.856662Z", "completed_at": "2024-08-23T19:21:33.856665Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.004935026168823242, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.normalized_input__int_admit_type_final", "compiled": true, "compiled_code": "\n\n\nselect\n    claim_id\n    , data_source\n    , column_name\n    , normalized_code\n    , normalized_description\n    , occurrence_count\n    , next_occurrence_count\n    , occurrence_row_count\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing._int_normalized_input_admit_type_normalize_voting\nwhere (occurrence_row_count = 1\n        and occurrence_count > next_occurrence_count)", "relation_name": "dev_tom.claims_preprocessing._int_normalized_input_admit_type_final"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.856942Z", "completed_at": "2024-08-23T19:21:33.861882Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.862489Z", "completed_at": "2024-08-23T19:21:33.862492Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0067861080169677734, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.normalized_input__int_apr_drg_final", "compiled": true, "compiled_code": "\n\n\nselect\n    claim_id\n    , data_source\n    , column_name\n    , normalized_code\n    , normalized_description\n    , occurrence_count\n    , next_occurrence_count\n    , occurrence_row_count\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing._int_normalized_input_apr_drg_voting\nwhere (occurrence_row_count = 1\n        and occurrence_count > next_occurrence_count)", "relation_name": "dev_tom.claims_preprocessing._int_normalized_input_apr_drg_final"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.859612Z", "completed_at": "2024-08-23T19:21:33.862244Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.865199Z", "completed_at": "2024-08-23T19:21:33.865202Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.008761167526245117, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.normalized_input__int_bill_type_final", "compiled": true, "compiled_code": "\n\n\nselect\n    claim_id\n    , data_source\n    , column_name\n    , normalized_code\n    , normalized_description\n    , occurrence_count\n    , next_occurrence_count\n    , occurrence_row_count\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing._int_normalized_input_bill_type_voting\nwhere (occurrence_row_count = 1\n        and occurrence_count > next_occurrence_count)", "relation_name": "dev_tom.claims_preprocessing._int_normalized_input_bill_type_final"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.862769Z", "completed_at": "2024-08-23T19:21:33.866133Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.866643Z", "completed_at": "2024-08-23T19:21:33.866646Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.005012035369873047, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.normalized_input__int_diagnosis_code_voting", "compiled": true, "compiled_code": "\n\nwith distinct_count as(\n    select\n        claim_id\n        , data_source\n        , diagnosis_column\n        , count(*) as distinct_count\n        , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\n    from dev_tom.claims_preprocessing._int_normalized_input_diagnosis_code_normalize\n    group by\n        claim_id\n        , data_source\n        , diagnosis_column\n)\n\nselect \n    norm.claim_id\n    , norm.data_source\n    , norm.diagnosis_column as column_name\n    , norm.normalized_diagnosis_code as normalized_code\n    , norm.diagnosis_code_occurrence_count as occurrence_count\n    , coalesce(lead(diagnosis_code_occurrence_count) \n        over (partition by norm.claim_id, norm.data_source, norm.diagnosis_column order by diagnosis_code_occurrence_count desc),0) as next_occurrence_count\n    , row_number() over (partition by norm.claim_id, norm.data_source, norm.diagnosis_column order by diagnosis_code_occurrence_count desc) as occurrence_row_count\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing._int_normalized_input_diagnosis_code_normalize norm\ninner join distinct_count dist\n    on norm.claim_id = dist.claim_id\n    and norm.data_source = dist.data_source\n    and norm.diagnosis_column = dist.diagnosis_column", "relation_name": "dev_tom.claims_preprocessing._int_normalized_input_diagnosis_code_voting"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.867080Z", "completed_at": "2024-08-23T19:21:33.871792Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.872121Z", "completed_at": "2024-08-23T19:21:33.872125Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.00619196891784668, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.normalized_input__int_discharge_disposition_final", "compiled": true, "compiled_code": "\n\n\nselect\n    claim_id\n    , data_source\n    , column_name\n    , normalized_code\n    , normalized_description\n    , occurrence_count\n    , next_occurrence_count\n    , occurrence_row_count\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing._int_normalized_input_discharge_disposition_voting\nwhere (occurrence_row_count = 1\n        and occurrence_count > next_occurrence_count)", "relation_name": "dev_tom.claims_preprocessing._int_normalized_input_discharge_disposition_final"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.869194Z", "completed_at": "2024-08-23T19:21:33.872379Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.874593Z", "completed_at": "2024-08-23T19:21:33.874596Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.008331060409545898, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.normalized_input__int_medical_date_aggregation", "compiled": true, "compiled_code": "\n\n\nselect\n    claim_id\n    , data_source\n    , min(normalized_claim_start_date) as minimum_claim_start_date\n    , max(normalized_claim_end_date) as maximum_claim_end_date\n    , min(normalized_admission_date) as minimum_admission_date\n    , max(normalized_discharge_date) as maximum_discharge_date\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing._int_normalized_input_medical_claim_date_normalize\nwhere claim_type = 'institutional'\ngroup by\n    claim_id\n    , data_source\n\nunion all\n\nselect\n    claim_id\n    , data_source\n    , min(normalized_claim_start_date) as minimum_claim_start_date\n    , max(normalized_claim_end_date) as maximum_claim_end_date\n    , null as minimum_admission_date\n    , null as maximum_discharge_date\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing._int_normalized_input_medical_claim_date_normalize\nwhere claim_type = 'professional'\ngroup by\n    claim_id\n    , data_source", "relation_name": "dev_tom.claims_preprocessing._int_normalized_input_medical_date_aggregation"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.872550Z", "completed_at": "2024-08-23T19:21:33.876245Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.879017Z", "completed_at": "2024-08-23T19:21:33.879021Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.007485866546630859, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.normalized_input__int_ms_drg_final", "compiled": true, "compiled_code": "\n\n\nselect\n    claim_id\n    , data_source\n    , column_name\n    , normalized_code\n    , normalized_description\n    , occurrence_count\n    , next_occurrence_count\n    , occurrence_row_count\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing._int_normalized_input_ms_drg_voting\nwhere (occurrence_row_count = 1\n        and occurrence_count > next_occurrence_count)", "relation_name": "dev_tom.claims_preprocessing._int_normalized_input_ms_drg_final"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.876597Z", "completed_at": "2024-08-23T19:21:33.882013Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.882407Z", "completed_at": "2024-08-23T19:21:33.882409Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.007534027099609375, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.normalized_input__int_present_on_admit_voting", "compiled": true, "compiled_code": "\n\nwith distinct_count as(\n    select\n        claim_id\n        , data_source\n        , diagnosis_column\n        , count(*) as distinct_count\n        , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\n    from dev_tom.claims_preprocessing._int_normalized_input_present_on_admit_normalize\n    group by\n        claim_id\n        , data_source\n        , diagnosis_column\n)\n\nselect \n    norm.claim_id\n    , norm.data_source\n    , norm.diagnosis_column as column_name\n    , norm.normalized_present_on_admit_code as normalized_code\n    , norm.present_on_admit_occurrence_count as occurrence_count\n    , coalesce(lead(present_on_admit_occurrence_count) \n        over (partition by norm.claim_id, norm.data_source, norm.diagnosis_column order by present_on_admit_occurrence_count desc),0) as next_occurrence_count\n    , row_number() over (partition by norm.claim_id, norm.data_source, norm.diagnosis_column order by present_on_admit_occurrence_count desc) as occurrence_row_count\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing._int_normalized_input_present_on_admit_normalize norm\ninner join distinct_count dist\n    on norm.claim_id = dist.claim_id\n    and norm.data_source = dist.data_source\n    and norm.diagnosis_column = dist.diagnosis_column", "relation_name": "dev_tom.claims_preprocessing._int_normalized_input_present_on_admit_voting"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.879726Z", "completed_at": "2024-08-23T19:21:33.883035Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.885763Z", "completed_at": "2024-08-23T19:21:33.885766Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.009386062622070312, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.normalized_input__int_procedure_code_voting", "compiled": true, "compiled_code": "\n\nwith distinct_count as(\n    select\n        claim_id\n        , data_source\n        , procedure_column\n        , count(*) as distinct_count\n        , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\n    from dev_tom.claims_preprocessing._int_normalized_input_procedure_code_normalize\n    group by\n        claim_id\n        , data_source\n        , procedure_column\n)\n\nselect \n    norm.claim_id\n    , norm.data_source\n    , norm.procedure_column as column_name\n    , norm.normalized_procedure_code as normalized_code\n    , norm.procedure_code_occurrence_count as occurrence_count\n    , coalesce(lead(procedure_code_occurrence_count) \n        over (partition by norm.claim_id, norm.data_source, norm.procedure_column order by procedure_code_occurrence_count desc),0) as next_occurrence_count\n    , row_number() over (partition by norm.claim_id, norm.data_source, norm.procedure_column order by procedure_code_occurrence_count desc) as occurrence_row_count\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing._int_normalized_input_procedure_code_normalize norm\ninner join distinct_count dist\n    on norm.claim_id = dist.claim_id\n    and norm.data_source = dist.data_source\n    and norm.procedure_column = dist.procedure_column", "relation_name": "dev_tom.claims_preprocessing._int_normalized_input_procedure_code_voting"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.883229Z", "completed_at": "2024-08-23T19:21:33.886425Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.890900Z", "completed_at": "2024-08-23T19:21:33.890903Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.008744239807128906, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.normalized_input__int_procedure_date_voting", "compiled": true, "compiled_code": "\n\nwith distinct_count as(\n    select\n        claim_id\n        , data_source\n        , procedure_column\n        , count(*) as distinct_count\n        , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\n    from dev_tom.claims_preprocessing._int_normalized_input_procedure_code_normalize\n    group by\n        claim_id\n        , data_source\n        , procedure_column\n)\n\nselect \n    norm.claim_id\n    , norm.data_source\n    , norm.procedure_column as column_name\n    , norm.procedure_date as normalized_code\n    , norm.procedure_date_occurrence_count as occurrence_count\n    , coalesce(lead(procedure_date_occurrence_count) \n        over (partition by norm.claim_id, norm.data_source, norm.procedure_column order by procedure_date_occurrence_count desc),0) as next_occurrence_count\n    , row_number() over (partition by norm.claim_id, norm.data_source, norm.procedure_column order by procedure_date_occurrence_count desc) as occurrence_row_count\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing._int_normalized_input_procedure_date_normalize norm\ninner join distinct_count dist\n    on norm.claim_id = dist.claim_id\n    and norm.data_source = dist.data_source\n    and norm.procedure_column = dist.procedure_column", "relation_name": "dev_tom.claims_preprocessing._int_normalized_input_procedure_date_voting"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.886594Z", "completed_at": "2024-08-23T19:21:33.891581Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.893748Z", "completed_at": "2024-08-23T19:21:33.893751Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.00820302963256836, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.core__stg_claims_pharmacy_claim", "compiled": true, "compiled_code": "\n\n-- *************************************************\n-- This dbt model creates the pharmacy_claim\n-- table in core.\n-- *************************************************\n\n\n\n\nselect\n    cast(claim_id as TEXT) || '-' || cast(claim_line_number as TEXT) as pharmacy_claim_id\n       , cast(claim_id as TEXT ) as claim_id\n       , cast(claim_line_number as integer ) as claim_line_number\n       , cast(patient_id as TEXT ) as patient_id\n       , cast(member_id as TEXT ) as member_id\n       , cast(payer as TEXT ) as payer\n       , plan\n       , cast(prescribing_provider_id as TEXT ) as prescribing_provider_id\n       , cast(prescribing_provider_name as TEXT ) as prescribing_provider_name\n       , cast(dispensing_provider_id as TEXT ) as dispensing_provider_id\n       , cast(dispensing_provider_name as TEXT ) as dispensing_provider_name\n       , cast(dispensing_date as date ) as dispensing_date\n       , cast(ndc_code as TEXT ) as ndc_code\n       , cast(ndc_description as TEXT ) as ndc_description\n       , cast(quantity as integer ) as quantity\n       , cast(days_supply as integer ) as days_supply\n       , cast(refills as integer ) as refills\n       , cast(paid_date as date ) as paid_date\n       , cast(paid_amount as numeric(28,6)) as paid_amount\n       , cast(allowed_amount as numeric(28,6) ) as allowed_amount\n       , cast(charge_amount as numeric(28,6) ) as charge_amount\n       , cast(coinsurance_amount as numeric(28,6) ) as coinsurance_amount\n       , cast(copayment_amount as numeric(28,6) ) as copayment_amount\n       , cast(deductible_amount as numeric(28,6) ) as deductible_amount\n       , cast(in_network_flag as int ) as in_network_flag\n       , cast(data_source as TEXT ) as data_source\n       , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing.normalized_input_pharmacy_claim  pharm", "relation_name": "dev_tom.core._stg_claims_pharmacy_claim"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.894674Z", "completed_at": "2024-08-23T19:21:33.904711Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.905112Z", "completed_at": "2024-08-23T19:21:33.905115Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.011588096618652344, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.core__stg_claims_eligibility", "compiled": true, "compiled_code": "\n\n-- *************************************************\n-- This dbt model creates the eligibility table in core.\n-- *************************************************\n\n\n\n\nselect\n       member_id || '-' || enrollment_start_date || '-' || enrollment_end_date || '-' || payer || '-' || plan as eligibility_id\n       , cast(patient_id as TEXT ) as patient_id\n       , cast(member_id as TEXT ) as member_id\n       , cast(subscriber_id as TEXT ) as subscriber_id\n       , cast(birth_date as date) as birth_date\n       , cast(death_date as date) as death_date\n       , cast(enrollment_start_date as date ) as enrollment_start_date\n       , cast(enrollment_end_date as date ) as enrollment_end_date\n       , cast(payer as TEXT ) as payer\n       , cast(payer_type as TEXT ) as payer_type\n       , plan\n       , cast(original_reason_entitlement_code as TEXT ) as original_reason_entitlement_code\n       , cast(dual_status_code as TEXT ) as dual_status_code\n       , cast(medicare_status_code as TEXT ) as medicare_status_code\n       , cast(subscriber_relation as TEXT ) as subscriber_relation\n       , cast(data_source as TEXT ) as data_source\n       , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing.normalized_input_eligibility", "relation_name": "dev_tom.core._stg_claims_eligibility"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.898629Z", "completed_at": "2024-08-23T19:21:33.908169Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.908613Z", "completed_at": "2024-08-23T19:21:33.908616Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.010820150375366211, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.core__stg_claims_patient", "compiled": true, "compiled_code": "\n\n-- *************************************************\n-- This dbt model creates the patient table in core.\n-- *************************************************\n\nwith patient_stage as(\n    select\n        patient_id\n        ,first_name\n        ,last_name\n        ,gender\n        ,race\n        ,birth_date\n        ,death_date\n        ,death_flag\n        ,social_security_number\n        ,address\n        ,city\n        ,state\n        ,zip_code\n        ,phone\n        ,data_source\n        ,row_number() over (\n\t        partition by patient_id\n\t        order by case when enrollment_end_date is null\n                then cast ('2050-01-01' as date)\n                else enrollment_end_date end DESC)\n            as row_sequence\n        , cast('2024-08-23 19:21:27.787896+00:00' as timestamp) as tuva_last_run_datetime\n        , cast(substring('2024-08-23 19:21:27.787896+00:00',1,10) as date) as tuva_last_run_date\n    from dev_tom.claims_preprocessing.normalized_input_eligibility\n)\n\nselect\n    cast(patient_id as TEXT) as patient_id\n    , cast(first_name as TEXT) as first_name\n    , cast(last_name as TEXT) as last_name\n    , cast(gender as TEXT) as sex\n    , cast(race as TEXT) as race\n    , cast(birth_date as date) as birth_date\n    , cast(death_date as date) as death_date\n    , cast(death_flag as int) as death_flag\n    , cast(social_security_number as TEXT) as social_security_number\n    , cast(address as TEXT) as address\n    , cast(city as TEXT) as city\n    , cast(state as TEXT) as state\n    , cast(zip_code as TEXT) as zip_code\n    , cast(null as TEXT) as county\n    , cast(null as float) as latitude \n    , cast(null as float) as longitude\n    , cast(data_source as TEXT) as data_source\n    , cast(floor(datediff(\n        hour,\n        birth_date,\n        tuva_last_run_date\n        ) / 8760.0) as integer ) as age\n    , cast(\n        CASE\n            WHEN cast(floor(datediff(\n        hour,\n        birth_date,\n        tuva_last_run_date\n        ) / 8760.0) as integer ) < 10 THEN '0-9'\n            WHEN cast(floor(datediff(\n        hour,\n        birth_date,\n        tuva_last_run_date\n        ) / 8760.0) as integer ) < 20 THEN '10-19'\n            WHEN cast(floor(datediff(\n        hour,\n        birth_date,\n        tuva_last_run_date\n        ) / 8760.0) as integer ) < 30 THEN '20-29'\n            WHEN cast(floor(datediff(\n        hour,\n        birth_date,\n        tuva_last_run_date\n        ) / 8760.0) as integer ) < 40 THEN '30-39'\n            WHEN cast(floor(datediff(\n        hour,\n        birth_date,\n        tuva_last_run_date\n        ) / 8760.0) as integer ) < 50 THEN '40-49'\n            WHEN cast(floor(datediff(\n        hour,\n        birth_date,\n        tuva_last_run_date\n        ) / 8760.0) as integer ) < 60 THEN '50-59'\n            WHEN cast(floor(datediff(\n        hour,\n        birth_date,\n        tuva_last_run_date\n        ) / 8760.0) as integer ) < 70 THEN '60-69'\n            WHEN cast(floor(datediff(\n        hour,\n        birth_date,\n        tuva_last_run_date\n        ) / 8760.0) as integer ) < 80 THEN '70-79'\n            WHEN cast(floor(datediff(\n        hour,\n        birth_date,\n        tuva_last_run_date\n        ) / 8760.0) as integer ) < 90 THEN '80-89'\n            ELSE '90+'\n        END as TEXT\n    ) AS age_group\n    , tuva_last_run_datetime as tuva_last_run\nfrom patient_stage\nwhere row_sequence = 1", "relation_name": "dev_tom.core._stg_claims_patient"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.909700Z", "completed_at": "2024-08-23T19:21:33.913835Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.919182Z", "completed_at": "2024-08-23T19:21:33.919186Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.01081705093383789, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__data_quality_claims_for_pbi", "compiled": true, "compiled_code": "\n\nWITH ranked_examples as (\n       select\n       summary_sk,\n       data_source,\n       table_name,\n       claim_type,\n       field_name,\n       bucket_name,\n       invalid_reason,\n       drill_down_key,\n       drill_down_value as drill_down_value, --all claims\n       field_value as field_value,\n       count(drill_down_value) as frequency,\n       row_number() over (partition by summary_sk, bucket_name, field_value order by field_value) as rn\n       , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nFROM dev_tom.data_quality.data_quality_claims_detail\nWHERE bucket_name not in ('valid', 'null')\nGROUP BY\n       data_source,\n       field_name,\n       table_name,\n       claim_type,\n       bucket_name,\n       field_value,\n       drill_down_key,\n       drill_down_value,\n       invalid_reason,\n       summary_sk\n)\nSELECT\n       summary_sk,\n       data_source,\n       table_name,\n       claim_type,\n       field_name,\n       bucket_name,\n       invalid_reason,\n       drill_down_key,\n       max(drill_down_value) as drill_down_value, --1 sample claim\n       null as field_value,\n       count(drill_down_value) as frequency\n       , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nFROM dev_tom.data_quality.data_quality_claims_detail\nWHERE bucket_name = 'null'\nGROUP BY\n       data_source,\n       field_name,\n       table_name,\n       claim_type,\n       bucket_name,\n       invalid_reason,\n       drill_down_key,\n       summary_sk\n\nunion all\nSELECT\n       summary_sk,\n       data_source,\n       table_name,\n       claim_type,\n       field_name,\n       bucket_name,\n       invalid_reason,\n       drill_down_key,\n       max(drill_down_value) as drill_down_value, --1 sample claim\n       field_value as field_value,\n       count(drill_down_value) as frequency\n       , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nFROM dev_tom.data_quality.data_quality_claims_detail\nWHERE bucket_name = 'valid'\nGROUP BY\n       data_source,\n       field_name,\n       table_name,\n       claim_type,\n       bucket_name,\n       field_value,\n       invalid_reason,\n       drill_down_key,\n       summary_sk\n\nunion all\nSELECT\n       summary_sk,\n       data_source,\n       table_name,\n       claim_type,\n       field_name,\n       bucket_name,\n       invalid_reason,\n       drill_down_key,\n       drill_down_value as drill_down_value,\n       field_value as field_value,\n       frequency\n       , '2024-08-23 19:21:27.787896+00:00'\nFROM ranked_examples\nWHERE rn <= 5 -- 5 Example claims per unique SK / field value\nunion all\nSELECT\n       summary_sk,\n       data_source,\n       table_name,\n       claim_type,\n       field_name,\n       bucket_name,\n       invalid_reason,\n       drill_down_key,\n       'All Others' as drill_down_value,\n       field_value as field_value,\n       sum(frequency) as frequency\n       , '2024-08-23 19:21:27.787896+00:00'\nFROM ranked_examples\nWHERE rn > 5 -- Aggregating all other rows\nGROUP BY\n    summary_sk,\n    data_source,\n    table_name,\n    claim_type,\n    field_name,\n    bucket_name,\n    invalid_reason,\n    drill_down_key,\n    field_value", "relation_name": "dev_tom.data_quality.data_quality_claims_for_pbi"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.913999Z", "completed_at": "2024-08-23T19:21:33.919787Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.920274Z", "completed_at": "2024-08-23T19:21:33.920277Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.007208108901977539, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__data_quality_detail", "compiled": true, "compiled_code": "\n\nSELECT\n    data_source,\n\tsource_date,\n\ttable_name,\n\tdrill_down_key,\n\tdrill_down_value,\n\tclaim_type,\n\tfield_name,\n\tbucket_name,\n\tinvalid_reason,\n\tfield_value,\n\tsummary_sk,\n\t'2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nFROM dev_tom.data_quality.data_quality_claims_detail\n\nunion all\n\nSELECT\n    data_source,\n\tsource_date,\n\ttable_name,\n\tdrill_down_key,\n\tdrill_down_value,\n\t'CLINICAL' AS claim_type,\n\tfield_name,\n\tbucket_name,\n\tinvalid_reason,\n\tfield_value,\n\tsummary_sk,\n\t'2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nFROM dev_tom.data_quality.data_quality_clinical_detail\n\n", "relation_name": "dev_tom.data_quality.data_quality_detail"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.917137Z", "completed_at": "2024-08-23T19:21:33.920102Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.920706Z", "completed_at": "2024-08-23T19:21:33.920709Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.007454872131347656, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.normalized_input__int_diagnosis_code_final", "compiled": true, "compiled_code": "\n\n\nselect\n    claim_id\n    , data_source\n    , max(case when lower(column_name) = 'diagnosis_code_1' then normalized_code else null end) as diagnosis_code_1\n    , max(case when lower(column_name) = 'diagnosis_code_2' then normalized_code else null end) as diagnosis_code_2\n    , max(case when lower(column_name) = 'diagnosis_code_3' then normalized_code else null end) as diagnosis_code_3\n    , max(case when lower(column_name) = 'diagnosis_code_4' then normalized_code else null end) as diagnosis_code_4\n    , max(case when lower(column_name) = 'diagnosis_code_5' then normalized_code else null end) as diagnosis_code_5\n    , max(case when lower(column_name) = 'diagnosis_code_6' then normalized_code else null end) as diagnosis_code_6\n    , max(case when lower(column_name) = 'diagnosis_code_7' then normalized_code else null end) as diagnosis_code_7\n    , max(case when lower(column_name) = 'diagnosis_code_8' then normalized_code else null end) as diagnosis_code_8\n    , max(case when lower(column_name) = 'diagnosis_code_9' then normalized_code else null end) as diagnosis_code_9\n    , max(case when lower(column_name) = 'diagnosis_code_10' then normalized_code else null end) as diagnosis_code_10\n    , max(case when lower(column_name) = 'diagnosis_code_11' then normalized_code else null end) as diagnosis_code_11\n    , max(case when lower(column_name) = 'diagnosis_code_12' then normalized_code else null end) as diagnosis_code_12\n    , max(case when lower(column_name) = 'diagnosis_code_13' then normalized_code else null end) as diagnosis_code_13\n    , max(case when lower(column_name) = 'diagnosis_code_14' then normalized_code else null end) as diagnosis_code_14\n    , max(case when lower(column_name) = 'diagnosis_code_15' then normalized_code else null end) as diagnosis_code_15\n    , max(case when lower(column_name) = 'diagnosis_code_16' then normalized_code else null end) as diagnosis_code_16\n    , max(case when lower(column_name) = 'diagnosis_code_17' then normalized_code else null end) as diagnosis_code_17\n    , max(case when lower(column_name) = 'diagnosis_code_18' then normalized_code else null end) as diagnosis_code_18\n    , max(case when lower(column_name) = 'diagnosis_code_19' then normalized_code else null end) as diagnosis_code_19\n    , max(case when lower(column_name) = 'diagnosis_code_20' then normalized_code else null end) as diagnosis_code_20\n    , max(case when lower(column_name) = 'diagnosis_code_21' then normalized_code else null end) as diagnosis_code_21\n    , max(case when lower(column_name) = 'diagnosis_code_22' then normalized_code else null end) as diagnosis_code_22\n    , max(case when lower(column_name) = 'diagnosis_code_23' then normalized_code else null end) as diagnosis_code_23\n    , max(case when lower(column_name) = 'diagnosis_code_24' then normalized_code else null end) as diagnosis_code_24\n    , max(case when lower(column_name) = 'diagnosis_code_25' then normalized_code else null end) as diagnosis_code_25\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing._int_normalized_input_diagnosis_code_voting\nwhere (occurrence_row_count = 1\n        and occurrence_count > next_occurrence_count)\ngroup by\n    claim_id\n    , data_source", "relation_name": "dev_tom.claims_preprocessing._int_normalized_input_diagnosis_code_final"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.921191Z", "completed_at": "2024-08-23T19:21:33.923939Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.926251Z", "completed_at": "2024-08-23T19:21:33.926254Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.006350994110107422, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.normalized_input__int_present_on_admit_final", "compiled": true, "compiled_code": "\n\nselect\n    claim_id\n    , data_source\n    , max(case when column_name = 'DIAGNOSIS_POA_1' then normalized_code else null end) as diagnosis_poa_1\n    , max(case when column_name = 'DIAGNOSIS_POA_2' then normalized_code else null end) as diagnosis_poa_2\n    , max(case when column_name = 'DIAGNOSIS_POA_3' then normalized_code else null end) as diagnosis_poa_3\n    , max(case when column_name = 'DIAGNOSIS_POA_4' then normalized_code else null end) as diagnosis_poa_4\n    , max(case when column_name = 'DIAGNOSIS_POA_5' then normalized_code else null end) as diagnosis_poa_5\n    , max(case when column_name = 'DIAGNOSIS_POA_6' then normalized_code else null end) as diagnosis_poa_6\n    , max(case when column_name = 'DIAGNOSIS_POA_7' then normalized_code else null end) as diagnosis_poa_7\n    , max(case when column_name = 'DIAGNOSIS_POA_8' then normalized_code else null end) as diagnosis_poa_8\n    , max(case when column_name = 'DIAGNOSIS_POA_9' then normalized_code else null end) as diagnosis_poa_9\n    , max(case when column_name = 'DIAGNOSIS_POA_10' then normalized_code else null end) as diagnosis_poa_10\n    , max(case when column_name = 'DIAGNOSIS_POA_11' then normalized_code else null end) as diagnosis_poa_11\n    , max(case when column_name = 'DIAGNOSIS_POA_12' then normalized_code else null end) as diagnosis_poa_12\n    , max(case when column_name = 'DIAGNOSIS_POA_13' then normalized_code else null end) as diagnosis_poa_13\n    , max(case when column_name = 'DIAGNOSIS_POA_14' then normalized_code else null end) as diagnosis_poa_14\n    , max(case when column_name = 'DIAGNOSIS_POA_15' then normalized_code else null end) as diagnosis_poa_15\n    , max(case when column_name = 'DIAGNOSIS_POA_16' then normalized_code else null end) as diagnosis_poa_16\n    , max(case when column_name = 'DIAGNOSIS_POA_17' then normalized_code else null end) as diagnosis_poa_17\n    , max(case when column_name = 'DIAGNOSIS_POA_18' then normalized_code else null end) as diagnosis_poa_18\n    , max(case when column_name = 'DIAGNOSIS_POA_19' then normalized_code else null end) as diagnosis_poa_19\n    , max(case when column_name = 'DIAGNOSIS_POA_20' then normalized_code else null end) as diagnosis_poa_20\n    , max(case when column_name = 'DIAGNOSIS_POA_21' then normalized_code else null end) as diagnosis_poa_21\n    , max(case when column_name = 'DIAGNOSIS_POA_22' then normalized_code else null end) as diagnosis_poa_22\n    , max(case when column_name = 'DIAGNOSIS_POA_23' then normalized_code else null end) as diagnosis_poa_23\n    , max(case when column_name = 'DIAGNOSIS_POA_24' then normalized_code else null end) as diagnosis_poa_24\n    , max(case when column_name = 'DIAGNOSIS_POA_25' then normalized_code else null end) as diagnosis_poa_25\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing._int_normalized_input_present_on_admit_voting\nwhere (occurrence_row_count = 1\n        and occurrence_count > next_occurrence_count)\ngroup by\n    claim_id\n    , data_source", "relation_name": "dev_tom.claims_preprocessing._int_normalized_input_present_on_admit_final"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.924261Z", "completed_at": "2024-08-23T19:21:33.928998Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.929489Z", "completed_at": "2024-08-23T19:21:33.929492Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.00613713264465332, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.normalized_input__int_procedure_code_final", "compiled": true, "compiled_code": "\n\nselect\n    claim_id\n    , data_source\n    , max(case when lower(column_name) = 'procedure_code_1' then normalized_code else null end) as procedure_code_1\n    , max(case when lower(column_name) = 'procedure_code_2' then normalized_code else null end) as procedure_code_2\n    , max(case when lower(column_name) = 'procedure_code_3' then normalized_code else null end) as procedure_code_3\n    , max(case when lower(column_name) = 'procedure_code_4' then normalized_code else null end) as procedure_code_4\n    , max(case when lower(column_name) = 'procedure_code_5' then normalized_code else null end) as procedure_code_5\n    , max(case when lower(column_name) = 'procedure_code_6' then normalized_code else null end) as procedure_code_6\n    , max(case when lower(column_name) = 'procedure_code_7' then normalized_code else null end) as procedure_code_7\n    , max(case when lower(column_name) = 'procedure_code_8' then normalized_code else null end) as procedure_code_8\n    , max(case when lower(column_name) = 'procedure_code_9' then normalized_code else null end) as procedure_code_9\n    , max(case when lower(column_name) = 'procedure_code_10' then normalized_code else null end) as procedure_code_10\n    , max(case when lower(column_name) = 'procedure_code_11' then normalized_code else null end) as procedure_code_11\n    , max(case when lower(column_name) = 'procedure_code_12' then normalized_code else null end) as procedure_code_12\n    , max(case when lower(column_name) = 'procedure_code_13' then normalized_code else null end) as procedure_code_13\n    , max(case when lower(column_name) = 'procedure_code_14' then normalized_code else null end) as procedure_code_14\n    , max(case when lower(column_name) = 'procedure_code_15' then normalized_code else null end) as procedure_code_15\n    , max(case when lower(column_name) = 'procedure_code_16' then normalized_code else null end) as procedure_code_16\n    , max(case when lower(column_name) = 'procedure_code_17' then normalized_code else null end) as procedure_code_17\n    , max(case when lower(column_name) = 'procedure_code_18' then normalized_code else null end) as procedure_code_18\n    , max(case when lower(column_name) = 'procedure_code_19' then normalized_code else null end) as procedure_code_19\n    , max(case when lower(column_name) = 'procedure_code_20' then normalized_code else null end) as procedure_code_20\n    , max(case when lower(column_name) = 'procedure_code_21' then normalized_code else null end) as procedure_code_21\n    , max(case when lower(column_name) = 'procedure_code_22' then normalized_code else null end) as procedure_code_22\n    , max(case when lower(column_name) = 'procedure_code_23' then normalized_code else null end) as procedure_code_23\n    , max(case when lower(column_name) = 'procedure_code_24' then normalized_code else null end) as procedure_code_24\n    , max(case when lower(column_name) = 'procedure_code_14' then normalized_code else null end) as procedure_code_25\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing._int_normalized_input_procedure_code_voting\nwhere (occurrence_row_count = 1\n        and occurrence_count > next_occurrence_count)\ngroup by\n    claim_id\n    , data_source", "relation_name": "dev_tom.claims_preprocessing._int_normalized_input_procedure_code_final"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.926520Z", "completed_at": "2024-08-23T19:21:33.929321Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.931133Z", "completed_at": "2024-08-23T19:21:33.931137Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.0075719356536865234, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.normalized_input__int_procedure_date_final", "compiled": true, "compiled_code": "\n\nselect\n    claim_id\n    , data_source\n    , max(case when lower(column_name) = 'procedure_date_1' then normalized_code else null end) as procedure_date_1\n    , max(case when lower(column_name) = 'procedure_date_2' then normalized_code else null end) as procedure_date_2\n    , max(case when lower(column_name) = 'procedure_date_3' then normalized_code else null end) as procedure_date_3\n    , max(case when lower(column_name) = 'procedure_date_4' then normalized_code else null end) as procedure_date_4\n    , max(case when lower(column_name) = 'procedure_date_5' then normalized_code else null end) as procedure_date_5\n    , max(case when lower(column_name) = 'procedure_date_6' then normalized_code else null end) as procedure_date_6\n    , max(case when lower(column_name) = 'procedure_date_7' then normalized_code else null end) as procedure_date_7\n    , max(case when lower(column_name) = 'procedure_date_8' then normalized_code else null end) as procedure_date_8\n    , max(case when lower(column_name) = 'procedure_date_9' then normalized_code else null end) as procedure_date_9\n    , max(case when lower(column_name) = 'procedure_date_10' then normalized_code else null end) as procedure_date_10\n    , max(case when lower(column_name) = 'procedure_date_11' then normalized_code else null end) as procedure_date_11\n    , max(case when lower(column_name) = 'procedure_date_12' then normalized_code else null end) as procedure_date_12\n    , max(case when lower(column_name) = 'procedure_date_13' then normalized_code else null end) as procedure_date_13\n    , max(case when lower(column_name) = 'procedure_date_14' then normalized_code else null end) as procedure_date_14\n    , max(case when lower(column_name) = 'procedure_date_15' then normalized_code else null end) as procedure_date_15\n    , max(case when lower(column_name) = 'procedure_date_16' then normalized_code else null end) as procedure_date_16\n    , max(case when lower(column_name) = 'procedure_date_17' then normalized_code else null end) as procedure_date_17\n    , max(case when lower(column_name) = 'procedure_date_18' then normalized_code else null end) as procedure_date_18\n    , max(case when lower(column_name) = 'procedure_date_19' then normalized_code else null end) as procedure_date_19\n    , max(case when lower(column_name) = 'procedure_date_20' then normalized_code else null end) as procedure_date_20\n    , max(case when lower(column_name) = 'procedure_date_21' then normalized_code else null end) as procedure_date_21\n    , max(case when lower(column_name) = 'procedure_date_22' then normalized_code else null end) as procedure_date_22\n    , max(case when lower(column_name) = 'procedure_date_23' then normalized_code else null end) as procedure_date_23\n    , max(case when lower(column_name) = 'procedure_date_24' then normalized_code else null end) as procedure_date_24\n    , max(case when lower(column_name) = 'procedure_date_14' then normalized_code else null end) as procedure_date_25\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing._int_normalized_input_procedure_date_voting\nwhere (occurrence_row_count = 1\n        and occurrence_count > next_occurrence_count)\ngroup by\n    claim_id\n    , data_source", "relation_name": "dev_tom.claims_preprocessing._int_normalized_input_procedure_date_final"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.929766Z", "completed_at": "2024-08-23T19:21:33.932027Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.932546Z", "completed_at": "2024-08-23T19:21:33.932549Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.0037729740142822266, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.core__pharmacy_claim", "compiled": true, "compiled_code": "\n\nselect * from dev_tom.core._stg_claims_pharmacy_claim", "relation_name": "dev_tom.core.pharmacy_claim"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.932977Z", "completed_at": "2024-08-23T19:21:33.938444Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.941628Z", "completed_at": "2024-08-23T19:21:33.941631Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.009800195693969727, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.core__eligibility", "compiled": true, "compiled_code": "\n\n\nselect * from dev_tom.core._stg_claims_eligibility", "relation_name": "dev_tom.core.eligibility"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.934614Z", "completed_at": "2024-08-23T19:21:33.941882Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.942321Z", "completed_at": "2024-08-23T19:21:33.942323Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.010155916213989258, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.core__patient", "compiled": true, "compiled_code": "\n\nselect * from dev_tom.core._stg_claims_patient\nunion all\nselect * from dev_tom.core._stg_clinical_patient\n\n", "relation_name": "dev_tom.core.patient"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.938608Z", "completed_at": "2024-08-23T19:21:33.942567Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.943170Z", "completed_at": "2024-08-23T19:21:33.943173Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.0052242279052734375, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__data_quality_for_pbi", "compiled": true, "compiled_code": "\n\nSELECT\n    data_source,\n    field_name,\n    table_name,\n    claim_type,\n    bucket_name,\n    field_value,\n    drill_down_key,\n    drill_down_value,\n    invalid_reason,\n    summary_sk,\n    frequency,\n\t'2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nFROM dev_tom.data_quality.data_quality_claims_for_pbi\n\nunion all\n\nSELECT\n    data_source,\n    field_name,\n    table_name,\n    'CLINICAL' AS claim_type,\n    bucket_name,\n    field_value,\n    drill_down_key,\n    drill_down_value,\n    invalid_reason,\n    summary_sk,\n    frequency,\n\t'2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nFROM dev_tom.data_quality.data_quality_clinical_for_pbi\n\n", "relation_name": "dev_tom.data_quality.data_quality_for_pbi"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.944055Z", "completed_at": "2024-08-23T19:21:33.948226Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:33.992222Z", "completed_at": "2024-08-23T19:21:33.992227Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.04954195022583008, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__crosswalk_field_to_mart_sk", "compiled": true, "compiled_code": "\n\n\n\nwith results as (\n\n    select distinct\n        table_name as input_layer_table_name\n      , claim_type\n      , field_name\n      , cast(NULL as TEXT) AS mart_name\n    from dev_tom.data_quality.data_quality_detail\n\n    union all\n\n    select\n        input_layer_table_name\n      , claim_type\n      , field_name\n      , mart_name\n    from dev_tom.data_quality._value_set_crosswalk_field_to_mart\n\n)\n\n, final as (\n\n    select\n        input_layer_table_name\n      , claim_type\n      , field_name\n      , mart_name\n      , DENSE_RANK () OVER (ORDER BY input_layer_table_name, claim_type, field_name) as table_claim_type_field_sk\n\t, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\n    from results\n    group by\n        input_layer_table_name\n      , claim_type\n      , field_name\n      , mart_name\n\n)\n\nselect * from final", "relation_name": "dev_tom.data_quality.crosswalk_field_to_mart_sk"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.946433Z", "completed_at": "2024-08-23T19:21:33.992519Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.061503Z", "completed_at": "2024-08-23T19:21:34.061508Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.1178748607635498, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__quality_trend", "compiled": true, "compiled_code": "\n\n\nwith cte as (\nselect try_cast( d.source_date as date ) as source_date_type\n    ,summary_sk\n    ,SUM(CASE WHEN bucket_name = 'valid' THEN 1 ELSE 0 END) as valid_num\n    ,SUM(CASE WHEN bucket_name <> 'null' THEN 1 ELSE 0 END) as fill_num\n    ,COUNT(drill_down_value) as denom\nfrom dev_tom.data_quality.data_quality_detail d\ngroup by\n    try_cast( d.source_date as date )\n    ,summary_sk\n\n)\n\nselect\n      c.first_day_of_month\n    , summary_sk\n    , sum(valid_num) as valid_num\n    , sum(fill_num) as fill_num\n    , sum(denom)  as denom\nfrom cte\nleft join dev_tom.reference_data.calendar c on cte.source_date_type = c.full_date\ngroup by\n      c.first_day_of_month\n    , summary_sk", "relation_name": "dev_tom.data_quality.quality_trend"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:33.948389Z", "completed_at": "2024-08-23T19:21:34.063396Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.066160Z", "completed_at": "2024-08-23T19:21:34.066164Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.1199958324432373, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.normalized_input__medical_claim", "compiled": true, "compiled_code": "\n\n\nwith __dbt__cte__normalized_input__stg_medical_claim as (\n\n\nselect\n      claim_id\n    , claim_line_number\n    , claim_type\n    , patient_id\n    , member_id\n    , payer\n    , plan\n    , claim_start_date\n    , claim_end_date\n    , claim_line_start_date\n    , claim_line_end_date\n    , admission_date\n    , discharge_date\n    , admit_source_code\n    , admit_type_code\n    , discharge_disposition_code\n    , place_of_service_code\n    , bill_type_code\n    , ms_drg_code\n    , apr_drg_code\n    , revenue_center_code\n    , service_unit_quantity\n    , hcpcs_code\n    , hcpcs_modifier_1\n    , hcpcs_modifier_2\n    , hcpcs_modifier_3\n    , hcpcs_modifier_4\n    , hcpcs_modifier_5\n    , rendering_npi\n    , rendering_tin\n    , billing_npi\n    , billing_tin\n    , facility_npi\n    , paid_date\n    , paid_amount\n    , allowed_amount\n    , charge_amount\n    , coinsurance_amount\n    , copayment_amount\n    , deductible_amount\n    , total_cost_amount\n    , diagnosis_code_type\n    , diagnosis_code_1\n    , diagnosis_code_2\n    , diagnosis_code_3\n    , diagnosis_code_4\n    , diagnosis_code_5\n    , diagnosis_code_6\n    , diagnosis_code_7\n    , diagnosis_code_8\n    , diagnosis_code_9\n    , diagnosis_code_10\n    , diagnosis_code_11\n    , diagnosis_code_12\n    , diagnosis_code_13\n    , diagnosis_code_14\n    , diagnosis_code_15\n    , diagnosis_code_16\n    , diagnosis_code_17\n    , diagnosis_code_18\n    , diagnosis_code_19\n    , diagnosis_code_20\n    , diagnosis_code_21\n    , diagnosis_code_22\n    , diagnosis_code_23\n    , diagnosis_code_24\n    , diagnosis_code_25\n    , diagnosis_poa_1\n    , diagnosis_poa_2\n    , diagnosis_poa_3\n    , diagnosis_poa_4\n    , diagnosis_poa_5\n    , diagnosis_poa_6\n    , diagnosis_poa_7\n    , diagnosis_poa_8\n    , diagnosis_poa_9\n    , diagnosis_poa_10\n    , diagnosis_poa_11\n    , diagnosis_poa_12\n    , diagnosis_poa_13\n    , diagnosis_poa_14\n    , diagnosis_poa_15\n    , diagnosis_poa_16\n    , diagnosis_poa_17\n    , diagnosis_poa_18\n    , diagnosis_poa_19\n    , diagnosis_poa_20\n    , diagnosis_poa_21\n    , diagnosis_poa_22\n    , diagnosis_poa_23\n    , diagnosis_poa_24\n    , diagnosis_poa_25\n    , procedure_code_type\n    , procedure_code_1\n    , procedure_code_2\n    , procedure_code_3\n    , procedure_code_4\n    , procedure_code_5\n    , procedure_code_6\n    , procedure_code_7\n    , procedure_code_8\n    , procedure_code_9\n    , procedure_code_10\n    , procedure_code_11\n    , procedure_code_12\n    , procedure_code_13\n    , procedure_code_14\n    , procedure_code_15\n    , procedure_code_16\n    , procedure_code_17\n    , procedure_code_18\n    , procedure_code_19\n    , procedure_code_20\n    , procedure_code_21\n    , procedure_code_22\n    , procedure_code_23\n    , procedure_code_24\n    , procedure_code_25\n    , procedure_date_1\n    , procedure_date_2\n    , procedure_date_3\n    , procedure_date_4\n    , procedure_date_5\n    , procedure_date_6\n    , procedure_date_7\n    , procedure_date_8\n    , procedure_date_9\n    , procedure_date_10\n    , procedure_date_11\n    , procedure_date_12\n    , procedure_date_13\n    , procedure_date_14\n    , procedure_date_15\n    , procedure_date_16\n    , procedure_date_17\n    , procedure_date_18\n    , procedure_date_19\n    , procedure_date_20\n    , procedure_date_21\n    , procedure_date_22\n    , procedure_date_23\n    , procedure_date_24\n    , procedure_date_25\n    , in_network_flag\n    , data_source\nfrom tuva.input_layer.medical_claim\n) select\n\tcast(med.claim_id as TEXT ) as claim_id\n\t, cast(med.claim_line_number as int ) as claim_line_number\n\t, cast(med.claim_type as TEXT ) as claim_type\n\t, cast(med.patient_id as TEXT ) as patient_id\n\t, cast(med.member_id as TEXT ) as member_id\n\t, cast(med.payer as TEXT ) as payer\n    , cast(med.plan as TEXT ) as plan\n\t, cast(coalesce(dates.minimum_claim_start_date, undetermined.claim_start_date) as date ) as claim_start_date\n\t, cast(coalesce(dates.maximum_claim_end_date, undetermined.claim_start_date) as date ) as claim_end_date\n\t, cast(coalesce(claim_line_dates.normalized_claim_line_start_date, undetermined.claim_line_start_date) as date ) as claim_line_start_date\n\t, cast(coalesce(claim_line_dates.normalized_claim_line_end_date, undetermined.claim_line_end_date) as date ) as claim_line_end_date\n\t, cast(coalesce(dates.minimum_admission_date, undetermined.admission_date) as date ) as admission_date\n\t, cast(coalesce(dates.maximum_discharge_date, undetermined.discharge_date) as date ) as discharge_date\n\t, cast(coalesce(ad_source.normalized_code, undetermined.admit_source_code) as TEXT ) as admit_source_code\n    , cast(coalesce(ad_source.normalized_description, undetermined.admit_source_description) as TEXT ) as admit_source_description\n\t, cast(coalesce(ad_type.normalized_code, undetermined.admit_type_code) as TEXT ) as admit_type_code\n    , cast(coalesce(ad_type.normalized_description, undetermined.admit_type_description) as TEXT ) as admit_type_description\n\t, cast(coalesce(disch_disp.normalized_code, undetermined.discharge_disposition_code) as TEXT ) as discharge_disposition_code\n    , cast(coalesce(disch_disp.normalized_description, undetermined.discharge_disposition_description) as TEXT ) as discharge_disposition_description\n\t, cast(coalesce(pos.normalized_code, undetermined.place_of_service_code) as TEXT ) as place_of_service_code\n    , cast(coalesce(pos.normalized_description, undetermined.place_of_service_description) as TEXT ) as place_of_service_description\n\t, cast(coalesce(bill.normalized_code, undetermined.bill_type_code) as TEXT ) as bill_type_code\n    , cast(coalesce(bill.normalized_description, undetermined.bill_type_description) as TEXT ) as bill_type_description\n\t, cast(coalesce(ms.normalized_code, undetermined.ms_drg_code) as TEXT ) as ms_drg_code\n    , cast(coalesce(ms.normalized_description, undetermined.ms_drg_description) as TEXT ) as ms_drg_description\n\t, cast(coalesce(apr.normalized_code, undetermined.apr_drg_code) as TEXT ) as apr_drg_code\n    , cast(coalesce(apr.normalized_description, undetermined.apr_drg_description) as TEXT ) as apr_drg_description\n\t, cast(coalesce(rev.normalized_code, undetermined.revenue_center_code) as TEXT ) as revenue_center_code\n    , cast(coalesce(rev.normalized_description, undetermined.revenue_center_description) as TEXT ) as revenue_center_description\n\t, cast(med.service_unit_quantity as TEXT ) as service_unit_quantity\n\t, cast(med.hcpcs_code as TEXT ) as hcpcs_code\n\t, cast(med.hcpcs_modifier_1 as TEXT ) as hcpcs_modifier_1\n\t, cast(med.hcpcs_modifier_2 as TEXT ) as hcpcs_modifier_2\n\t, cast(med.hcpcs_modifier_3 as TEXT ) as hcpcs_modifier_3\n\t, cast(med.hcpcs_modifier_4 as TEXT ) as hcpcs_modifier_4\n\t, cast(med.hcpcs_modifier_5 as TEXT ) as hcpcs_modifier_5\n\t, cast(coalesce(med_npi.normalized_rendering_npi, undetermined.rendering_npi) as TEXT ) as rendering_id\n    , cast(med.rendering_tin as TEXT ) as rendering_tin\n    , cast(coalesce(med_npi.normalized_rendering_name, undetermined.rendering_name) as TEXT ) as rendering_name\n\t, cast(coalesce(med_npi.normalized_billing_npi, undetermined.billing_npi) as TEXT ) as billing_id\n    , cast(med.billing_tin as TEXT ) as billing_tin\n    , cast(coalesce(med_npi.normalized_billing_name, undetermined.billing_name) as TEXT ) as billing_name\n\t, cast(coalesce(med_npi.normalized_facility_npi, undetermined.facility_npi) as TEXT ) as facility_id\n\t, cast(coalesce(med_npi.normalized_facility_name, undetermined.facility_name) as TEXT ) as facility_name\n    , cast(med.paid_date as date ) as paid_date\n\t, cast(med.paid_amount as numeric(28,6) ) as paid_amount\n\t, cast(med.allowed_amount as numeric(28,6) ) as allowed_amount\n\t, cast(med.charge_amount as numeric(28,6) ) as charge_amount\n\t, cast(med.coinsurance_amount as numeric(28,6) ) as coinsurance_amount\n\t, cast(med.copayment_amount as numeric(28,6) ) as copayment_amount\n\t, cast(med.deductible_amount as numeric(28,6) ) as deductible_amount\n\t, cast(med.total_cost_amount as numeric(28,6) ) as total_cost_amount\n\t, cast(med.diagnosis_code_type as TEXT ) as diagnosis_code_type\n\t, cast(coalesce(dx_code.diagnosis_code_1, undetermined.diagnosis_code_1) as TEXT ) as diagnosis_code_1\n\t, cast(coalesce(dx_code.diagnosis_code_2, undetermined.diagnosis_code_2) as TEXT ) as diagnosis_code_2\n\t, cast(coalesce(dx_code.diagnosis_code_3, undetermined.diagnosis_code_3) as TEXT ) as diagnosis_code_3\n\t, cast(coalesce(dx_code.diagnosis_code_4, undetermined.diagnosis_code_4) as TEXT ) as diagnosis_code_4\n\t, cast(coalesce(dx_code.diagnosis_code_5, undetermined.diagnosis_code_5) as TEXT ) as diagnosis_code_5\n\t, cast(coalesce(dx_code.diagnosis_code_6, undetermined.diagnosis_code_6) as TEXT ) as diagnosis_code_6\n\t, cast(coalesce(dx_code.diagnosis_code_7, undetermined.diagnosis_code_7) as TEXT ) as diagnosis_code_7\n\t, cast(coalesce(dx_code.diagnosis_code_8, undetermined.diagnosis_code_8) as TEXT ) as diagnosis_code_8\n\t, cast(coalesce(dx_code.diagnosis_code_9, undetermined.diagnosis_code_9) as TEXT ) as diagnosis_code_9\n\t, cast(coalesce(dx_code.diagnosis_code_10, undetermined.diagnosis_code_10) as TEXT ) as diagnosis_code_10\n\t, cast(coalesce(dx_code.diagnosis_code_11, undetermined.diagnosis_code_11) as TEXT ) as diagnosis_code_11\n\t, cast(coalesce(dx_code.diagnosis_code_12, undetermined.diagnosis_code_12) as TEXT ) as diagnosis_code_12\n\t, cast(coalesce(dx_code.diagnosis_code_13, undetermined.diagnosis_code_13) as TEXT ) as diagnosis_code_13\n\t, cast(coalesce(dx_code.diagnosis_code_14, undetermined.diagnosis_code_14) as TEXT ) as diagnosis_code_14\n\t, cast(coalesce(dx_code.diagnosis_code_15, undetermined.diagnosis_code_15) as TEXT ) as diagnosis_code_15\n\t, cast(coalesce(dx_code.diagnosis_code_16, undetermined.diagnosis_code_16) as TEXT ) as diagnosis_code_16\n\t, cast(coalesce(dx_code.diagnosis_code_17, undetermined.diagnosis_code_17) as TEXT ) as diagnosis_code_17\n\t, cast(coalesce(dx_code.diagnosis_code_18, undetermined.diagnosis_code_18) as TEXT ) as diagnosis_code_18\n\t, cast(coalesce(dx_code.diagnosis_code_19, undetermined.diagnosis_code_19) as TEXT ) as diagnosis_code_19\n\t, cast(coalesce(dx_code.diagnosis_code_20, undetermined.diagnosis_code_20) as TEXT ) as diagnosis_code_20\n\t, cast(coalesce(dx_code.diagnosis_code_21, undetermined.diagnosis_code_21) as TEXT ) as diagnosis_code_21\n\t, cast(coalesce(dx_code.diagnosis_code_22, undetermined.diagnosis_code_22) as TEXT ) as diagnosis_code_22\n\t, cast(coalesce(dx_code.diagnosis_code_23, undetermined.diagnosis_code_23) as TEXT ) as diagnosis_code_23\n\t, cast(coalesce(dx_code.diagnosis_code_24, undetermined.diagnosis_code_24) as TEXT ) as diagnosis_code_24\n\t, cast(coalesce(dx_code.diagnosis_code_25, undetermined.diagnosis_code_25) as TEXT ) as diagnosis_code_25\n\t, cast(coalesce(poa.diagnosis_poa_1, undetermined.diagnosis_poa_1) as TEXT ) as diagnosis_poa_1\n\t, cast(coalesce(poa.diagnosis_poa_2, undetermined.diagnosis_poa_2) as TEXT ) as diagnosis_poa_2\n\t, cast(coalesce(poa.diagnosis_poa_3, undetermined.diagnosis_poa_3) as TEXT ) as diagnosis_poa_3\n\t, cast(coalesce(poa.diagnosis_poa_4, undetermined.diagnosis_poa_4) as TEXT ) as diagnosis_poa_4\n\t, cast(coalesce(poa.diagnosis_poa_5, undetermined.diagnosis_poa_5) as TEXT ) as diagnosis_poa_5\n\t, cast(coalesce(poa.diagnosis_poa_6, undetermined.diagnosis_poa_6) as TEXT ) as diagnosis_poa_6\n\t, cast(coalesce(poa.diagnosis_poa_7, undetermined.diagnosis_poa_7) as TEXT ) as diagnosis_poa_7\n\t, cast(coalesce(poa.diagnosis_poa_8, undetermined.diagnosis_poa_8) as TEXT ) as diagnosis_poa_8\n\t, cast(coalesce(poa.diagnosis_poa_9, undetermined.diagnosis_poa_9) as TEXT ) as diagnosis_poa_9\n\t, cast(coalesce(poa.diagnosis_poa_10, undetermined.diagnosis_poa_10) as TEXT ) as diagnosis_poa_10\n\t, cast(coalesce(poa.diagnosis_poa_11, undetermined.diagnosis_poa_11) as TEXT ) as diagnosis_poa_11\n\t, cast(coalesce(poa.diagnosis_poa_12, undetermined.diagnosis_poa_12) as TEXT ) as diagnosis_poa_12\n\t, cast(coalesce(poa.diagnosis_poa_13, undetermined.diagnosis_poa_13) as TEXT ) as diagnosis_poa_13\n\t, cast(coalesce(poa.diagnosis_poa_14, undetermined.diagnosis_poa_14) as TEXT ) as diagnosis_poa_14\n\t, cast(coalesce(poa.diagnosis_poa_15, undetermined.diagnosis_poa_15) as TEXT ) as diagnosis_poa_15\n\t, cast(coalesce(poa.diagnosis_poa_16, undetermined.diagnosis_poa_16) as TEXT ) as diagnosis_poa_16\n\t, cast(coalesce(poa.diagnosis_poa_17, undetermined.diagnosis_poa_17) as TEXT ) as diagnosis_poa_17\n\t, cast(coalesce(poa.diagnosis_poa_18, undetermined.diagnosis_poa_18) as TEXT ) as diagnosis_poa_18\n\t, cast(coalesce(poa.diagnosis_poa_19, undetermined.diagnosis_poa_19) as TEXT ) as diagnosis_poa_19\n\t, cast(coalesce(poa.diagnosis_poa_20, undetermined.diagnosis_poa_20) as TEXT ) as diagnosis_poa_20\n\t, cast(coalesce(poa.diagnosis_poa_21, undetermined.diagnosis_poa_21) as TEXT ) as diagnosis_poa_21\n\t, cast(coalesce(poa.diagnosis_poa_22, undetermined.diagnosis_poa_22) as TEXT ) as diagnosis_poa_22\n\t, cast(coalesce(poa.diagnosis_poa_23, undetermined.diagnosis_poa_23) as TEXT ) as diagnosis_poa_23\n\t, cast(coalesce(poa.diagnosis_poa_24, undetermined.diagnosis_poa_24) as TEXT ) as diagnosis_poa_24\n\t, cast(coalesce(poa.diagnosis_poa_25, undetermined.diagnosis_poa_25) as TEXT ) as diagnosis_poa_25\n\t, cast(med.procedure_code_type as TEXT ) as procedure_code_type\n\t, cast(coalesce(px_code.procedure_code_1, undetermined.procedure_code_1) as TEXT ) as procedure_code_1\n\t, cast(coalesce(px_code.procedure_code_2, undetermined.procedure_code_2) as TEXT ) as procedure_code_2\n\t, cast(coalesce(px_code.procedure_code_3, undetermined.procedure_code_3) as TEXT ) as procedure_code_3\n\t, cast(coalesce(px_code.procedure_code_4, undetermined.procedure_code_4) as TEXT ) as procedure_code_4\n\t, cast(coalesce(px_code.procedure_code_5, undetermined.procedure_code_5) as TEXT ) as procedure_code_5\n\t, cast(coalesce(px_code.procedure_code_6, undetermined.procedure_code_6) as TEXT ) as procedure_code_6\n\t, cast(coalesce(px_code.procedure_code_7, undetermined.procedure_code_7) as TEXT ) as procedure_code_7\n\t, cast(coalesce(px_code.procedure_code_8, undetermined.procedure_code_8) as TEXT ) as procedure_code_8\n\t, cast(coalesce(px_code.procedure_code_9, undetermined.procedure_code_9) as TEXT ) as procedure_code_9\n\t, cast(coalesce(px_code.procedure_code_10, undetermined.procedure_code_10) as TEXT ) as procedure_code_10\n\t, cast(coalesce(px_code.procedure_code_11, undetermined.procedure_code_11) as TEXT ) as procedure_code_11\n\t, cast(coalesce(px_code.procedure_code_12, undetermined.procedure_code_12) as TEXT ) as procedure_code_12\n\t, cast(coalesce(px_code.procedure_code_13, undetermined.procedure_code_13) as TEXT ) as procedure_code_13\n\t, cast(coalesce(px_code.procedure_code_14, undetermined.procedure_code_14) as TEXT ) as procedure_code_14\n\t, cast(coalesce(px_code.procedure_code_15, undetermined.procedure_code_15) as TEXT ) as procedure_code_15\n\t, cast(coalesce(px_code.procedure_code_16, undetermined.procedure_code_16) as TEXT ) as procedure_code_16\n\t, cast(coalesce(px_code.procedure_code_17, undetermined.procedure_code_17) as TEXT ) as procedure_code_17\n\t, cast(coalesce(px_code.procedure_code_18, undetermined.procedure_code_18) as TEXT ) as procedure_code_18\n\t, cast(coalesce(px_code.procedure_code_19, undetermined.procedure_code_19) as TEXT ) as procedure_code_19\n\t, cast(coalesce(px_code.procedure_code_20, undetermined.procedure_code_20) as TEXT ) as procedure_code_20\n\t, cast(coalesce(px_code.procedure_code_21, undetermined.procedure_code_21) as TEXT ) as procedure_code_21\n\t, cast(coalesce(px_code.procedure_code_22, undetermined.procedure_code_22) as TEXT ) as procedure_code_22\n\t, cast(coalesce(px_code.procedure_code_23, undetermined.procedure_code_23) as TEXT ) as procedure_code_23\n\t, cast(coalesce(px_code.procedure_code_24, undetermined.procedure_code_24) as TEXT ) as procedure_code_24\n\t, cast(coalesce(px_code.procedure_code_25, undetermined.procedure_code_25) as TEXT ) as procedure_code_25\n\t, cast(coalesce(px_date.procedure_date_1, undetermined.procedure_date_1) as date ) as procedure_date_1\n\t, cast(coalesce(px_date.procedure_date_2, undetermined.procedure_date_2) as date ) as procedure_date_2\n\t, cast(coalesce(px_date.procedure_date_3, undetermined.procedure_date_3) as date ) as procedure_date_3\n\t, cast(coalesce(px_date.procedure_date_4, undetermined.procedure_date_4) as date ) as procedure_date_4\n\t, cast(coalesce(px_date.procedure_date_5, undetermined.procedure_date_5) as date ) as procedure_date_5\n\t, cast(coalesce(px_date.procedure_date_6, undetermined.procedure_date_6) as date ) as procedure_date_6\n\t, cast(coalesce(px_date.procedure_date_7, undetermined.procedure_date_7) as date ) as procedure_date_7\n\t, cast(coalesce(px_date.procedure_date_8, undetermined.procedure_date_8) as date ) as procedure_date_8\n\t, cast(coalesce(px_date.procedure_date_9, undetermined.procedure_date_9) as date ) as procedure_date_9\n\t, cast(coalesce(px_date.procedure_date_10, undetermined.procedure_date_10) as date ) as procedure_date_10\n\t, cast(coalesce(px_date.procedure_date_11, undetermined.procedure_date_11) as date ) as procedure_date_11\n\t, cast(coalesce(px_date.procedure_date_12, undetermined.procedure_date_12) as date ) as procedure_date_12\n\t, cast(coalesce(px_date.procedure_date_13, undetermined.procedure_date_13) as date ) as procedure_date_13\n\t, cast(coalesce(px_date.procedure_date_14, undetermined.procedure_date_14) as date ) as procedure_date_14\n\t, cast(coalesce(px_date.procedure_date_15, undetermined.procedure_date_15) as date ) as procedure_date_15\n\t, cast(coalesce(px_date.procedure_date_16, undetermined.procedure_date_16) as date ) as procedure_date_16\n\t, cast(coalesce(px_date.procedure_date_17, undetermined.procedure_date_17) as date ) as procedure_date_17\n\t, cast(coalesce(px_date.procedure_date_18, undetermined.procedure_date_18) as date ) as procedure_date_18\n\t, cast(coalesce(px_date.procedure_date_19, undetermined.procedure_date_19) as date ) as procedure_date_19\n\t, cast(coalesce(px_date.procedure_date_20, undetermined.procedure_date_20) as date ) as procedure_date_20\n\t, cast(coalesce(px_date.procedure_date_21, undetermined.procedure_date_21) as date ) as procedure_date_21\n\t, cast(coalesce(px_date.procedure_date_22, undetermined.procedure_date_22) as date ) as procedure_date_22\n\t, cast(coalesce(px_date.procedure_date_23, undetermined.procedure_date_23) as date ) as procedure_date_23\n\t, cast(coalesce(px_date.procedure_date_24, undetermined.procedure_date_24) as date ) as procedure_date_24\n\t, cast(coalesce(px_date.procedure_date_25, undetermined.procedure_date_25) as date ) as procedure_date_25\n\t, cast(med.data_source as TEXT ) as data_source\n    , cast(med.in_network_flag as int ) as in_network_flag\n    , cast('2024-08-23 19:21:27.787896+00:00' as TEXT ) as tuva_last_run\nfrom __dbt__cte__normalized_input__stg_medical_claim med\nleft join dev_tom.claims_preprocessing._int_normalized_input_admit_source_final ad_source\n    on med.claim_id = ad_source.claim_id\n    and med.data_source = ad_source.data_source\nleft join dev_tom.claims_preprocessing._int_normalized_input_admit_type_final ad_type\n    on med.claim_id = ad_type.claim_id\n    and med.data_source = ad_type.data_source\nleft join dev_tom.claims_preprocessing._int_normalized_input_apr_drg_final apr\n    on med.claim_id = apr.claim_id\n    and med.data_source = apr.data_source\nleft join dev_tom.claims_preprocessing._int_normalized_input_bill_type_final bill\n    on med.claim_id = bill.claim_id\n    and med.data_source = bill.data_source\nleft join dev_tom.claims_preprocessing._int_normalized_input_medical_claim_date_normalize claim_line_dates\n    on med.claim_id = claim_line_dates.claim_id\n    and med.claim_line_number = claim_line_dates.claim_line_number\n    and med.data_source = claim_line_dates.data_source\nleft join dev_tom.claims_preprocessing._int_normalized_input_medical_date_aggregation dates\n    on med.claim_id = dates.claim_id\n    and med.data_source = dates.data_source\nleft join dev_tom.claims_preprocessing._int_normalized_input_medical_npi_normalize med_npi\n    on med.claim_id = med_npi.claim_id\n    and med.claim_line_number = med_npi.claim_line_number\n    and med.data_source = med_npi.data_source\nleft join dev_tom.claims_preprocessing._int_normalized_input_discharge_disposition_final disch_disp\n    on med.claim_id = disch_disp.claim_id\n    and med.data_source = disch_disp.data_source\nleft join dev_tom.claims_preprocessing._int_normalized_input_ms_drg_final ms\n    on med.claim_id = ms.claim_id\n    and med.data_source = ms.data_source\nleft join dev_tom.claims_preprocessing._int_normalized_input_place_of_service_normalize pos\n    on med.claim_id = pos.claim_id\n    and med.claim_line_number = pos.claim_line_number\n    and med.data_source = pos.data_source\nleft join dev_tom.claims_preprocessing._int_normalized_input_diagnosis_code_final dx_code\n    on med.claim_id = dx_code.claim_id\n    and med.data_source = dx_code.data_source\nleft join dev_tom.claims_preprocessing._int_normalized_input_present_on_admit_final poa\n    on med.claim_id = poa.claim_id\n    and med.data_source = poa.data_source\nleft join dev_tom.claims_preprocessing._int_normalized_input_procedure_code_final px_code\n    on med.claim_id = px_code.claim_id\n    and med.data_source = px_code.data_source\nleft join dev_tom.claims_preprocessing._int_normalized_input_procedure_date_final px_date\n    on med.claim_id = px_date.claim_id\n    and med.data_source = px_date.data_source\nleft join dev_tom.claims_preprocessing._int_normalized_input_revenue_center_normalize rev\n    on med.claim_id = rev.claim_id\n    and med.claim_line_number = rev.claim_line_number\n    and med.data_source = rev.data_source\nleft join dev_tom.claims_preprocessing._int_normalized_input_undetermined_claim_type undetermined\n    on med.claim_id = undetermined.claim_id\n    and med.claim_line_number = undetermined.claim_line_number\n    and med.data_source = undetermined.data_source", "relation_name": "dev_tom.claims_preprocessing.normalized_input_medical_claim"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.071839Z", "completed_at": "2024-08-23T19:21:34.075951Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.076336Z", "completed_at": "2024-08-23T19:21:34.076340Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.0059051513671875, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.mart_review__stg_pharmacy_claim", "compiled": true, "compiled_code": "\n\nselect mc.*,\ncast(c.year_month_int as TEXT) as year_month\nFROM dev_tom.core.pharmacy_claim  mc\nleft join dev_tom.reference_data.calendar c on coalesce(mc.paid_date,mc.dispensing_date) = c.full_date", "relation_name": "dev_tom.data_quality.mart_review__stg_pharmacy_claim"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.082315Z", "completed_at": "2024-08-23T19:21:34.086199Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.089700Z", "completed_at": "2024-08-23T19:21:34.089703Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.008526086807250977, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.the_tuva_project.unique_core__pharmacy_claim_pharmacy_claim_id.a91e86c79c", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    pharmacy_claim_id as unique_field,\n    count(*) as n_records\n\nfrom dev_tom.core.pharmacy_claim\nwhere pharmacy_claim_id is not null\ngroup by pharmacy_claim_id\nhaving count(*) > 1\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.086349Z", "completed_at": "2024-08-23T19:21:34.090660Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.091160Z", "completed_at": "2024-08-23T19:21:34.091163Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.007206916809082031, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.core__member_months", "compiled": true, "compiled_code": "\n\nwith month_start_and_end_dates as (\n  select\n    year || \n\n    case when 2 = 0\n        then ''\n    else\n        right(\n            '0' || month,\n            2\n        )\n    end as year_month\n    , min(full_date) as month_start_date\n    , max(full_date) as month_end_date\n  from dev_tom.reference_data.calendar\n  group by year, month, year_month\n)\n\nselect distinct\n    a.patient_id\n  , year_month\n  , a.payer\n  , a.plan\n  , data_source\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.eligibility a\ninner join month_start_and_end_dates b\n  on a.enrollment_start_date <= b.month_end_date\n  and a.enrollment_end_date >= b.month_start_date", "relation_name": "dev_tom.core.member_months"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.094798Z", "completed_at": "2024-08-23T19:21:34.098570Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.098983Z", "completed_at": "2024-08-23T19:21:34.098985Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.00802302360534668, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.the_tuva_project.unique_core__eligibility_eligibility_id.f0f050366a", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    eligibility_id as unique_field,\n    count(*) as n_records\n\nfrom dev_tom.core.eligibility\nwhere eligibility_id is not null\ngroup by eligibility_id\nhaving count(*) > 1\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.110479Z", "completed_at": "2024-08-23T19:21:34.114369Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.114958Z", "completed_at": "2024-08-23T19:21:34.114961Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.00554203987121582, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.mart_review__patient", "compiled": true, "compiled_code": "\n\nSELECT *,\n    patient_id || '|' || data_source as patient_data_source_key\nFROM dev_tom.core.patient", "relation_name": "dev_tom.data_quality.mart_review__patient"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.118636Z", "completed_at": "2024-08-23T19:21:34.125642Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.126012Z", "completed_at": "2024-08-23T19:21:34.126015Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.008533000946044922, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.the_tuva_project.unique_core__patient_patient_id.8fc869ed1e", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    patient_id as unique_field,\n    count(*) as n_records\n\nfrom dev_tom.core.patient\nwhere patient_id is not null\ngroup by patient_id\nhaving count(*) > 1\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.121251Z", "completed_at": "2024-08-23T19:21:34.125830Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.126333Z", "completed_at": "2024-08-23T19:21:34.126336Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.008655071258544922, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.data_quality__summary", "compiled": true, "compiled_code": "\n\nWITH CTE AS (\n    SELECT DISTINCT fm.field_name\n    ,fm.input_layer_table_name\n    ,fm.claim_type\n    ,table_claim_type_field_sk\n    FROM dev_tom.data_quality.crosswalk_field_to_mart_sk fm\n)\n\nSELECT\n    summary_sk,\n    fm.table_claim_type_field_sk,\n    data_source,\n    x.table_name,\n    x.claim_type,\n    x.field_name,\n    sct.red,\n    sct.green,\n    sum(case when bucket_name = 'valid' then 1 else 0 end) as valid_num,\n    sum(case when bucket_name <> 'null' then 1 else 0 end) as fill_num,\n    count(drill_down_value) as denom,\n    '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nFROM\n    dev_tom.data_quality.data_quality_detail x\nLEFT JOIN CTE fm\n    on x.field_name = fm.field_name\n    and\n    fm.input_layer_table_name = x.table_name\n    and\n    fm.claim_type = x.claim_type\nLEFT JOIN dev_tom.data_quality._value_set_crosswalk_field_info sct\n    on x.field_name = sct.field_name\n    and\n    sct.input_layer_table_name = x.table_name\n    and\n    sct.claim_type = x.claim_type\nGROUP BY\n    summary_sk,\n    data_source,\n    fm.table_claim_type_field_sk,\n    x.claim_type,\n    x.table_name,\n    x.field_name,\n    sct.red,\n    sct.green", "relation_name": "dev_tom.data_quality.summary"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.132283Z", "completed_at": "2024-08-23T19:21:34.137326Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.138023Z", "completed_at": "2024-08-23T19:21:34.138026Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.010235071182250977, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.the_tuva_project.dbt_utils_unique_combination_of_columns_normalized_input__medical_claim_claim_id__claim_line_number.6d94c0c08d", "compiled": true, "compiled_code": "\n\n\n\n\n\nwith validation_errors as (\n\n    select\n        claim_id, claim_line_number\n    from dev_tom.claims_preprocessing.normalized_input_medical_claim\n    group by claim_id, claim_line_number\n    having count(*) > 1\n\n)\n\nselect *\nfrom validation_errors\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.139028Z", "completed_at": "2024-08-23T19:21:34.157560Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.159655Z", "completed_at": "2024-08-23T19:21:34.159659Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.021862030029296875, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.hcc_suspecting__int_all_medications", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__hcc_suspecting__stg_core__medication as (\n\nselect\n      patient_id\n    , dispensing_date\n    , source_code\n    , source_code_type\n    , ndc_code\n    , rxnorm_code\n    , data_source\nfrom dev_tom.core.medication\n\n\n),  __dbt__cte__hcc_suspecting__stg_core__pharmacy_claim as (\n\nselect\n      patient_id\n    , dispensing_date\n    , ndc_code\n    , paid_date\n    , data_source\nfrom dev_tom.core.pharmacy_claim\n\n\n), medications as (\n\n    select\n          patient_id\n        , dispensing_date\n        , source_code\n        , source_code_type\n        , ndc_code\n        , rxnorm_code\n        , data_source\n    from __dbt__cte__hcc_suspecting__stg_core__medication\n\n)\n\n, pharmacy_claims as (\n\n    select\n          patient_id\n        , coalesce(dispensing_date, paid_date) as dispensing_date\n        , ndc_code as drug_code\n        , 'ndc' as code_system\n        , data_source\n    from __dbt__cte__hcc_suspecting__stg_core__pharmacy_claim\n\n)\n\n, ndc_medications as (\n\n    select\n          patient_id\n        , dispensing_date\n        , ndc_code as drug_code\n        , 'ndc' as code_system\n        , data_source\n    from medications\n    where ndc_code is not null\n\n    union all\n\n    select\n          patient_id\n        , dispensing_date\n        , source_code as drug_code\n        , 'ndc' as code_system\n        , data_source\n    from medications\n    where lower(source_code_type) = 'ndc'\n\n)\n\n, rxnorm_medications as (\n\n    select\n          patient_id\n        , dispensing_date\n        , rxnorm_code as drug_code\n        , 'rxnorm' as code_system\n        , data_source\n    from medications\n    where rxnorm_code is not null\n\n    union all\n\n    select\n          patient_id\n        , dispensing_date\n        , source_code as drug_code\n        , 'rxnorm' as code_system\n        , data_source\n    from medications\n    where lower(source_code_type) = 'rxnorm'\n\n)\n\n, unioned as (\n\n    select * from pharmacy_claims\n    union all\n    select * from ndc_medications\n    union all\n    select * from rxnorm_medications\n\n)\n\n, add_data_types as (\n\n    select\n          cast(patient_id as TEXT) as patient_id\n        , cast(dispensing_date as date) as dispensing_date\n        , cast(drug_code as TEXT) as drug_code\n        , cast(code_system as TEXT) as code_system\n        , cast(data_source as TEXT) as data_source\n    from unioned\n\n)\n\nselect\n      patient_id\n    , dispensing_date\n    , drug_code\n    , code_system\n    , data_source\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.hcc_suspecting._int_all_medications"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.149559Z", "completed_at": "2024-08-23T19:21:34.159487Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.160297Z", "completed_at": "2024-08-23T19:21:34.160300Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.022034883499145508, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.pharmacy__int_claims_current_cost", "compiled": true, "compiled_code": "\nwith __dbt__cte__pharmacy__stg_pharmacy_claim as (\n\n\nselect \n    p.ndc_code\n  , n.fda_description as ndc_description\n  , p.data_source\n  , n.rxcui\n  , p.paid_amount\n  , p.allowed_amount\n  , p.claim_id\n  , p.claim_line_number\n  , p.patient_id\n  , p.member_id\n  , p.prescribing_provider_id\n  , p.dispensing_provider_id\n  , p.dispensing_date\n  , p.quantity\n  , p.days_supply\n  , p.refills\n  , p.paid_date\nfrom dev_tom.core.pharmacy_claim as p\nleft join dev_tom.terminology.ndc as n \n  on p.ndc_code = n.ndc\n) /* All claims, current cost*/\n\nselect \n    p.ndc_code\n  , p.ndc_description\n  , p.data_source\n  , p.rxcui\n  , r.brand_vs_generic\n  , case \n      when ga.brand_with_generic_available is not null \n        then 'brand_with_generic_available' \n      else null \n    end as generic_available\n  , sum(paid_amount) as paid_amount\n  , count(distinct claim_id) as claim_count\n  , sum(paid_amount) / count(distinct claim_id) as cost_per_claim\n  , sum(quantity) as total_units\n  , case \n      when sum(quantity) > 0 \n      and  sum(paid_amount) > 0 \n      then sum(paid_amount) / sum(quantity) \n      else null \n    end as cost_per_unit\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom __dbt__cte__pharmacy__stg_pharmacy_claim as p\nleft join dev_tom.terminology.rxnorm_brand_generic as r \n  on p.rxcui = r.product_rxcui\nleft join dev_tom.pharmacy._int_brand_with_generic_available as ga \n  on p.rxcui = ga.brand_with_generic_available\nwhere p.ndc_code is not null\ngroup by \n    case \n      when ga.brand_with_generic_available is not null \n        then 'brand_with_generic_available' \n      else null \n    end\n  , r.brand_vs_generic\n  , p.ndc_code\n  , p.rxcui\n  , p.ndc_description\n  , p.data_source", "relation_name": "dev_tom.pharmacy._int_claims_current_cost"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.157706Z", "completed_at": "2024-08-23T19:21:34.160598Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.161210Z", "completed_at": "2024-08-23T19:21:34.161213Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.012393951416015625, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.ahrq_measures__stg_pqi_member_months", "compiled": true, "compiled_code": "\n\nwith\n\ndate_int as (\n    select distinct\n        replace(year_month,'-','') yyyymm\n      , first_day_of_month\n    from dev_tom.reference_data.calendar as c\n)\n\nselect \n    data_source\n  , patient_id\n  , first_day_of_month\n  , d.yyyymm as year_month\n\nfrom \n    dev_tom.core.member_months mm\ninner join date_int d on mm.year_month = d.yyyymm", "relation_name": "dev_tom.ahrq_measures._stg_pqi_member_months"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.162603Z", "completed_at": "2024-08-23T19:21:34.170830Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.171372Z", "completed_at": "2024-08-23T19:21:34.171375Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.009920120239257812, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.claims_enrollment__flag_claims_with_enrollment", "compiled": true, "compiled_code": "\n\n\nwith claim_dates as(\n    select\n         claim_id || '-' || claim_line_number as medical_claim_id\n        , patient_id\n        , payer\n        , plan\n        , coalesce(claim_line_start_date, claim_start_date, admission_date) as inferred_claim_start_date\n        , coalesce(claim_line_end_date, claim_end_date, discharge_date) as inferred_claim_end_date\n        , case\n            when claim_line_start_date is not null then 'claim_line_start_date'\n            when claim_line_start_date is null and claim_start_date is not null then 'claim_start_date'\n            when claim_line_start_date is null and claim_start_date is null and admission_date is not null then 'admission_date'\n        end as inferred_claim_start_column_used\n        , case\n            when claim_line_end_date is not null then 'claim_line_end_date'\n            when claim_line_end_date is null and claim_end_date is not null then 'claim_end_date'\n            when claim_line_end_date is null and claim_end_date is null and discharge_date is not null then 'discharge_date'\n        end as inferred_claim_end_column_used\n    from dev_tom.claims_preprocessing.normalized_input_medical_claim\n)\n\n, claim_year_month as(\n    select\n        medical_claim_id\n        , patient_id\n        , payer\n        , plan\n        , inferred_claim_start_date\n        , inferred_claim_end_date\n        , inferred_claim_start_column_used\n        , inferred_claim_end_column_used\n\n        , date_part('year', inferred_claim_start_date) || \n\n    case when 2 = 0\n        then ''\n    else\n        right(\n            '0' || date_part('month', inferred_claim_start_date),\n            2\n        )\n    end as inferred_claim_start_year_month\n\n    , date_part('year', inferred_claim_end_date) || \n\n    case when 2 = 0\n        then ''\n    else\n        right(\n            '0' || date_part('month', inferred_claim_end_date),\n            2\n        )\n    end as inferred_claim_end_year_month\n\nfrom claim_dates\n\n)\n\nselect distinct\n    claim.medical_claim_id\n    , claim.patient_id\n    , claim.payer\n    , claim.plan\n    , claim.inferred_claim_start_year_month\n    , claim.inferred_claim_end_year_month\n    , claim.inferred_claim_start_column_used\n    , claim.inferred_claim_end_column_used\n    , cast('2024-08-23 19:21:27.787896+00:00' as timestamp ) as tuva_last_run\nfrom dev_tom.core.member_months mm\ninner join claim_year_month claim\n    on mm.patient_id = claim.patient_id\n    and mm.payer = claim.payer\n    and mm.plan = claim.plan\n    and mm.year_month >= claim.inferred_claim_start_year_month\n    and mm.year_month <= claim.inferred_claim_end_year_month", "relation_name": "dev_tom.claims_preprocessing.flag_claims_with_enrollment"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.169124Z", "completed_at": "2024-08-23T19:21:34.171213Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.171820Z", "completed_at": "2024-08-23T19:21:34.171823Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.009429931640625, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.mart_review__stg_member_month", "compiled": true, "compiled_code": "\n\nwith cte as\n(\nselect distinct year_month_int\n,full_date\nfrom dev_tom.reference_data.calendar c\nwhere day = 1\n\n)\n\nselect  mm.*\n,c.year_month_int\n,c.full_date as year_month_date\nFROM dev_tom.core.member_months mm\nleft join cte c on cast(mm.year_month as int) = c.year_month_int", "relation_name": "dev_tom.data_quality.mart_review__stg_member_month"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.172838Z", "completed_at": "2024-08-23T19:21:34.184465Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.215960Z", "completed_at": "2024-08-23T19:21:34.215963Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.04436492919921875, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.ahrq_measures__int_pqi_shared_exclusion_missing_age", "compiled": true, "compiled_code": "\n\nwith __dbt__cte__ahrq_measures__stg_pqi_patient as (\n\n\nselect \n    data_source\n  , birth_date\n  , patient_id\n  , sex\nfrom \n    dev_tom.core.patient\n) /* Exclude patients with missing age */\nselect \n    data_source\n    , patient_id\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom __dbt__cte__ahrq_measures__stg_pqi_patient\nwhere birth_date is null", "relation_name": "dev_tom.ahrq_measures._int_pqi_shared_exclusions_missing_age"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.175763Z", "completed_at": "2024-08-23T19:21:34.216525Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.216894Z", "completed_at": "2024-08-23T19:21:34.216897Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.04426908493041992, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.ahrq_measures__int_pqi_shared_exclusion_missing_gender", "compiled": true, "compiled_code": "\n\nwith __dbt__cte__ahrq_measures__stg_pqi_patient as (\n\n\nselect \n    data_source\n  , birth_date\n  , patient_id\n  , sex\nfrom \n    dev_tom.core.patient\n) -- Exclude patients with undefined or missing gender\nselect \n    data_source\n  , patient_id\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom __dbt__cte__ahrq_measures__stg_pqi_patient\nwhere \n  sex not in ('male', 'female')", "relation_name": "dev_tom.ahrq_measures._int_pqi_shared_exclusion_missing_gender"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.178204Z", "completed_at": "2024-08-23T19:21:34.217158Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.217685Z", "completed_at": "2024-08-23T19:21:34.217688Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.04251694679260254, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.cms_hcc__int_members", "compiled": true, "compiled_code": "\n/*\nSteps for transforming eligibility data into member demographics:\n    1) Determine enrollment status using eligibility from the collection year.\n    2) Roll up to latest eligibility record for enrollment statuses.\n    3) Add age groups based on the payment year.\n    4) Determine other statuses.\n\nJinja is used to set payment year variable.\n - The payment_year var has been set here so it gets compiled.\n - CMS guidance: Age is calculated as of Feb 1 of the payment year.\n - The collection year is one year prior to the payment year.\n*/\n\n\n\n\nwith  __dbt__cte__cms_hcc__stg_core__eligibility as (\n\nselect\n      patient_id\n    , enrollment_start_date\n    , enrollment_end_date\n    , original_reason_entitlement_code\n    , dual_status_code\n    , medicare_status_code\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.eligibility\n),  __dbt__cte__cms_hcc__stg_core__patient as (\n\nselect\n      patient_id\n    , sex\n    , birth_date\n    , death_date\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.patient\n), stg_eligibility as (\n\n    select\n          patient_id\n        , enrollment_start_date\n        , enrollment_end_date\n        , original_reason_entitlement_code\n        , dual_status_code\n        , medicare_status_code\n        , row_number() over(\n            partition by patient_id\n            order by enrollment_end_date desc\n        ) as row_num /* used to dedupe eligibility */\n    from __dbt__cte__cms_hcc__stg_core__eligibility\n    where (\n        /* filter to members with eligibility in collection or payment year */\n              date_part('year', enrollment_start_date)\n                between 2023\n                and 2024\n             or date_part('year', enrollment_end_date)\n                between 2023\n                and 2024\n    )\n\n)\n\n, stg_patient as (\n\n    select\n          patient_id\n        , sex\n        , birth_date\n        , floor(datediff(\n        hour,\n        birth_date,\n        '2024-02-01'\n        ) / 8766.0) as payment_year_age\n        , death_date\n    from __dbt__cte__cms_hcc__stg_core__patient\n\n)\n\n/* create proxy enrollment dates if outside of the collection year */\n, cap_collection_start_end_dates as (\n\n    select\n          patient_id\n        , enrollment_start_date\n        , enrollment_end_date\n        , case\n            when enrollment_start_date < try_cast( '2023-01-01' as date )\n            then try_cast( '2023-01-01' as date )\n            else enrollment_start_date\n          end as proxy_enrollment_start_date\n        , case\n            when enrollment_end_date > try_cast( '2023-12-31' as date )\n            then try_cast( '2023-12-31' as date )\n            else enrollment_end_date\n          end as proxy_enrollment_end_date\n    from stg_eligibility\n    where (\n        /* filter to members with eligibility in collection or payment year */\n        \n            extract(year from enrollment_start_date)\n                between 2023\n                and 2024\n            or extract(year from enrollment_end_date)\n                between 2023\n                and 2024\n        \n    )\n\n)\n\n, calculate_prior_coverage as (\n\n    select patient_id\n        , sum(datediff(\n        month,\n        proxy_enrollment_start_date,\n        proxy_enrollment_end_date\n        ) + 1) as coverage_months  /* include starting month */\n    from cap_collection_start_end_dates\n    group by patient_id\n\n)\n\n/*\n   CMS guidance: A \u201cNew Enrollee\u201d status is when a beneficiary has less than\n   12 months of coverage prior to the payment year.\n*/\n, add_enrollment as (\n\n    select\n          patient_id\n        , case\n            when coverage_months < 12 then 'New'\n            else 'Continuing'\n          end as enrollment_status\n    from calculate_prior_coverage\n\n)\n\n, latest_eligibility as (\n\n    select\n          stg_eligibility.patient_id\n        , stg_patient.sex as gender\n        , stg_patient.payment_year_age\n        , stg_eligibility.original_reason_entitlement_code\n        , stg_eligibility.dual_status_code\n        , stg_eligibility.medicare_status_code\n        /* Defaulting to \"New\" enrollment status when missing */\n        , case\n            when add_enrollment.enrollment_status is null then 'New'\n            else add_enrollment.enrollment_status\n          end as enrollment_status\n        \n            , case\n                when add_enrollment.enrollment_status is null then TRUE\n                else FALSE\n              end as enrollment_status_default\n        \n    from stg_eligibility\n        left join add_enrollment\n            on stg_eligibility.patient_id = add_enrollment.patient_id\n        left join stg_patient\n            on stg_eligibility.patient_id = stg_patient.patient_id\n    where stg_eligibility.row_num = 1\n\n)\n\n, add_age_group as (\n\n    select\n          patient_id\n        , gender\n        , payment_year_age\n        , original_reason_entitlement_code\n        , dual_status_code\n        , medicare_status_code\n        , enrollment_status\n        , enrollment_status_default\n        , case\n            when enrollment_status = 'Continuing' and payment_year_age between 0 and 34 then '0-34'\n            when enrollment_status = 'Continuing' and payment_year_age between 35 and 44 then '35-44'\n            when enrollment_status = 'Continuing' and payment_year_age between 45 and 54 then '45-54'\n            when enrollment_status = 'Continuing' and payment_year_age between 55 and 59 then '55-59'\n            when enrollment_status = 'Continuing' and payment_year_age between 60 and 64 then '60-64'\n            when enrollment_status = 'Continuing' and payment_year_age between 65 and 69 then '65-69'\n            when enrollment_status = 'Continuing' and payment_year_age between 70 and 74 then '70-74'\n            when enrollment_status = 'Continuing' and payment_year_age between 75 and 79 then '75-79'\n            when enrollment_status = 'Continuing' and payment_year_age between 80 and 84 then '80-84'\n            when enrollment_status = 'Continuing' and payment_year_age between 85 and 89 then '85-89'\n            when enrollment_status = 'Continuing' and payment_year_age between 90 and 94 then '90-94'\n            when enrollment_status = 'Continuing' and payment_year_age >= 95 then '>=95'\n            when enrollment_status = 'New' and payment_year_age between 0 and 34 then '0-34'\n            when enrollment_status = 'New' and payment_year_age between 35 and 44 then '35-44'\n            when enrollment_status = 'New' and payment_year_age between 45 and 54 then '45-54'\n            when enrollment_status = 'New' and payment_year_age between 55 and 59 then '55-59'\n            when enrollment_status = 'New' and payment_year_age between 60 and 64 then '60-64'\n            when enrollment_status = 'New' and payment_year_age = 65 then '65'\n            when enrollment_status = 'New' and payment_year_age = 66 then '66'\n            when enrollment_status = 'New' and payment_year_age = 67 then '67'\n            when enrollment_status = 'New' and payment_year_age = 68 then '68'\n            when enrollment_status = 'New' and payment_year_age = 69 then '69'\n            when enrollment_status = 'New' and payment_year_age between 70 and 74 then '70-74'\n            when enrollment_status = 'New' and payment_year_age between 75 and 79 then '75-79'\n            when enrollment_status = 'New' and payment_year_age between 80 and 84 then '80-84'\n            when enrollment_status = 'New' and payment_year_age between 85 and 89 then '85-89'\n            when enrollment_status = 'New' and payment_year_age between 90 and 94 then '90-94'\n            when enrollment_status = 'New' and payment_year_age >= 95 then '>=95'\n          end as age_group\n    from latest_eligibility\n\n)\n\n, add_status_logic as (\n\n    select\n          patient_id\n        , enrollment_status\n        , case\n            when gender = 'female' then 'Female'\n            when gender = 'male' then 'Male'\n            else null\n          end as gender\n        , age_group\n        , case\n            when dual_status_code in ('01','02','03','04','05','06','08') then 'Yes'\n            else 'No'\n          end as medicaid_status\n        , case\n            when dual_status_code in ('02','04','08') then 'Full'\n            when dual_status_code in ('01','03','05','06') then 'Partial'\n            else 'Non'\n          end as dual_status\n        /*\n           The CMS-HCC model does not have factors for ESRD for these edge-cases,\n           we default to 'Aged'. When OREC is missing, latest Medicare status is\n           used, if available.\n        */\n        , case\n            when original_reason_entitlement_code in ('0','2') then 'Aged'\n            when original_reason_entitlement_code in ('1','3') then 'Disabled'\n            when original_reason_entitlement_code is null and medicare_status_code in ('10','11','31') then 'Aged'\n            when original_reason_entitlement_code is null and medicare_status_code in ('20','21') then 'Disabled'\n            when coalesce(original_reason_entitlement_code,medicare_status_code) is null then 'Aged'\n          end as orec\n        /* Defaulting everyone to non-institutional until logic is added */\n        , cast('No' as TEXT) as institutional_status\n        , enrollment_status_default\n        , case\n            \n                when dual_status_code is null then TRUE\n                else FALSE\n            \n          end as medicaid_dual_status_default\n        /* Setting default true when OREC or Medicare Status is ESRD, or null */\n        , case\n            \n                when original_reason_entitlement_code in ('2') then TRUE\n                when original_reason_entitlement_code is null and medicare_status_code in ('31') then TRUE\n                when coalesce(original_reason_entitlement_code,medicare_status_code) is null then TRUE\n                else FALSE\n            \n          end as orec_default\n        /* Setting default true until institutional logic is added */\n        \n            , TRUE as institutional_status_default\n        \n    from add_age_group\n\n)\n\n, add_data_types as (\n\n    select\n          cast(patient_id as TEXT) as patient_id\n        , cast(enrollment_status as TEXT) as enrollment_status\n        , cast(gender as TEXT) as gender\n        , cast(age_group as TEXT) as age_group\n        , cast(medicaid_status as TEXT) as medicaid_status\n        , cast(dual_status as TEXT) as dual_status\n        , cast(orec as TEXT) as orec\n        , cast(institutional_status as TEXT) as institutional_status\n        \n            , cast(enrollment_status_default as boolean) as enrollment_status_default\n            , cast(medicaid_dual_status_default as boolean) as medicaid_dual_status_default\n            , cast(orec_default as boolean) as orec_default\n            , cast(institutional_status_default as boolean) as institutional_status_default\n        \n        , cast('2024' as integer) as payment_year\n    from add_status_logic\n\n)\n\nselect\n      patient_id\n    , enrollment_status\n    , gender\n    , age_group\n    , medicaid_status\n    , dual_status\n    , orec\n    , institutional_status\n    , enrollment_status_default\n    , medicaid_dual_status_default\n    , orec_default\n    , institutional_status_default\n    , payment_year\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.cms_hcc._int_members"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.217970Z", "completed_at": "2024-08-23T19:21:34.223569Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.225817Z", "completed_at": "2024-08-23T19:21:34.225820Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.009155035018920898, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.the_tuva_project.accepted_values_quality_measures__stg_core__patient_sex__female__male__unknown.e6adc9ce2b", "compiled": true, "compiled_code": "\n    \n    \n\nwith  __dbt__cte__quality_measures__stg_core__patient as (\n\nselect\n      patient_id\n    , sex\n    , birth_date\n    , death_date\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.patient\n), all_values as (\n\n    select\n        sex as value_field,\n        count(*) as n_records\n\n    from __dbt__cte__quality_measures__stg_core__patient\n    group by sex\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    'female','male','unknown'\n)\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.223725Z", "completed_at": "2024-08-23T19:21:34.228240Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.228626Z", "completed_at": "2024-08-23T19:21:34.228629Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.0059201717376708984, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.the_tuva_project.not_null_quality_measures__stg_core__patient_birth_date.4b3a2e74e6", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nwith __dbt__cte__quality_measures__stg_core__patient as (\n\nselect\n      patient_id\n    , sex\n    , birth_date\n    , death_date\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.patient\n) select birth_date\nfrom __dbt__cte__quality_measures__stg_core__patient\nwhere birth_date is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.226129Z", "completed_at": "2024-08-23T19:21:34.228882Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.229435Z", "completed_at": "2024-08-23T19:21:34.229438Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.006080150604248047, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.the_tuva_project.not_null_quality_measures__stg_core__patient_patient_id.5510e1a0fd", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nwith __dbt__cte__quality_measures__stg_core__patient as (\n\nselect\n      patient_id\n    , sex\n    , birth_date\n    , death_date\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.patient\n) select patient_id\nfrom __dbt__cte__quality_measures__stg_core__patient\nwhere patient_id is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.229714Z", "completed_at": "2024-08-23T19:21:34.239366Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.240940Z", "completed_at": "2024-08-23T19:21:34.240944Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.01254725456237793, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.the_tuva_project.not_null_quality_measures__stg_core__patient_sex.e2f34cab69", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nwith __dbt__cte__quality_measures__stg_core__patient as (\n\nselect\n      patient_id\n    , sex\n    , birth_date\n    , death_date\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.patient\n) select sex\nfrom __dbt__cte__quality_measures__stg_core__patient\nwhere sex is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.233096Z", "completed_at": "2024-08-23T19:21:34.243837Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.244239Z", "completed_at": "2024-08-23T19:21:34.244242Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.011976003646850586, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.service_category__acute_inpatient_institutional", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__service_category__stg_medical_claim as (\n\n\nselect\napr_drg_code,\nbill_type_code,\nclaim_id,\nclaim_line_number,\nclaim_type,\nhcpcs_code,\nms_drg_code,\nplace_of_service_code,\nrevenue_center_code,\n'2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\n), room_and_board_requirement as (\nselect distinct \n  claim_id\nfrom __dbt__cte__service_category__stg_medical_claim\nwhere claim_type = 'institutional'\n  and revenue_center_code in\n  ('0100','0101',\n   '0110','0111','0112','0113','0114','0116','0117','0118','0119',\n   '0120','0121','0122','0123','0124','0126','0127','0128','0129',\n   '0130','0131','0132','0133','0134','0136','0137','0138','0139',\n   '0140','0141','0142','0143','0144','0146','0147','0148','0149',\n   '0150','0151','0152','0153','0154','0156','0157','0158','0159',\n   '0160','0164','0167','0169',\n   '0170','0171','0172','0173','0174','0179',\n   '0190','0191','0192','0193','0194','0199',\n   '0200','0201','0202','0203','0204','0206','0207','0208','0209',\n   '0210','0211','0212','0213','0214','0219',\n   '1000','1001','1002')\n)\n\n, drg_requirement as (\nselect distinct \n  mc.claim_id\nfrom __dbt__cte__service_category__stg_medical_claim mc\nleft join dev_tom.terminology.ms_drg msdrg\n  on mc.ms_drg_code = msdrg.ms_drg_code\nleft join dev_tom.terminology.apr_drg aprdrg\n  on mc.apr_drg_code = aprdrg.apr_drg_code\nwhere claim_type = 'institutional'\n  and (msdrg.ms_drg_code is not null or aprdrg.apr_drg_code is not null)\n)\n\n, bill_type_requirement as (\nselect distinct \n  claim_id\nfrom __dbt__cte__service_category__stg_medical_claim\nwhere claim_type = 'institutional'\n  and substring(bill_type_code, 1, 2) in ('11','12')\n)\n\nselect distinct \n  a.claim_id\n, 'Acute Inpatient' as service_category_2\n, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom __dbt__cte__service_category__stg_medical_claim a\ninner join room_and_board_requirement b\n  on a.claim_id = b.claim_id\ninner join drg_requirement c\n  on a.claim_id = c.claim_id\ninner join bill_type_requirement d\n  on a.claim_id = d.claim_id", "relation_name": "dev_tom.claims_preprocessing._int_acute_inpatient_institutional"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.241278Z", "completed_at": "2024-08-23T19:21:34.244494Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.245062Z", "completed_at": "2024-08-23T19:21:34.245065Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.012196063995361328, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.service_category__acute_inpatient_professional", "compiled": true, "compiled_code": "\n\nwith __dbt__cte__service_category__stg_medical_claim as (\n\n\nselect\napr_drg_code,\nbill_type_code,\nclaim_id,\nclaim_line_number,\nclaim_type,\nhcpcs_code,\nms_drg_code,\nplace_of_service_code,\nrevenue_center_code,\n'2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\n) select distinct\n  claim_id\n, claim_line_number\n, 'Acute Inpatient' as service_category_2\n, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom __dbt__cte__service_category__stg_medical_claim\nwhere claim_type = 'professional'\n  and place_of_service_code = '21'", "relation_name": "dev_tom.claims_preprocessing._int_acute_inpatient_professional"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.245354Z", "completed_at": "2024-08-23T19:21:34.248766Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.251535Z", "completed_at": "2024-08-23T19:21:34.251538Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.007542133331298828, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.service_category__ambulance_professional", "compiled": true, "compiled_code": "\n\nwith __dbt__cte__service_category__stg_medical_claim as (\n\n\nselect\napr_drg_code,\nbill_type_code,\nclaim_id,\nclaim_line_number,\nclaim_type,\nhcpcs_code,\nms_drg_code,\nplace_of_service_code,\nrevenue_center_code,\n'2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\n) select distinct \n  claim_id\n, claim_line_number\n, 'Ambulance' as service_category_2\n, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom __dbt__cte__service_category__stg_medical_claim\nwhere claim_type = 'professional'\n  and (hcpcs_code between 'A0425' and 'A0436' or place_of_service_code in ('41','42'))", "relation_name": "dev_tom.claims_preprocessing._int_ambulance_professional"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.248931Z", "completed_at": "2024-08-23T19:21:34.254480Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.254878Z", "completed_at": "2024-08-23T19:21:34.254881Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.006913900375366211, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.service_category__dialysis_institutional", "compiled": true, "compiled_code": "\n\nwith __dbt__cte__service_category__stg_medical_claim as (\n\n\nselect\napr_drg_code,\nbill_type_code,\nclaim_id,\nclaim_line_number,\nclaim_type,\nhcpcs_code,\nms_drg_code,\nplace_of_service_code,\nrevenue_center_code,\n'2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\n) select distinct \n  claim_id\n, 'Dialysis' as service_category_2\n, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom __dbt__cte__service_category__stg_medical_claim\nwhere claim_type = 'institutional'\n  and substring(bill_type_code, 1, 2) in ('72')", "relation_name": "dev_tom.claims_preprocessing._int_dialysis_institutional"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.251849Z", "completed_at": "2024-08-23T19:21:34.255293Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.258168Z", "completed_at": "2024-08-23T19:21:34.258172Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.009608745574951172, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.service_category__dialysis_professional", "compiled": true, "compiled_code": "\n\nwith __dbt__cte__service_category__stg_medical_claim as (\n\n\nselect\napr_drg_code,\nbill_type_code,\nclaim_id,\nclaim_line_number,\nclaim_type,\nhcpcs_code,\nms_drg_code,\nplace_of_service_code,\nrevenue_center_code,\n'2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\n) select distinct \n  claim_id\n, claim_line_number\n, 'Dialysis' as service_category_2\n, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom __dbt__cte__service_category__stg_medical_claim\nwhere claim_type = 'professional'\n  and place_of_service_code in ('65')", "relation_name": "dev_tom.claims_preprocessing._int_dialysis_professional"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.255654Z", "completed_at": "2024-08-23T19:21:34.259221Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.276821Z", "completed_at": "2024-08-23T19:21:34.276824Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.022173166275024414, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.service_category__dme_professional", "compiled": true, "compiled_code": "\n\nwith __dbt__cte__service_category__stg_medical_claim as (\n\n\nselect\napr_drg_code,\nbill_type_code,\nclaim_id,\nclaim_line_number,\nclaim_type,\nhcpcs_code,\nms_drg_code,\nplace_of_service_code,\nrevenue_center_code,\n'2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\n) select distinct \n  claim_id\n, claim_line_number\n, 'Durable Medical Equipment' as service_category_2\n, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom __dbt__cte__service_category__stg_medical_claim\nwhere claim_type = 'professional'\n  and hcpcs_code between 'E0100' and 'E8002'", "relation_name": "dev_tom.claims_preprocessing._int_dme_professional"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.259370Z", "completed_at": "2024-08-23T19:21:34.279276Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.279748Z", "completed_at": "2024-08-23T19:21:34.279752Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.021335124969482422, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.service_category__dq_input_layer_tests", "compiled": true, "compiled_code": "\n\nwith __dbt__cte__service_category__stg_medical_claim as (\n\n\nselect\napr_drg_code,\nbill_type_code,\nclaim_id,\nclaim_line_number,\nclaim_type,\nhcpcs_code,\nms_drg_code,\nplace_of_service_code,\nrevenue_center_code,\n'2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\n) select distinct \n  claim_id\n, 'Multiple claim_type' as dq_problem\n, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom __dbt__cte__service_category__stg_medical_claim\ngroup by claim_id\nhaving count(distinct claim_type) > 1\n\nunion all\n\nselect distinct \n  claim_id\n, 'Multiple bill_type_code' as dq_problem\n, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom __dbt__cte__service_category__stg_medical_claim\ngroup by claim_id\nhaving count(distinct bill_type_code) > 1\n\nunion all\n\nselect distinct \n  claim_id\n, 'Missing claim_type' as dq_problem\n, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom __dbt__cte__service_category__stg_medical_claim\nwhere claim_type is null\n\nunion all\n\nselect distinct \n  claim_id\n, 'Missing place_of_service_code' as dq_problem\n, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom __dbt__cte__service_category__stg_medical_claim\nwhere claim_type = 'professional'\n  and place_of_service_code is null\n\nunion all\n\nselect distinct \n  claim_id\n, 'Missing bill_type_code' as dq_problem\n, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom __dbt__cte__service_category__stg_medical_claim\nwhere claim_type = 'institutional'\n  and bill_type_code is null\n\nunion all\n\nselect distinct \n  claim_id\n, 'Missing revenue_center_code' as dq_problem\n, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom __dbt__cte__service_category__stg_medical_claim\nwhere claim_type = 'institutional'\n  and revenue_center_code is null\n\nunion all\n\nselect distinct \n  claim_id\n, 'Missing hcpcs_code' as dq_problem\n, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom __dbt__cte__service_category__stg_medical_claim\nwhere claim_type = 'professional'\n  and hcpcs_code is null\n\nunion all\n\nselect distinct \n  claim_id\n, 'Invalid claim_type' as dq_problem\n, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom __dbt__cte__service_category__stg_medical_claim a\ninner join dev_tom.terminology.claim_type b\n  on a.claim_type = b.claim_type\nwhere b.claim_type is null\n\nunion all\n\nselect distinct \n  claim_id\n, 'Invalid place_of_service_code' as dq_problem\n, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom __dbt__cte__service_category__stg_medical_claim a\ninner join dev_tom.terminology.place_of_service b\n  on a.place_of_service_code = b.place_of_service_code\nwhere a.claim_type = 'professional'\n  and b.place_of_service_code is null\n\nunion all\n\nselect distinct \n  claim_id\n, 'Invalid bill_type_code' as dq_problem\n, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom __dbt__cte__service_category__stg_medical_claim a\ninner join dev_tom.terminology.bill_type b\n  on a.bill_type_code = b.bill_type_code\nwhere a.claim_type = 'institutional'\n  and b.bill_type_code is null\n\nunion all\n\nselect distinct \n  claim_id\n, 'Invalid revenue_center_code' as dq_problem\n, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom __dbt__cte__service_category__stg_medical_claim a\ninner join dev_tom.terminology.revenue_center b\n  on a.revenue_center_code = b.revenue_center_code\nwhere a.claim_type = 'institutional'\n  and b.revenue_center_code is null\n\nunion all\n\nselect distinct \n  claim_id\n, 'Invalid hcpcs_code' as dq_problem\n, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom __dbt__cte__service_category__stg_medical_claim a\ninner join dev_tom.terminology.hcpcs_level_2 b\n  on a.hcpcs_code = b.hcpcs\nwhere a.claim_type = 'professional'\n  and b.hcpcs is null\n\nunion all\n\nselect distinct \n  claim_id\n, 'Invalid ms_drg_code' as dq_problem\n, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom __dbt__cte__service_category__stg_medical_claim a\ninner join dev_tom.terminology.ms_drg b\n  on a.ms_drg_code = b.ms_drg_code\nwhere a.claim_type = 'institutional'\n  and b.ms_drg_code is null\n\nunion all\n\nselect distinct \n  claim_id\n, 'Invalid apr_drg_code' as dq_problem\n, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom __dbt__cte__service_category__stg_medical_claim a\ninner join dev_tom.terminology.apr_drg b\n  on a.apr_drg_code = b.apr_drg_code\nwhere a.claim_type = 'institutional'\n  and b.apr_drg_code is null", "relation_name": "dev_tom.claims_preprocessing._dq_input_layer_tests"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.277106Z", "completed_at": "2024-08-23T19:21:34.280001Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.280484Z", "completed_at": "2024-08-23T19:21:34.280487Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.02147817611694336, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.service_category__duplicate_bill_types", "compiled": true, "compiled_code": "\n\nwith __dbt__cte__service_category__stg_medical_claim as (\n\n\nselect\napr_drg_code,\nbill_type_code,\nclaim_id,\nclaim_line_number,\nclaim_type,\nhcpcs_code,\nms_drg_code,\nplace_of_service_code,\nrevenue_center_code,\n'2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\n) select distinct\n  claim_id\n, count(distinct bill_type_code) as cnt\nfrom __dbt__cte__service_category__stg_medical_claim\ngroup by claim_id\nhaving count(distinct bill_type_code) > 1", "relation_name": "dev_tom.claims_preprocessing._int_duplicate_bill_types"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.280778Z", "completed_at": "2024-08-23T19:21:34.286379Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.286745Z", "completed_at": "2024-08-23T19:21:34.286748Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.007226228713989258, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.service_category__emergency_department_professional", "compiled": true, "compiled_code": "\n\nwith __dbt__cte__service_category__stg_medical_claim as (\n\n\nselect\napr_drg_code,\nbill_type_code,\nclaim_id,\nclaim_line_number,\nclaim_type,\nhcpcs_code,\nms_drg_code,\nplace_of_service_code,\nrevenue_center_code,\n'2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\n) select distinct \n  claim_id\n, claim_line_number\n, 'Emergency Department' as service_category_2\n, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom __dbt__cte__service_category__stg_medical_claim\nwhere claim_type = 'professional'\n  and place_of_service_code = '23'", "relation_name": "dev_tom.claims_preprocessing._int_emergency_department_professional"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.283896Z", "completed_at": "2024-08-23T19:21:34.289544Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.289951Z", "completed_at": "2024-08-23T19:21:34.289955Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.006891965866088867, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.service_category__home_health_institutional", "compiled": true, "compiled_code": "\n\nwith __dbt__cte__service_category__stg_medical_claim as (\n\n\nselect\napr_drg_code,\nbill_type_code,\nclaim_id,\nclaim_line_number,\nclaim_type,\nhcpcs_code,\nms_drg_code,\nplace_of_service_code,\nrevenue_center_code,\n'2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\n) select distinct \n  claim_id\n, 'Home Health' as service_category_2\n, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom __dbt__cte__service_category__stg_medical_claim\nwhere claim_type = 'institutional'\n  and substring(bill_type_code, 1, 2) in ('31','32','33')", "relation_name": "dev_tom.claims_preprocessing._int_home_health_institutional"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.287043Z", "completed_at": "2024-08-23T19:21:34.290632Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.291352Z", "completed_at": "2024-08-23T19:21:34.291355Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.007672786712646484, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.service_category__hospice_institutional", "compiled": true, "compiled_code": "\n\nwith __dbt__cte__service_category__stg_medical_claim as (\n\n\nselect\napr_drg_code,\nbill_type_code,\nclaim_id,\nclaim_line_number,\nclaim_type,\nhcpcs_code,\nms_drg_code,\nplace_of_service_code,\nrevenue_center_code,\n'2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\n) select distinct \n  claim_id\n, 'Hospice' as service_category_2\n, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom __dbt__cte__service_category__stg_medical_claim\nwhere claim_type = 'institutional'\n  and substring(bill_type_code, 1, 2) in ('81','82')", "relation_name": "dev_tom.claims_preprocessing._int_hospice_institutional"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.291951Z", "completed_at": "2024-08-23T19:21:34.298122Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.298677Z", "completed_at": "2024-08-23T19:21:34.298680Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.008451223373413086, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.service_category__hospice_professional", "compiled": true, "compiled_code": "\n\nwith __dbt__cte__service_category__stg_medical_claim as (\n\n\nselect\napr_drg_code,\nbill_type_code,\nclaim_id,\nclaim_line_number,\nclaim_type,\nhcpcs_code,\nms_drg_code,\nplace_of_service_code,\nrevenue_center_code,\n'2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\n) select distinct \n  claim_id\n, claim_line_number\n, 'Hospice' as service_category_2\n, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom __dbt__cte__service_category__stg_medical_claim\nwhere claim_type = 'professional'\n  and place_of_service_code in ('34')", "relation_name": "dev_tom.claims_preprocessing._int_hospice_professional"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.295518Z", "completed_at": "2024-08-23T19:21:34.299093Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.302048Z", "completed_at": "2024-08-23T19:21:34.302051Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.01111602783203125, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.service_category__inpatient_psychiatric_professional", "compiled": true, "compiled_code": "\n\nwith __dbt__cte__service_category__stg_medical_claim as (\n\n\nselect\napr_drg_code,\nbill_type_code,\nclaim_id,\nclaim_line_number,\nclaim_type,\nhcpcs_code,\nms_drg_code,\nplace_of_service_code,\nrevenue_center_code,\n'2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\n) select distinct \n  claim_id\n, claim_line_number\n, 'Inpatient Psychiatric' as service_category_2\n, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom __dbt__cte__service_category__stg_medical_claim\nwhere claim_type = 'professional'\n  and place_of_service_code in ('51','55','56')", "relation_name": "dev_tom.claims_preprocessing._int_inpatient_psychiatric_professional"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.299244Z", "completed_at": "2024-08-23T19:21:34.302760Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.303247Z", "completed_at": "2024-08-23T19:21:34.303250Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.005324840545654297, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.service_category__inpatient_rehab_professional", "compiled": true, "compiled_code": "\n\nwith __dbt__cte__service_category__stg_medical_claim as (\n\n\nselect\napr_drg_code,\nbill_type_code,\nclaim_id,\nclaim_line_number,\nclaim_type,\nhcpcs_code,\nms_drg_code,\nplace_of_service_code,\nrevenue_center_code,\n'2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\n) select distinct \n  claim_id\n, claim_line_number\n, 'Inpatient Rehabilitation' as service_category_2\n, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom __dbt__cte__service_category__stg_medical_claim\nwhere claim_type = 'professional'\n  and place_of_service_code in ('61')", "relation_name": "dev_tom.claims_preprocessing._int_inpatient_rehab_professional"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.303503Z", "completed_at": "2024-08-23T19:21:34.310166Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.310541Z", "completed_at": "2024-08-23T19:21:34.310545Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.008195877075195312, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.service_category__lab_institutional", "compiled": true, "compiled_code": "\n\nwith __dbt__cte__service_category__stg_medical_claim as (\n\n\nselect\napr_drg_code,\nbill_type_code,\nclaim_id,\nclaim_line_number,\nclaim_type,\nhcpcs_code,\nms_drg_code,\nplace_of_service_code,\nrevenue_center_code,\n'2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\n) select distinct \n  claim_id\n, 'Lab' as service_category_2\n, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom __dbt__cte__service_category__stg_medical_claim\nwhere claim_type = 'institutional'\n  and substring(bill_type_code, 1, 2) in ('14')", "relation_name": "dev_tom.claims_preprocessing._int_lab_institutional"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.306644Z", "completed_at": "2024-08-23T19:21:34.313295Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.313699Z", "completed_at": "2024-08-23T19:21:34.313702Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.010663270950317383, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.service_category__lab_professional", "compiled": true, "compiled_code": "\n\nwith __dbt__cte__service_category__stg_medical_claim as (\n\n\nselect\napr_drg_code,\nbill_type_code,\nclaim_id,\nclaim_line_number,\nclaim_type,\nhcpcs_code,\nms_drg_code,\nplace_of_service_code,\nrevenue_center_code,\n'2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\n) select distinct \n  claim_id\n, claim_line_number\n, 'Lab' as service_category_2\n, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom __dbt__cte__service_category__stg_medical_claim\nwhere claim_type = 'professional'\n  and place_of_service_code = '81'", "relation_name": "dev_tom.claims_preprocessing._int_lab_professional"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.310831Z", "completed_at": "2024-08-23T19:21:34.314165Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.314700Z", "completed_at": "2024-08-23T19:21:34.314703Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.004752159118652344, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.service_category__office_visit_professional", "compiled": true, "compiled_code": "\n\nwith __dbt__cte__service_category__stg_medical_claim as (\n\n\nselect\napr_drg_code,\nbill_type_code,\nclaim_id,\nclaim_line_number,\nclaim_type,\nhcpcs_code,\nms_drg_code,\nplace_of_service_code,\nrevenue_center_code,\n'2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\n) select distinct \n  claim_id\n, claim_line_number\n, 'Office Visit' as service_category_2\n, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom __dbt__cte__service_category__stg_medical_claim\nwhere claim_type = 'professional'\n  and place_of_service_code in ('11','02')", "relation_name": "dev_tom.claims_preprocessing._int_office_visit_professional"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.315142Z", "completed_at": "2024-08-23T19:21:34.320738Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.321118Z", "completed_at": "2024-08-23T19:21:34.321121Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.007151126861572266, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.service_category__outpatient_hospital_or_clinic_professional", "compiled": true, "compiled_code": "\n\nwith __dbt__cte__service_category__stg_medical_claim as (\n\n\nselect\napr_drg_code,\nbill_type_code,\nclaim_id,\nclaim_line_number,\nclaim_type,\nhcpcs_code,\nms_drg_code,\nplace_of_service_code,\nrevenue_center_code,\n'2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\n) select distinct \n  claim_id\n, claim_line_number\n, 'Outpatient Hospital or Clinic' as service_category_2\n, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom __dbt__cte__service_category__stg_medical_claim\nwhere claim_type = 'professional'\n  and place_of_service_code in ('15','17','19','22','49','50','60','71','72')", "relation_name": "dev_tom.claims_preprocessing._int_outpatient_hospital_or_clinic_professional"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.318276Z", "completed_at": "2024-08-23T19:21:34.323810Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.324210Z", "completed_at": "2024-08-23T19:21:34.324213Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.009279012680053711, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.service_category__outpatient_psychiatric_institutional", "compiled": true, "compiled_code": "\n\nwith __dbt__cte__service_category__stg_medical_claim as (\n\n\nselect\napr_drg_code,\nbill_type_code,\nclaim_id,\nclaim_line_number,\nclaim_type,\nhcpcs_code,\nms_drg_code,\nplace_of_service_code,\nrevenue_center_code,\n'2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\n) select distinct \n  claim_id\n, 'Outpatient Psychiatric' as service_category_2\n, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom __dbt__cte__service_category__stg_medical_claim\nwhere claim_type = 'institutional'\n  and substring(bill_type_code, 1, 2) in ('52')", "relation_name": "dev_tom.claims_preprocessing._int_outpatient_psychiatric_institutional"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.321421Z", "completed_at": "2024-08-23T19:21:34.324667Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.325204Z", "completed_at": "2024-08-23T19:21:34.325207Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.007161855697631836, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.service_category__outpatient_psychiatric_professional", "compiled": true, "compiled_code": "\n\nwith __dbt__cte__service_category__stg_medical_claim as (\n\n\nselect\napr_drg_code,\nbill_type_code,\nclaim_id,\nclaim_line_number,\nclaim_type,\nhcpcs_code,\nms_drg_code,\nplace_of_service_code,\nrevenue_center_code,\n'2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\n) select distinct \n  claim_id\n, claim_line_number\n, 'Outpatient Psychiatric' as service_category_2\n, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom __dbt__cte__service_category__stg_medical_claim\nwhere claim_type = 'professional'\n  and place_of_service_code in ('52','53','57','58')", "relation_name": "dev_tom.claims_preprocessing._int_outpatient_psychiatric_professional"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.325663Z", "completed_at": "2024-08-23T19:21:34.331164Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.331556Z", "completed_at": "2024-08-23T19:21:34.331558Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.007085084915161133, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.service_category__outpatient_rehab_professional", "compiled": true, "compiled_code": "\n\nwith __dbt__cte__service_category__stg_medical_claim as (\n\n\nselect\napr_drg_code,\nbill_type_code,\nclaim_id,\nclaim_line_number,\nclaim_type,\nhcpcs_code,\nms_drg_code,\nplace_of_service_code,\nrevenue_center_code,\n'2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\n) select distinct \n  claim_id\n, claim_line_number\n, 'Outpatient Rehabilitation' as service_category_2\n, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom __dbt__cte__service_category__stg_medical_claim\nwhere claim_type = 'professional'\n  and place_of_service_code in ('62')", "relation_name": "dev_tom.claims_preprocessing._int_outpatient_rehab_professional"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.328678Z", "completed_at": "2024-08-23T19:21:34.334353Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.334752Z", "completed_at": "2024-08-23T19:21:34.334755Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.009308815002441406, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.service_category__skilled_nursing_institutional", "compiled": true, "compiled_code": "\n\nwith __dbt__cte__service_category__stg_medical_claim as (\n\n\nselect\napr_drg_code,\nbill_type_code,\nclaim_id,\nclaim_line_number,\nclaim_type,\nhcpcs_code,\nms_drg_code,\nplace_of_service_code,\nrevenue_center_code,\n'2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\n) select distinct \n  claim_id\n, 'Skilled Nursing' as service_category_2\n, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom __dbt__cte__service_category__stg_medical_claim\nwhere claim_type = 'institutional'\n  and substring(bill_type_code, 1, 2) in ('21','22')", "relation_name": "dev_tom.claims_preprocessing._int_skilled_nursing_institutional"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.331853Z", "completed_at": "2024-08-23T19:21:34.335190Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.337461Z", "completed_at": "2024-08-23T19:21:34.337464Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.009011030197143555, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.service_category__urgent_care_professional", "compiled": true, "compiled_code": "\n\nwith __dbt__cte__service_category__stg_medical_claim as (\n\n\nselect\napr_drg_code,\nbill_type_code,\nclaim_id,\nclaim_line_number,\nclaim_type,\nhcpcs_code,\nms_drg_code,\nplace_of_service_code,\nrevenue_center_code,\n'2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\n) select distinct \n  claim_id\n, claim_line_number\n, 'Urgent Care' as service_category_2\n, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom __dbt__cte__service_category__stg_medical_claim\nwhere claim_type = 'professional'\n  and place_of_service_code in ('20')", "relation_name": "dev_tom.claims_preprocessing._int_urgent_care_professional"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.335555Z", "completed_at": "2024-08-23T19:21:34.338298Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.341397Z", "completed_at": "2024-08-23T19:21:34.341400Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0068759918212890625, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.pharmacy__int_generic_cost", "compiled": true, "compiled_code": "\n\n/* for each brand rxcui, what is the average cost/unit of generics available*/\n\nselect\n    g.product_rxcui as brand_rxcui\n  , cl.data_source\n  , max(case when claim_count > 0 then 1 else 0 end) as prescribed_atleast_one_generic_history\n  , sum(case when total_units > 0 and paid_amount > 0 then paid_amount else null end)/sum(case when total_units > 0 and paid_amount > 0 then total_units else null end) as generic_average_cost_per_unit\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.pharmacy.rxnorm_generic_available as g\nleft join dev_tom.pharmacy._int_claims_current_cost as cl \n  on cl.ndc_code = g.ndc\nwhere cl.brand_vs_generic = 'generic'\ngroup by\n    g.product_rxcui\n  , cl.data_source", "relation_name": "dev_tom.pharmacy._int_generic_cost"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.338645Z", "completed_at": "2024-08-23T19:21:34.346236Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.346616Z", "completed_at": "2024-08-23T19:21:34.346619Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.008919954299926758, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.pharmacy__int_generic_cost_by_ndc", "compiled": true, "compiled_code": "\n\n/* for each brand rxcui, what is the average cost/unit of all generics available*/\n\nselect\n    g.product_rxcui as brand_rxcui\n  , cl.data_source\n  , cl.ndc_code as generic_ndc_code\n  , cl.paid_amount\n  , cl.claim_count\n  , cl.total_units\n  , cl.cost_per_unit\n  , case when claim_count > 0 then 1 else 0 end as prescribed_atleast_one_generic_history\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.pharmacy.rxnorm_generic_available as g\nleft join dev_tom.pharmacy._int_claims_current_cost as cl \n  on cl.ndc_code = g.ndc\nwhere cl.brand_vs_generic = 'generic'", "relation_name": "dev_tom.pharmacy._int_generic_cost_by_ndc"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.342098Z", "completed_at": "2024-08-23T19:21:34.347237Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.351764Z", "completed_at": "2024-08-23T19:21:34.351767Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.013329029083251953, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.ahrq_measures__int_pqi_01_denom", "compiled": true, "compiled_code": "\n\nwith __dbt__cte__ahrq_measures__stg_pqi_patient as (\n\n\nselect \n    data_source\n  , birth_date\n  , patient_id\n  , sex\nfrom \n    dev_tom.core.patient\n) select distinct\n    cast(substring(e.year_month, 1, 4) as int) AS year_number\n  , e.patient_id\n  , e.data_source\n  , datediff(\n        year,\n        p.birth_date,\n        e.first_day_of_month\n        ) as age\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ahrq_measures._stg_pqi_member_months as e\ninner join __dbt__cte__ahrq_measures__stg_pqi_patient as p \n  on e.patient_id = p.patient_id\n  and p.data_source = e.data_source\nwhere \n  datediff(\n        year,\n        p.birth_date,\n        e.first_day_of_month\n        ) >= 18", "relation_name": "dev_tom.ahrq_measures._int_pqi_01_denom"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.347416Z", "completed_at": "2024-08-23T19:21:34.352436Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.357037Z", "completed_at": "2024-08-23T19:21:34.357040Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.010659933090209961, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.ahrq_measures__int_pqi_03_denom", "compiled": true, "compiled_code": "\n\nwith __dbt__cte__ahrq_measures__stg_pqi_patient as (\n\n\nselect \n    data_source\n  , birth_date\n  , patient_id\n  , sex\nfrom \n    dev_tom.core.patient\n) select distinct\n    cast(substring(e.year_month, 1, 4) as int) AS year_number\n  , e.patient_id\n  , e.data_source\n  , datediff(\n        year,\n        p.birth_date,\n        e.first_day_of_month\n        ) as age\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ahrq_measures._stg_pqi_member_months as e\ninner join __dbt__cte__ahrq_measures__stg_pqi_patient as p \n  on e.patient_id = p.patient_id\n  and p.data_source = e.data_source\nwhere \n  datediff(\n        year,\n        p.birth_date,\n        e.first_day_of_month\n        ) >= 18", "relation_name": "dev_tom.ahrq_measures._int_pqi_03_denom"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.352586Z", "completed_at": "2024-08-23T19:21:34.357705Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.362109Z", "completed_at": "2024-08-23T19:21:34.362112Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.010544300079345703, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.ahrq_measures__int_pqi_05_denom", "compiled": true, "compiled_code": "\n\nwith __dbt__cte__ahrq_measures__stg_pqi_patient as (\n\n\nselect \n    data_source\n  , birth_date\n  , patient_id\n  , sex\nfrom \n    dev_tom.core.patient\n) select distinct\n    cast(substring(e.year_month, 1, 4) as int) AS year_number\n  , e.patient_id\n  , e.data_source\n  , datediff(\n        year,\n        p.birth_date,\n        e.first_day_of_month\n        ) as age\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ahrq_measures._stg_pqi_member_months as e\ninner join __dbt__cte__ahrq_measures__stg_pqi_patient as p \n  on e.patient_id = p.patient_id\n  and p.data_source = e.data_source\nwhere \n  datediff(\n        year,\n        p.birth_date,\n        e.first_day_of_month\n        ) >= 40", "relation_name": "dev_tom.ahrq_measures._int_pqi_05_denom"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.357872Z", "completed_at": "2024-08-23T19:21:34.366902Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.367293Z", "completed_at": "2024-08-23T19:21:34.367296Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.010461091995239258, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.ahrq_measures__int_pqi_07_denom", "compiled": true, "compiled_code": "\n\nwith __dbt__cte__ahrq_measures__stg_pqi_patient as (\n\n\nselect \n    data_source\n  , birth_date\n  , patient_id\n  , sex\nfrom \n    dev_tom.core.patient\n) select distinct\n    cast(substring(e.year_month, 1, 4) as int) AS year_number\n  , e.patient_id\n  , e.data_source\n  , datediff(\n        year,\n        p.birth_date,\n        e.first_day_of_month\n        ) as age\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ahrq_measures._stg_pqi_member_months as e\ninner join __dbt__cte__ahrq_measures__stg_pqi_patient as p \n  on e.patient_id = p.patient_id\n  and p.data_source = e.data_source\nwhere \n  datediff(\n        year,\n        p.birth_date,\n        e.first_day_of_month\n        ) >= 18", "relation_name": "dev_tom.ahrq_measures._int_pqi_07_denom"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.362774Z", "completed_at": "2024-08-23T19:21:34.367929Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.372410Z", "completed_at": "2024-08-23T19:21:34.372413Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.010516166687011719, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.ahrq_measures__int_pqi_08_denom", "compiled": true, "compiled_code": "\n\nwith __dbt__cte__ahrq_measures__stg_pqi_patient as (\n\n\nselect \n    data_source\n  , birth_date\n  , patient_id\n  , sex\nfrom \n    dev_tom.core.patient\n) select distinct\n    cast(substring(e.year_month, 1, 4) as int) AS year_number\n  , e.patient_id\n  , e.data_source\n  , datediff(\n        year,\n        p.birth_date,\n        e.first_day_of_month\n        ) as age\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ahrq_measures._stg_pqi_member_months as e\ninner join __dbt__cte__ahrq_measures__stg_pqi_patient as p \n  on e.patient_id = p.patient_id\n  and p.data_source = e.data_source\nwhere \n  datediff(\n        year,\n        p.birth_date,\n        e.first_day_of_month\n        ) >= 18", "relation_name": "dev_tom.ahrq_measures._int_pqi_08_denom"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.368107Z", "completed_at": "2024-08-23T19:21:34.378113Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.378516Z", "completed_at": "2024-08-23T19:21:34.378519Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.011469841003417969, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.ahrq_measures__int_pqi_11_denom", "compiled": true, "compiled_code": "\n\nwith __dbt__cte__ahrq_measures__stg_pqi_patient as (\n\n\nselect \n    data_source\n  , birth_date\n  , patient_id\n  , sex\nfrom \n    dev_tom.core.patient\n) select distinct\n    cast(substring(e.year_month, 1, 4) as int) AS year_number\n  , e.patient_id\n  , e.data_source\n  , datediff(\n        year,\n        p.birth_date,\n        e.first_day_of_month\n        ) as age\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ahrq_measures._stg_pqi_member_months as e\ninner join __dbt__cte__ahrq_measures__stg_pqi_patient as p \n  on e.patient_id = p.patient_id\n  and p.data_source = e.data_source\nwhere \n  datediff(\n        year,\n        p.birth_date,\n        e.first_day_of_month\n        ) >= 18", "relation_name": "dev_tom.ahrq_measures._int_pqi_11_denom"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.373234Z", "completed_at": "2024-08-23T19:21:34.379140Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.383792Z", "completed_at": "2024-08-23T19:21:34.383795Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.011605978012084961, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.ahrq_measures__int_pqi_12_denom", "compiled": true, "compiled_code": "\n\nwith __dbt__cte__ahrq_measures__stg_pqi_patient as (\n\n\nselect \n    data_source\n  , birth_date\n  , patient_id\n  , sex\nfrom \n    dev_tom.core.patient\n) select distinct\n    cast(substring(e.year_month, 1, 4) as int) AS year_number\n  , e.patient_id\n  , e.data_source\n  , datediff(\n        year,\n        p.birth_date,\n        e.first_day_of_month\n        ) as age\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ahrq_measures._stg_pqi_member_months as e\ninner join __dbt__cte__ahrq_measures__stg_pqi_patient as p \n  on e.patient_id = p.patient_id\n  and p.data_source = e.data_source\nwhere \n  datediff(\n        year,\n        p.birth_date,\n        e.first_day_of_month\n        ) >= 18", "relation_name": "dev_tom.ahrq_measures._int_pqi_12_denom"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.379322Z", "completed_at": "2024-08-23T19:21:34.384482Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.389605Z", "completed_at": "2024-08-23T19:21:34.389608Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.011358976364135742, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.ahrq_measures__int_pqi_14_denom", "compiled": true, "compiled_code": "\n\nwith __dbt__cte__ahrq_measures__stg_pqi_patient as (\n\n\nselect \n    data_source\n  , birth_date\n  , patient_id\n  , sex\nfrom \n    dev_tom.core.patient\n) select distinct\n    cast(substring(e.year_month, 1, 4) as int) AS year_number\n  , e.patient_id\n  , e.data_source\n  , datediff(\n        year,\n        p.birth_date,\n        e.first_day_of_month\n        ) as age\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ahrq_measures._stg_pqi_member_months as e\ninner join __dbt__cte__ahrq_measures__stg_pqi_patient as p \n  on e.patient_id = p.patient_id\n  and p.data_source = e.data_source\nwhere \n  datediff(\n        year,\n        p.birth_date,\n        e.first_day_of_month\n        ) >= 18", "relation_name": "dev_tom.ahrq_measures._int_pqi_14_denom"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.384644Z", "completed_at": "2024-08-23T19:21:34.390296Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.394819Z", "completed_at": "2024-08-23T19:21:34.394821Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.011232137680053711, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.ahrq_measures__int_pqi_15_denom", "compiled": true, "compiled_code": "\n\nwith __dbt__cte__ahrq_measures__stg_pqi_patient as (\n\n\nselect \n    data_source\n  , birth_date\n  , patient_id\n  , sex\nfrom \n    dev_tom.core.patient\n) select distinct\n    cast(substring(e.year_month, 1, 4) as int) AS year_number\n  , e.patient_id\n  , e.data_source\n  , datediff(\n        year,\n        p.birth_date,\n        e.first_day_of_month\n        ) as age\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ahrq_measures._stg_pqi_member_months as e\ninner join __dbt__cte__ahrq_measures__stg_pqi_patient as p \n  on e.patient_id = p.patient_id\n  and p.data_source = e.data_source\nwhere \n  datediff(\n        year,\n        p.birth_date,\n        e.first_day_of_month\n        ) >= 18\n  and\n  datediff(\n        year,\n        p.birth_date,\n        e.first_day_of_month\n        ) <= 39", "relation_name": "dev_tom.ahrq_measures._int_pqi_15_denom"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.390450Z", "completed_at": "2024-08-23T19:21:34.395490Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.398304Z", "completed_at": "2024-08-23T19:21:34.398307Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.008917093276977539, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.ahrq_measures__int_pqi_16_denom", "compiled": true, "compiled_code": "\n\nwith __dbt__cte__ahrq_measures__stg_pqi_patient as (\n\n\nselect \n    data_source\n  , birth_date\n  , patient_id\n  , sex\nfrom \n    dev_tom.core.patient\n) select distinct\n    cast(substring(e.year_month, 1, 4) as int) AS year_number\n  , e.patient_id\n  , e.data_source\n  , datediff(\n        year,\n        p.birth_date,\n        e.first_day_of_month\n        ) as age\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ahrq_measures._stg_pqi_member_months as e\ninner join __dbt__cte__ahrq_measures__stg_pqi_patient as p \n  on e.patient_id = p.patient_id\n  and p.data_source = e.data_source\nwhere \n  datediff(\n        year,\n        p.birth_date,\n        e.first_day_of_month\n        ) >= 18", "relation_name": "dev_tom.ahrq_measures._int_pqi_16_denom"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.395660Z", "completed_at": "2024-08-23T19:21:34.398974Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.403079Z", "completed_at": "2024-08-23T19:21:34.403082Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.008477926254272461, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.mart_review__enrollment_change", "compiled": true, "compiled_code": "\n\nWITH RankedMonths AS (\n    SELECT\n        patient_id,\n        year_month,\n        data_source,\n        lag(year_month_date, 1) over (partition by patient_id, data_source order by year_month_date) as prev_year_month,\n        lead(year_month_date, 1) over (partition by patient_id, data_source order by year_month_date) as next_year_month,\n        year_month_date\n    FROM dev_tom.data_quality.mart_review__stg_member_month\n),\nChanges AS (\n SELECT\n    patient_id,\n    data_source,\n    year_month_date as change_month,\n    case\n        when prev_year_month is null\n            or \n\n    dateadd(\n        month,\n        -1,\n        year_month_date\n        )\n\n != prev_year_month\n        then 'added'\n    end as change_type\nFROM RankedMonths\nunion all\nSELECT\n    patient_id,\n    data_source,\n    \n\n    dateadd(\n        month,\n        1,\n        year_month_date\n        )\n\n as change_month,\n    case\n        when next_year_month is null\n            or \n\n    dateadd(\n        month,\n        1,\n        year_month_date\n        )\n\n != next_year_month\n        then 'removed'\n    end as change_type\nFROM RankedMonths\n\n),\nFinal AS (\n    SELECT\n       patient_id || '|' || change_month as membermonthkey,\n        data_source,\n        patient_id,\n        change_month,\n        change_type\n    FROM Changes\n    WHERE change_type IS NOT NULL\n),\nResult AS (\n    SELECT\n        data_source,\n        change_month,\n        change_type,\n        count(*) as member_count\n    FROM Final\n    GROUP BY data_source\n    , change_month\n    , change_type\n)\n\n\nSELECT * , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nFROM Result", "relation_name": "dev_tom.data_quality.mart_review__enrollment_change"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.399145Z", "completed_at": "2024-08-23T19:21:34.405513Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.406226Z", "completed_at": "2024-08-23T19:21:34.406229Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.008143901824951172, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.cms_hcc__int_demographic_factors", "compiled": true, "compiled_code": "\n\nwith members as (\n\n    select\n          patient_id\n        , enrollment_status\n        , gender\n        , age_group\n        , medicaid_status\n        , dual_status\n        , orec\n        , institutional_status\n        , enrollment_status_default\n        , medicaid_dual_status_default\n        , orec_default\n        , institutional_status_default\n        , payment_year\n    from dev_tom.cms_hcc._int_members\n\n)\n\n, seed_demographic_factors as (\n\n    select\n          model_version\n        , factor_type\n        , enrollment_status\n        , gender\n        , age_group\n        , medicaid_status\n        , dual_status\n        , orec\n        , institutional_status\n        , coefficient\n    from dev_tom.cms_hcc._value_set_demographic_factors\n    where plan_segment is null /* data not available */\n\n)\n\n, v24_new_enrollees as (\n\n    select\n          members.patient_id\n        , members.enrollment_status\n        , members.gender\n        , members.age_group\n        , members.medicaid_status\n        , members.dual_status\n        , members.orec\n        , members.institutional_status\n        , members.enrollment_status_default\n        , members.medicaid_dual_status_default\n        , members.orec_default\n        , members.institutional_status_default\n        , members.payment_year\n        , seed_demographic_factors.model_version\n        , seed_demographic_factors.factor_type\n        , seed_demographic_factors.coefficient\n    from members\n        inner join seed_demographic_factors\n            on members.enrollment_status = seed_demographic_factors.enrollment_status\n            and members.gender = seed_demographic_factors.gender\n            and members.age_group = seed_demographic_factors.age_group\n            and members.medicaid_status = seed_demographic_factors.medicaid_status\n            and members.orec = seed_demographic_factors.orec\n    where members.enrollment_status = 'New'\n        and seed_demographic_factors.model_version = 'CMS-HCC-V24'\n\n)\n\n, v24_continuining_enrollees as (\n\n    select\n          members.patient_id\n        , members.enrollment_status\n        , members.gender\n        , members.age_group\n        , members.medicaid_status\n        , members.dual_status\n        , members.orec\n        , members.institutional_status\n        , members.enrollment_status_default\n        , members.medicaid_dual_status_default\n        , members.orec_default\n        , members.institutional_status_default\n        , members.payment_year\n        , seed_demographic_factors.model_version\n        , seed_demographic_factors.factor_type\n        , seed_demographic_factors.coefficient\n    from members\n        inner join seed_demographic_factors\n            on members.enrollment_status = seed_demographic_factors.enrollment_status\n            and members.gender = seed_demographic_factors.gender\n            and members.age_group = seed_demographic_factors.age_group\n            and members.medicaid_status = seed_demographic_factors.medicaid_status\n            and members.dual_status = seed_demographic_factors.dual_status\n            and members.orec = seed_demographic_factors.orec\n            and members.institutional_status = seed_demographic_factors.institutional_status\n    where members.enrollment_status = 'Continuing'\n        and seed_demographic_factors.model_version = 'CMS-HCC-V24'\n\n)\n\n, v28_new_enrollees as (\n\n    select\n          members.patient_id\n        , members.enrollment_status\n        , members.gender\n        , members.age_group\n        , members.medicaid_status\n        , members.dual_status\n        , members.orec\n        , members.institutional_status\n        , members.enrollment_status_default\n        , members.medicaid_dual_status_default\n        , members.orec_default\n        , members.institutional_status_default\n        , members.payment_year\n        , seed_demographic_factors.model_version\n        , seed_demographic_factors.factor_type\n        , seed_demographic_factors.coefficient\n    from members\n        inner join seed_demographic_factors\n            on members.enrollment_status = seed_demographic_factors.enrollment_status\n            and members.gender = seed_demographic_factors.gender\n            and members.age_group = seed_demographic_factors.age_group\n            and members.medicaid_status = seed_demographic_factors.medicaid_status\n            and members.orec = seed_demographic_factors.orec\n    where members.enrollment_status = 'New'\n        and seed_demographic_factors.model_version = 'CMS-HCC-V28'\n\n)\n\n, v28_continuining_enrollees as (\n\n    select\n          members.patient_id\n        , members.enrollment_status\n        , members.gender\n        , members.age_group\n        , members.medicaid_status\n        , members.dual_status\n        , members.orec\n        , members.institutional_status\n        , members.enrollment_status_default\n        , members.medicaid_dual_status_default\n        , members.orec_default\n        , members.institutional_status_default\n        , members.payment_year\n        , seed_demographic_factors.model_version\n        , seed_demographic_factors.factor_type\n        , seed_demographic_factors.coefficient\n    from members\n        inner join seed_demographic_factors\n            on members.enrollment_status = seed_demographic_factors.enrollment_status\n            and members.gender = seed_demographic_factors.gender\n            and members.age_group = seed_demographic_factors.age_group\n            and members.medicaid_status = seed_demographic_factors.medicaid_status\n            and members.dual_status = seed_demographic_factors.dual_status\n            and members.orec = seed_demographic_factors.orec\n            and members.institutional_status = seed_demographic_factors.institutional_status\n    where members.enrollment_status = 'Continuing'\n        and seed_demographic_factors.model_version = 'CMS-HCC-V28'\n\n)\n\n, unioned as (\n\n    select * from v24_new_enrollees\n    union all\n    select * from v24_continuining_enrollees\n    union all\n    select * from v28_new_enrollees\n    union all\n    select * from v28_continuining_enrollees\n\n)\n\n, add_data_types as (\n\n    select\n          cast(patient_id as TEXT) as patient_id\n        , cast(enrollment_status as TEXT) as enrollment_status\n        , cast(gender as TEXT) as gender\n        , cast(age_group as TEXT) as age_group\n        , cast(medicaid_status as TEXT) as medicaid_status\n        , cast(dual_status as TEXT) as dual_status\n        , cast(orec as TEXT) as orec\n        , cast(institutional_status as TEXT) as institutional_status\n        \n            , cast(enrollment_status_default as boolean) as enrollment_status_default\n            , cast(medicaid_dual_status_default as boolean) as medicaid_dual_status_default\n            , cast(orec_default as boolean) as orec_default\n            , cast(institutional_status_default as boolean) as institutional_status_default\n        \n        , round(cast(coefficient as numeric(28,6)),3) as coefficient\n        , cast(factor_type as TEXT) as factor_type\n        , cast(model_version as TEXT) as model_version\n        , cast(payment_year as integer) as payment_year\n    from unioned\n\n)\n\nselect\n      patient_id\n    , enrollment_status\n    , gender\n    , age_group\n    , medicaid_status\n    , dual_status\n    , orec\n    , institutional_status\n    , enrollment_status_default\n    , medicaid_dual_status_default\n    , orec_default\n    , institutional_status_default\n    , coefficient\n    , factor_type\n    , model_version\n    , payment_year\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.cms_hcc._int_demographic_factors"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.403782Z", "completed_at": "2024-08-23T19:21:34.407398Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.409512Z", "completed_at": "2024-08-23T19:21:34.409515Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.00665593147277832, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.the_tuva_project.not_null_cms_hcc__int_members_patient_id.75e528329b", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect patient_id\nfrom dev_tom.cms_hcc._int_members\nwhere patient_id is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.407974Z", "completed_at": "2024-08-23T19:21:34.410703Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.415141Z", "completed_at": "2024-08-23T19:21:34.415144Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.009180307388305664, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.the_tuva_project.unique_cms_hcc__int_members_patient_id.4d202f2bbb", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    patient_id as unique_field,\n    count(*) as n_records\n\nfrom dev_tom.cms_hcc._int_members\nwhere patient_id is not null\ngroup by patient_id\nhaving count(*) > 1\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.411992Z", "completed_at": "2024-08-23T19:21:34.419278Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.419676Z", "completed_at": "2024-08-23T19:21:34.419679Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.009931087493896484, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.service_category__emergency_department_institutional", "compiled": true, "compiled_code": "\n\nwith __dbt__cte__service_category__stg_medical_claim as (\n\n\nselect\napr_drg_code,\nbill_type_code,\nclaim_id,\nclaim_line_number,\nclaim_type,\nhcpcs_code,\nms_drg_code,\nplace_of_service_code,\nrevenue_center_code,\n'2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\n) select distinct \n    med.claim_id\n    , 'Emergency Department' as service_category_2\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom __dbt__cte__service_category__stg_medical_claim med\nleft join dev_tom.claims_preprocessing._int_acute_inpatient_institutional inpatient\n    on med.claim_id = inpatient.claim_id\nwhere claim_type = 'institutional'\nand revenue_center_code in ('0450','0451','0452','0459','0981')\nand inpatient.claim_id is null\n-- 0456, urgent care, is included in most published definitions\n-- that also include a requirement of a bill type code for\n-- inpatient or outpatient hospital.", "relation_name": "dev_tom.claims_preprocessing._int_emergency_department_institutional"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.416129Z", "completed_at": "2024-08-23T19:21:34.420325Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.424023Z", "completed_at": "2024-08-23T19:21:34.424026Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.013186216354370117, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.service_category__ambulatory_surgery_professional", "compiled": true, "compiled_code": "\n\nwith __dbt__cte__service_category__stg_medical_claim as (\n\n\nselect\napr_drg_code,\nbill_type_code,\nclaim_id,\nclaim_line_number,\nclaim_type,\nhcpcs_code,\nms_drg_code,\nplace_of_service_code,\nrevenue_center_code,\n'2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\n) select distinct \n  a.claim_id\n, a.claim_line_number\n, 'Ambulatory Surgery' as service_category_2\n, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom __dbt__cte__service_category__stg_medical_claim a\nleft join dev_tom.claims_preprocessing._int_dme_professional b\n  on a.claim_id = b.claim_id\n  and a.claim_line_number = b.claim_line_number\nwhere a.claim_type = 'professional'\n  and a.place_of_service_code in ('24')\n  and (b.claim_id is null and b.claim_line_number is null)", "relation_name": "dev_tom.claims_preprocessing._int_ambulatory_surgery_professional"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.420542Z", "completed_at": "2024-08-23T19:21:34.424701Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.428240Z", "completed_at": "2024-08-23T19:21:34.428243Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.00882101058959961, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.service_category__home_health_professional", "compiled": true, "compiled_code": "\n\nwith __dbt__cte__service_category__stg_medical_claim as (\n\n\nselect\napr_drg_code,\nbill_type_code,\nclaim_id,\nclaim_line_number,\nclaim_type,\nhcpcs_code,\nms_drg_code,\nplace_of_service_code,\nrevenue_center_code,\n'2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\n) select distinct \n  a.claim_id\n, a.claim_line_number\n, 'Home Health' as service_category_2\n, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom __dbt__cte__service_category__stg_medical_claim a\nleft join dev_tom.claims_preprocessing._int_dme_professional b\n  on a.claim_id = b.claim_id\n  and a.claim_line_number = b.claim_line_number\nwhere a.claim_type = 'professional'\n  and a.place_of_service_code in ('12')\n  and (b.claim_id is null and b.claim_line_number is null)", "relation_name": "dev_tom.claims_preprocessing._int_home_health_professional"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.424881Z", "completed_at": "2024-08-23T19:21:34.428922Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.431189Z", "completed_at": "2024-08-23T19:21:34.431192Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.007393836975097656, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.service_category__skilled_nursing_professional", "compiled": true, "compiled_code": "\n\nwith __dbt__cte__service_category__stg_medical_claim as (\n\n\nselect\napr_drg_code,\nbill_type_code,\nclaim_id,\nclaim_line_number,\nclaim_type,\nhcpcs_code,\nms_drg_code,\nplace_of_service_code,\nrevenue_center_code,\n'2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\n) select distinct \n  a.claim_id\n, a.claim_line_number\n, 'Skilled Nursing' as service_category_2\n, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom __dbt__cte__service_category__stg_medical_claim a\nleft join dev_tom.claims_preprocessing._int_dme_professional b\n  on a.claim_id = b.claim_id\n  and a.claim_line_number = b.claim_line_number\nwhere claim_type = 'professional'\n  and place_of_service_code in ('31','32')\n  and (b.claim_id is null and b.claim_line_number is null)", "relation_name": "dev_tom.claims_preprocessing._int_skilled_nursing_professional"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.429078Z", "completed_at": "2024-08-23T19:21:34.431869Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.438275Z", "completed_at": "2024-08-23T19:21:34.438278Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.010253667831420898, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.service_category__dq_input_layer_results", "compiled": true, "compiled_code": "\n\nselect\n  dq_problem\n, count(distinct claim_id) as distinct_claims\n, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing._dq_input_layer_tests\ngroup by dq_problem", "relation_name": "dev_tom.claims_preprocessing._dq_input_layer_results"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.432044Z", "completed_at": "2024-08-23T19:21:34.438961Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.445252Z", "completed_at": "2024-08-23T19:21:34.445255Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.01429295539855957, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.pharmacy__brand_generic_opportunity", "compiled": true, "compiled_code": "\n\n/* claimid/line/source grain. calculates opportunity at line level*/\n\nwith  __dbt__cte__pharmacy__stg_pharmacy_claim as (\n\n\nselect \n    p.ndc_code\n  , n.fda_description as ndc_description\n  , p.data_source\n  , n.rxcui\n  , p.paid_amount\n  , p.allowed_amount\n  , p.claim_id\n  , p.claim_line_number\n  , p.patient_id\n  , p.member_id\n  , p.prescribing_provider_id\n  , p.dispensing_provider_id\n  , p.dispensing_date\n  , p.quantity\n  , p.days_supply\n  , p.refills\n  , p.paid_date\nfrom dev_tom.core.pharmacy_claim as p\nleft join dev_tom.terminology.ndc as n \n  on p.ndc_code = n.ndc\n), cpu as (\nselect claim_id\n,claim_line_number\n,data_source\n,case when quantity > 0 then paid_amount/quantity else null end as brand_cost_per_unit\nfrom __dbt__cte__pharmacy__stg_pharmacy_claim\n)\n\n\nselect \n    pc.data_source\n  , pc.claim_id\n  , pc.claim_line_number\n  , cc.ndc_code\n  , cc.ndc_description\n  , cc.rxcui as brand_rxcui\n  , cc.brand_vs_generic \n  , cc.generic_available\n  , pc.paid_amount\n  , pc.quantity as total_units\n  , cpu.brand_cost_per_unit\n  , gc.generic_average_cost_per_unit \n  , cpu.brand_cost_per_unit - gc.generic_average_cost_per_unit as brand_less_generic_cost_per_unit\n  , case \n      when cpu.brand_cost_per_unit - gc.generic_average_cost_per_unit > 0 \n        then (cpu.brand_cost_per_unit - gc.generic_average_cost_per_unit) * pc.quantity \n      else 0 \n    end as generic_available_total_opportunity\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom __dbt__cte__pharmacy__stg_pharmacy_claim as pc\ninner join cpu on pc.claim_id = cpu.claim_id\n  and\n  pc.claim_line_number = cpu.claim_line_number\n  and\n  pc.data_source = cpu.data_source\ninner join dev_tom.pharmacy._int_claims_current_cost cc\n  on cc.ndc_code = pc.ndc_code\n  and\n  cc.data_source = pc.data_source\ninner join dev_tom.pharmacy._int_generic_cost  as gc \n  on cc.rxcui = gc.brand_rxcui\n  and gc.data_source = cc.data_source\nwhere prescribed_atleast_one_generic_history = 1", "relation_name": "dev_tom.pharmacy.brand_generic_opportunity"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.439134Z", "completed_at": "2024-08-23T19:21:34.445987Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.449837Z", "completed_at": "2024-08-23T19:21:34.449839Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.011779069900512695, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.ahrq_measures__pqi_denom_long", "compiled": true, "compiled_code": "\n\nselect\n    d.year_number\n  , d.patient_id\n  , d.data_source\n  , '01' as pqi_number\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ahrq_measures._int_pqi_01_denom as d\n\nunion all\n\nselect\n    d.year_number\n  , d.patient_id\n  , d.data_source\n  , '03' as pqi_number\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ahrq_measures._int_pqi_03_denom as d\n\nunion all\n\nselect\n    d.year_number\n  , d.patient_id\n  , d.data_source\n  , '05' as pqi_number\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ahrq_measures._int_pqi_05_denom as d\n\nunion all\n\nselect\n    d.year_number\n  , d.patient_id\n  , d.data_source\n  , '07' as pqi_number\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ahrq_measures._int_pqi_07_denom as d\n\nunion all\n\nselect\n    d.year_number\n  , d.patient_id\n  , d.data_source\n  , '08' as pqi_number\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ahrq_measures._int_pqi_08_denom as d\n\nunion all\n\nselect\n    d.year_number\n  , d.patient_id\n  , d.data_source\n  , '11' as pqi_number\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ahrq_measures._int_pqi_11_denom as d\n\nunion all\n\nselect\n    d.year_number\n  , d.patient_id\n  , d.data_source\n  , '12' as pqi_number\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ahrq_measures._int_pqi_12_denom as d\n\nunion all\n\nselect\n    d.year_number\n  , d.patient_id\n  , d.data_source\n  , '14' as pqi_number\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ahrq_measures._int_pqi_14_denom as d\n\nunion all\n\nselect\n    d.year_number\n  , d.patient_id\n  , d.data_source\n  , '15' as pqi_number\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ahrq_measures._int_pqi_15_denom as d\n\nunion all\n\nselect\n    d.year_number\n  , d.patient_id\n  , d.data_source\n  , '16' as pqi_number\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ahrq_measures._int_pqi_16_denom as d", "relation_name": "dev_tom.ahrq_measures.pqi_denom_long"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.446146Z", "completed_at": "2024-08-23T19:21:34.450507Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.452907Z", "completed_at": "2024-08-23T19:21:34.452909Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.007882118225097656, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.cms_hcc__int_enrollment_interaction_factors", "compiled": true, "compiled_code": "\n\nwith demographics as (\n\n    select\n          patient_id\n        , enrollment_status\n        , gender\n        , age_group\n        , medicaid_status\n        , dual_status\n        , orec\n        , institutional_status\n        , model_version\n        , payment_year\n    from dev_tom.cms_hcc._int_demographic_factors\n\n)\n\n, seed_interaction_factors as (\n\n    select\n          model_version\n        , factor_type\n        , gender\n        , enrollment_status\n        , medicaid_status\n        , dual_status\n        , institutional_status\n        , description\n        , coefficient\n    from dev_tom.cms_hcc._value_set_enrollment_interaction_factors\n\n)\n\n/*\n    Originally disabled interactions for non-institutional members >= 65\n*/\n, non_institutional_interactions as (\n\n    select\n          demographics.patient_id\n        , demographics.model_version\n        , demographics.payment_year\n        , seed_interaction_factors.factor_type\n        , seed_interaction_factors.description\n        , seed_interaction_factors.coefficient\n    from demographics\n        inner join seed_interaction_factors\n            on demographics.gender = seed_interaction_factors.gender\n            and demographics.enrollment_status = seed_interaction_factors.enrollment_status\n            and demographics.medicaid_status = seed_interaction_factors.medicaid_status\n            and demographics.dual_status = seed_interaction_factors.dual_status\n            and demographics.institutional_status = seed_interaction_factors.institutional_status\n            and demographics.model_version = seed_interaction_factors.model_version\n    where demographics.institutional_status = 'No'\n        and demographics.orec = 'Disabled'\n        and demographics.age_group in (\n              '65-69'\n            , '70-74'\n            , '75-79'\n            , '80-84'\n            , '85-89'\n            , '90-94'\n            , '>=95'\n        )\n\n)\n\n/*\n    Medicaid interactions for institutional members\n*/\n, institutional_interactions as (\n\n    select\n          demographics.patient_id\n        , demographics.model_version\n        , demographics.payment_year\n        , seed_interaction_factors.factor_type\n        , seed_interaction_factors.description\n        , seed_interaction_factors.coefficient\n    from demographics\n        inner join seed_interaction_factors\n            on demographics.enrollment_status = seed_interaction_factors.enrollment_status\n            and demographics.institutional_status = seed_interaction_factors.institutional_status\n            and demographics.model_version = seed_interaction_factors.model_version\n    where demographics.institutional_status = 'Yes'\n        and demographics.medicaid_status = 'Yes'\n\n)\n\n, unioned as (\n\n    select * from non_institutional_interactions\n    union all\n    select * from institutional_interactions\n\n)\n\n, add_data_types as (\n\n    select\n          cast(patient_id as TEXT) as patient_id\n        , cast(description as TEXT) as description\n        , round(cast(coefficient as numeric(28,6)),3) as coefficient\n        , cast(factor_type as TEXT) as factor_type\n        , cast(model_version as TEXT) as model_version\n        , cast(payment_year as integer) as payment_year\n    from unioned\n\n)\n\nselect\n      patient_id\n    , description\n    , coefficient\n    , factor_type\n    , model_version\n    , payment_year\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.cms_hcc._int_enrollment_interaction_factors"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.450658Z", "completed_at": "2024-08-23T19:21:34.453576Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.457088Z", "completed_at": "2024-08-23T19:21:34.457091Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0074520111083984375, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.the_tuva_project.dbt_utils_unique_combination_of_columns_cms_hcc__int_demographic_factors_patient_id__model_version.d5ad3bc1ba", "compiled": true, "compiled_code": "\n\n\n\n\n\nwith validation_errors as (\n\n    select\n        patient_id, model_version\n    from dev_tom.cms_hcc._int_demographic_factors\n    group by patient_id, model_version\n    having count(*) > 1\n\n)\n\nselect *\nfrom validation_errors\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.453754Z", "completed_at": "2024-08-23T19:21:34.457757Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.461162Z", "completed_at": "2024-08-23T19:21:34.461165Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.00845789909362793, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.service_category__urgent_care_institutional", "compiled": true, "compiled_code": "\n\nwith __dbt__cte__service_category__stg_medical_claim as (\n\n\nselect\napr_drg_code,\nbill_type_code,\nclaim_id,\nclaim_line_number,\nclaim_type,\nhcpcs_code,\nms_drg_code,\nplace_of_service_code,\nrevenue_center_code,\n'2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\n) select distinct \n  a.claim_id\n, 'Urgent Care' as service_category_2\n, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom __dbt__cte__service_category__stg_medical_claim a\nleft join dev_tom.claims_preprocessing._int_emergency_department_institutional b\n  on a.claim_id = b.claim_id\nwhere claim_type = 'institutional'\n  and revenue_center_code = '0456'\n  and substring(bill_type_code, 1, 2) in ('13','71','73')\n  and b.claim_id is null", "relation_name": "dev_tom.claims_preprocessing._int_urgent_care_institutional"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.457924Z", "completed_at": "2024-08-23T19:21:34.461849Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.472187Z", "completed_at": "2024-08-23T19:21:34.472191Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.015302181243896484, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.service_category__combined_professional", "compiled": true, "compiled_code": "\n\nwith combined as (\nselect *\nfrom dev_tom.claims_preprocessing._int_acute_inpatient_professional\n\nunion all\n\nselect *\nfrom dev_tom.claims_preprocessing._int_ambulatory_surgery_professional\n\nunion all\n\nselect *\nfrom dev_tom.claims_preprocessing._int_dialysis_professional\n\nunion all\n\nselect *\nfrom dev_tom.claims_preprocessing._int_emergency_department_professional\n\nunion all\n\nselect *\nfrom dev_tom.claims_preprocessing._int_home_health_professional\n\nunion all\n\nselect *\nfrom dev_tom.claims_preprocessing._int_hospice_professional\n\nunion all\n\nselect *\nfrom dev_tom.claims_preprocessing._int_inpatient_psychiatric_professional\n\nunion all\n\nselect *\nfrom dev_tom.claims_preprocessing._int_inpatient_rehab_professional\n\nunion all\n\nselect *\nfrom dev_tom.claims_preprocessing._int_lab_professional\n\nunion all\n\nselect *\nfrom dev_tom.claims_preprocessing._int_office_visit_professional\n\nunion all\n\nselect *\nfrom dev_tom.claims_preprocessing._int_outpatient_hospital_or_clinic_professional\n\nunion all\n\nselect *\nfrom dev_tom.claims_preprocessing._int_outpatient_psychiatric_professional\n\nunion all\n\nselect *\nfrom dev_tom.claims_preprocessing._int_outpatient_rehab_professional\n\nunion all\n\nselect *\nfrom dev_tom.claims_preprocessing._int_skilled_nursing_professional\n\nunion all\n\nselect *\nfrom dev_tom.claims_preprocessing._int_urgent_care_professional\n)\n\nselect \n  claim_id\n, claim_line_number\n, service_category_2\n, tuva_last_run\nfrom dev_tom.claims_preprocessing._int_dme_professional\n\nunion all\n\nselect \n  a.claim_id\n, a.claim_line_number\n, a.service_category_2\n, a.tuva_last_run\nfrom dev_tom.claims_preprocessing._int_ambulance_professional a\nleft join dev_tom.claims_preprocessing._int_dme_professional b\n  on a.claim_id = b.claim_id\n  and a.claim_line_number = b.claim_line_number\nwhere (b.claim_id is null and b.claim_line_number is null)\n\nunion all\n\nselect \n  a.claim_id\n, a.claim_line_number\n, a.service_category_2\n, a.tuva_last_run\nfrom combined a\nleft join dev_tom.claims_preprocessing._int_dme_professional b\n  on a.claim_id = b.claim_id\n  and a.claim_line_number = b.claim_line_number\nleft join dev_tom.claims_preprocessing._int_ambulance_professional c\n  on a.claim_id = c.claim_id\n  and a.claim_line_number = c.claim_line_number\nwhere (b.claim_id is null and b.claim_line_number is null)\n  and (c.claim_id is null and c.claim_line_number is null)", "relation_name": "dev_tom.claims_preprocessing._int_combined_professional"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.462012Z", "completed_at": "2024-08-23T19:21:34.472878Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.475144Z", "completed_at": "2024-08-23T19:21:34.475147Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.014202117919921875, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.pharmacy__pharmacy_claim_expanded", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__pharmacy__stg_pharmacy_claim as (\n\n\nselect \n    p.ndc_code\n  , n.fda_description as ndc_description\n  , p.data_source\n  , n.rxcui\n  , p.paid_amount\n  , p.allowed_amount\n  , p.claim_id\n  , p.claim_line_number\n  , p.patient_id\n  , p.member_id\n  , p.prescribing_provider_id\n  , p.dispensing_provider_id\n  , p.dispensing_date\n  , p.quantity\n  , p.days_supply\n  , p.refills\n  , p.paid_date\nfrom dev_tom.core.pharmacy_claim as p\nleft join dev_tom.terminology.ndc as n \n  on p.ndc_code = n.ndc\n), all_drugs as (\n  select \n      p.data_source\n    , p.claim_id\n    , p.claim_line_number\n    , p.patient_id\n    , p.member_id\n    , p.prescribing_provider_id\n    , p.dispensing_provider_id\n    , p.dispensing_date\n    , p.ndc_code\n    , p.ndc_description\n    , p.quantity\n    , p.days_supply\n    , p.refills\n    , p.paid_date\n    , p.paid_amount\n    , p.allowed_amount\n    , p.rxcui\n    , r.product_name\n    , r.product_tty\n    , r.brand_vs_generic\n    , r.brand_name\n    , r.clinical_product_rxcui as generic_rxcui\n    , r.clinical_product_name as generic_rxcui_description\n    , r.clinical_product_tty as generic_tty\n    , r.ingredient_name\n    , r.dose_form_name\n    , case \n        when ga.brand_with_generic_available is not null \n          then 'brand_with_generic_available' \n        else r.brand_vs_generic \n      end as generic_available\n    , opp.brand_cost_per_unit\n    , opp.generic_average_cost_per_unit\n    , opp.brand_less_generic_cost_per_unit\n    , opp.generic_available_total_opportunity\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\n  from __dbt__cte__pharmacy__stg_pharmacy_claim as p\n  left join dev_tom.terminology.rxnorm_brand_generic as r \n    on p.rxcui = r.product_rxcui\n  left join dev_tom.pharmacy._int_brand_with_generic_available as ga \n    on p.rxcui = ga.brand_with_generic_available\n  left join dev_tom.pharmacy.brand_generic_opportunity as opp \n    on p.claim_id = opp.claim_id\n    and p.claim_line_number = opp.claim_line_number\n    and p.data_source = opp.data_source\n)\n\n, generic_available as (\n  select \n      *\n    , row_number() over (order by ndc_code, data_source) as generic_available_sk\n  from all_drugs\n  where generic_available = 'brand_with_generic_available'\n)\n\nselect \n    a.data_source\n  , a.claim_id\n  , a.claim_line_number\n  , a.patient_id\n  , a.member_id\n  , a.prescribing_provider_id\n  , a.dispensing_provider_id\n  , a.dispensing_date\n  , a.ndc_code\n  , a.ndc_description\n  , a.quantity\n  , a.days_supply\n  , a.refills\n  , a.paid_date\n  , a.paid_amount\n  , a.allowed_amount\n  , a.rxcui\n  , a.product_name\n  , a.product_tty\n  , a.brand_vs_generic\n  , a.brand_name\n  , a.generic_rxcui\n  , a.generic_rxcui_description\n  , a.generic_tty\n  , a.ingredient_name\n  , a.dose_form_name\n  , a.generic_available\n  , a.brand_cost_per_unit\n  , a.generic_average_cost_per_unit\n  , a.brand_less_generic_cost_per_unit\n  , a.generic_available_total_opportunity\n  , g.generic_available_sk\nfrom all_drugs as a\nleft join generic_available as g \n  on a.claim_id = g.claim_id\n  and a.claim_line_number = g.claim_line_number\n  and a.data_source = g.data_source", "relation_name": "dev_tom.pharmacy.pharmacy_claim_expanded"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.473070Z", "completed_at": "2024-08-23T19:21:34.475809Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.479678Z", "completed_at": "2024-08-23T19:21:34.479681Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.007727146148681641, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.the_tuva_project.dbt_utils_unique_combination_of_columns_pharmacy__brand_generic_opportunity_data_source__claim_id__claim_line_number.c19d0cecc7", "compiled": true, "compiled_code": "\n\n\n\n\n\nwith validation_errors as (\n\n    select\n        data_source, claim_id, claim_line_number\n    from dev_tom.pharmacy.brand_generic_opportunity\n    group by data_source, claim_id, claim_line_number\n    having count(*) > 1\n\n)\n\nselect *\nfrom validation_errors\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.476001Z", "completed_at": "2024-08-23T19:21:34.480349Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.482574Z", "completed_at": "2024-08-23T19:21:34.482577Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.007653236389160156, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.service_category__outpatient_hospital_or_clinic_institutional", "compiled": true, "compiled_code": "\n\nwith __dbt__cte__service_category__stg_medical_claim as (\n\n\nselect\napr_drg_code,\nbill_type_code,\nclaim_id,\nclaim_line_number,\nclaim_type,\nhcpcs_code,\nms_drg_code,\nplace_of_service_code,\nrevenue_center_code,\n'2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\n) select distinct \n  a.claim_id\n, 'Outpatient Hospital or Clinic' as service_category_2\n, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom __dbt__cte__service_category__stg_medical_claim a\nleft join dev_tom.claims_preprocessing._int_emergency_department_institutional b\n  on a.claim_id = b.claim_id\nleft join dev_tom.claims_preprocessing._int_urgent_care_institutional c\n  on a.claim_id = c.claim_id\nwhere a.claim_type = 'institutional'\n  and substring(a.bill_type_code, 1, 2) in ('13','71','73')\n  and b.claim_id is null\n  and c.claim_id is null", "relation_name": "dev_tom.claims_preprocessing._int_outpatient_hospital_or_clinic_institutional"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.480518Z", "completed_at": "2024-08-23T19:21:34.483282Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.492109Z", "completed_at": "2024-08-23T19:21:34.492112Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.012650251388549805, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.service_category__dq_multiple_service_categories_professional", "compiled": true, "compiled_code": "\n\nselect\n  claim_id\n, claim_line_number\n, count(distinct service_category_2) as distinct_service_category_count\n, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing._int_combined_professional\ngroup by claim_id, claim_line_number\nhaving count(distinct service_category_2) > 1", "relation_name": "dev_tom.claims_preprocessing._dq_multiple_service_categories_professional"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.483460Z", "completed_at": "2024-08-23T19:21:34.492793Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.494739Z", "completed_at": "2024-08-23T19:21:34.494742Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.01240229606628418, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.pharmacy__generic_available_list", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__pharmacy__stg_pharmacy_claim as (\n\n\nselect \n    p.ndc_code\n  , n.fda_description as ndc_description\n  , p.data_source\n  , n.rxcui\n  , p.paid_amount\n  , p.allowed_amount\n  , p.claim_id\n  , p.claim_line_number\n  , p.patient_id\n  , p.member_id\n  , p.prescribing_provider_id\n  , p.dispensing_provider_id\n  , p.dispensing_date\n  , p.quantity\n  , p.days_supply\n  , p.refills\n  , p.paid_date\nfrom dev_tom.core.pharmacy_claim as p\nleft join dev_tom.terminology.ndc as n \n  on p.ndc_code = n.ndc\n), generic_sk as (\n  select \n      generic_available_sk\n    , claim_id\n    , claim_line_number\n    , data_source\n  from dev_tom.pharmacy.pharmacy_claim_expanded as e\n  where generic_available_sk is not null\n)\n\nselect \n    sk.generic_available_sk\n  , p.data_source\n  , p.ndc_code as brand_ndc_code\n  , p.ndc_description as brand_ndc_description\n  , p.rxcui as brand_rxcui\n  , p.paid_amount as brand_paid_amount\n  , p.quantity as brand_units\n  , case \n      when p.quantity = 0 \n        then 0 \n      else p.paid_amount / p.quantity  \n    end as brand_paid_per_unit\n  , ga.ndc as generic_ndc\n  , n.fda_description as generic_ndc_description\n  , case \n      when gc.ndc_code is not null \n        then 1 \n      else 0 \n    end as generic_prescribed_history\n  , gc.cost_per_unit as generic_cost_per_unit\n  , gc.cost_per_unit * p.quantity as generic_cost_at_units\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom __dbt__cte__pharmacy__stg_pharmacy_claim as p\ninner join generic_sk as sk \n  on p.claim_id = sk.claim_id\n  and p.claim_line_number = sk.claim_line_number\n  and p.data_source = sk.data_source\ninner join dev_tom.pharmacy._int_brand_with_generic_available as b \n  on p.rxcui = b.brand_with_generic_available\ninner join dev_tom.pharmacy.rxnorm_generic_available as ga \n  on p.rxcui = ga.product_rxcui\n  and ga.ndc_product_tty in ('SCD','GPCK')\nleft join dev_tom.terminology.ndc as n \n  on ga.ndc = n.ndc\nleft join dev_tom.pharmacy._int_claims_current_cost as gc \n  on ga.ndc = gc.ndc_code\n  and gc.brand_vs_generic = 'generic'\n  and gc.data_source = p.data_source\nwhere \n    ga.product_startmarketingdate is not null\n    \n        and cast(ga.product_startmarketingdate as date) <= current_date\n", "relation_name": "dev_tom.pharmacy.generic_available_list"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.492939Z", "completed_at": "2024-08-23T19:21:34.495273Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.497896Z", "completed_at": "2024-08-23T19:21:34.497898Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.005992889404296875, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.the_tuva_project.dbt_utils_unique_combination_of_columns_pharmacy__pharmacy_claim_expanded_data_source__claim_id__claim_line_number.132bf82f59", "compiled": true, "compiled_code": "\n\n\n\n\n\nwith validation_errors as (\n\n    select\n        data_source, claim_id, claim_line_number\n    from dev_tom.pharmacy.pharmacy_claim_expanded\n    group by data_source, claim_id, claim_line_number\n    having count(*) > 1\n\n)\n\nselect *\nfrom validation_errors\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.495612Z", "completed_at": "2024-08-23T19:21:34.500609Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.500788Z", "completed_at": "2024-08-23T19:21:34.500791Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.006273031234741211, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.service_category__combined_institutional", "compiled": true, "compiled_code": "\n\nwith duplicate_bill_types as (\nselect distinct\n  claim_id\n, 'Other' as service_category_2\nfrom dev_tom.claims_preprocessing._int_duplicate_bill_types\n)\n\n, combine as (\nselect *\nfrom dev_tom.claims_preprocessing._int_acute_inpatient_institutional\n\nunion all\n\nselect *\nfrom dev_tom.claims_preprocessing._int_dialysis_institutional\n\nunion all\n\nselect *\nfrom dev_tom.claims_preprocessing._int_emergency_department_institutional\n\nunion all\n\nselect *\nfrom dev_tom.claims_preprocessing._int_home_health_institutional\n\nunion all\n\nselect *\nfrom dev_tom.claims_preprocessing._int_hospice_institutional\n\nunion all\n\nselect *\nfrom dev_tom.claims_preprocessing._int_lab_institutional\n\nunion all\n\nselect *\nfrom dev_tom.claims_preprocessing._int_outpatient_hospital_or_clinic_institutional\n\nunion all\n\nselect *\nfrom dev_tom.claims_preprocessing._int_outpatient_psychiatric_institutional\n\nunion all\n\nselect *\nfrom dev_tom.claims_preprocessing._int_skilled_nursing_institutional\n\nunion all\n\nselect *\nfrom dev_tom.claims_preprocessing._int_urgent_care_institutional\n)\n\nselect\n  claim_id\n, service_category_2\nfrom duplicate_bill_types\n\nunion all\n\nselect\n  a.claim_id\n, a.service_category_2\nfrom combine a\nleft join duplicate_bill_types b\n  on a.claim_id = b.claim_id\nwhere b.claim_id is null", "relation_name": "dev_tom.claims_preprocessing._int_combined_institutional"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.498592Z", "completed_at": "2024-08-23T19:21:34.501109Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.501605Z", "completed_at": "2024-08-23T19:21:34.501607Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.0034880638122558594, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.the_tuva_project.dbt_utils_unique_combination_of_columns_pharmacy__generic_available_list_generic_available_sk__generic_ndc.5460505c42", "compiled": true, "compiled_code": "\n\n\n\n\n\nwith validation_errors as (\n\n    select\n        generic_available_sk, generic_ndc\n    from dev_tom.pharmacy.generic_available_list\n    group by generic_available_sk, generic_ndc\n    having count(*) > 1\n\n)\n\nselect *\nfrom validation_errors\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.502685Z", "completed_at": "2024-08-23T19:21:34.524293Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.524643Z", "completed_at": "2024-08-23T19:21:34.524646Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.022735118865966797, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.service_category__dq_multiple_service_categories_institutional", "compiled": true, "compiled_code": "\n\nselect\n  claim_id\n, count(distinct service_category_2) as distinct_service_category_count\n, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing._int_combined_institutional\ngroup by claim_id\nhaving count(distinct service_category_2) > 1", "relation_name": "dev_tom.claims_preprocessing._dq_multiple_service_categories_institutional"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.504483Z", "completed_at": "2024-08-23T19:21:34.524468Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.525090Z", "completed_at": "2024-08-23T19:21:34.525094Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.022991180419921875, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.service_category__service_category_grouper", "compiled": true, "compiled_code": "\nwith  __dbt__cte__service_category__stg_medical_claim as (\n\n\nselect\napr_drg_code,\nbill_type_code,\nclaim_id,\nclaim_line_number,\nclaim_type,\nhcpcs_code,\nms_drg_code,\nplace_of_service_code,\nrevenue_center_code,\n'2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\n), service_category_1_mapping as(\n    select distinct \n        a.claim_id\n        , a.claim_line_number\n        , a.claim_type\n        , case\n            when service_category_2 = 'Acute Inpatient'               then 'Inpatient'\n            when service_category_2 = 'Ambulance'                     then 'Ancillary'\n            when service_category_2 = 'Ambulatory Surgery'            then 'Outpatient'\n            when service_category_2 = 'Dialysis'                      then 'Outpatient'\n            when service_category_2 = 'Durable Medical Equipment'     then 'Ancillary'\n            when service_category_2 = 'Emergency Department'          then 'Outpatient'\n            when service_category_2 = 'Home Health'                   then 'Outpatient'\n            when service_category_2 = 'Hospice'                       then 'Outpatient'\n            when service_category_2 = 'Inpatient Psychiatric'         then 'Inpatient'\n            when service_category_2 = 'Inpatient Rehabilitation'      then 'Inpatient'\n            when service_category_2 = 'Lab'                           then 'Ancillary'\n            when service_category_2 = 'Office Visit'                  then 'Office Visit'\n            when service_category_2 = 'Outpatient Hospital or Clinic' then 'Outpatient'\n            when service_category_2 = 'Outpatient Psychiatric'        then 'Outpatient'\n            when service_category_2 = 'Outpatient Rehabilitation'     then 'Outpatient'\n            when service_category_2 = 'Skilled Nursing'               then 'Inpatient'\n            when service_category_2 = 'Urgent Care'                   then 'Outpatient'\n            when service_category_2 is null                           then 'Other'\n        end service_category_1\n        , case\n            when service_category_2 is null then 'Other'\n            else service_category_2\n        end service_category_2\n        , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\n    from __dbt__cte__service_category__stg_medical_claim a\n    left join dev_tom.claims_preprocessing._int_combined_professional b\n    on a.claim_id = b.claim_id\n    and a.claim_line_number = b.claim_line_number\n    where a.claim_type = 'professional'\n\n    union all\n\n    select distinct \n        a.claim_id\n        , a.claim_line_number\n        , a.claim_type\n        , case\n            when service_category_2 = 'Acute Inpatient'               then 'Inpatient'\n            when service_category_2 = 'Ambulatory Surgery'            then 'Outpatient'\n            when service_category_2 = 'Dialysis'                      then 'Outpatient'\n            when service_category_2 = 'Emergency Department'          then 'Outpatient'\n            when service_category_2 = 'Home Health'                   then 'Outpatient'\n            when service_category_2 = 'Hospice'                       then 'Outpatient'\n            when service_category_2 = 'Inpatient Psychiatric'         then 'Inpatient'\n            when service_category_2 = 'Inpatient Rehabilitation'      then 'Inpatient'\n            when service_category_2 = 'Lab'                           then 'Ancillary'\n            when service_category_2 = 'Office Visit'                  then 'Office Visit'\n            when service_category_2 = 'Outpatient Hospital or Clinic' then 'Outpatient'\n            when service_category_2 = 'Outpatient Psychiatric'        then 'Outpatient'\n            when service_category_2 = 'Skilled Nursing'               then 'Inpatient'\n            when service_category_2 = 'Urgent Care'                   then 'Outpatient'\n            when service_category_2 is null                           then 'Other'\n        end service_category_1\n        , case\n            when service_category_2 is null then 'Other'\n            else service_category_2\n        end service_category_2\n        , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\n    from __dbt__cte__service_category__stg_medical_claim a\n    left join dev_tom.claims_preprocessing._int_combined_institutional b\n    on a.claim_id = b.claim_id\n    where a.claim_type = 'institutional'\n)\n, service_category_2_deduplication as(\n    select \n        claim_id\n        , claim_line_number\n        , claim_type\n        , service_category_1\n        , service_category_2\n        , row_number() over (partition by claim_id, claim_line_number order by \n            case\n            when service_category_2 = 'Acute Inpatient'               then 3\n            when service_category_2 = 'Ambulance'                     then 7\n            when service_category_2 = 'Ambulatory Surgery'            then 8\n            when service_category_2 = 'Dialysis'                      then 17\n            when service_category_2 = 'Durable Medical Equipment'     then 1\n            when service_category_2 = 'Emergency Department'          then 5\n            when service_category_2 = 'Home Health'                   then 9\n            when service_category_2 = 'Hospice'                       then 10\n            when service_category_2 = 'Inpatient Psychiatric'         then 11\n            when service_category_2 = 'Inpatient Rehabilitation'      then 12\n            when service_category_2 = 'Lab'                           then 13\n            when service_category_2 = 'Office Visit'                  then 4\n            when service_category_2 = 'Outpatient Hospital or Clinic' then 14\n            when service_category_2 = 'Outpatient Psychiatric'        then 15\n            when service_category_2 = 'Outpatient Rehabilitation'     then 16\n            when service_category_2 = 'Skilled Nursing'               then 6\n            when service_category_2 = 'Urgent Care'                   then 2\n            when service_category_2 is null                           then 18\n                else 99 end) as duplicate_row_number\n    from service_category_1_mapping\n)\n\nselect\n    claim_id\n    , claim_line_number\n    , claim_type\n    , service_category_1\n    , service_category_2\nfrom service_category_2_deduplication\nwhere duplicate_row_number = 1", "relation_name": "dev_tom.claims_preprocessing.service_category_grouper"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.581639Z", "completed_at": "2024-08-23T19:21:34.643204Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.643543Z", "completed_at": "2024-08-23T19:21:34.643548Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.06261420249938965, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.acute_inpatient__institutional_claims", "compiled": true, "compiled_code": "\n\n-- *************************************************\n-- This dbt model gives us all acute inpatient institutional claims.\n-- We have one row per claim_id (for all claim_ids belonging to\n-- acute inpatient institutinal claims).\n-- The number of rows in the table is equal to the number of unique\n-- claim_ids (i.e. claim_id is a primary key).\n-- Note that we are assuming that a claim_id is unique across\n-- all people in the datset, i.e.\n-- that no two people can have the same claim_id.\n-- *************************************************\n\nwith  __dbt__cte__acute_inpatient__stg_medical_claim as (\n\n\nselect \n    claim_id\n    , claim_line_number\n    , patient_id\n    , claim_type\n    , claim_start_date\n    , claim_end_date\n    , admission_date\n    , discharge_date\n    , facility_id\n    , ms_drg_code\n    , apr_drg_code\n    , admit_source_code\n    , admit_type_code\n    , discharge_disposition_code\n    , paid_amount\n    , allowed_amount\n    , charge_amount\n    , diagnosis_code_type\n    , diagnosis_code_1\n    , data_source\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\n),  __dbt__cte__acute_inpatient__stg_service_category as (\n\n\n\nSELECT\n  claim_id\n, claim_type\n, claim_line_number\n, service_category_2\n, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing.service_category_grouper\n), acute_inpatient_claim_lines as (\nselect\n  mc.patient_id,\n  mc.claim_id,\n  mc.claim_line_number,\n  mc.claim_start_date,\n  mc.claim_end_date,\n  mc.admission_date,\n  mc.discharge_date,\n  mc.admit_source_code,\n  mc.admit_type_code,\n  mc.discharge_disposition_code,\n  mc.facility_id,\n  mc.claim_type,\n  mc.data_source\nfrom __dbt__cte__acute_inpatient__stg_medical_claim mc\ninner join __dbt__cte__acute_inpatient__stg_service_category sc\n  on mc.claim_id = sc.claim_id\nwhere mc.claim_type = 'institutional'\n  and sc.service_category_2 = 'Acute Inpatient'\n),\n\ndata_quality_flags as (\nselect\n  claim_id,\n-- patient_id_not_unique:\n  case\n    when count(distinct patient_id) > 1 then 1\n    else 0\n  end as patient_id_not_unique,\n-- patient_id_missing:  \n  case\n    when max(patient_id) is null then 1\n    else 0\n  end as patient_id_missing,  \n-- claim_start_date_not_unique:\n  case\n    when count(distinct claim_start_date) > 1 then 1\n    else 0\n  end as claim_start_date_not_unique,\n-- claim_start_date_missing:  \n  case\n    when max(claim_start_date) is null then 1\n    else 0\n  end as claim_start_date_missing,\n-- claim_end_date_not_unique:\n  case\n    when count(distinct claim_end_date) > 1 then 1\n    else 0\n  end as claim_end_date_not_unique,\n-- claim_end_date_missing:  \n  case\n    when max(claim_end_date) is null then 1\n    else 0\n  end as claim_end_date_missing,\n-- claim_start_date_after_claim_end_date:\n  case\n    when min(claim_start_date) > max(claim_end_date) then 1\n    else 0\n  end as claim_start_date_after_claim_end_date,\n-- admission_date_not_unique:\n  case\n    when count(distinct admission_date) > 1 then 1\n    else 0\n  end as admission_date_not_unique,\n-- admission_date_missing:  \n  case\n    when max(admission_date) is null then 1\n    else 0\n  end as admission_date_missing,\n-- discharge_date_not_unique:\n  case\n    when count(distinct discharge_date) > 1 then 1\n    else 0\n  end as discharge_date_not_unique,\n-- discharge_date_missing:  \n  case\n    when max(discharge_date) is null then 1\n    else 0\n  end as discharge_date_missing,\n-- admission_date_after_discharge_date:\n  case\n    when min(admission_date) > max(discharge_date) then 1\n    else 0\n  end as admission_date_after_discharge_date,\n-- admit_type_code_not_unique:\n  case\n    when count(distinct admit_type_code) > 1 then 1\n    else 0\n  end as admit_type_code_not_unique,\n-- admit_type_code_missing:  \n  case\n    when max(admit_type_code) is null then 1\n    else 0\n  end as admit_type_code_missing,  \n-- admit_source_code_not_unique:\n  case\n    when count(distinct admit_source_code) > 1 then 1\n    else 0\n  end as admit_source_code_not_unique,\n-- admit_source_code_missing:  \n  case\n    when max(admit_source_code) is null then 1\n    else 0\n  end as admit_source_code_missing,  \n-- discharge_disposition_code_not_unique:\n  case\n    when count(distinct discharge_disposition_code) > 1 then 1\n    else 0\n  end as discharge_disposition_code_not_unique,\n-- discharge_disposition_code_missing:  \n  case\n    when max(discharge_disposition_code) is null then 1\n    else 0\n  end as discharge_disposition_code_missing,\n-- facility_id_not_unique:\n  case\n    when count(distinct facility_id) > 1 then 1\n    else 0\n  end as facility_id_not_unique,\n-- facility_id_missing:  \n  case\n    when max(facility_id) is null then 1\n    else 0\n  end as facility_id_missing,\n-- claim_type_not_unique:\n  case\n    when count(distinct claim_type) > 1 then 1\n    else 0\n  end as claim_type_not_unique,\n-- claim_type_missing:  \n  case\n    when max(claim_type) is null then 1\n    else 0\n  end as claim_type_missing,\n-- claim_type_not_institutional:\n  case\n    when max(claim_type) <> 'institutional'\n     and min(claim_type) <> 'institutional' then 1\n    else 0\n  end as claim_type_not_institutional\nfrom acute_inpatient_claim_lines\ngroup by claim_id\n),\n\n\nheader_level_values as (\nselect\n  claim_id,\n  max(patient_id) as patient_id,\n  min(claim_start_date) as claim_start_date,\n  max(claim_end_date) as claim_end_date,\n  min(admission_date) as admission_date,\n  max(discharge_date) as discharge_date,\n  max(admit_source_code) as admit_source_code,\n  max(admit_type_code) as admit_type_code,\n  max(discharge_disposition_code) as discharge_disposition_code,\n  max(facility_id) as facility_id,\n  max(claim_type) as claim_type,\n  coalesce(min(admission_date),\n           min(claim_start_date)) as start_date,\n  coalesce(max(discharge_date),\n           max(claim_end_date)) as end_date,\n  case\n    when min(admission_date) is not null then 'admission_date'\n    when min(claim_start_date) is not null then 'claim_start_date'\n    else null\n  end as date_used_as_start_date,\n  case\n    when max(discharge_date) is not null then 'discharge_date'\n    when max(claim_end_date) is not null then 'claim_end_date'\n    else null\n  end as date_used_as_end_date,\n  data_source\nfrom acute_inpatient_claim_lines\ngroup by claim_id, data_source\n)\n\nselect\n  h.patient_id as patient_id,\n  h.claim_id as claim_id,  \n  h.claim_start_date as claim_start_date,\n  h.claim_end_date as claim_end_date,\n  h.admission_date as admission_date,\n  h.discharge_date as discharge_date,\n  h.admit_source_code as admit_source_code,\n  h.admit_type_code as admit_type_code,\n  h.discharge_disposition_code as discharge_disposition_code,\n  h.facility_id as facility_id,\n  h.claim_type as claim_type,\n  h.start_date as start_date,\n  h.end_date as end_date,\n  h.date_used_as_start_date,\n  h.date_used_as_end_date, \n\n  case\n    when\n      ( (dq.patient_id_not_unique = 1) or\n        (dq.patient_id_missing = 1) or\n        (dq.discharge_disposition_code_not_unique = 1) or\n        (dq.discharge_disposition_code_missing = 1) or\n        (dq.facility_id_not_unique = 1) or\n        (dq.facility_id_missing = 1) or\n        (h.date_used_as_start_date is null) or\n\t(h.date_used_as_end_date is null) or\n\t(h.start_date > h.end_date) ) then 1\n    else 0\n  end as dq_problem,\n\n  case\n    when\n      ( (dq.claim_start_date_not_unique = 1) or\n\t(dq.claim_start_date_missing = 1) or\n        (dq.claim_end_date_not_unique = 1) or\n        (dq.claim_end_date_missing = 1) or\n        (dq.claim_start_date_after_claim_end_date = 1) or\n        (dq.admission_date_not_unique = 1) or\n        (dq.admission_date_missing = 1) or\n        (dq.discharge_date_not_unique = 1) or\n        (dq.discharge_date_missing = 1) or\n        (dq.admission_date_after_discharge_date = 1) or\n        (dq.admit_type_code_not_unique = 1) or\n        (dq.admit_type_code_missing = 1) or\n        (dq.admit_source_code_not_unique = 1) or\n        (dq.admit_source_code_missing = 1) or\t\n        (dq.claim_type_not_unique = 1) or\n        (dq.claim_type_missing = 1) or\n        (dq.claim_type_not_institutional = 1) ) then 1\n    else 0\n  end as dq_insight,\n\n  case\n    when (h.date_used_as_start_date is null) then 1\n    else 0\n  end as start_date_not_determined,\n  \n  case\n    when (h.date_used_as_end_date is null) then 1\n    else 0\n  end as end_date_not_determined,\n\n  case\n    when (h.start_date > h.end_date) then 1\n    else 0\n  end as start_date_after_end_date,\n  \n  dq.patient_id_not_unique as patient_id_not_unique,\n  dq.patient_id_missing as patient_id_missing,\n  dq.claim_start_date_not_unique as claim_start_date_not_unique,\n  dq.claim_start_date_missing as claim_start_date_missing,\n  dq.claim_end_date_not_unique as claim_end_date_not_unique,\n  dq.claim_end_date_missing as claim_end_date_missing,\n  dq.claim_start_date_after_claim_end_date\n       as claim_start_date_after_claim_end_date,\n  dq.admission_date_not_unique as admission_date_not_unique,\n  dq.admission_date_missing as admission_date_missing,\n  dq.discharge_date_not_unique as discharge_date_not_unique,\n  dq.discharge_date_missing as discharge_date_missing,\n  dq.admission_date_after_discharge_date\n       as admission_date_after_discharge_date,\n  dq.admit_type_code_not_unique\n       as admit_type_code_not_unique,\n  dq.admit_type_code_missing\n       as admit_type_code_missing,\n  dq.admit_source_code_not_unique\n       as admit_source_code_not_unique,\n  dq.admit_source_code_missing\n       as admit_source_code_missing,\n  dq.discharge_disposition_code_not_unique\n       as discharge_disposition_code_not_unique,\n  dq.discharge_disposition_code_missing\n       as discharge_disposition_code_missing,\n  dq.facility_id_not_unique as facility_id_not_unique,\n  dq.facility_id_missing as facility_id_missing,\n  dq.claim_type_not_unique as claim_type_not_unique,\n  dq.claim_type_missing as claim_type_missing,\n  dq.claim_type_not_institutional as claim_type_not_institutional,\n  h.data_source,\n  '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\n\nfrom header_level_values h\nleft join data_quality_flags dq\n  on h.claim_id = dq.claim_id", "relation_name": "dev_tom.claims_preprocessing._int_acute_inpatient_institutional_claims"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.611458Z", "completed_at": "2024-08-23T19:21:34.643397Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.643847Z", "completed_at": "2024-08-23T19:21:34.643849Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.06270599365234375, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.emergency_department__int_institutional_claims", "compiled": true, "compiled_code": "\n\n\nwith  __dbt__cte__emergency_department__stg_medical_claim as (\n\n\nselect \n    claim_id\n    , claim_line_number\n    , patient_id\n    , claim_type\n    , claim_start_date\n    , claim_end_date\n    , admission_date\n    , discharge_date\n    , facility_id\n    , ms_drg_code\n    , apr_drg_code\n    , admit_source_code\n    , admit_type_code\n    , discharge_disposition_code\n    , paid_amount\n    , allowed_amount\n    , charge_amount\n    , diagnosis_code_type\n    , diagnosis_code_1\n    , data_source\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\n),  __dbt__cte__emergency_department__stg_service_category as (\n\n\n\nselect\n    claim_id\n    , claim_type\n    , claim_line_number\n    , service_category_2\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing.service_category_grouper\n), emergency_department_claim_lines as (\nselect\n  mc.patient_id,\n  mc.claim_id,\n  mc.claim_line_number,\n  mc.claim_start_date,\n  mc.claim_end_date,\n  mc.admission_date,\n  mc.discharge_date,\n  mc.admit_source_code,\n  mc.admit_type_code,\n  mc.discharge_disposition_code,\n  mc.facility_id,\n  mc.claim_type,\n  mc.data_source\nfrom __dbt__cte__emergency_department__stg_medical_claim mc\ninner join __dbt__cte__emergency_department__stg_service_category sc\n  on mc.claim_id = sc.claim_id\nwhere mc.claim_type = 'institutional'\n  and sc.service_category_2 = 'Emergency Department'\n),\n\ndata_quality_flags as (\nselect\n  claim_id,\n-- patient_id_not_unique:\n  case\n    when count(distinct patient_id) > 1 then 1\n    else 0\n  end as patient_id_not_unique,\n-- patient_id_missing:  \n  case\n    when max(patient_id) is null then 1\n    else 0\n  end as patient_id_missing,  \n-- claim_start_date_not_unique:\n  case\n    when count(distinct claim_start_date) > 1 then 1\n    else 0\n  end as claim_start_date_not_unique,\n-- claim_start_date_missing:  \n  case\n    when max(claim_start_date) is null then 1\n    else 0\n  end as claim_start_date_missing,\n-- claim_end_date_not_unique:\n  case\n    when count(distinct claim_end_date) > 1 then 1\n    else 0\n  end as claim_end_date_not_unique,\n-- claim_end_date_missing:  \n  case\n    when max(claim_end_date) is null then 1\n    else 0\n  end as claim_end_date_missing,\n-- claim_start_date_after_claim_end_date:\n  case\n    when min(claim_start_date) > max(claim_end_date) then 1\n    else 0\n  end as claim_start_date_after_claim_end_date,\n-- admission_date_not_unique:\n  case\n    when count(distinct admission_date) > 1 then 1\n    else 0\n  end as admission_date_not_unique,\n-- admission_date_missing:  \n  case\n    when max(admission_date) is null then 1\n    else 0\n  end as admission_date_missing,\n-- discharge_date_not_unique:\n  case\n    when count(distinct discharge_date) > 1 then 1\n    else 0\n  end as discharge_date_not_unique,\n-- discharge_date_missing:  \n  case\n    when max(discharge_date) is null then 1\n    else 0\n  end as discharge_date_missing,\n-- admission_date_after_discharge_date:\n  case\n    when min(admission_date) > max(discharge_date) then 1\n    else 0\n  end as admission_date_after_discharge_date,\n-- admit_type_code_not_unique:\n  case\n    when count(distinct admit_type_code) > 1 then 1\n    else 0\n  end as admit_type_code_not_unique,\n-- admit_type_code_missing:  \n  case\n    when max(admit_type_code) is null then 1\n    else 0\n  end as admit_type_code_missing,  \n-- admit_source_code_not_unique:\n  case\n    when count(distinct admit_source_code) > 1 then 1\n    else 0\n  end as admit_source_code_not_unique,\n-- admit_source_code_missing:  \n  case\n    when max(admit_source_code) is null then 1\n    else 0\n  end as admit_source_code_missing,  \n-- discharge_disposition_code_not_unique:\n  case\n    when count(distinct discharge_disposition_code) > 1 then 1\n    else 0\n  end as discharge_disposition_code_not_unique,\n-- discharge_disposition_code_missing:  \n  case\n    when max(discharge_disposition_code) is null then 1\n    else 0\n  end as discharge_disposition_code_missing,\n-- facility_id_not_unique:\n  case\n    when count(distinct facility_id) > 1 then 1\n    else 0\n  end as facility_id_not_unique,\n-- facility_id_missing:  \n  case\n    when max(facility_id) is null then 1\n    else 0\n  end as facility_id_missing,\n-- claim_type_not_unique:\n  case\n    when count(distinct claim_type) > 1 then 1\n    else 0\n  end as claim_type_not_unique,\n-- claim_type_missing:  \n  case\n    when max(claim_type) is null then 1\n    else 0\n  end as claim_type_missing,\n-- claim_type_not_institutional:\n  case\n    when max(claim_type) <> 'institutional'\n     and min(claim_type) <> 'institutional' then 1\n    else 0\n  end as claim_type_not_institutional\nfrom emergency_department_claim_lines\ngroup by claim_id\n),\n\n\nheader_level_values as (\nselect\n  claim_id,\n  max(patient_id) as patient_id,\n  min(claim_start_date) as claim_start_date,\n  max(claim_end_date) as claim_end_date,\n  min(admission_date) as admission_date,\n  max(discharge_date) as discharge_date,\n  max(admit_source_code) as admit_source_code,\n  max(admit_type_code) as admit_type_code,\n  max(discharge_disposition_code) as discharge_disposition_code,\n  max(facility_id) as facility_id,\n  max(claim_type) as claim_type,\n  coalesce(min(admission_date),\n           min(claim_start_date)) as start_date,\n  coalesce(max(discharge_date),\n           max(claim_end_date)) as end_date,\n  case\n    when min(admission_date) is not null then 'admission_date'\n    when min(claim_start_date) is not null then 'claim_start_date'\n    else null\n  end as date_used_as_start_date,\n  case\n    when max(discharge_date) is not null then 'discharge_date'\n    when max(claim_end_date) is not null then 'claim_end_date'\n    else null\n  end as date_used_as_end_date,\n  data_source\nfrom emergency_department_claim_lines\ngroup by claim_id, data_source\n)\n\nselect\n  h.patient_id as patient_id,\n  h.claim_id as claim_id,  \n  h.claim_start_date as claim_start_date,\n  h.claim_end_date as claim_end_date,\n  h.admission_date as admission_date,\n  h.discharge_date as discharge_date,\n  h.admit_source_code as admit_source_code,\n  h.admit_type_code as admit_type_code,\n  h.discharge_disposition_code as discharge_disposition_code,\n  h.facility_id as facility_id,\n  h.claim_type as claim_type,\n  h.start_date as start_date,\n  h.end_date as end_date,\n  h.date_used_as_start_date,\n  h.date_used_as_end_date, \n\n  case\n    when\n      ( (dq.patient_id_not_unique = 1) or\n        (dq.patient_id_missing = 1) or\n        (dq.discharge_disposition_code_not_unique = 1) or\n        (dq.discharge_disposition_code_missing = 1) or\n        (dq.facility_id_not_unique = 1) or\n        (dq.facility_id_missing = 1) or\n        (h.date_used_as_start_date is null) or\n\t(h.date_used_as_end_date is null) or\n\t(h.start_date > h.end_date) ) then 1\n    else 0\n  end as dq_problem,\n\n  case\n    when\n      ( (dq.claim_start_date_not_unique = 1) or\n\t(dq.claim_start_date_missing = 1) or\n        (dq.claim_end_date_not_unique = 1) or\n        (dq.claim_end_date_missing = 1) or\n        (dq.claim_start_date_after_claim_end_date = 1) or\n        (dq.admission_date_not_unique = 1) or\n        (dq.admission_date_missing = 1) or\n        (dq.discharge_date_not_unique = 1) or\n        (dq.discharge_date_missing = 1) or\n        (dq.admission_date_after_discharge_date = 1) or\n        (dq.admit_type_code_not_unique = 1) or\n        (dq.admit_type_code_missing = 1) or\n        (dq.admit_source_code_not_unique = 1) or\n        (dq.admit_source_code_missing = 1) or\t\n        (dq.claim_type_not_unique = 1) or\n        (dq.claim_type_missing = 1) or\n        (dq.claim_type_not_institutional = 1) ) then 1\n    else 0\n  end as dq_insight,\n\n  case\n    when (h.date_used_as_start_date is null) then 1\n    else 0\n  end as start_date_not_determined,\n  \n  case\n    when (h.date_used_as_end_date is null) then 1\n    else 0\n  end as end_date_not_determined,\n\n  case\n    when (h.start_date > h.end_date) then 1\n    else 0\n  end as start_date_after_end_date,\n  \n  dq.patient_id_not_unique as patient_id_not_unique,\n  dq.patient_id_missing as patient_id_missing,\n  dq.claim_start_date_not_unique as claim_start_date_not_unique,\n  dq.claim_start_date_missing as claim_start_date_missing,\n  dq.claim_end_date_not_unique as claim_end_date_not_unique,\n  dq.claim_end_date_missing as claim_end_date_missing,\n  dq.claim_start_date_after_claim_end_date\n       as claim_start_date_after_claim_end_date,\n  dq.admission_date_not_unique as admission_date_not_unique,\n  dq.admission_date_missing as admission_date_missing,\n  dq.discharge_date_not_unique as discharge_date_not_unique,\n  dq.discharge_date_missing as discharge_date_missing,\n  dq.admission_date_after_discharge_date\n       as admission_date_after_discharge_date,\n  dq.admit_type_code_not_unique\n       as admit_type_code_not_unique,\n  dq.admit_type_code_missing\n       as admit_type_code_missing,\n  dq.admit_source_code_not_unique\n       as admit_source_code_not_unique,\n  dq.admit_source_code_missing\n       as admit_source_code_missing,\n  dq.discharge_disposition_code_not_unique\n       as discharge_disposition_code_not_unique,\n  dq.discharge_disposition_code_missing\n       as discharge_disposition_code_missing,\n  dq.facility_id_not_unique as facility_id_not_unique,\n  dq.facility_id_missing as facility_id_missing,\n  dq.claim_type_not_unique as claim_type_not_unique,\n  dq.claim_type_missing as claim_type_missing,\n  dq.claim_type_not_institutional as claim_type_not_institutional,\n  h.data_source,\n  '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\n\nfrom header_level_values h\nleft join data_quality_flags dq\n  on h.claim_id = dq.claim_id", "relation_name": "dev_tom.claims_preprocessing._int_emergency_department_institutional_claims"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.645597Z", "completed_at": "2024-08-23T19:21:34.655033Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.655238Z", "completed_at": "2024-08-23T19:21:34.655241Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.010703086853027344, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.acute_inpatient__data_quality_summary", "compiled": true, "compiled_code": "\n\n-- *************************************************\n-- This dbt model summarizes data quality issues\n-- that could affect claims preprocessing.\n-- The table returns 2 fields:\n--        field\n--        total_count\n--\n-- If we order the results by 'field', the first\n-- 3 rows give us a high level summary:\n--\n--       01 Total acute inpatient institutional claims:\n--             This is the total number of acute inpatient\n--             institutional claims\n--       02 Acute inpatient institutional claims with insights:\n--             This is the number of acute inpatient institutional\n--             claims for which something is not ideal (e.g. they\n--             are missing a claim_start_date) but it's not something\n--             that prevents the claim from being used in the\n--             encounter grouper.\n\n--       03 Acute inpatient institutional claims with problems:\n--             This is the number of acute inpatient institutional\n--             claims that have a data quality problem that\n--             prevents them from being used in the encounter grouper.\n\n-- The rest of the rows in the table give us counts\n-- of the number of acute inpatient institutional claims\n-- that have specific data quality problems.\n-- *************************************************\n\n\n\n\nwith total_acute_inpatient__institutional_claims as (\nselect\n  '01 Total acute inpatient institutional claims' as field,\n  count(*) as total_count\nfrom dev_tom.claims_preprocessing._int_acute_inpatient_institutional_claims\n),\n\n\ntotal_claims_with_insights as (\nselect\n  '02 Acute inpatient institutional claims with insights' as field,\n  count(*) as total_count\nfrom dev_tom.claims_preprocessing._int_acute_inpatient_institutional_claims\nwhere dq_insight = 1\n),\n\n\ntotal_claims_with_problems as (\nselect\n  '03 Acute inpatient institutional claims with problems' as field,\n  count(*) as total_count\nfrom dev_tom.claims_preprocessing._int_acute_inpatient_institutional_claims\nwhere dq_problem = 1\n),\n\n\npatient_id_not_unique as (\nselect\n  '04 patient_id_not_unique' as field,\n  sum(patient_id_not_unique) as total_count\nfrom dev_tom.claims_preprocessing._int_acute_inpatient_institutional_claims\n),\n\n\npatient_id_missing as (\nselect\n  '05 patient_id_missing' as field,\n  sum(patient_id_missing) as total_count\nfrom dev_tom.claims_preprocessing._int_acute_inpatient_institutional_claims\n),\n\n\nclaim_start_date_not_unique as (\nselect\n  '06 claim_start_date_not_unique' as field,\n  sum(claim_start_date_not_unique) as total_count\nfrom dev_tom.claims_preprocessing._int_acute_inpatient_institutional_claims\n),\n\n\nclaim_start_date_missing as (\nselect\n  '07 claim_start_date_missing' as field,\n  sum(claim_start_date_missing) as total_count\nfrom dev_tom.claims_preprocessing._int_acute_inpatient_institutional_claims\n),\n\n\nclaim_end_date_not_unique as (\nselect\n  '08 claim_end_date_not_unique' as field,\n  sum(claim_end_date_not_unique) as total_count\nfrom dev_tom.claims_preprocessing._int_acute_inpatient_institutional_claims\n),\n\n\nclaim_end_date_missing as (\nselect\n  '09 claim_end_date_missing' as field,\n  sum(claim_end_date_missing) as total_count\nfrom dev_tom.claims_preprocessing._int_acute_inpatient_institutional_claims\n),\n\n\nclaim_start_date_after_claim_end_date as (\nselect\n  '10 claim_start_date_after_claim_end_date' as field,\n  sum(claim_start_date_after_claim_end_date) as total_count\nfrom dev_tom.claims_preprocessing._int_acute_inpatient_institutional_claims\n),\n\n\nadmission_date_not_unique as (\nselect\n  '11 admission_date_not_unique' as field,\n  sum(admission_date_not_unique) as total_count\nfrom dev_tom.claims_preprocessing._int_acute_inpatient_institutional_claims\n),\n\n\nadmission_date_missing as (\nselect\n  '12 admission_date_missing' as field,\n  sum(admission_date_missing) as total_count\nfrom dev_tom.claims_preprocessing._int_acute_inpatient_institutional_claims\n),\n\n\ndischarge_date_not_unique as (\nselect\n  '13 discharge_date_not_unique' as field,\n  sum(discharge_date_not_unique) as total_count\nfrom dev_tom.claims_preprocessing._int_acute_inpatient_institutional_claims\n),\n\n\ndischarge_date_missing as (\nselect\n  '14 discharge_date_missing' as field,\n  sum(discharge_date_missing) as total_count\nfrom dev_tom.claims_preprocessing._int_acute_inpatient_institutional_claims\n),\n\n\nadmission_date_after_discharge_date as (\nselect\n  '15 admission_date_after_discharge_date' as field,\n  sum(admission_date_after_discharge_date) as total_count\nfrom dev_tom.claims_preprocessing._int_acute_inpatient_institutional_claims\n),\n\n\nadmit_type_code_not_unique as (\nselect\n  '16 admit_type_code_not_unique' as field,\n  sum(admit_type_code_not_unique) as total_count\nfrom dev_tom.claims_preprocessing._int_acute_inpatient_institutional_claims\n),\n\n\nadmit_type_code_missing as (\nselect\n  '17 admit_type_code_missing' as field,\n  sum(admit_type_code_missing) as total_count\nfrom dev_tom.claims_preprocessing._int_acute_inpatient_institutional_claims\n),\n\n\nadmit_source_code_not_unique as (\nselect\n  '18 admit_source_code_not_unique' as field,\n  sum(admit_source_code_not_unique) as total_count\nfrom dev_tom.claims_preprocessing._int_acute_inpatient_institutional_claims\n),\n\n\nadmit_source_code_missing as (\nselect\n  '19 admit_source_code_missing' as field,\n  sum(admit_source_code_missing) as total_count\nfrom dev_tom.claims_preprocessing._int_acute_inpatient_institutional_claims\n),\n\n\ndischarge_disposition_code_not_unique as (\nselect\n  '20 discharge_disposition_code_not_unique' as field,\n  sum(discharge_disposition_code_not_unique) as total_count\nfrom dev_tom.claims_preprocessing._int_acute_inpatient_institutional_claims\n),\n\n\ndischarge_disposition_code_missing as (\nselect\n  '21 discharge_disposition_code_missing' as field,\n  sum(discharge_disposition_code_missing) as total_count\nfrom dev_tom.claims_preprocessing._int_acute_inpatient_institutional_claims\n),\n\n\nfacility_id_not_unique as (\nselect\n  '22 facility_id_not_unique' as field,\n  sum(facility_id_not_unique) as total_count\nfrom dev_tom.claims_preprocessing._int_acute_inpatient_institutional_claims\n),\n\n\nfacility_id_missing as (\nselect\n  '23 facility_id_missing' as field,\n  sum(facility_id_missing) as total_count\nfrom dev_tom.claims_preprocessing._int_acute_inpatient_institutional_claims\n),\n\n\nclaim_type_not_unique as (\nselect\n  '24 claim_type_not_unique' as field,\n  sum(claim_type_not_unique) as total_count\nfrom dev_tom.claims_preprocessing._int_acute_inpatient_institutional_claims\n),\n\n\nclaim_type_missing as (\nselect\n  '25 claim_type_missing' as field,\n  sum(claim_type_missing) as total_count\nfrom dev_tom.claims_preprocessing._int_acute_inpatient_institutional_claims\n),\n\n\nclaim_type_not_institutional as (\nselect\n  '26 claim_type_not_institutional' as field,\n  sum(claim_type_not_institutional) as total_count\nfrom dev_tom.claims_preprocessing._int_acute_inpatient_institutional_claims\n),\n\n\nstart_date_not_determined as (\nselect\n  '27 start_date_not_determined' as field,\n  sum(start_date_not_determined) as total_count\nfrom dev_tom.claims_preprocessing._int_acute_inpatient_institutional_claims\n),\n\n\nend_date_not_determined as (\nselect\n  '28 end_date_not_determined' as field,\n  sum(end_date_not_determined) as total_count\nfrom dev_tom.claims_preprocessing._int_acute_inpatient_institutional_claims\n),\n\n\nstart_date_after_end_date as (\nselect\n  '29 start_date_after_end_date' as field,\n  sum(start_date_after_end_date) as total_count\nfrom dev_tom.claims_preprocessing._int_acute_inpatient_institutional_claims\n),\n\n\n\nunion_cte as (\nselect *\nfrom total_acute_inpatient__institutional_claims\n\nunion all\n\nselect *\nfrom total_claims_with_insights\n\nunion all\n\nselect *\nfrom total_claims_with_problems\n\nunion all\n\nselect *\nfrom patient_id_not_unique\n\nunion all\n\nselect *\nfrom patient_id_missing\n\nunion all\n\nselect *\nfrom claim_start_date_not_unique\n\nunion all\n\nselect *\nfrom claim_start_date_missing\n\nunion all\n\nselect *\nfrom claim_end_date_not_unique\n\nunion all\n\nselect *\nfrom claim_end_date_missing\n\nunion all\n\nselect *\nfrom claim_start_date_after_claim_end_date\n\nunion all\n\nselect *\nfrom admission_date_not_unique\n\nunion all\n\nselect *\nfrom admission_date_missing\n\nunion all\n\nselect *\nfrom discharge_date_not_unique\n\nunion all\n\nselect *\nfrom discharge_date_missing\n\nunion all\n\nselect *\nfrom admission_date_after_discharge_date\n\nunion all\n\nselect *\nfrom admit_type_code_not_unique\n\nunion all\n\nselect *\nfrom admit_type_code_missing\n\nunion all\n\nselect *\nfrom admit_source_code_not_unique\n\nunion all\n\nselect *\nfrom admit_source_code_missing\n\nunion all\n\nselect *\nfrom discharge_disposition_code_not_unique\n\nunion all\n\nselect *\nfrom discharge_disposition_code_missing\n\nunion all\n\nselect *\nfrom facility_id_not_unique\n\nunion all\n\nselect *\nfrom facility_id_missing\n\nunion all\n\nselect *\nfrom claim_type_not_unique\n\nunion all\n\nselect *\nfrom claim_type_missing\n\nunion all\n\nselect *\nfrom claim_type_not_institutional\n\nunion all\n\nselect *\nfrom start_date_not_determined\n\nunion all\n\nselect *\nfrom end_date_not_determined\n\nunion all\n\nselect *\nfrom start_date_after_end_date\n)\n\n\n\nselect *, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom union_cte", "relation_name": "dev_tom.claims_preprocessing._int_acute_inpatient_data_quality_summary"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.650403Z", "completed_at": "2024-08-23T19:21:34.655508Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.655875Z", "completed_at": "2024-08-23T19:21:34.655878Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.010985136032104492, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.acute_inpatient__institutional_encounter_id", "compiled": true, "compiled_code": "\n\n-- *************************************************\n-- This dbt model groups acute inpatient institutional\n-- claims into encounters. It assigns an encounter_id\n-- to each acute inpatient institutional claim.\n-- This returns a table with 3 fields:\n--      patient_id\n--      claim_id\n--      encounter_id\n-- The number of rows in the table should be equal\n-- to the number of acute inpatient institutional claims.\n-- *************************************************\n\n\nwith add_row_num as (\nselect\n  patient_id,\n  claim_id,\n  start_date,\n  end_date,\n  discharge_disposition_code,\n  facility_id,\n  row_number() over (partition by patient_id order by end_date, start_date, claim_id) as row_num\nfrom dev_tom.claims_preprocessing._int_acute_inpatient_institutional_claims\n),\n\ncheck_for_merges_with_larger_row_num as (\nselect\n  aa.patient_id,\n  aa.claim_id as claim_id_a,\n  bb.claim_id as claim_id_b,\n  aa.row_num as row_num_a,\n  bb.row_num as row_num_b,\n  case\n    -- Claims with same end_date and same facility_id should be merged:\n    when (aa.end_date = bb.end_date\n          and aa.facility_id = bb.facility_id) then 1\n\n    -- Claims with different end_date and start_date that are\n    -- adjacent (i.e. separated by 1 day) should be merged:\n    when  ( \n\n    dateadd(\n        day,\n        1,\n        aa.end_date\n        )\n\n  = bb.start_date\n          and aa.facility_id = bb.facility_id\n\t  and aa.discharge_disposition_code = '30') then 1\n\n    -- Claims with different end_date \n    -- should be merged if they overlap:\n    when ( (aa.end_date <> bb.end_date) and \n           (aa.end_date >= bb.start_date) and --overlap requirement\n           (aa.facility_id = bb.facility_id)\n\t )then 1\n    else 0\n  end as merge_flag\nfrom add_row_num aa\n     inner join add_row_num bb\n     on aa.patient_id = bb.patient_id\n     and aa.row_num < bb.row_num\n),\n\nmerges_with_larger_row_num as (\nselect\n  patient_id,\n  claim_id_a,\n  claim_id_b,\n  row_num_a,\n  row_num_b,\n  merge_flag\nfrom check_for_merges_with_larger_row_num\nwhere merge_flag = 1\n),\n\n\nclaim_ids_that_merge_with_larger_row_num as (\nselect distinct claim_id_a as claim_id\nfrom merges_with_larger_row_num\n),\n\n\nclaim_ids_having_a_smaller_row_num_merging_with_a_larger_row_num as (\nselect distinct aa.claim_id as claim_id\nfrom add_row_num aa\n     inner join\n     merges_with_larger_row_num bb\n     on aa.patient_id = bb.patient_id\n     and bb.row_num_a < aa.row_num\n     and bb.row_num_b > aa.row_num\n),\n\n\nclose_flags as (\nselect\n  aa.patient_id,\n  aa.claim_id,\n  aa.start_date,\n  aa.end_date,\n  aa.discharge_disposition_code,\n  aa.facility_id,\n  aa.row_num,\n  case when (bb.claim_id is null and cc.claim_id is null) then 1\n       else 0\n  end as close_flag\n\nfrom add_row_num aa\n\nleft join claim_ids_that_merge_with_larger_row_num bb\non aa.claim_id = bb.claim_id\n\nleft join claim_ids_having_a_smaller_row_num_merging_with_a_larger_row_num cc\non aa.claim_id = cc.claim_id\n),\n\n\njoin_every_row_to_later_closes as (\nselect\n  aa.patient_id as patient_id,\n  aa.claim_id as claim_id,\n  aa.row_num as row_num,\n  bb.row_num as row_num_b\nfrom close_flags aa inner join close_flags bb\n     on aa.patient_id = bb.patient_id\n     and aa.row_num <= bb.row_num\nwhere bb.close_flag = 1\n),\n\n\nfind_min_closing_row_num_for_every_claim as (\nselect\n  patient_id,\n  claim_id,\n  min(row_num_b) as min_closing_row\nfrom join_every_row_to_later_closes\ngroup by patient_id, claim_id\n),\n\n\nadd_min_closing_row_to_every_claim as (\nselect\n  aa.patient_id as patient_id,\n  aa.claim_id as claim_id,\n  aa.start_date as start_date,\n  aa.end_date as end_date,\n  aa.discharge_disposition_code as discharge_disposition_code,\n  aa.facility_id as facility_id,\n  aa.row_num as row_num,\n  aa.close_flag as close_flag,\n  bb.min_closing_row as min_closing_row\nfrom close_flags aa\n     left join find_min_closing_row_num_for_every_claim bb\n     on aa.patient_id = bb.patient_id\n     and aa.claim_id = bb.claim_id\n),\n\n\nadd_encounter_id as (\nselect\n  aa.patient_id as patient_id,\n  aa.claim_id as claim_id,\n  aa.start_date as start_date,\n  aa.end_date as end_date,\n  aa.discharge_disposition_code as discharge_disposition_code,\n  aa.facility_id as facility_id,\n  aa.row_num as row_num,\n  aa.close_flag as close_flag,\n  aa.min_closing_row as min_closing_row,\n  bb.claim_id as encounter_id\nfrom add_min_closing_row_to_every_claim aa\n     left join add_min_closing_row_to_every_claim bb\n     on aa.patient_id = bb.patient_id\n     and aa.min_closing_row = bb.row_num\n)\n\nselect *, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_encounter_id", "relation_name": "dev_tom.claims_preprocessing._int_acute_inpatient_institutional_encounter_id"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.652807Z", "completed_at": "2024-08-23T19:21:34.655697Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.656154Z", "completed_at": "2024-08-23T19:21:34.656157Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.010924816131591797, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.emergency_department__int_institutional_encounter_id", "compiled": true, "compiled_code": "\n\n\nwith add_row_num as (\nselect\n  patient_id,\n  claim_id,\n  start_date,\n  end_date,\n  discharge_disposition_code,\n  facility_id,\n  row_number() over (partition by patient_id order by end_date, start_date, claim_id) as row_num\nfrom dev_tom.claims_preprocessing._int_emergency_department_institutional_claims\n),\n\ncheck_for_merges_with_larger_row_num as (\nselect\n  aa.patient_id,\n  aa.claim_id as claim_id_a,\n  bb.claim_id as claim_id_b,\n  aa.row_num as row_num_a,\n  bb.row_num as row_num_b,\n  case\n    -- Claims with same end_date and same facility_id should be merged:\n    when (aa.end_date = bb.end_date\n          and aa.facility_id = bb.facility_id) then 1\n    -- Claims with different end_date \n    -- should be merged if they overlap:\n    when ( (aa.end_date <> bb.end_date) and \n           (aa.end_date >= bb.start_date) and --overlap requirement\n           (aa.facility_id = bb.facility_id)\n\t )then 1\n    else 0\n  end as merge_flag\nfrom add_row_num aa\n     inner join add_row_num bb\n     on aa.patient_id = bb.patient_id\n     and aa.row_num < bb.row_num\n),\n\nmerges_with_larger_row_num as (\nselect\n  patient_id,\n  claim_id_a,\n  claim_id_b,\n  row_num_a,\n  row_num_b,\n  merge_flag\nfrom check_for_merges_with_larger_row_num\nwhere merge_flag = 1\n),\n\n\nclaim_ids_that_merge_with_larger_row_num as (\nselect distinct claim_id_a as claim_id\nfrom merges_with_larger_row_num\n),\n\n\nclaim_ids_having_a_smaller_row_num_merging_with_a_larger_row_num as (\nselect distinct aa.claim_id as claim_id\nfrom add_row_num aa\n     inner join\n     merges_with_larger_row_num bb\n     on aa.patient_id = bb.patient_id\n     and bb.row_num_a < aa.row_num\n     and bb.row_num_b > aa.row_num\n),\n\n\nclose_flags as (\nselect\n  aa.patient_id,\n  aa.claim_id,\n  aa.start_date,\n  aa.end_date,\n  aa.discharge_disposition_code,\n  aa.facility_id,\n  aa.row_num,\n  case when (bb.claim_id is null and cc.claim_id is null) then 1\n       else 0\n  end as close_flag\n\nfrom add_row_num aa\n\nleft join claim_ids_that_merge_with_larger_row_num bb\non aa.claim_id = bb.claim_id\n\nleft join claim_ids_having_a_smaller_row_num_merging_with_a_larger_row_num cc\non aa.claim_id = cc.claim_id\n),\n\n\njoin_every_row_to_later_closes as (\nselect\n  aa.patient_id as patient_id,\n  aa.claim_id as claim_id,\n  aa.row_num as row_num,\n  bb.row_num as row_num_b\nfrom close_flags aa inner join close_flags bb\n     on aa.patient_id = bb.patient_id\n     and aa.row_num <= bb.row_num\nwhere bb.close_flag = 1\n),\n\n\nfind_min_closing_row_num_for_every_claim as (\nselect\n  patient_id,\n  claim_id,\n  min(row_num_b) as min_closing_row\nfrom join_every_row_to_later_closes\ngroup by patient_id, claim_id\n),\n\n\nadd_min_closing_row_to_every_claim as (\nselect\n  aa.patient_id as patient_id,\n  aa.claim_id as claim_id,\n  aa.start_date as start_date,\n  aa.end_date as end_date,\n  aa.discharge_disposition_code as discharge_disposition_code,\n  aa.facility_id as facility_id,\n  aa.row_num as row_num,\n  aa.close_flag as close_flag,\n  bb.min_closing_row as min_closing_row\nfrom close_flags aa\n     left join find_min_closing_row_num_for_every_claim bb\n     on aa.patient_id = bb.patient_id\n     and aa.claim_id = bb.claim_id\n),\n\n\nadd_encounter_id as (\nselect\n  aa.patient_id as patient_id,\n  aa.claim_id as claim_id,\n  aa.start_date as start_date,\n  aa.end_date as end_date,\n  aa.discharge_disposition_code as discharge_disposition_code,\n  aa.facility_id as facility_id,\n  aa.row_num as row_num,\n  aa.close_flag as close_flag,\n  aa.min_closing_row as min_closing_row,\n  bb.claim_id as encounter_id\nfrom add_min_closing_row_to_every_claim aa\n     left join add_min_closing_row_to_every_claim bb\n     on aa.patient_id = bb.patient_id\n     and aa.min_closing_row = bb.row_num\n)\n\nselect *, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_encounter_id", "relation_name": "dev_tom.claims_preprocessing._int_emergency_department_institutional_encounter_id"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.658803Z", "completed_at": "2024-08-23T19:21:34.663351Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.663562Z", "completed_at": "2024-08-23T19:21:34.663566Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.006543874740600586, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.acute_inpatient__encounter_start_and_end_dates", "compiled": true, "compiled_code": "\n\n-- *************************************************\n-- This dbt model assigns an encounter_start_date and\n-- an encounter_end_date to each acute inpatient\n-- encounter_id.\n-- This returns a table with 4 fields:\n--      patient_id\n--      encounter_id\n--      encounter_start_date\n--      encounter_end_date\n-- The number of rows in the table should be equal\n-- to the number of acute inpatient encounters.\n-- *************************************************\n\n\nwith add_encounter_id_to_acute_inpatient_encounters as (\nselect\n  aip.claim_id as claim_id,\n  aip.patient_id as patient_id,\n  aip.start_date as start_date,\n  aip.end_date as end_date,\n  eid.encounter_id as encounter_id\nfrom dev_tom.claims_preprocessing._int_acute_inpatient_institutional_claims aip\nleft join dev_tom.claims_preprocessing._int_acute_inpatient_institutional_encounter_id eid\n  on aip.patient_id = eid.patient_id\n  and aip.claim_id = eid.claim_id\n),\n\nencounter_start_and_end_dates as (\nselect\n  patient_id,\n  encounter_id,\n  min(start_date) as encounter_start_date,\n  max(end_date) as encounter_end_date\nfrom add_encounter_id_to_acute_inpatient_encounters\ngroup by patient_id, encounter_id\n)\n\nselect\n    patient_id\n    , encounter_id\n    , encounter_start_date\n    , encounter_end_date\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom encounter_start_and_end_dates", "relation_name": "dev_tom.claims_preprocessing._int_acute_inpatient_encounter_start_and_end_dates"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.660927Z", "completed_at": "2024-08-23T19:21:34.663838Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.664060Z", "completed_at": "2024-08-23T19:21:34.664062Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.00652313232421875, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.emergency_department__int_encounter_start_and_end_dates", "compiled": true, "compiled_code": "\n\n\nwith add_encounter_id_to_emergency_department_encounters as (\nselect\n  aip.claim_id as claim_id,\n  aip.patient_id as patient_id,\n  aip.start_date as start_date,\n  aip.end_date as end_date,\n  eid.encounter_id as encounter_id\nfrom dev_tom.claims_preprocessing._int_emergency_department_institutional_claims aip\nleft join dev_tom.claims_preprocessing._int_emergency_department_institutional_encounter_id eid\n  on aip.patient_id = eid.patient_id\n  and aip.claim_id = eid.claim_id\n),\n\nencounter_start_and_end_dates as (\nselect\n  patient_id,\n  encounter_id,\n  min(start_date) as encounter_start_date,\n  max(end_date) as encounter_end_date\nfrom add_encounter_id_to_emergency_department_encounters\ngroup by patient_id, encounter_id\n)\n\nselect \n    patient_id\n    , encounter_id\n    , encounter_start_date\n    , encounter_end_date\n    , coalesce(encounter_start_date, encounter_end_date) as determined_encounter_start_date\n    , coalesce(encounter_end_date, encounter_start_date) as determined_encounter_end_date\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom encounter_start_and_end_dates", "relation_name": "dev_tom.claims_preprocessing._int_emergency_department_encounter_start_and_end_dates"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.665624Z", "completed_at": "2024-08-23T19:21:34.688625Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.688939Z", "completed_at": "2024-08-23T19:21:34.688944Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.024261951446533203, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.acute_inpatient__professional_encounter_id", "compiled": true, "compiled_code": "\n\n-- *************************************************\n-- This dbt model assigns professional acute inpatient\n-- claims to acute inpatient encounters.\n-- Some acute inpatient professional claims do not fall\n-- within an acute inpatient encounter. We call these\n-- orphan claims, and they do not have an encounter_id.\n-- Some acute inpatient professional claims fall within\n-- more than one acute inpatient encounter. Since we do not\n-- know what encounter these claims should be mapped to\n-- we do not assign them an encounter_id. These claims\n-- have encounter_count > 1.\n-- This model returns a table with 5 fields:\n--      patient_id\n--      claim_id\n--      encounter_id (is null for orphan claims or claims\n--                    that fall within more than one encounter)\n--      orphan_claim_flag (is always 0 or 1)\n--      encounter_count (an integer that represents the number\n--                       of acute inpatient encounters this\n--                       professional claim could fall into:\n--                       could be 0,1,2,3,...  but is never null\n--                       for acute inpatient professional claims)\n-- *************************************************\n\n\n\n\nwith  __dbt__cte__acute_inpatient__stg_service_category as (\n\n\n\nSELECT\n  claim_id\n, claim_type\n, claim_line_number\n, service_category_2\n, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing.service_category_grouper\n),  __dbt__cte__acute_inpatient__stg_medical_claim as (\n\n\nselect \n    claim_id\n    , claim_line_number\n    , patient_id\n    , claim_type\n    , claim_start_date\n    , claim_end_date\n    , admission_date\n    , discharge_date\n    , facility_id\n    , ms_drg_code\n    , apr_drg_code\n    , admit_source_code\n    , admit_type_code\n    , discharge_disposition_code\n    , paid_amount\n    , allowed_amount\n    , charge_amount\n    , diagnosis_code_type\n    , diagnosis_code_1\n    , data_source\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\n), acute_inpatient_professional_claim_ids as (\nselect distinct \n    claim_id\n    , claim_line_number\nfrom __dbt__cte__acute_inpatient__stg_service_category \nwhere claim_type = 'professional'\n  and service_category_2 = 'Acute Inpatient'\n),\n\nacute_inpatient_professional_claim_lines as (\nselect\n  mc.claim_id,\n  mc.claim_line_number,\n  mc.patient_id,\n  mc.claim_start_date as start_date,\n  mc.claim_end_date as end_date\t   \nfrom __dbt__cte__acute_inpatient__stg_medical_claim mc\ninner join acute_inpatient_professional_claim_ids prof\n  on mc.claim_id = prof.claim_id\n  and mc.claim_line_number = prof.claim_line_number\n),\n\n\nacute_inpatient_professional_claim_dates as (\nselect\n  claim_id,\n  claim_line_number,\n  patient_id,\n  min(start_date) as start_date,\n  max(end_date) as end_date\nfrom acute_inpatient_professional_claim_lines\ngroup by claim_id, claim_line_number, patient_id\n),\n\n\nroll_up_professional_claims_to_institutional_claims as (\nselect\n  aa.patient_id,\n  aa.claim_id,\n  aa.claim_line_number,\n  aa.start_date,\n  aa.end_date,\n  bb.encounter_id,\n  case\n    when bb.encounter_id is null then 1\n    else 0\n  end as orphan_claim_flag\nfrom acute_inpatient_professional_claim_dates aa\nleft join dev_tom.claims_preprocessing._int_acute_inpatient_encounter_start_and_end_dates bb\n  on aa.patient_id = bb.patient_id\n  and (coalesce(aa.start_date, aa.end_date) between bb.encounter_start_date and bb.encounter_end_date)\n  and (coalesce(aa.end_date, aa.start_date) between bb.encounter_start_date and bb.encounter_end_date)\n),\n\nprofessional_claims_in_more_than_one_encounter as (\nselect\n  patient_id,\n  claim_id,\n  claim_line_number,\n  min(start_date) as start_date,\n  max(end_date) as end_date,\n  count(distinct encounter_id) as encounter_count\nfrom roll_up_professional_claims_to_institutional_claims\ngroup by patient_id, claim_line_number, claim_id\nhaving count(distinct encounter_id) > 1\n),\n\n\nprofessional_claims_not_in_more_than_one_encounter as (\nselect\n  aa.patient_id,\n  aa.claim_id,\n  aa.claim_line_number,\n  aa.start_date,\n  aa.end_date,\n  aa.encounter_id,\n  aa.orphan_claim_flag,\n  case\n    when (aa.orphan_claim_flag = 1) then 0\n    else 1\n  end as encounter_count\nfrom roll_up_professional_claims_to_institutional_claims aa\nleft join professional_claims_in_more_than_one_encounter bb\non aa.claim_id = bb.claim_id\nand aa.claim_line_number = bb.claim_line_number\nand aa.patient_id = bb.patient_id\nwhere (bb.patient_id is null) and (bb.claim_id is null)\n),\n\n\nall_acute_inpatient_professional_claims as (\nselect\n  patient_id,\n  claim_id,\n  claim_line_number,\n  start_date,\n  end_date,\n  encounter_id,\n  orphan_claim_flag,\n  encounter_count\nfrom professional_claims_not_in_more_than_one_encounter\n\nunion all\n\nselect\n  patient_id,\n  claim_id,\n  claim_line_number,\n  start_date,\n  end_date,\n  null as encounter_id,\n  0 as orphan_claim_count,\n  encounter_count\nfrom professional_claims_in_more_than_one_encounter\n)\n\n\n\nselect *, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom all_acute_inpatient_professional_claims", "relation_name": "dev_tom.claims_preprocessing._int_acute_inpatient_professional_encounter_id"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.677354Z", "completed_at": "2024-08-23T19:21:34.688779Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.689216Z", "completed_at": "2024-08-23T19:21:34.689219Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.024339914321899414, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.emergency_department__int_professional_encounter_id", "compiled": true, "compiled_code": "\n\n\nwith  __dbt__cte__emergency_department__stg_service_category as (\n\n\n\nselect\n    claim_id\n    , claim_type\n    , claim_line_number\n    , service_category_2\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing.service_category_grouper\n),  __dbt__cte__emergency_department__stg_medical_claim as (\n\n\nselect \n    claim_id\n    , claim_line_number\n    , patient_id\n    , claim_type\n    , claim_start_date\n    , claim_end_date\n    , admission_date\n    , discharge_date\n    , facility_id\n    , ms_drg_code\n    , apr_drg_code\n    , admit_source_code\n    , admit_type_code\n    , discharge_disposition_code\n    , paid_amount\n    , allowed_amount\n    , charge_amount\n    , diagnosis_code_type\n    , diagnosis_code_1\n    , data_source\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\n), emergency_department_professional_claim_ids as (\nselect \n    claim_id\n    , claim_line_number\nfrom __dbt__cte__emergency_department__stg_service_category \nwhere claim_type = 'professional'\n  and service_category_2 = 'Emergency Department'\n),\n\nemergency_department_professional_claim_lines as (\nselect\n  mc.claim_id\n  , mc.claim_line_number\n  , mc.patient_id\n  , mc.claim_start_date as start_date\n  , mc.claim_end_date as end_date\t   \nfrom __dbt__cte__emergency_department__stg_medical_claim mc\ninner join emergency_department_professional_claim_ids prof\n  on mc.claim_id = prof.claim_id\n  and mc.claim_line_number = prof.claim_line_number\n),\n\n\nemergency_department_professional_claim_dates as (\nselect\n  claim_id\n  , claim_line_number\n  , patient_id\n  , min(start_date) as start_date\n  , max(end_date) as end_date\nfrom emergency_department_professional_claim_lines\ngroup by \n    claim_id\n    , claim_line_number\n    , patient_id\n),\n\n\nroll_up_professional_claims_to_institutional_claims as (\n    select\n    aa.patient_id\n    , aa.claim_id\n    , aa.claim_line_number\n    , aa.start_date\n    , aa.end_date\n    , bb.encounter_id\n    , case\n            when bb.encounter_id is null then 1\n            else 0\n    end as orphan_claim_flag\n    from emergency_department_professional_claim_dates aa\n    left join dev_tom.claims_preprocessing._int_emergency_department_encounter_start_and_end_dates bb\n    on aa.patient_id = bb.patient_id\n    and (coalesce(aa.start_date, aa.end_date) between coalesce(bb.encounter_start_date, bb.determined_encounter_start_date) and coalesce(bb.encounter_end_date, bb.determined_encounter_end_date))\n    and (coalesce(aa.end_date, aa.start_date) between coalesce(bb.encounter_start_date, bb.determined_encounter_start_date) and coalesce(bb.encounter_end_date, bb.determined_encounter_end_date))\n),\n\nprofessional_claims_in_more_than_one_encounter as (\nselect\n  patient_id\n , claim_id\n , claim_line_number\n , min(start_date) as start_date\n , max(end_date) as end_date\n , count(distinct encounter_id) as encounter_count\nfrom roll_up_professional_claims_to_institutional_claims\ngroup by patient_id, claim_id, claim_line_number\nhaving count(distinct encounter_id) > 1\n),\n\n\nprofessional_claims_not_in_more_than_one_encounter as (\nselect\n  aa.patient_id,\n  aa.claim_id,\n  aa.claim_line_number,\n  aa.start_date,\n  aa.end_date,\n  aa.encounter_id,\n  aa.orphan_claim_flag,\n  case\n    when (aa.orphan_claim_flag = 1) then 0\n    else 1\n  end as encounter_count\nfrom roll_up_professional_claims_to_institutional_claims aa\nleft join professional_claims_in_more_than_one_encounter bb\non aa.claim_id = bb.claim_id\nand aa.claim_line_number = bb.claim_line_number\nand aa.patient_id = bb.patient_id\nwhere (bb.patient_id is null) and (bb.claim_id is null)\n),\n\n\nall_emergency_department_professional_claims as (\nselect\n  patient_id,\n  claim_id,\n  claim_line_number,\n  start_date,\n  end_date,\n  encounter_id,\n  orphan_claim_flag,\n  encounter_count\nfrom professional_claims_not_in_more_than_one_encounter\n\nunion all\n\nselect\n  patient_id,\n  claim_id,\n  claim_line_number,\n  start_date,\n  end_date,\n  null as encounter_id,\n  0 as orphan_claim_count,\n  encounter_count\nfrom professional_claims_in_more_than_one_encounter\n)\n\n\n\nselect *, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom all_emergency_department_professional_claims", "relation_name": "dev_tom.claims_preprocessing._int_emergency_department_professional_encounter_id"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.690632Z", "completed_at": "2024-08-23T19:21:34.698921Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.699089Z", "completed_at": "2024-08-23T19:21:34.699092Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.009157896041870117, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.acute_inpatient__encounter_id", "compiled": true, "compiled_code": "\n\nwith __dbt__cte__acute_inpatient__stg_medical_claim as (\n\n\nselect \n    claim_id\n    , claim_line_number\n    , patient_id\n    , claim_type\n    , claim_start_date\n    , claim_end_date\n    , admission_date\n    , discharge_date\n    , facility_id\n    , ms_drg_code\n    , apr_drg_code\n    , admit_source_code\n    , admit_type_code\n    , discharge_disposition_code\n    , paid_amount\n    , allowed_amount\n    , charge_amount\n    , diagnosis_code_type\n    , diagnosis_code_1\n    , data_source\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\n) -- *************************************************\n-- This dbt model assigns an encounter_id to each\n-- institutional or professional acute inpatient claim\n-- that is eligible to be part of an encounter.\n-- Professional acute inpatient claims that are\n-- orphan claims (don't overlap with an institutional\n-- acute inpatient claim) or that have\n-- encounter_count > 1 (overlap with more than one different\n-- acute inpatient encounter) are not included here.\n-- It returns a table with these 3 columns:\n--      patient_id\n--      claim_id\n--      encounter_id\n-- *************************************************\n\n\n\n\nselect\n  inst.patient_id,\n  inst.claim_id,\n  med.claim_line_number,\n  inst.encounter_id,\n  '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing._int_acute_inpatient_institutional_encounter_id inst\nleft join __dbt__cte__acute_inpatient__stg_medical_claim med\n    on inst.claim_id = med.claim_id\n\n\nunion distinct\n\n\nselect\n  patient_id,\n  claim_id,\n  claim_line_number,\n  encounter_id,\n  '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing._int_acute_inpatient_professional_encounter_id\nwhere (orphan_claim_flag = 0) and (encounter_count = 1)", "relation_name": "dev_tom.claims_preprocessing._int_acute_inpatient_encounter_id"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.694765Z", "completed_at": "2024-08-23T19:21:34.699358Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.699604Z", "completed_at": "2024-08-23T19:21:34.699607Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.009483098983764648, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.emergency_department__int_encounter_id", "compiled": true, "compiled_code": "\n\n\nwith __dbt__cte__emergency_department__stg_medical_claim as (\n\n\nselect \n    claim_id\n    , claim_line_number\n    , patient_id\n    , claim_type\n    , claim_start_date\n    , claim_end_date\n    , admission_date\n    , discharge_date\n    , facility_id\n    , ms_drg_code\n    , apr_drg_code\n    , admit_source_code\n    , admit_type_code\n    , discharge_disposition_code\n    , paid_amount\n    , allowed_amount\n    , charge_amount\n    , diagnosis_code_type\n    , diagnosis_code_1\n    , data_source\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\n) select\n  inst.patient_id,\n  inst.claim_id,\n  med.claim_line_number,\n  inst.encounter_id,\n  '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing._int_emergency_department_institutional_encounter_id inst\nleft join __dbt__cte__emergency_department__stg_medical_claim med\n    on inst.claim_id = med.claim_id\n\n\nunion distinct\n\n\nselect\n  patient_id,\n  claim_id,\n  claim_line_number,\n  encounter_id,\n  '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing._int_emergency_department_professional_encounter_id\nwhere (orphan_claim_flag = 0) and (encounter_count = 1)", "relation_name": "dev_tom.claims_preprocessing._int_emergency_department_encounter_id"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.701488Z", "completed_at": "2024-08-23T19:21:34.711742Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.712068Z", "completed_at": "2024-08-23T19:21:34.712072Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.011703968048095703, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.acute_inpatient__claims_with_encounter_data", "compiled": true, "compiled_code": "\n\n-- *************************************************\n-- This dbt model returns relevant encounter-level\n-- data for every professional or institutional\n-- acute inpatient claim that is part of an encounter\n-- (note that all institutional acute inpatienet claims\n--  are part of an acute inpatient encounter, but only\n--  professional acute inpatient claims that are not\n--  orphan claims and that belong to one and only\n--  one encounter, i.e. have encounter_count = 1,\n--  are part of an acute inpatient encounter).\n-- It returns a table with these columns:\n--      patient_id\n--      claim_id\n--      start_date (date used for merging claims into encounters)\n--      end_date (date used for merging claims into encounters)\n--      encounter_id\n--      encounter_start_date,\n--      encounter_end_date,\n--      encounter_admit_source_code,\n--      encounter_admit_type_code,\n--      encounter_discharge_disposition_code\n-- *************************************************\n\n\n\n\nwith useful_fields_at_claim_id_level as (\nselect\n  aa.patient_id,\n  aa.claim_id,\n  aa.admit_type_code,\n  aa.admit_source_code,\n  aa.discharge_disposition_code,\n  aa.start_date,\n  aa.end_date,\n\n  bb.encounter_id,\n\n  cc.encounter_start_date,\n  cc.encounter_end_date\n\nfrom dev_tom.claims_preprocessing._int_acute_inpatient_institutional_claims aa\n\nleft join\ndev_tom.claims_preprocessing._int_acute_inpatient_encounter_id bb\non aa.claim_id = bb.claim_id\nand aa.patient_id = bb.patient_id\n\nleft join\ndev_tom.claims_preprocessing._int_acute_inpatient_encounter_start_and_end_dates cc\non bb.encounter_id = cc.encounter_id\nand bb.patient_id = cc.patient_id\n),\n\n\n\nadmit_codes as (\nselect\n  encounter_id,\n  max(admit_source_code) as encounter_admit_source_code,\n  max(admit_type_code) as encounter_admit_type_code\nfrom useful_fields_at_claim_id_level\nwhere start_date = encounter_start_date\ngroup by encounter_id\n),\n\n\ndischarge_code as (\nselect\n  encounter_id,\n  max(discharge_disposition_code) as encounter_discharge_disposition_code\nfrom useful_fields_at_claim_id_level\nwhere end_date = encounter_end_date\ngroup by encounter_id\n),\n\n\nall_useful_fields_at_claim_id_level as (\nselect\n  aa.patient_id,\n  aa.claim_id,\n  aa.start_date,\n  aa.end_date,\n  aa.encounter_id,\n  aa.encounter_start_date,\n  aa.encounter_end_date,\n\n  bb.encounter_admit_source_code,\n  bb.encounter_admit_type_code,\n  \n  cc.encounter_discharge_disposition_code\n\nfrom useful_fields_at_claim_id_level aa \n     left join admit_codes bb on aa.encounter_id = bb.encounter_id\n     left join discharge_code cc on aa.encounter_id = cc.encounter_id\n)\n\n\n\nselect \n *, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom all_useful_fields_at_claim_id_level", "relation_name": "dev_tom.claims_preprocessing._int_acute_inpatient_claims_with_encounter_data"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.703652Z", "completed_at": "2024-08-23T19:21:34.711928Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.712357Z", "completed_at": "2024-08-23T19:21:34.712361Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.01177978515625, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.acute_inpatient__first_claim_values", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__acute_inpatient__stg_medical_claim as (\n\n\nselect \n    claim_id\n    , claim_line_number\n    , patient_id\n    , claim_type\n    , claim_start_date\n    , claim_end_date\n    , admission_date\n    , discharge_date\n    , facility_id\n    , ms_drg_code\n    , apr_drg_code\n    , admit_source_code\n    , admit_type_code\n    , discharge_disposition_code\n    , paid_amount\n    , allowed_amount\n    , charge_amount\n    , diagnosis_code_type\n    , diagnosis_code_1\n    , data_source\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\n), first_claim_values as(\n    select distinct\n        e.encounter_id\n        , coalesce(claim_start_date, admission_date) as claim_start\n        , diagnosis_code_1\n        , diagnosis_code_type\n        , admit_source_code\n        , admit_type_code\n        , facility_id\n        , ms_drg_code\n        , apr_drg_code\n    from dev_tom.claims_preprocessing._int_acute_inpatient_encounter_id e\n    inner join __dbt__cte__acute_inpatient__stg_medical_claim m\n        on e.claim_id = m.claim_id\n    where claim_type = 'institutional'\n)\n\nselect\n    encounter_id\n    , claim_start\n    , diagnosis_code_1\n    , diagnosis_code_type\n    , admit_source_code\n    , admit_type_code\n    , facility_id\n    , ms_drg_code\n    , apr_drg_code\n    , row_number() over (partition by encounter_id order by claim_start) as claim_row\nfrom first_claim_values", "relation_name": "dev_tom.claims_preprocessing._int_acute_inpatient_first_claim_values"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.707590Z", "completed_at": "2024-08-23T19:21:34.712631Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.713181Z", "completed_at": "2024-08-23T19:21:34.713184Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.012420177459716797, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.acute_inpatient__last_claim_values", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__acute_inpatient__stg_medical_claim as (\n\n\nselect \n    claim_id\n    , claim_line_number\n    , patient_id\n    , claim_type\n    , claim_start_date\n    , claim_end_date\n    , admission_date\n    , discharge_date\n    , facility_id\n    , ms_drg_code\n    , apr_drg_code\n    , admit_source_code\n    , admit_type_code\n    , discharge_disposition_code\n    , paid_amount\n    , allowed_amount\n    , charge_amount\n    , diagnosis_code_type\n    , diagnosis_code_1\n    , data_source\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\n), first_claim_values as(\n    select distinct\n        e.encounter_id\n        , coalesce(claim_start_date, admission_date) as claim_start\n        , discharge_disposition_code\n    from dev_tom.claims_preprocessing._int_acute_inpatient_encounter_id e\n    inner join __dbt__cte__acute_inpatient__stg_medical_claim m\n        on e.claim_id = m.claim_id\n    where claim_type = 'institutional'\n)\n\nselect\n    encounter_id\n    , claim_start\n    , discharge_disposition_code\n    , row_number() over (partition by encounter_id order by claim_start desc) as claim_row\nfrom first_claim_values", "relation_name": "dev_tom.claims_preprocessing._int_acute_inpatient_last_claim_values"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.724045Z", "completed_at": "2024-08-23T19:21:34.749407Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.750756Z", "completed_at": "2024-08-23T19:21:34.750761Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.03722214698791504, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.core__stg_claims_medical_claim", "compiled": true, "compiled_code": "\n\n-- *************************************************\n-- This dbt model creates the medical_claim table\n-- in core. It adds these 4 fields to the input layer\n-- medical claim table:\n--      encounter_id\n--      service_category_1\n--      service_category_2\n-- *************************************************\n\nwith medical_claim_stage as(\n    select\n        med.claim_id || '-' || med.claim_line_number as medical_claim_id\n        , cast(med.claim_id as TEXT ) as claim_id\n        , cast(med.claim_line_number as integer ) as claim_line_number\n        , cast(coalesce(ap.encounter_id,ed.encounter_id) as TEXT ) as encounter_id\n        , cast(med.claim_type as TEXT ) as claim_type\n        , cast(med.patient_id as TEXT ) as patient_id\n        , cast(med.member_id as TEXT ) as member_id\n        , cast(med.payer as TEXT ) as payer\n        , med.plan\n        , try_cast( med.claim_start_date as date ) as claim_start_date\n        , try_cast( med.claim_end_date as date ) as claim_end_date\n        , try_cast( med.claim_line_start_date as date ) as claim_line_start_date\n        , try_cast( med.claim_line_end_date as date ) as claim_line_end_date\n        , try_cast( med.admission_date as date ) as admission_date\n        , try_cast( med.discharge_date as date ) as discharge_date\n        , cast(srv_group.service_category_1 as TEXT ) as service_category_1\n        , cast(srv_group.service_category_2 as TEXT ) as service_category_2\n        , cast(med.admit_source_code as TEXT ) as admit_source_code\n        , cast(med.admit_source_description as TEXT ) as admit_source_description\n        , cast(med.admit_type_code as TEXT ) as admit_type_code\n        , cast(med.admit_type_description as TEXT ) as admit_type_description\n        , cast(med.discharge_disposition_code as TEXT ) as discharge_disposition_code\n        , cast(med.discharge_disposition_description as TEXT ) as discharge_disposition_description\n        , cast(med.place_of_service_code as TEXT ) as place_of_service_code\n        , cast(med.place_of_service_description as TEXT ) as place_of_service_description\n        , cast(med.bill_type_code as TEXT ) as bill_type_code\n        , cast(med.bill_type_description as TEXT ) as bill_type_description\n        , cast(med.ms_drg_code as TEXT ) as ms_drg_code\n        , cast(med.ms_drg_description as TEXT ) as ms_drg_description\n        , cast(med.apr_drg_code as TEXT ) as apr_drg_code\n        , cast(med.apr_drg_description as TEXT ) as apr_drg_description\n        , cast(med.revenue_center_code as TEXT ) as revenue_center_code\n        , cast(med.revenue_center_description as TEXT ) as revenue_center_description\n        , cast(med.service_unit_quantity as numeric(28,6) ) as service_unit_quantity\n        , cast(med.hcpcs_code as TEXT ) as hcpcs_code\n        , cast(med.hcpcs_modifier_1 as TEXT ) as hcpcs_modifier_1\n        , cast(med.hcpcs_modifier_2 as TEXT ) as hcpcs_modifier_2\n        , cast(med.hcpcs_modifier_3 as TEXT ) as hcpcs_modifier_3\n        , cast(med.hcpcs_modifier_4 as TEXT ) as hcpcs_modifier_4\n        , cast(med.hcpcs_modifier_5 as TEXT ) as hcpcs_modifier_5\n        , cast(med.rendering_id as TEXT ) as rendering_id\n        , cast(med.rendering_tin as TEXT ) as rendering_tin\n        , cast(med.rendering_name as TEXT ) as rendering_name\n        , cast(med.billing_id as TEXT ) as billing_id\n        , cast(med.billing_tin as TEXT ) as billing_tin\n        , cast(med.billing_name as TEXT ) as billing_name\n        , cast(med.facility_id as TEXT ) as facility_id\n        , cast(med.facility_name as TEXT ) as facility_name\n        , try_cast( med.paid_date as date ) as paid_date\n        , cast(med.paid_amount as numeric(28,6) ) as paid_amount\n        , cast(med.allowed_amount as numeric(28,6) ) as allowed_amount\n        , cast(med.charge_amount as numeric(28,6) ) as charge_amount\n        , cast(med.coinsurance_amount as numeric(28,6) ) as coinsurance_amount\n        , cast(med.copayment_amount as numeric(28,6) ) as copayment_amount\n        , cast(med.deductible_amount as numeric(28,6) ) as deductible_amount\n        , cast(med.total_cost_amount as numeric(28,6) ) as total_cost_amount\n        , cast(med.in_network_flag as int ) as in_network_flag\n        , cast(med.data_source as TEXT ) as data_source\n        , cast('2024-08-23 19:21:27.787896+00:00' as timestamp ) as tuva_last_run\n    from dev_tom.claims_preprocessing.normalized_input_medical_claim med\n    left join dev_tom.claims_preprocessing.service_category_grouper srv_group\n        on med.claim_id = srv_group.claim_id\n        and med.claim_line_number = srv_group.claim_line_number\n    left join dev_tom.claims_preprocessing._int_acute_inpatient_encounter_id ap\n        on med.claim_id = ap.claim_id\n        and med.claim_line_number = ap.claim_line_number\n    left join dev_tom.claims_preprocessing._int_emergency_department_encounter_id ed\n        on med.claim_id = ed.claim_id\n        and med.claim_line_number = ed.claim_line_number\n)\nselect\n    cast(med.medical_claim_id as TEXT ) as medical_claim_id\n    , cast(med.claim_id as TEXT ) as claim_id\n    , cast(med.claim_line_number as integer ) as claim_line_number\n    , cast(med.encounter_id as TEXT ) as encounter_id\n    , cast(med.claim_type as TEXT ) as claim_type\n    , cast(med.patient_id as TEXT ) as patient_id\n    , cast(med.member_id as TEXT ) as member_id\n    , cast(med.payer as TEXT ) as payer\n    , med.plan\n    , try_cast( med.claim_start_date as date ) as claim_start_date\n    , try_cast( med.claim_end_date as date ) as claim_end_date\n    , try_cast( med.claim_line_start_date as date ) as claim_line_start_date\n    , try_cast( med.claim_line_end_date as date ) as claim_line_end_date\n    , try_cast( med.admission_date as date ) as admission_date\n    , try_cast( med.discharge_date as date ) as discharge_date\n    , cast(med.service_category_1 as TEXT ) as service_category_1\n    , cast(med.service_category_2 as TEXT ) as service_category_2\n    , cast(med.admit_source_code as TEXT ) as admit_source_code\n    , cast(med.admit_source_description as TEXT ) as admit_source_description\n    , cast(med.admit_type_code as TEXT ) as admit_type_code\n    , cast(med.admit_type_description as TEXT ) as admit_type_description\n    , cast(med.discharge_disposition_code as TEXT ) as discharge_disposition_code\n    , cast(med.discharge_disposition_description as TEXT ) as discharge_disposition_description\n    , cast(med.place_of_service_code as TEXT ) as place_of_service_code\n    , cast(med.place_of_service_description as TEXT ) as place_of_service_description\n    , cast(med.bill_type_code as TEXT ) as bill_type_code\n    , cast(med.bill_type_description as TEXT ) as bill_type_description\n    , cast(med.ms_drg_code as TEXT ) as ms_drg_code\n    , cast(med.ms_drg_description as TEXT ) as ms_drg_description\n    , cast(med.apr_drg_code as TEXT ) as apr_drg_code\n    , cast(med.apr_drg_description as TEXT ) as apr_drg_description\n    , cast(med.revenue_center_code as TEXT ) as revenue_center_code\n    , cast(med.revenue_center_description as TEXT ) as revenue_center_description\n    , cast(med.service_unit_quantity as numeric(28,6) ) as service_unit_quantity\n    , cast(med.hcpcs_code as TEXT ) as hcpcs_code\n    , cast(med.hcpcs_modifier_1 as TEXT ) as hcpcs_modifier_1\n    , cast(med.hcpcs_modifier_2 as TEXT ) as hcpcs_modifier_2\n    , cast(med.hcpcs_modifier_3 as TEXT ) as hcpcs_modifier_3\n    , cast(med.hcpcs_modifier_4 as TEXT ) as hcpcs_modifier_4\n    , cast(med.hcpcs_modifier_5 as TEXT ) as hcpcs_modifier_5\n    , cast(med.rendering_id as TEXT ) as rendering_id\n    , cast(med.rendering_tin as TEXT ) as rendering_tin\n    , cast(med.rendering_name as TEXT ) as rendering_name\n    , cast(med.billing_id as TEXT ) as billing_id\n    , cast(med.billing_tin as TEXT ) as billing_tin\n    , cast(med.billing_name as TEXT ) as billing_name\n    , cast(med.facility_id as TEXT ) as facility_id\n    , cast(med.facility_name as TEXT ) as facility_name\n    , try_cast( med.paid_date as date ) as paid_date\n    , cast(med.paid_amount as numeric(28,6) ) as paid_amount\n    , cast(med.allowed_amount as numeric(28,6) ) as allowed_amount\n    , cast(med.charge_amount as numeric(28,6) ) as charge_amount\n    , cast(med.coinsurance_amount as numeric(28,6) ) as coinsurance_amount\n    , cast(med.copayment_amount as numeric(28,6) ) as copayment_amount\n    , cast(med.deductible_amount as numeric(28,6) ) as deductible_amount\n    , cast(med.total_cost_amount as numeric(28,6) ) as total_cost_amount\n    , cast(med.in_network_flag as int ) as in_network_flag\n    , cast(\n        case\n            when enroll.medical_claim_id is not null then 1\n                else 0\n        end as int) as enrollment_flag\n    , cast(med.data_source as TEXT ) as data_source\n    , cast(med.tuva_last_run as timestamp ) as tuva_last_run\nfrom medical_claim_stage med\nleft join dev_tom.claims_preprocessing.flag_claims_with_enrollment enroll\n    on med.medical_claim_id = enroll.medical_claim_id", "relation_name": "dev_tom.core._stg_claims_medical_claim"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.714405Z", "completed_at": "2024-08-23T19:21:34.749590Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.780917Z", "completed_at": "2024-08-23T19:21:34.780926Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0675959587097168, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.core__stg_claims_condition", "compiled": true, "compiled_code": "\n\n-- *************************************************\n-- This dbt model creates the condition table in core.\n-- *************************************************\n\nwith unpivot_cte as (\n\nselect\n    claim_id\n  , claim_line_number\n  , patient_id\n  , coalesce(admission_date\n           , claim_start_date\n           , discharge_date\n           , claim_end_date\n    ) as recorded_date\n  , 'discharge_diagnosis' as condition_type\n  , diagnosis_code_type as source_code_type\n  , diagnosis_code_1 as source_code\n  , 1 as diagnosis_rank\n  , diagnosis_poa_1 as present_on_admit_code\n  , data_source\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim \nwhere diagnosis_code_1 is not null\n\nunion all \n\nselect\n    claim_id\n  , claim_line_number\n  , patient_id\n  , coalesce(admission_date\n           , claim_start_date\n\t       , discharge_date\n\t       , claim_end_date\n    ) as recorded_date\n  , 'discharge_diagnosis' as condition_type\n  , diagnosis_code_type as source_code_type\n  , diagnosis_code_2 as source_code\n  , 2 as diagnosis_rank\n  , diagnosis_poa_2 as present_on_admit_code\n  , data_source\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\nwhere diagnosis_code_2 is not null\n\nunion all \n\nselect\n    claim_id\n  , claim_line_number\n  , patient_id\n  , coalesce(admission_date\n           , claim_start_date\n           , discharge_date\n           , claim_end_date\n    ) as recorded_date\n  , 'discharge_diagnosis' as condition_type\n  , diagnosis_code_type as source_code_type\n  , diagnosis_code_3 as source_code\n  , 3 as diagnosis_rank\n  , diagnosis_poa_3 as present_on_admit_code\n  , data_source\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\nwhere diagnosis_code_3 is not null\n\nunion all \n\nselect\n    claim_id\n  , claim_line_number\n  , patient_id\n  , coalesce(admission_date\n           , claim_start_date\n           , discharge_date\n           , claim_end_date\n    ) as recorded_date\n  , 'discharge_diagnosis' as condition_type\n  , diagnosis_code_type as source_code_type\n  , diagnosis_code_4 as source_code\n  , 4 as diagnosis_rank\n  , diagnosis_poa_4 as present_on_admit_code\n  , data_source\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\nwhere diagnosis_code_4 is not null\n\nunion all \n\nselect\n    claim_id\n  , claim_line_number\n  , patient_id\n  , coalesce(admission_date\n           , claim_start_date\n           , discharge_date\n           , claim_end_date\n    ) as recorded_date\n  , 'discharge_diagnosis' as condition_type\n  , diagnosis_code_type as source_code_type\n  , diagnosis_code_5 as source_code\n  , 5 as diagnosis_rank\n  , diagnosis_poa_5 as present_on_admit_code\n  , data_source\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\nwhere diagnosis_code_5 is not null\n\nunion all \n\nselect\n    claim_id\n  , claim_line_number\n  , patient_id\n  , coalesce(admission_date\n           , claim_start_date\n           , discharge_date\n           , claim_end_date\n    ) as recorded_date\n  , 'discharge_diagnosis' as condition_type\n  , diagnosis_code_type as source_code_type\n  , diagnosis_code_6 as source_code\n  , 6 as diagnosis_rank\n  , diagnosis_poa_6 as present_on_admit_code\n  , data_source\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\nwhere diagnosis_code_6 is not null\n\nunion all \n\nselect\n    claim_id\n  , claim_line_number\n  , patient_id\n  , coalesce(admission_date\n           , claim_start_date\n           , discharge_date\n           , claim_end_date\n    ) as recorded_date\n  , 'discharge_diagnosis' as condition_type\n  , diagnosis_code_type as source_code_type\n  , diagnosis_code_7 as source_code\n  , 7 as diagnosis_rank\n  , diagnosis_poa_7 as present_on_admit_code\n  , data_source\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\nwhere diagnosis_code_7 is not null\n\nunion all \n\nselect\n    claim_id\n  , claim_line_number\n  , patient_id\n  , coalesce(admission_date\n           , claim_start_date\n           , discharge_date\n           , claim_end_date\n    ) as recorded_date\n  , 'discharge_diagnosis' as condition_type\n  , diagnosis_code_type as source_code_type\n  , diagnosis_code_8 as source_code\n  , 8 as diagnosis_rank\n  , diagnosis_poa_8 as present_on_admit_code\n  , data_source\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\nwhere diagnosis_code_8 is not null\n\nunion all \n\nselect\n    claim_id\n  , claim_line_number\n  , patient_id\n  , coalesce(admission_date\n           , claim_start_date\n           , discharge_date\n           , claim_end_date\n    ) as recorded_date\n  , 'discharge_diagnosis' as condition_type\n  , diagnosis_code_type as source_code_type\n  , diagnosis_code_9 as source_code\n  , 9 as diagnosis_rank\n  , diagnosis_poa_9 as present_on_admit_code\n  , data_source\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\nwhere diagnosis_code_9 is not null\n\nunion all \n\nselect\n    claim_id\n  , claim_line_number\n  , patient_id\n  , coalesce(admission_date\n           , claim_start_date\n           , discharge_date\n           , claim_end_date\n    ) as recorded_date\n  , 'discharge_diagnosis' as condition_type\n  , diagnosis_code_type as source_code_type\n  , diagnosis_code_10 as source_code\n  , 10 as diagnosis_rank\n  , diagnosis_poa_10 as present_on_admit_code\n  , data_source\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\nwhere diagnosis_code_10 is not null\n\nunion all \n\nselect\n    claim_id\n  , claim_line_number\n  , patient_id\n  , coalesce(admission_date\n           , claim_start_date\n           , discharge_date\n           , claim_end_date\n    ) as recorded_date\n  , 'discharge_diagnosis' as condition_type\n  , diagnosis_code_type as source_code_type\n  , diagnosis_code_11 as source_code\n  , 11 as diagnosis_rank\n  , diagnosis_poa_11 as present_on_admit_code\n  , data_source\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\nwhere diagnosis_code_11 is not null\n\nunion all \n\nselect\n    claim_id\n  , claim_line_number\n  , patient_id\n  , coalesce(admission_date\n           , claim_start_date\n           , discharge_date\n           , claim_end_date\n    ) as recorded_date\n  , 'discharge_diagnosis' as condition_type\n  , diagnosis_code_type as source_code_type\n  , diagnosis_code_12 as source_code\n  , 12 as diagnosis_rank\n  , diagnosis_poa_12 as present_on_admit_code\n  , data_source\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\nwhere diagnosis_code_12 is not null\n\nunion all \n\nselect\n    claim_id\n  , claim_line_number\n  , patient_id\n  , coalesce(admission_date\n           , claim_start_date\n           , discharge_date\n           , claim_end_date\n    ) as recorded_date\n  , 'discharge_diagnosis' as condition_type\n  , diagnosis_code_type as source_code_type\n  , diagnosis_code_13 as source_code\n  , 13 as diagnosis_rank\n  , diagnosis_poa_13 as present_on_admit_code\n  , data_source\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\nwhere diagnosis_code_13 is not null\n\nunion all \n\nselect\n    claim_id\n  , claim_line_number\n  , patient_id\n  , coalesce(admission_date\n           , claim_start_date\n           , discharge_date\n           , claim_end_date\n    ) as recorded_date\n  , 'discharge_diagnosis' as condition_type\n  , diagnosis_code_type as source_code_type\n  , diagnosis_code_14 as source_code\n  , 14 as diagnosis_rank\n  , diagnosis_poa_14 as present_on_admit_code\n  , data_source\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\nwhere diagnosis_code_14 is not null\n\nunion all \n\nselect\n    claim_id\n  , claim_line_number\n  , patient_id\n  , coalesce(admission_date\n           , claim_start_date\n           , discharge_date\n           , claim_end_date\n    ) as recorded_date\n  , 'discharge_diagnosis' as condition_type\n  , diagnosis_code_type as source_code_type\n  , diagnosis_code_15 as source_code\n  , 15 as diagnosis_rank\n  , diagnosis_poa_15 as present_on_admit_code\n  , data_source\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\nwhere diagnosis_code_15 is not null\n\nunion all \n\nselect\n    claim_id\n  , claim_line_number\n  , patient_id\n  , coalesce(admission_date\n           , claim_start_date\n           , discharge_date\n           , claim_end_date\n    ) as recorded_date\n  , 'discharge_diagnosis' as condition_type\n  , diagnosis_code_type as source_code_type\n  , diagnosis_code_16 as source_code\n  , 16 as diagnosis_rank\n  , diagnosis_poa_16 as present_on_admit_code\n  , data_source\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\nwhere diagnosis_code_16 is not null\n\nunion all \n\nselect\n    claim_id\n  , claim_line_number\n  , patient_id\n  , coalesce(admission_date\n           , claim_start_date\n           , discharge_date\n           , claim_end_date\n    ) as recorded_date\n  , 'discharge_diagnosis' as condition_type\n  , diagnosis_code_type as source_code_type\n  , diagnosis_code_17 as source_code\n  , 17 as diagnosis_rank\n  , diagnosis_poa_17 as present_on_admit_code\n  , data_source\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\nwhere diagnosis_code_17 is not null\n\nunion all \n\nselect\n    claim_id\n  , claim_line_number\n  , patient_id\n  , coalesce(admission_date\n           , claim_start_date\n           , discharge_date\n           , claim_end_date\n    ) as recorded_date\n  , 'discharge_diagnosis' as condition_type\n  , diagnosis_code_type as source_code_type\n  , diagnosis_code_18 as source_code\n  , 18 as diagnosis_rank\n  , diagnosis_poa_18 as present_on_admit_code\n  , data_source\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\nwhere diagnosis_code_18 is not null\n\nunion all \n\nselect\n    claim_id\n  , claim_line_number\n  , patient_id\n  , coalesce(admission_date\n           , claim_start_date\n           , discharge_date\n           , claim_end_date\n    ) as recorded_date\n  , 'discharge_diagnosis' as condition_type\n  , diagnosis_code_type as source_code_type\n  , diagnosis_code_19 as source_code\n  , 19 as diagnosis_rank\n  , diagnosis_poa_19 as present_on_admit_code\n  , data_source\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\nwhere diagnosis_code_19 is not null\n\nunion all \n\nselect\n    claim_id\n  , claim_line_number\n  , patient_id\n  , coalesce(admission_date\n           , claim_start_date\n           , discharge_date\n           , claim_end_date\n    ) as recorded_date\n  , 'discharge_diagnosis' as condition_type\n  , diagnosis_code_type as source_code_type\n  , diagnosis_code_20 as source_code\n  , 20 as diagnosis_rank\n  , diagnosis_poa_20 as present_on_admit_code\n  , data_source\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\nwhere diagnosis_code_20 is not null\n\nunion all \n\nselect\n    claim_id\n  , claim_line_number\n  , patient_id\n  , coalesce(admission_date\n           , claim_start_date\n           , discharge_date\n           , claim_end_date\n    ) as recorded_date\n  , 'discharge_diagnosis' as condition_type\n  , diagnosis_code_type as source_code_type\n  , diagnosis_code_21 as source_code\n  , 21 as diagnosis_rank\n  , diagnosis_poa_21 as present_on_admit_code\n  , data_source\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\nwhere diagnosis_code_21 is not null\n\nunion all \n\nselect\n    claim_id\n  , claim_line_number\n  , patient_id\n  , coalesce(admission_date\n           , claim_start_date\n           , discharge_date\n           , claim_end_date\n    ) as recorded_date\n  , 'discharge_diagnosis' as condition_type\n  , diagnosis_code_type as source_code_type\n  , diagnosis_code_22 as source_code\n  , 22 as diagnosis_rank\n  , diagnosis_poa_22 as present_on_admit_code\n  , data_source\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\nwhere diagnosis_code_22 is not null\n\nunion all \n\nselect\n    claim_id\n  , claim_line_number\n  , patient_id\n  , coalesce(admission_date\n           , claim_start_date\n           , discharge_date\n           , claim_end_date\n    ) as recorded_date\n  , 'discharge_diagnosis' as condition_type\n  , diagnosis_code_type as source_code_type\n  , diagnosis_code_23 as source_code\n  , 23 as diagnosis_rank\n  , diagnosis_poa_23 as present_on_admit_code\n  , data_source\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\nwhere diagnosis_code_23 is not null\n\nunion all \n\nselect\n    claim_id\n  , claim_line_number\n  , patient_id\n  , coalesce(admission_date\n           , claim_start_date\n           , discharge_date\n           , claim_end_date\n    ) as recorded_date\n  , 'discharge_diagnosis' as condition_type\n  , diagnosis_code_type as source_code_type\n  , diagnosis_code_24 as source_code\n  , 24 as diagnosis_rank\n  , diagnosis_poa_24 as present_on_admit_code\n  , data_source\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\nwhere diagnosis_code_24 is not null\n\nunion all \n\nselect\n    claim_id\n  , claim_line_number\n  , patient_id\n  , coalesce(admission_date\n           , claim_start_date\n           , discharge_date\n           , claim_end_date\n    ) as recorded_date\n  , 'discharge_diagnosis' as condition_type\n  , diagnosis_code_type as source_code_type\n  , diagnosis_code_25 as source_code\n  , 25 as diagnosis_rank\n  , diagnosis_poa_25 as present_on_admit_code\n  , data_source\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\nwhere diagnosis_code_25 is not null\n\n)\n\nselect distinct\n\n    \n        try_cast(CAST(unpivot_cte.data_source AS TEXT) || '_' || CAST(unpivot_cte.claim_id AS TEXT) || '_' || CAST(unpivot_cte.diagnosis_rank AS TEXT) || '_' || CAST(unpivot_cte.source_code AS TEXT) as TEXT)\n     as condition_id\n\n    , cast(unpivot_cte.patient_id as TEXT ) as patient_id\n    , cast(coalesce(ap.encounter_id, ed.encounter_id) as TEXT ) as encounter_id\n    , cast(unpivot_cte.claim_id as TEXT ) as claim_id\n    , try_cast( unpivot_cte.recorded_date as date ) as recorded_date\n    , try_cast( null as date ) as onset_date\n    , try_cast( null as date ) as resolved_date\n    , cast('active' as TEXT ) as status\n    , cast(unpivot_cte.condition_type as TEXT ) as condition_type\n    , cast(unpivot_cte.source_code_type as TEXT ) as source_code_type\n    , cast(unpivot_cte.source_code as TEXT ) as source_code\n    , cast(null as TEXT ) as source_description\n    , cast(\n        case\n        when icd.icd_10_cm is not null then 'icd-10-cm'\n        end as TEXT\n      ) as normalized_code_type\n    , cast(icd.icd_10_cm as TEXT ) as normalized_code\n    , cast(icd.long_description as TEXT ) as normalized_description\n    , cast(unpivot_cte.diagnosis_rank as integer ) as condition_rank\n    , cast(unpivot_cte.present_on_admit_code as TEXT ) as present_on_admit_code\n    , cast(poa.present_on_admit_description as TEXT ) as present_on_admit_description\n    , cast(unpivot_cte.data_source as TEXT ) as data_source\n    , cast('2024-08-23 19:21:27.787896+00:00' as timestamp ) as tuva_last_run\nfrom unpivot_cte\nleft join dev_tom.claims_preprocessing._int_acute_inpatient_encounter_id as ap\n    on unpivot_cte.claim_id = ap.claim_id\nleft join dev_tom.claims_preprocessing._int_emergency_department_encounter_id as ed\n    on unpivot_cte.claim_id = ed.claim_id\nleft join dev_tom.terminology.icd_10_cm icd\n    on unpivot_cte.source_code = icd.icd_10_cm\nleft join dev_tom.terminology.present_on_admission as poa\n    on unpivot_cte.present_on_admit_code = poa.present_on_admit_code", "relation_name": "dev_tom.core._stg_claims_condition"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.738182Z", "completed_at": "2024-08-23T19:21:34.781262Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.783258Z", "completed_at": "2024-08-23T19:21:34.783261Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.06905388832092285, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.core__stg_claims_procedure", "compiled": true, "compiled_code": "\n\n-- *************************************************\n-- This dbt model creates the procedure table in core.\n-- *************************************************\n\nwith unpivot_cte as (\n\nselect\n    claim_id as claim_id\n  , patient_id as patient_id\n  , coalesce(admission_date\n           , claim_start_date\n           , discharge_date\n           , claim_end_date\n    ) as procedure_date\n  , 'hcpcs' as source_code_type\n  , hcpcs_code as source_code\n  , rendering_id as practitioner_npi\n  , hcpcs_modifier_1 as modifier_1\n  , hcpcs_modifier_2 as modifier_2\n  , hcpcs_modifier_3 as modifier_3\n  , hcpcs_modifier_4 as modifier_4\n  , hcpcs_modifier_5 as modifier_5\n  , data_source as data_source\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\nwhere hcpcs_code is not null\n\n\nunion distinct\n\n\nselect\n    claim_id as claim_id\n  , patient_id as patient_id\n  , procedure_date_1 as procedure_date\n  , procedure_code_type as source_code_type\n  , procedure_code_1 as source_code\n  , rendering_id as practitioner_npi\n  , null as modifier_1\n  , null as modifier_2\n  , null as modifier_3\n  , null as modifier_4\n  , null as modifier_5\n  , data_source as data_source\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim \nwhere procedure_code_1 is not null\n    \n\nunion distinct\n\n\nselect\n    claim_id as claim_id\n  , patient_id as patient_id\n  , procedure_date_2 as procedure_date\n  , procedure_code_type as source_code_type\n  , procedure_code_2 as source_code\n  , rendering_id as practitioner_npi\n  , null as modifier_1\n  , null as modifier_2\n  , null as modifier_3\n  , null as modifier_4\n  , null as modifier_5\n  , data_source as data_source\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim \nwhere procedure_code_2 is not null\n\n\nunion distinct\n\n\nselect\n    claim_id as claim_id\n  , patient_id as patient_id\n  , procedure_date_3 as procedure_date\n  , procedure_code_type as source_code_type\n  , procedure_code_3 as source_code\n  , rendering_id as practitioner_npi\n  , null as modifier_1\n  , null as modifier_2\n  , null as modifier_3\n  , null as modifier_4\n  , null as modifier_5\n  , data_source as data_source\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim \nwhere procedure_code_3 is not null\n\n\nunion distinct\n\n\nselect\n    claim_id as claim_id\n  , patient_id as patient_id\n  , procedure_date_4 as procedure_date\n  , procedure_code_type as source_code_type\n  , procedure_code_4 as source_code\n  , rendering_id as practitioner_npi\n  , null as modifier_1\n  , null as modifier_2\n  , null as modifier_3\n  , null as modifier_4\n  , null as modifier_5\n  , data_source as data_source\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim \nwhere procedure_code_4 is not null\n\n\nunion distinct\n\n\nselect\n    claim_id as claim_id\n  , patient_id as patient_id\n  , procedure_date_5 as procedure_date\n  , procedure_code_type as source_code_type\n  , procedure_code_5 as source_code\n  , rendering_id as practitioner_npi\n  , null as modifier_1\n  , null as modifier_2\n  , null as modifier_3\n  , null as modifier_4\n  , null as modifier_5\n  , data_source as data_source\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim \nwhere procedure_code_5 is not null\n\n\nunion distinct\n\n\nselect\n    claim_id as claim_id\n  , patient_id as patient_id\n  , procedure_date_6 as procedure_date\n  , procedure_code_type as source_code_type\n  , procedure_code_6 as source_code\n  , rendering_id as practitioner_npi\n  , null as modifier_1\n  , null as modifier_2\n  , null as modifier_3\n  , null as modifier_4\n  , null as modifier_5\n  , data_source as data_source\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim \nwhere procedure_code_6 is not null\n\n\nunion distinct\n\n\nselect\n    claim_id as claim_id\n  , patient_id as patient_id\n  , procedure_date_7 as procedure_date\n  , procedure_code_type as source_code_type\n  , procedure_code_7 as source_code\n  , rendering_id as practitioner_npi\n  , null as modifier_1\n  , null as modifier_2\n  , null as modifier_3\n  , null as modifier_4\n  , null as modifier_5\n  , data_source as data_source\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim \nwhere procedure_code_7 is not null\n\n\nunion distinct\n\n\nselect\n    claim_id as claim_id\n  , patient_id as patient_id\n  , procedure_date_8 as procedure_date\n  , procedure_code_type as source_code_type\n  , procedure_code_8 as source_code\n  , rendering_id as practitioner_npi\n  , null as modifier_1\n  , null as modifier_2\n  , null as modifier_3\n  , null as modifier_4\n  , null as modifier_5\n  , data_source as data_source\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim \nwhere procedure_code_8 is not null\n\n\nunion distinct\n\n\nselect\n    claim_id as claim_id\n  , patient_id as patient_id\n  , procedure_date_9 as procedure_date\n  , procedure_code_type as source_code_type\n  , procedure_code_9 as source_code\n  , rendering_id as practitioner_npi\n  , null as modifier_1\n  , null as modifier_2\n  , null as modifier_3\n  , null as modifier_4\n  , null as modifier_5\n  , data_source as data_source\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim \nwhere procedure_code_9 is not null\n\n\nunion distinct\n\n\nselect\n    claim_id as claim_id\n  , patient_id as patient_id\n  , procedure_date_10 as procedure_date\n  , procedure_code_type as source_code_type\n  , procedure_code_10 as source_code\n  , rendering_id as practitioner_npi\n  , null as modifier_1\n  , null as modifier_2\n  , null as modifier_3\n  , null as modifier_4\n  , null as modifier_5\n  , data_source as data_source\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim \nwhere procedure_code_10 is not null\n\n\nunion distinct\n\n\nselect\n    claim_id as claim_id\n  , patient_id as patient_id\n  , procedure_date_11 as procedure_date\n  , procedure_code_type as source_code_type\n  , procedure_code_11 as source_code\n  , rendering_id as practitioner_npi\n  , null as modifier_1\n  , null as modifier_2\n  , null as modifier_3\n  , null as modifier_4\n  , null as modifier_5\n  , data_source as data_source\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim \nwhere procedure_code_11 is not null\n\n\nunion distinct\n\n\nselect\n    claim_id as claim_id\n  , patient_id as patient_id\n  , procedure_date_12 as procedure_date\n  , procedure_code_type as source_code_type\n  , procedure_code_12 as source_code\n  , rendering_id as practitioner_npi\n  , null as modifier_1\n  , null as modifier_2\n  , null as modifier_3\n  , null as modifier_4\n  , null as modifier_5\n  , data_source as data_source\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim \nwhere procedure_code_12 is not null\n\n\nunion distinct\n\n\nselect\n    claim_id as claim_id\n  , patient_id as patient_id\n  , procedure_date_13 as procedure_date\n  , procedure_code_type as source_code_type\n  , procedure_code_13 as source_code\n  , rendering_id as practitioner_npi\n  , null as modifier_1\n  , null as modifier_2\n  , null as modifier_3\n  , null as modifier_4\n  , null as modifier_5\n  , data_source as data_source\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim \nwhere procedure_code_13 is not null\n\n\nunion distinct\n\n\nselect\n    claim_id as claim_id\n  , patient_id as patient_id\n  , procedure_date_14 as procedure_date\n  , procedure_code_type as source_code_type\n  , procedure_code_14 as source_code\n  , rendering_id as practitioner_npi\n  , null as modifier_1\n  , null as modifier_2\n  , null as modifier_3\n  , null as modifier_4\n  , null as modifier_5\n  , data_source as data_source\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim \nwhere procedure_code_14 is not null\n\n\nunion distinct\n\n\nselect\n    claim_id as claim_id\n  , patient_id as patient_id\n  , procedure_date_15 as procedure_date\n  , procedure_code_type as source_code_type\n  , procedure_code_15 as source_code\n  , rendering_id as practitioner_npi\n  , null as modifier_1\n  , null as modifier_2\n  , null as modifier_3\n  , null as modifier_4\n  , null as modifier_5\n  , data_source as data_source\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim \nwhere procedure_code_15 is not null\n\n\nunion distinct\n\n\nselect\n    claim_id as claim_id\n  , patient_id as patient_id\n  , procedure_date_16 as procedure_date\n  , procedure_code_type as source_code_type\n  , procedure_code_16 as source_code\n  , rendering_id as practitioner_npi\n  , null as modifier_1\n  , null as modifier_2\n  , null as modifier_3\n  , null as modifier_4\n  , null as modifier_5\n  , data_source as data_source\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim \nwhere procedure_code_16 is not null\n    \n\nunion distinct\n\n\nselect\n    claim_id as claim_id\n  , patient_id as patient_id\n  , procedure_date_17 as procedure_date\n  , procedure_code_type as source_code_type\n  , procedure_code_17 as source_code\n  , rendering_id as practitioner_npi\n  , null as modifier_1\n  , null as modifier_2\n  , null as modifier_3\n  , null as modifier_4\n  , null as modifier_5\n  , data_source as data_source\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim \nwhere procedure_code_17 is not null\n\n\nunion distinct\n\n\nselect\n    claim_id as claim_id\n  , patient_id as patient_id\n  , procedure_date_18 as procedure_date\n  , procedure_code_type as source_code_type\n  , procedure_code_18 as source_code\n  , rendering_id as practitioner_npi\n  , null as modifier_1\n  , null as modifier_2\n  , null as modifier_3\n  , null as modifier_4\n  , null as modifier_5\n  , data_source as data_source\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim \nwhere procedure_code_18 is not null\n\n\nunion distinct\n\n\nselect\n    claim_id as claim_id\n  , patient_id as patient_id\n  , procedure_date_19 as procedure_date\n  , procedure_code_type as source_code_type\n  , procedure_code_19 as source_code\n  , rendering_id as practitioner_npi\n  , null as modifier_1\n  , null as modifier_2\n  , null as modifier_3\n  , null as modifier_4\n  , null as modifier_5\n  , data_source as data_source\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim \nwhere procedure_code_19 is not null\n\n\nunion distinct\n\n\nselect\n    claim_id as claim_id\n  , patient_id as patient_id\n  , procedure_date_20 as procedure_date\n  , procedure_code_type as source_code_type\n  , procedure_code_20 as source_code\n  , rendering_id as practitioner_npi\n  , null as modifier_1\n  , null as modifier_2\n  , null as modifier_3\n  , null as modifier_4\n  , null as modifier_5\n  , data_source as data_source\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim \nwhere procedure_code_20 is not null\n\n\nunion distinct\n\n\nselect\n    claim_id as claim_id\n  , patient_id as patient_id\n  , procedure_date_21 as procedure_date\n  , procedure_code_type as source_code_type\n  , procedure_code_21 as source_code\n  , rendering_id as practitioner_npi\n  , null as modifier_1\n  , null as modifier_2\n  , null as modifier_3\n  , null as modifier_4\n  , null as modifier_5\n  , data_source as data_source\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim \nwhere procedure_code_21 is not null\n\n\nunion distinct\n\n\nselect\n    claim_id as claim_id\n  , patient_id as patient_id\n  , procedure_date_22 as procedure_date\n  , procedure_code_type as source_code_type\n  , procedure_code_22 as source_code\n  , rendering_id as practitioner_npi\n  , null as modifier_1\n  , null as modifier_2\n  , null as modifier_3\n  , null as modifier_4\n  , null as modifier_5\n  , data_source as data_source\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim \nwhere procedure_code_22 is not null\n\n\nunion distinct\n\n\nselect\n    claim_id as claim_id\n  , patient_id as patient_id\n  , procedure_date_23 as procedure_date\n  , procedure_code_type as source_code_type\n  , procedure_code_23 as source_code\n  , rendering_id as practitioner_npi\n  , null as modifier_1\n  , null as modifier_2\n  , null as modifier_3\n  , null as modifier_4\n  , null as modifier_5\n  , data_source as data_source\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim \nwhere procedure_code_23 is not null\n\n\nunion distinct\n\n\nselect\n    claim_id as claim_id\n  , patient_id as patient_id\n  , procedure_date_24 as procedure_date\n  , procedure_code_type as source_code_type\n  , procedure_code_24 as source_code\n  , rendering_id as practitioner_npi\n  , null as modifier_1\n  , null as modifier_2\n  , null as modifier_3\n  , null as modifier_4\n  , null as modifier_5\n  , data_source as data_source\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim \nwhere procedure_code_24 is not null\n\n\nunion distinct\n\n\nselect\n    claim_id as claim_id\n  , patient_id as patient_id\n  , procedure_date_25 as procedure_date\n  , procedure_code_type as source_code_type\n  , procedure_code_25 as source_code\n  , rendering_id as practitioner_npi\n  , null as modifier_1\n  , null as modifier_2\n  , null as modifier_3\n  , null as modifier_4\n  , null as modifier_5\n  , data_source as data_source\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim \nwhere procedure_code_25 is not null\n\n)\n\nselect distinct\n\n    \n        try_cast(unpivot_cte.data_source || '_' || unpivot_cte.claim_id || '_' || unpivot_cte.source_code || case when unpivot_cte.modifier_1 is not null then CONCAT('_', unpivot_cte.modifier_1) else '' end || case when unpivot_cte.modifier_2 is not null then CONCAT('_', unpivot_cte.modifier_2) else '' end || case when unpivot_cte.modifier_3 is not null then CONCAT('_', unpivot_cte.modifier_3) else '' end || case when unpivot_cte.modifier_4 is not null then CONCAT('_', unpivot_cte.modifier_4) else '' end || case when unpivot_cte.modifier_5 is not null then CONCAT('_', unpivot_cte.modifier_5) else '' end || case when unpivot_cte.practitioner_npi is not null then CONCAT('_', unpivot_cte.practitioner_npi) else '' end as TEXT)\n     as procedure_id\n    , cast(unpivot_cte.patient_id as TEXT ) as patient_id\n    , cast(coalesce(ap.encounter_id, ed.encounter_id) as TEXT ) as encounter_id\n    , cast(unpivot_cte.claim_id as TEXT ) as claim_id\n    , try_cast( unpivot_cte.procedure_date as date ) as procedure_date\n    , cast(unpivot_cte.source_code_type as TEXT ) as source_code_type\n    , cast(unpivot_cte.source_code as TEXT ) as source_code\n    , cast(null as TEXT ) as source_description\n    , cast(\n        case\n        when icd.icd_10_pcs is not null then 'icd-10-pcs'\n        when hcpcs.hcpcs is not null then 'hcpcs'\n        end\n      as TEXT ) as normalized_code_type\n    , cast (\n        coalesce (\n            icd.icd_10_pcs\n          , hcpcs.hcpcs\n        )\n      as TEXT ) as normalized_code\n    , cast (\n        coalesce (\n            icd.description\n          , hcpcs.short_description\n        )\n      as TEXT ) as normalized_description\n    , cast(unpivot_cte.modifier_1 as TEXT ) as modifier_1\n    , cast(unpivot_cte.modifier_2 as TEXT ) as modifier_2\n    , cast(unpivot_cte.modifier_3 as TEXT ) as modifier_3\n    , cast(unpivot_cte.modifier_4 as TEXT ) as modifier_4\n    , cast(unpivot_cte.modifier_5 as TEXT ) as modifier_5\n    , cast(unpivot_cte.practitioner_npi as TEXT ) as practitioner_id\n    , cast(unpivot_cte.data_source as TEXT ) as data_source\n    , cast('2024-08-23 19:21:27.787896+00:00' as timestamp ) as tuva_last_run\nfrom unpivot_cte\nleft join dev_tom.terminology.icd_10_pcs as icd\n    on unpivot_cte.source_code = icd.icd_10_pcs\nleft join dev_tom.terminology.hcpcs_level_2 as hcpcs\n    on unpivot_cte.source_code = hcpcs.hcpcs\nleft join dev_tom.claims_preprocessing._int_acute_inpatient_encounter_id as ap\n    on unpivot_cte.claim_id = ap.claim_id\nleft join dev_tom.claims_preprocessing._int_emergency_department_encounter_id as ed\n    on unpivot_cte.claim_id = ed.claim_id", "relation_name": "dev_tom.core._stg_claims_procedure"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.787558Z", "completed_at": "2024-08-23T19:21:34.799642Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.800001Z", "completed_at": "2024-08-23T19:21:34.800005Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.01369476318359375, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.emergency_department__int_first_claim_values", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__emergency_department__stg_medical_claim as (\n\n\nselect \n    claim_id\n    , claim_line_number\n    , patient_id\n    , claim_type\n    , claim_start_date\n    , claim_end_date\n    , admission_date\n    , discharge_date\n    , facility_id\n    , ms_drg_code\n    , apr_drg_code\n    , admit_source_code\n    , admit_type_code\n    , discharge_disposition_code\n    , paid_amount\n    , allowed_amount\n    , charge_amount\n    , diagnosis_code_type\n    , diagnosis_code_1\n    , data_source\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\n), first_claim_values as(\n    select distinct\n        e.encounter_id\n        , coalesce(claim_start_date, admission_date) as claim_start\n        , diagnosis_code_1\n        , diagnosis_code_type\n        , admit_source_code\n        , admit_type_code\n        , facility_id\n        , ms_drg_code\n        , apr_drg_code\n    from dev_tom.claims_preprocessing._int_emergency_department_encounter_id e\n    inner join __dbt__cte__emergency_department__stg_medical_claim m\n        on e.claim_id = m.claim_id\n    where claim_type = 'institutional'\n)\n\nselect\n    encounter_id\n    , claim_start\n    , diagnosis_code_1\n    , diagnosis_code_type\n    , admit_source_code\n    , admit_type_code\n    , facility_id\n    , ms_drg_code\n    , apr_drg_code\n    , row_number() over (partition by encounter_id order by claim_start) as claim_row\nfrom first_claim_values", "relation_name": "dev_tom.claims_preprocessing._int_emergency_department_first_claim_values"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.792321Z", "completed_at": "2024-08-23T19:21:34.799822Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.800290Z", "completed_at": "2024-08-23T19:21:34.800293Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.013762712478637695, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.emergency_department__int_last_claim_values", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__emergency_department__stg_medical_claim as (\n\n\nselect \n    claim_id\n    , claim_line_number\n    , patient_id\n    , claim_type\n    , claim_start_date\n    , claim_end_date\n    , admission_date\n    , discharge_date\n    , facility_id\n    , ms_drg_code\n    , apr_drg_code\n    , admit_source_code\n    , admit_type_code\n    , discharge_disposition_code\n    , paid_amount\n    , allowed_amount\n    , charge_amount\n    , diagnosis_code_type\n    , diagnosis_code_1\n    , data_source\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\n), first_claim_values as(\n    select distinct\n        e.encounter_id\n        , coalesce(claim_start_date, admission_date) as claim_start\n        , discharge_disposition_code\n    from dev_tom.claims_preprocessing._int_emergency_department_encounter_id e\n    inner join __dbt__cte__emergency_department__stg_medical_claim m\n        on e.claim_id = m.claim_id\n    where claim_type = 'institutional'\n)\n\nselect\n    encounter_id\n    , claim_start\n    , discharge_disposition_code\n    , row_number() over (partition by encounter_id order by claim_start desc) as claim_row\nfrom first_claim_values", "relation_name": "dev_tom.claims_preprocessing._int_emergency_department_last_claim_values"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.796324Z", "completed_at": "2024-08-23T19:21:34.800559Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.801162Z", "completed_at": "2024-08-23T19:21:34.801167Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.013835906982421875, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.acute_inpatient__encounter_data_for_medical_claims", "compiled": true, "compiled_code": "\n\n-- *************************************************\n-- This dbt model returns all the columns with relevant\n-- encounter fields that we will append to the medical_claim\n-- table.\n\n-- It returns a table with these columns:\n--      patient_id\n--      claim_id\n--      encounter_type\n--      encounter_id\n--      start_date (date used for merging claims into encounters)\n--      end_date (date used for merging claims into encounters)\n--      encounter_start_date,\n--      encounter_end_date,\n--      encounter_admit_source_code,\n--      encounter_admit_type_code,\n--      encounter_discharge_disposition_code\n--      orphan_claim_flag (always 0 or 1) (never null)\n--      encounter_count (could be 0,1,2,3,...) (never null)\n-- *************************************************\n\n\n\n\nwith acute_inpatient_claims_with_encounter_id as (\nselect\n  patient_id,\n  claim_id,\n  start_date,\n  end_date,  \n-- Relevant encounter-level fields for\n-- professional and institutional acute inpatient\n-- claims that are assigned to an encounter:\n  'acute inpatient' as encounter_type,\n  encounter_id,\n  encounter_start_date,\n  encounter_end_date,\n  encounter_admit_source_code,\n  encounter_admit_type_code,\n  encounter_discharge_disposition_code,\n-- Fields that are only relevant for professional\n-- acute inpatient claims that are not assigned to\n-- an encounter because they are orphan claims or because\n-- they overlap with more than one encounter:\n  0 as orphan_claim_flag,\n  1 as encounter_count\nfrom dev_tom.claims_preprocessing._int_acute_inpatient_claims_with_encounter_data\n),\n\n\nacute_inpatient_claims_without_encounter_id as (\nselect\n  patient_id,\n  claim_id,\n  start_date,\n  end_date,  \n-- Relevant encounter-level fields for\n-- professional and institutional acute inpatient\n-- claims that are assigned to an encounter:\n  'acute inpatient' encounter_type,\n  cast(null as TEXT) as encounter_id,\n  cast(null as date) as encounter_start_date,\n  cast(null as date) as encounter_end_date,\n  cast(null as TEXT) as encounter_admit_source_code,\n  cast(null as TEXT) as encounter_admit_type_code,\n  cast(null as TEXT) as encounter_discharge_disposition_code,\n-- Fields that are only relevant for professional\n-- acute inpatient claims that are not assigned to\n-- an encounter because they are orphan claims or because\n-- they overlap with more than one encounter:\n  orphan_claim_flag,\n  encounter_count\n  \nfrom dev_tom.claims_preprocessing._int_acute_inpatient_professional_encounter_id\nwhere (orphan_claim_flag = 1) or (encounter_count > 1)\n)\n\n\nselect *, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom acute_inpatient_claims_with_encounter_id\n\nunion all\n\nselect *, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom acute_inpatient_claims_without_encounter_id", "relation_name": "dev_tom.claims_preprocessing._int_encounter_data_for_medical_claims"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.822679Z", "completed_at": "2024-08-23T19:21:34.828680Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.828998Z", "completed_at": "2024-08-23T19:21:34.829001Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.027410268783569336, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.core__medical_claim", "compiled": true, "compiled_code": "\n\n\nselect * from dev_tom.core._stg_claims_medical_claim", "relation_name": "dev_tom.core.medical_claim"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.802517Z", "completed_at": "2024-08-23T19:21:34.828825Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.829273Z", "completed_at": "2024-08-23T19:21:34.829276Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.027849912643432617, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.acute_inpatient__summary", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__acute_inpatient__stg_medical_claim as (\n\n\nselect \n    claim_id\n    , claim_line_number\n    , patient_id\n    , claim_type\n    , claim_start_date\n    , claim_end_date\n    , admission_date\n    , discharge_date\n    , facility_id\n    , ms_drg_code\n    , apr_drg_code\n    , admit_source_code\n    , admit_type_code\n    , discharge_disposition_code\n    , paid_amount\n    , allowed_amount\n    , charge_amount\n    , diagnosis_code_type\n    , diagnosis_code_1\n    , data_source\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing.normalized_input_medical_claim\n),  __dbt__cte__acute_inpatient__stg_eligibility as (\n\n\nselect\n    patient_id\n    , birth_date\n    , gender\n    , race\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing.normalized_input_eligibility\n), distinct_encounters as (\n    select distinct\n    a.encounter_id\n    , a.patient_id\n    , b.encounter_start_date\n    , b.encounter_end_date\nfrom dev_tom.claims_preprocessing._int_acute_inpatient_encounter_id a\ninner join dev_tom.claims_preprocessing._int_acute_inpatient_encounter_start_and_end_dates b\n  on a.encounter_id = b.encounter_id\n)\n\n, institutional_claim_details as (\n    select\n        b.encounter_id\n        , first.diagnosis_code_1\n        , first.diagnosis_code_type\n        , first.facility_id as facility_id\n        , first.ms_drg_code as ms_drg_code\n        , first.apr_drg_code as apr_drg_code\n        , first.admit_source_code as admit_source_code\n        , first.admit_type_code as admit_type_code\n        , last.discharge_disposition_code as discharge_disposition_code\n        , sum(paid_amount) as inst_paid_amount\n        , sum(allowed_amount) as inst_allowed_amount\n        , sum(charge_amount) as inst_charge_amount\n        , max(data_source) as data_source\n    from tuva.input_layer.medical_claim a\n    inner join dev_tom.claims_preprocessing._int_acute_inpatient_encounter_id b\n    on a.claim_id = b.claim_id\n    and a.claim_line_number = b.claim_line_number\n    and a.claim_type = 'institutional'\n    inner join dev_tom.claims_preprocessing._int_acute_inpatient_first_claim_values first\n        on b.encounter_id = first.encounter_id\n        and first.claim_row = 1\n    inner join dev_tom.claims_preprocessing._int_acute_inpatient_last_claim_values last\n        on b.encounter_id = last.encounter_id\n        and last.claim_row = 1\n    group by\n        b.encounter_id\n        , first.diagnosis_code_1\n        , first.diagnosis_code_type\n        , first.facility_id\n        , first.ms_drg_code\n        , first.apr_drg_code\n        , first.admit_source_code\n        , first.admit_type_code\n        , last.discharge_disposition_code\n)\n\n, professional_claim_details as (\n    select\n        b.encounter_id\n        , sum(paid_amount) as prof_paid_amount\n        , sum(allowed_amount) as prof_allowed_amount\n        , sum(charge_amount) as prof_charge_amount\n    from __dbt__cte__acute_inpatient__stg_medical_claim a\n    inner join dev_tom.claims_preprocessing._int_acute_inpatient_encounter_id b\n    on a.claim_id = b.claim_id\n    and a.claim_line_number = b.claim_line_number\n    and a.claim_type = 'professional'\ngroup by b.encounter_id\n)\n\n, patient as (\n    select distinct\n        patient_id\n        , birth_date\n        , gender\n        , race\n    from __dbt__cte__acute_inpatient__stg_eligibility\n    )\n\n, facility as (\n    select\n          a.encounter_id\n        , max(a.facility_id) as facility_id\n        , count(distinct facility_id) as npi_count\n    from dev_tom.claims_preprocessing._int_acute_inpatient_institutional_encounter_id a\n    group by a.encounter_id\n)\n\nselect\n  a.encounter_id\n, a.encounter_start_date\n, a.encounter_end_date\n, a.patient_id\n, datediff(\n        day,\n        birth_date,\n        encounter_end_date\n        )/365 as admit_age\n, e.gender\n, e.race\n, c.diagnosis_code_type as primary_diagnosis_code_type\n, c.diagnosis_code_1 as primary_diagnosis_code\n, coalesce(icd10cm.long_description, icd9cm.long_description) as primary_diagnosis_description\n, f.facility_id as facility_id\n, b.provider_organization_name as facility_name\n, c.ms_drg_code\n, j.ms_drg_description\n, j.medical_surgical\n, c.apr_drg_code\n, k.apr_drg_description\n, c.admit_source_code\n, h.admit_source_description\n, c.admit_type_code\n, i.admit_type_description\n, c.discharge_disposition_code\n, g.discharge_disposition_description\n, c.inst_paid_amount + coalesce(d.prof_paid_amount,0) as total_paid_amount\n, c.inst_allowed_amount + coalesce(d.prof_allowed_amount,0) as total_allowed_amount\n, c.inst_charge_amount + coalesce(d.prof_charge_amount,0) as total_charge_amount\n, datediff(\n        day,\n        a.encounter_start_date,\n        a.encounter_end_date\n        ) as length_of_stay\n, case\n    when c.discharge_disposition_code = '20' then 1\n    else 0\n  end mortality_flag\n, data_source\n, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom distinct_encounters a\nleft join institutional_claim_details c\n  on a.encounter_id = c.encounter_id\nleft join professional_claim_details d\n  on a.encounter_id = d.encounter_id\nleft join patient e\n  on a.patient_id = e.patient_id\nleft join facility f\n  on a.encounter_id = f.encounter_id\nleft join dev_tom.terminology.provider b\n  on f.facility_id = b.npi\nleft join dev_tom.terminology.discharge_disposition g\n  on c.discharge_disposition_code = g.discharge_disposition_code\nleft join dev_tom.terminology.admit_source h\n  on c.admit_source_code = h.admit_source_code\nleft join dev_tom.terminology.admit_type i\n  on c.admit_type_code = i.admit_type_code\nleft join dev_tom.terminology.ms_drg j\n  on c.ms_drg_code = j.ms_drg_code\nleft join dev_tom.terminology.apr_drg k\n  on c.apr_drg_code = k.apr_drg_code\nleft join dev_tom.terminology.icd_10_cm icd10cm\n  on c.diagnosis_code_1 = icd10cm.icd_10_cm\n  and c.diagnosis_code_type = 'icd-10-cm'\nleft join dev_tom.terminology.icd_9_cm icd9cm\n  on c.diagnosis_code_1 = icd9cm.icd_9_cm\n  and c.diagnosis_code_type = 'icd-9-cm'", "relation_name": "dev_tom.claims_preprocessing.acute_inpatient_summary"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.824358Z", "completed_at": "2024-08-23T19:21:34.829528Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.830123Z", "completed_at": "2024-08-23T19:21:34.830126Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.027823209762573242, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.core__stg_claims_location", "compiled": true, "compiled_code": "\n\nwith all_providers_in_claims_dataset as (\nselect distinct facility_id as npi, data_source\nfrom dev_tom.core._stg_claims_medical_claim\n\n\nunion distinct\n\n\nselect distinct rendering_id as npi, data_source\nfrom dev_tom.core._stg_claims_medical_claim\n\n\nunion distinct\n\n\nselect distinct billing_id as npi, data_source\nfrom dev_tom.core._stg_claims_medical_claim\n\n\nunion distinct\n\n\nselect distinct prescribing_provider_id as npi, data_source\nfrom dev_tom.core._stg_claims_pharmacy_claim\n\n\nunion distinct\n\n\nselect distinct dispensing_provider_id as npi, data_source\nfrom dev_tom.core._stg_claims_pharmacy_claim\n),\n\n\nprovider as (\nselect aa.*, bb.data_source\nfrom dev_tom.terminology.provider aa\ninner join all_providers_in_claims_dataset bb\non aa.npi = bb.npi\nwhere lower(aa.entity_type_description) = 'organization'\n)\n\n\n\nselect \n    cast(npi as TEXT ) as location_id\n    , cast(npi as TEXT ) as npi\n    , cast(provider_organization_name as TEXT ) as name\n    , cast(null as TEXT ) as facility_type\n    , cast(parent_organization_name as TEXT ) as parent_organization\n    , cast(practice_address_line_1 as TEXT ) as address\n    , cast(practice_city as TEXT ) as city\n    , cast(practice_state as TEXT ) as state\n    , cast(practice_zip_code as TEXT ) as zip_code\n    , cast(null as float ) as latitude\n    , cast(null as float ) as longitude\n    , cast(data_source as TEXT ) as data_source\n    , cast( '2024-08-23 19:21:27.787896+00:00' as timestamp ) as tuva_last_run\nfrom provider", "relation_name": "dev_tom.core._stg_claims_location"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.831448Z", "completed_at": "2024-08-23T19:21:34.844037Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.844566Z", "completed_at": "2024-08-23T19:21:34.844570Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.014211177825927734, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.core__stg_claims_practitioner", "compiled": true, "compiled_code": "\n\n-- *************************************************\n-- This dbt model creates the provider table \n-- in core. It includes data about all providers\n-- present in the raw claims dataset.\n-- *************************************************\n\n\nwith all_providers_in_claims_dataset as (\nselect distinct facility_id as npi, data_source\nfrom dev_tom.core._stg_claims_medical_claim\n\n\nunion distinct\n\n\nselect distinct rendering_id as npi, data_source\nfrom dev_tom.core._stg_claims_medical_claim\n\n\nunion distinct\n\n\nselect distinct billing_id as npi, data_source\nfrom dev_tom.core._stg_claims_medical_claim\n\n\nunion distinct\n\n\nselect distinct prescribing_provider_id as npi, data_source\nfrom dev_tom.core._stg_claims_pharmacy_claim\n\n\nunion distinct\n\n\nselect distinct dispensing_provider_id as npi, data_source\nfrom dev_tom.core._stg_claims_pharmacy_claim\n),\n\n\nprovider as (\nselect aa.*, bb.data_source\nfrom dev_tom.terminology.provider aa\ninner join all_providers_in_claims_dataset bb\non aa.npi = bb.npi\nwhere lower(aa.entity_type_description) = 'individual'\n)\n\n\n\nselect \n    cast(npi as TEXT ) as practitioner_id\n    , cast(npi as TEXT ) as npi\n    , cast(provider_first_name as TEXT ) as provider_first_name\n    , cast(provider_last_name as TEXT ) as provider_last_name\n    , cast(parent_organization_name as TEXT ) as practice_affiliation\n    , cast(primary_specialty_description as TEXT ) as specialty\n    , cast(null as TEXT ) as sub_specialty\n    , cast(data_source as TEXT ) as data_source\n    , cast('2024-08-23 19:21:27.787896+00:00' as timestamp ) as tuva_last_run\nfrom provider", "relation_name": "dev_tom.core._stg_claims_practitioner"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.835297Z", "completed_at": "2024-08-23T19:21:34.844199Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.844880Z", "completed_at": "2024-08-23T19:21:34.844883Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.014350175857543945, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.core__condition", "compiled": true, "compiled_code": "\n\n\nwith all_conditions as (\n   select *\nfrom dev_tom.core._stg_claims_condition\nunion all\nselect *\nfrom dev_tom.core._stg_clinical_condition\n\n\n)\n\n\n\n\nselect\n    all_conditions.condition_id\n  , all_conditions.patient_id\n  , all_conditions.encounter_id\n  , all_conditions.claim_id\n  , all_conditions.recorded_date\n  , all_conditions.onset_date\n  , all_conditions.resolved_date\n  , all_conditions.status\n  , all_conditions.condition_type\n  , all_conditions.source_code_type\n  , all_conditions.source_code\n  , all_conditions.source_description\n  , case\n        when all_conditions.normalized_code_type is not null then all_conditions.normalized_code_type\n        when icd10.icd_10_cm is not null then 'icd-10-cm'\n        when icd9.icd_9_cm is not null then 'icd-9-cm'\n        when snomed_ct.snomed_ct is not null then 'snomed-ct'\n        else null end as normalized_code_type\n  , coalesce(\n        all_conditions.normalized_code\n      , icd10.icd_10_cm\n      , icd9.icd_9_cm\n      , snomed_ct.snomed_ct) as normalized_code\n  , coalesce(\n        all_conditions.normalized_description\n      , icd10.short_description\n      , icd9.short_description\n      , snomed_ct.description) as normalized_description\n  , case when coalesce(all_conditions.normalized_code, all_conditions.normalized_description) is not null then 'manual'\n         when coalesce(icd10.icd_10_cm,icd9.icd_9_cm, snomed_ct.snomed_ct) is not null then 'automatic'\n         end as mapping_method\n  , all_conditions.condition_rank\n  , all_conditions.present_on_admit_code\n  , all_conditions.present_on_admit_description\n  , all_conditions.data_source\n  , all_conditions.tuva_last_run\nfrom\nall_conditions\nleft join dev_tom.terminology.icd_10_cm icd10\n    on all_conditions.source_code_type = 'icd-10-cm'\n        and replace(all_conditions.source_code,'.','') = icd10.icd_10_cm\nleft join dev_tom.terminology.icd_9_cm icd9\n    on all_conditions.source_code_type = 'icd-9-cm'\n        and replace(all_conditions.source_code,'.','') = icd9.icd_9_cm\nleft join dev_tom.terminology.snomed_ct snomed_ct\n    on all_conditions.source_code_type = 'snomed-ct'\n        and all_conditions.source_code = snomed_ct.snomed_ct\n\n\n\n\n", "relation_name": "dev_tom.core.condition"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.840334Z", "completed_at": "2024-08-23T19:21:34.845286Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.846111Z", "completed_at": "2024-08-23T19:21:34.846114Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.014874935150146484, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.core__procedure", "compiled": true, "compiled_code": "\n\n\nwith all_procedures as (\nselect * from dev_tom.core._stg_claims_procedure\nunion all\nselect * from dev_tom.core._stg_clinical_procedure\n\n\n)\n\n\n\nselect\n    all_procedures.procedure_id\n  , all_procedures.patient_id\n  , all_procedures.encounter_id\n  , all_procedures.claim_id\n  , all_procedures.procedure_date\n  , all_procedures.source_code_type\n  , all_procedures.source_code\n  , all_procedures.source_description\n  , case when all_procedures.normalized_code_type is not null then  all_procedures.normalized_code_type\n      when icd10.icd_10_pcs is not null then 'icd-10-pcs'\n      when icd9.icd_9_pcs is not null then 'icd-9-pcs'\n      when hcpcs.hcpcs is not null then 'hcpcs'\n      when snomed_ct.snomed_ct is not null then 'snomed-ct'\n      end as normalized_code_type\n  , coalesce(all_procedures.normalized_code\n      , icd10.icd_10_pcs\n      , icd9.icd_9_pcs\n      , hcpcs.hcpcs\n      ,snomed_ct.snomed_ct ) as normalized_code\n  ,  coalesce(all_procedures.normalized_description\n      , icd10.description\n      , icd9.short_description\n      , hcpcs.short_description\n      , snomed_ct.description) normalized_description\n  , case when coalesce(all_procedures.normalized_code, all_procedures.normalized_description) is not null then 'manual'\n         when coalesce(icd10.icd_10_pcs,icd9.icd_9_pcs, hcpcs.hcpcs, snomed_ct.snomed_ct) is not null then 'automatic'\n         end as mapping_method\n  , all_procedures.modifier_1\n  , all_procedures.modifier_2\n  , all_procedures.modifier_3\n  , all_procedures.modifier_4\n  , all_procedures.modifier_5\n  , all_procedures.practitioner_id\n  , all_procedures.data_source\n  , all_procedures.tuva_last_run\nfrom all_procedures\nleft join dev_tom.terminology.icd_10_pcs icd10\n    on all_procedures.source_code_type = 'icd-10-pcs'\n        and all_procedures.source_code = icd10.icd_10_pcs\nleft join dev_tom.terminology.icd_9_pcs icd9\n    on all_procedures.source_code_type = 'icd-9-pcs'\n        and all_procedures.source_code = icd9.icd_9_pcs\nleft join dev_tom.terminology.hcpcs_level_2 hcpcs\n    on all_procedures.source_code_type = 'hcpcs'\n        and all_procedures.source_code = hcpcs.hcpcs\nleft join dev_tom.terminology.snomed_ct snomed_ct\n    on all_procedures.source_code_type = 'snomed-ct'\n        and all_procedures.source_code = snomed_ct.snomed_ct\n\n\n", "relation_name": "dev_tom.core.procedure"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.847482Z", "completed_at": "2024-08-23T19:21:34.872805Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.873399Z", "completed_at": "2024-08-23T19:21:34.873402Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.027049779891967773, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.emergency_department__summary", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__emergency_department__stg_eligibility as (\n\n\nselect\n    patient_id\n    , birth_date\n    , gender\n    , race\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.claims_preprocessing.normalized_input_eligibility\n), distinct_encounters as (\n    select distinct\n      a.encounter_id\n    , a.patient_id\n    , b.encounter_start_date\n    , b.encounter_end_date\n    from dev_tom.claims_preprocessing._int_emergency_department_encounter_id a\n    inner join dev_tom.claims_preprocessing._int_emergency_department_encounter_start_and_end_dates b\n      on a.encounter_id = b.encounter_id\n)\n\n, institutional_claim_details as (\n    select\n        b.encounter_id\n        , first.diagnosis_code_1\n        , first.diagnosis_code_type\n        , first.facility_id as facility_id\n        , first.ms_drg_code as ms_drg_code\n        , first.apr_drg_code as apr_drg_code\n        , first.admit_source_code as admit_source_code\n        , first.admit_type_code as admit_type_code\n        , last.discharge_disposition_code as discharge_disposition_code\n        , sum(paid_amount) as inst_paid_amount\n        , sum(allowed_amount) as inst_allowed_amount\n        , sum(charge_amount) as inst_charge_amount\n        , max(data_source) as data_source\n    from tuva.input_layer.medical_claim a\n    inner join dev_tom.claims_preprocessing._int_emergency_department_encounter_id b\n        on a.claim_id = b.claim_id\n        and a.claim_line_number = b.claim_line_number\n        and a.claim_type = 'institutional'\n    inner join dev_tom.claims_preprocessing._int_emergency_department_first_claim_values first\n        on b.encounter_id = first.encounter_id\n        and first.claim_row = 1\n    inner join dev_tom.claims_preprocessing._int_emergency_department_last_claim_values last\n        on b.encounter_id = last.encounter_id\n        and last.claim_row = 1\n    group by\n    b.encounter_id\n    , first.diagnosis_code_1\n    , first.diagnosis_code_type\n    , first.facility_id\n    , first.ms_drg_code\n    , first.apr_drg_code\n    , first.admit_source_code\n    , first.admit_type_code\n    , last.discharge_disposition_code\n)\n\n, professional_claim_details as (\n    select\n      b.encounter_id\n    , sum(paid_amount) as prof_paid_amount\n    , sum(allowed_amount) as prof_allowed_amount\n    , sum(charge_amount) as prof_charge_amount\n    from tuva.input_layer.medical_claim a\n    inner join dev_tom.claims_preprocessing._int_emergency_department_encounter_id b\n      on a.claim_id = b.claim_id\n      and a.claim_line_number = b.claim_line_number\n      and a.claim_type = 'professional'\n    group by b.encounter_id\n)\n\n, patient as (\n    select distinct\n          patient_id\n        , birth_date\n        , gender\n        , race\n    from __dbt__cte__emergency_department__stg_eligibility\n)\n\n, facility as (\n    select\n          a.encounter_id\n        , max(a.facility_id) as facility_id\n        , count(distinct facility_id) as npi_count\n    from dev_tom.claims_preprocessing._int_emergency_department_institutional_encounter_id a\n    group by a.encounter_id\n)\n\nselect\n    a.encounter_id\n    , a.encounter_start_date\n    , a.encounter_end_date\n    , a.patient_id\n    , datediff(\n        day,\n        birth_date,\n        encounter_end_date\n        )/365 as admit_age\n    , e.gender\n    , e.race\n    , c.diagnosis_code_type as primary_diagnosis_code_type\n    , c.diagnosis_code_1 as primary_diagnosis_code\n    , coalesce(icd10cm.long_description, icd9cm.long_description) as primary_diagnosis_description\n    , f.facility_id\n    , b.provider_organization_name as facility_name\n    , c.ms_drg_code\n    , j.ms_drg_description\n    , j.medical_surgical\n    , c.apr_drg_code\n    , k.apr_drg_description\n    , c.admit_source_code\n    , h.admit_source_description\n    , c.admit_type_code\n    , i.admit_type_description\n    , c.discharge_disposition_code\n    , g.discharge_disposition_description\n    , c.inst_paid_amount + coalesce(d.prof_paid_amount,0) as total_paid_amount\n    , c.inst_allowed_amount + coalesce(d.prof_allowed_amount,0) as total_allowed_amount\n    , c.inst_charge_amount + coalesce(d.prof_charge_amount,0) as total_charge_amount\n    , datediff(\n        day,\n        a.encounter_start_date,\n        a.encounter_end_date\n        ) as length_of_stay\n    , case\n        when c.discharge_disposition_code = '20' then 1\n        else 0\n    end mortality_flag\n    , data_source\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom distinct_encounters a\nleft join institutional_claim_details c\n  on a.encounter_id = c.encounter_id\nleft join professional_claim_details d\n  on a.encounter_id = d.encounter_id\nleft join patient e\n  on a.patient_id = e.patient_id\nleft join facility f\n  on a.encounter_id = f.encounter_id\nleft join dev_tom.terminology.provider b\n  on f.facility_id = b.npi\nleft join dev_tom.terminology.discharge_disposition g\n  on c.discharge_disposition_code = g.discharge_disposition_code\nleft join dev_tom.terminology.admit_source h\n  on c.admit_source_code = h.admit_source_code\nleft join dev_tom.terminology.admit_type i\n  on c.admit_type_code = i.admit_type_code\nleft join dev_tom.terminology.ms_drg j\n  on c.ms_drg_code = j.ms_drg_code\nleft join dev_tom.terminology.apr_drg k\n  on c.apr_drg_code = k.apr_drg_code\nleft join dev_tom.terminology.icd_10_cm icd10cm\n  on c.diagnosis_code_1 = icd10cm.icd_10_cm\n  and c.diagnosis_code_type = 'icd-10-cm'\nleft join dev_tom.terminology.icd_9_cm icd9cm\n  on c.diagnosis_code_1 = icd9cm.icd_9_cm\n  and c.diagnosis_code_type = 'icd-9-cm'", "relation_name": "dev_tom.claims_preprocessing.emergency_department_summary"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.874995Z", "completed_at": "2024-08-23T19:21:34.883961Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.884145Z", "completed_at": "2024-08-23T19:21:34.884150Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.010287284851074219, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.mart_review__data_source", "compiled": true, "compiled_code": "\n\nSELECT DISTINCT data_source\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nFROM dev_tom.core.medical_claim", "relation_name": "dev_tom.data_quality.mart_review__data_source"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.876930Z", "completed_at": "2024-08-23T19:21:34.884642Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.885249Z", "completed_at": "2024-08-23T19:21:34.885252Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.010975122451782227, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.mart_review__stg_medical_claim", "compiled": true, "compiled_code": "\n\nselect mc.*,\ncast(c.year_month_int as TEXT) as year_month\nFROM dev_tom.core.medical_claim  mc\nleft join dev_tom.reference_data.calendar c on coalesce(mc.claim_line_start_date,mc.claim_start_date) = c.full_date", "relation_name": "dev_tom.data_quality.mart_review__stg_medical_claim"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.886341Z", "completed_at": "2024-08-23T19:21:34.895088Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.895349Z", "completed_at": "2024-08-23T19:21:34.895354Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.01034402847290039, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.the_tuva_project.unique_core__medical_claim_medical_claim_id.74a5d63708", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    medical_claim_id as unique_field,\n    count(*) as n_records\n\nfrom dev_tom.core.medical_claim\nwhere medical_claim_id is not null\ngroup by medical_claim_id\nhaving count(*) > 1\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.888759Z", "completed_at": "2024-08-23T19:21:34.895870Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.896491Z", "completed_at": "2024-08-23T19:21:34.896494Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.010390996932983398, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.core__location", "compiled": true, "compiled_code": "\n\nselect * from dev_tom.core._stg_claims_location\nunion all\nselect * from dev_tom.core._stg_clinical_location\n\n", "relation_name": "dev_tom.core.location"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.891434Z", "completed_at": "2024-08-23T19:21:34.896068Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.896798Z", "completed_at": "2024-08-23T19:21:34.896801Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.008641242980957031, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.core__practitioner", "compiled": true, "compiled_code": "\n\nselect * from dev_tom.core._stg_claims_practitioner\nunion all\nselect * from dev_tom.core._stg_clinical_practitioner\n\n", "relation_name": "dev_tom.core.practitioner"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.916625Z", "completed_at": "2024-08-23T19:21:34.921330Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.921779Z", "completed_at": "2024-08-23T19:21:34.921783Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.007867097854614258, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.the_tuva_project.unique_core__condition_condition_id.ef1067e2f0", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    condition_id as unique_field,\n    count(*) as n_records\n\nfrom dev_tom.core.condition\nwhere condition_id is not null\ngroup by condition_id\nhaving count(*) > 1\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.934583Z", "completed_at": "2024-08-23T19:21:34.953517Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.956210Z", "completed_at": "2024-08-23T19:21:34.956216Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.022866010665893555, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.the_tuva_project.unique_core__procedure_procedure_id.feb1b6b4d5", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    procedure_id as unique_field,\n    count(*) as n_records\n\nfrom dev_tom.core.procedure\nwhere procedure_id is not null\ngroup by procedure_id\nhaving count(*) > 1\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.936421Z", "completed_at": "2024-08-23T19:21:34.956782Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.957994Z", "completed_at": "2024-08-23T19:21:34.957997Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.024209976196289062, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.financial_pmpm__patient_spend_with_service_categories", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__financial_pmpm__stg_medical_claim as (\n\n\n\nSELECT\n    patient_id\n    , claim_id\n    , claim_line_number\n    , claim_start_date\n    , claim_end_date\n    , service_category_1\n    , service_category_2\n    , paid_amount\n    , allowed_amount\n    , payer\n    , plan\n    , data_source\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.medical_claim\n),  __dbt__cte__financial_pmpm__stg_pharmacy_claim as (\n\n\n\nSELECT\n    patient_id\n    , dispensing_date\n    , paid_date\n    , paid_amount\n    , allowed_amount\n    , payer\n    , plan\n    , data_source\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.pharmacy_claim\n), claims_with_service_categories as (\n  select\n      patient_id\n    , payer\n    , plan\n    , service_category_1\n    , service_category_2\n    , coalesce(claim_start_date,claim_end_date) as claim_date\n    , paid_amount\n    , allowed_amount\n    , data_source\n  from __dbt__cte__financial_pmpm__stg_medical_claim\n)\n\n, medical_claims_year_month as (\n  select\n      patient_id\n    , payer\n    , plan\n    , service_category_1\n    , service_category_2\n    , date_part('year', claim_date) || \n\n    case when 2 = 0\n        then ''\n    else\n        right(\n            '0' || date_part('month', claim_date),\n            2\n        )\n    end as year_month\n    , paid_amount\n    , allowed_amount\n    , data_source\n  from claims_with_service_categories\n)\n\n, rx_claims as (\n  select\n      patient_id\n    , payer\n    , plan\n    , 'Pharmacy' as service_category_1\n    , cast(null as TEXT) as service_category_2\n    , coalesce(dispensing_date, paid_date) as claim_date\n    , paid_amount\n    , allowed_amount\n    , data_source\n  from __dbt__cte__financial_pmpm__stg_pharmacy_claim\n)\n\n, rx_claims_year_month as (\n  select\n      patient_id\n    , payer\n    , plan\n    , service_category_1\n    , service_category_2\n    , date_part('year', claim_date) || \n\n    case when 2 = 0\n        then ''\n    else\n        right(\n            '0' || date_part('month', claim_date),\n            2\n        )\n    end as year_month\n    , paid_amount\n    , allowed_amount\n    , data_source\n  from rx_claims\n)\n\n, combine_medical_and_rx as (\nselect *\nfrom medical_claims_year_month\n\nunion all\n\nselect *\nfrom rx_claims_year_month\n)\n\nselect\n    patient_id\n  , year_month\n  , payer\n  , plan\n  , service_category_1\n  , service_category_2\n  , sum(paid_amount) as total_paid\n  , sum(allowed_amount) as total_allowed\n  , data_source\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\n  from combine_medical_and_rx\ngroup by\n    patient_id\n  , year_month\n  , payer\n  , plan\n  , service_category_1\n  , service_category_2\n  , data_source", "relation_name": "dev_tom.financial_pmpm._int_patient_spend_with_service_categories"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.947024Z", "completed_at": "2024-08-23T19:21:34.958287Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.959055Z", "completed_at": "2024-08-23T19:21:34.959058Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.022865772247314453, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.core__stg_claims_encounter", "compiled": true, "compiled_code": "\n\n-- *************************************************\n-- This dbt model creates the encounter table in core.\n-- *************************************************\n\nselect\n    cast(encounter_id as TEXT ) as encounter_id\n    , cast(patient_id as TEXT ) as patient_id\n    , cast('acute inpatient' as TEXT ) as encounter_type\n    , try_cast( encounter_start_date as date ) as encounter_start_date\n    , try_cast( encounter_end_date as date ) as encounter_end_date\n    , cast(length_of_stay as integer ) as length_of_stay\n    , cast(admit_source_code as TEXT ) as admit_source_code\n    , cast(admit_source_description as TEXT ) as admit_source_description\n    , cast(admit_type_code as TEXT ) as admit_type_code\n    , cast(admit_type_description as TEXT ) as admit_type_description\n    , cast(discharge_disposition_code as TEXT ) as discharge_disposition_code\n    , cast(discharge_disposition_description as TEXT ) as discharge_disposition_description\n    , cast(null as TEXT ) as attending_provider_id\n    , cast(null as TEXT ) as attending_provider_name\n    , cast(facility_id as TEXT ) as facility_id\n    , cast(facility_name as TEXT ) as facility_name\n    , cast(primary_diagnosis_code_type as TEXT ) as primary_diagnosis_code_type\n    , cast(primary_diagnosis_code as TEXT ) as primary_diagnosis_code\n    , cast(primary_diagnosis_description as TEXT ) as primary_diagnosis_description\n    , cast(ms_drg_code as TEXT ) as ms_drg_code\n    , cast(ms_drg_description as TEXT ) as ms_drg_description\n    , cast(apr_drg_code as TEXT ) as apr_drg_code\n    , cast(apr_drg_description as TEXT ) as apr_drg_description\n    , cast(total_paid_amount as numeric(28,6) ) as  paid_amount\n    , cast(total_allowed_amount as numeric(28,6) ) as allowed_amount\n    , cast(total_charge_amount as numeric(28,6) ) as charge_amount\n    , cast(data_source as TEXT ) as data_source\n    , cast('2024-08-23 19:21:27.787896+00:00' as timestamp ) as  tuva_last_run\nfrom dev_tom.claims_preprocessing.acute_inpatient_summary \n\nunion all \n\nselect\n    cast(encounter_id as TEXT ) as encounter_id\n    , cast(patient_id as TEXT ) as patient_id\n    , cast('emergency department' as TEXT ) as encounter_type\n    , try_cast( encounter_start_date as date ) as encounter_start_date\n    , try_cast( encounter_end_date as date ) as encounter_end_date\n    , cast(length_of_stay as integer ) as length_of_stay\n    , cast(admit_source_code as TEXT ) as admit_source_code\n    , cast(admit_source_description as TEXT ) as admit_source_description\n    , cast(admit_type_code as TEXT ) as admit_type_code\n    , cast(admit_type_description as TEXT ) as admit_type_description\n    , cast(discharge_disposition_code as TEXT ) as discharge_disposition_code\n    , cast(discharge_disposition_description as TEXT ) as discharge_disposition_description\n    , cast(null as TEXT ) as attending_provider_id\n    , cast(null as TEXT ) as attending_provider_name\n    , cast(facility_id as TEXT ) as facility_id\n    , cast(facility_name as TEXT ) as facility_name\n    , cast(primary_diagnosis_code_type as TEXT ) as primary_diagnosis_code_type\n    , cast(primary_diagnosis_code as TEXT ) as primary_diagnosis_code\n    , cast(primary_diagnosis_description as TEXT ) as primary_diagnosis_description\n    , cast(ms_drg_code as TEXT ) as ms_drg_code\n    , cast(ms_drg_description as TEXT ) as ms_drg_description\n    , cast(apr_drg_code as TEXT ) as apr_drg_code\n    , cast(apr_drg_description as TEXT ) as apr_drg_description\n    , cast(total_paid_amount as numeric(28,6) ) as  paid_amount\n    , cast(total_allowed_amount as numeric(28,6) ) as allowed_amount\n    , cast(total_charge_amount as numeric(28,6) ) as charge_amount\n    , cast(data_source as TEXT ) as data_source\n    , cast('2024-08-23 19:21:27.787896+00:00' as timestamp ) as  tuva_last_run\nfrom dev_tom.claims_preprocessing.emergency_department_summary", "relation_name": "dev_tom.core._stg_claims_encounter"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.960241Z", "completed_at": "2024-08-23T19:21:34.968687Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.971256Z", "completed_at": "2024-08-23T19:21:34.971259Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.012860298156738281, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_shared_exclusions_institutional_snp", "compiled": true, "compiled_code": "\n\n/*\n    patients in institutional special needs plans (snp)\n    or residing in long term care\n\n    while referencing this model, patients greater or equal than 66 years of age should be taken\n\n    filtering out age from this model has been stripped out as different measures calculate age varingly\n\n    future enhancement: group claims into encounters\n*/\n\nwith  __dbt__cte__quality_measures__stg_core__patient as (\n\nselect\n      patient_id\n    , sex\n    , birth_date\n    , death_date\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.patient\n),  __dbt__cte__quality_measures__stg_medical_claim as (\n\n\nselect\n      patient_id\n    , claim_id\n    , claim_start_date\n    , claim_end_date\n    , place_of_service_code\n    , hcpcs_code\n    , hcpcs_modifier_1\n    , hcpcs_modifier_2\n    , hcpcs_modifier_3\n    , hcpcs_modifier_4\n    , hcpcs_modifier_5\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.medical_claim\n\n\n), patients as (\n\n    select\n          patient_id\n    from __dbt__cte__quality_measures__stg_core__patient\n\n)\n\n, medical_claim as (\n\n    select\n          patient_id\n        , claim_start_date\n        , claim_end_date\n        , hcpcs_code\n        , place_of_service_code\n    from __dbt__cte__quality_measures__stg_medical_claim\n\n)\n\n, exclusions as (\n\n    select\n          patients.patient_id\n        , coalesce(\n              medical_claim.claim_start_date\n            , medical_claim.claim_end_date\n          ) as exclusion_date\n        , 'institutional or long term care' as exclusion_reason\n    from patients\n         inner join medical_claim\n         on patients.patient_id = medical_claim.patient_id\n    where place_of_service_code in ('32', '33', '34', '54', '56')\n    and datediff(\n        day,\n        medical_claim.claim_start_date,\n        medical_claim.claim_end_date\n        ) >= 90\n\n)\n\nselect\n      patient_id\n    , exclusion_date\n    , exclusion_reason\n    , 'institutional_snp' as exclusion_type\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom exclusions", "relation_name": "dev_tom.quality_measures._int_shared_exclusions_institutional_snp"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.966325Z", "completed_at": "2024-08-23T19:21:34.971535Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.971997Z", "completed_at": "2024-08-23T19:21:34.972000Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.01238107681274414, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.mart_review__claims_with_enrollment", "compiled": true, "compiled_code": "\n\nwith enrollment_stage as(\nSELECT\n    mc.data_source,\n    mc.year_month,\n    SUM(CASE WHEN mm.patient_id IS NOT NULL THEN 1 ELSE 0 END) AS claims_with_enrollment,\n    COUNT(*) AS claims\nFROM dev_tom.data_quality.mart_review__stg_medical_claim mc\nLEFT JOIN dev_tom.core.member_months mm\n    ON mc.patient_id = mm.patient_id\n    AND mc.data_source = mm.data_source\n    AND mc.year_month = mm.year_month\nGROUP BY mc.data_source\n, mc.year_month\n)\n\nselect\n    data_source\n    , year_month\n    , claims_with_enrollment\n    , claims\n    , cast(claims_with_enrollment / claims as numeric(28,6) ) AS percentage_claims_with_enrollment\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom enrollment_stage", "relation_name": "dev_tom.data_quality.mart_review__claims_with_enrollment"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.968924Z", "completed_at": "2024-08-23T19:21:34.972459Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.972996Z", "completed_at": "2024-08-23T19:21:34.972999Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.006994009017944336, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.mart_review__members_with_claims", "compiled": true, "compiled_code": "\n\nWITH medical_claim AS (\n    SELECT\n        data_source,\n        patient_id,\n        year_month,\n        SUM(paid_amount) AS paid_amount\n    FROM dev_tom.data_quality.mart_review__stg_medical_claim\n    GROUP BY data_source\n    , patient_id\n    , year_month\n)\n\n,pharmacy_claim AS (\n    SELECT\n        data_source,\n        patient_id,\n        year_month,\n        SUM(paid_amount) AS paid_amount\n    FROM dev_tom.data_quality.mart_review__stg_pharmacy_claim\n    GROUP BY data_source\n    , patient_id\n    , year_month\n)\n, final as(\nSELECT\n    mm.data_source,\n    mm.year_month,\n    SUM(CASE WHEN mc.patient_id IS NOT NULL THEN 1 ELSE 0 END) AS members_with_medical_claims,\n    SUM(CASE WHEN pc.patient_id IS NOT NULL THEN 1 ELSE 0 END) AS members_with_pharmacy_claims,\n    SUM(CASE WHEN pc.patient_id IS NOT NULL THEN 1\n             WHEN mc.patient_id is not null THEN 1 ELSE 0 END) AS members_with_claims,\n    COUNT(*) AS total_member_months\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nFROM dev_tom.core.member_months mm\nLEFT JOIN medical_claim mc\n    ON mm.patient_id = mc.patient_id\n    AND mm.data_source = mc.data_source\n    AND mm.year_month = mc.year_month\nLEFT JOIN pharmacy_claim pc\n    ON mm.patient_id = pc.patient_id\n    AND mm.data_source = pc.data_source\n    AND mm.year_month = pc.year_month\nGROUP BY mm.data_source, mm.year_month\n)\n\nselect\n    data_source\n    , year_month\n    , members_with_medical_claims\n    , members_with_pharmacy_claims\n    , members_with_claims\n    , total_member_months\n    , cast(members_with_claims/ total_member_months as numeric(28,6)) as percent_members_with_claims\n    , cast(members_with_medical_claims/ total_member_months  as numeric(28,6)) as percent_members_with_medical_claims\n    , cast(members_with_pharmacy_claims/ total_member_months as numeric(28,6))  as  percent_members_with_pharmacy_claims\nfrom final", "relation_name": "dev_tom.data_quality.mart_review__members_with_claims"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.973446Z", "completed_at": "2024-08-23T19:21:34.978352Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.980103Z", "completed_at": "2024-08-23T19:21:34.980106Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.007847309112548828, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.the_tuva_project.unique_core__location_location_id.dc12ec8d3a", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    location_id as unique_field,\n    count(*) as n_records\n\nfrom dev_tom.core.location\nwhere location_id is not null\ngroup by location_id\nhaving count(*) > 1\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.975698Z", "completed_at": "2024-08-23T19:21:34.980358Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.980799Z", "completed_at": "2024-08-23T19:21:34.980802Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.007570981979370117, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.mart_review__pharmacy", "compiled": true, "compiled_code": "\n\n\nWITH dedup_prac AS (\n    SELECT DISTINCT practitioner_id,\n                    provider_first_name,\n                    provider_last_name,\n                    specialty\n    FROM dev_tom.core.practitioner\n),\ndedup_loc AS (\n    SELECT DISTINCT location_id,\n                    npi,\n                    name\n    FROM dev_tom.core.location\n)\n\nSELECT\n    p.claim_id,\n    p.claim_line_number,\n    p.patient_id,\n    p.data_source,\n    p.patient_id || '|' || p.data_source as patient_source_key,\n    p.ndc_code,\n    COALESCE(n.fda_description, n.rxnorm_description) AS ndc_description,\n    p.paid_amount,\n    p.allowed_amount,\n    p.prescribing_provider_id,\n    p.prescribing_provider_name,\n    prac.specialty AS prescribing_specialty,\n    p.dispensing_provider_id,\n    p.dispensing_provider_name,\n    p.paid_date,\n    p.dispensing_date,\n    p.days_supply,\n    n.rxcui,\n    n.rxnorm_description,\n    r.brand_name,\n    r.brand_vs_generic,\n    r.ingredient_name,\n    a.atc_1_name,\n    a.atc_2_name,\n    a.atc_3_name,\n    a.atc_4_name\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nFROM dev_tom.core.pharmacy_claim p\nLEFT JOIN dev_tom.terminology.ndc n ON p.ndc_code = n.ndc\nLEFT JOIN dev_tom.terminology.rxnorm_brand_generic r ON n.rxcui = r.product_rxcui\nLEFT JOIN dev_tom.terminology.rxnorm_to_atc a ON n.rxcui = a.rxcui\nLEFT JOIN dedup_prac prac ON p.prescribing_provider_id = prac.practitioner_id\nLEFT JOIN dedup_loc l ON p.dispensing_provider_id = l.location_id", "relation_name": "dev_tom.data_quality.mart_review__pharmacy"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.978550Z", "completed_at": "2024-08-23T19:21:34.981062Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:34.981669Z", "completed_at": "2024-08-23T19:21:34.981672Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.006204128265380859, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.the_tuva_project.unique_core__practitioner_practitioner_id.24d565a6b6", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    practitioner_id as unique_field,\n    count(*) as n_records\n\nfrom dev_tom.core.practitioner\nwhere practitioner_id is not null\ngroup by practitioner_id\nhaving count(*) > 1\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.982486Z", "completed_at": "2024-08-23T19:21:35.000202Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.013857Z", "completed_at": "2024-08-23T19:21:35.013861Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.03265881538391113, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.ccsr__long_condition_category", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__ccsr__stg_core__condition as (\n\n\nselect\n    encounter_id\n    , claim_id\n    , patient_id\n    , normalized_code\n    , condition_rank\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.condition\nwhere normalized_code_type = 'icd-10-cm'\n), ccsr__dx_vertical_pivot as (\n    \n    select * from dev_tom.ccsr.dx_vertical_pivot \n\n), condition as (\n    \n    select * from __dbt__cte__ccsr__stg_core__condition\n\n), dxccsr_body_systems as (\n\n    select * from dev_tom.ccsr._value_set_dxccsr_v2023_1_body_systems\n\n)\n\nselect \n    condition.encounter_id,\n    condition.claim_id,\n    condition.patient_id,\n    condition.normalized_code,\n    ccsr__dx_vertical_pivot.code_description,\n    condition.condition_rank,\n    ccsr__dx_vertical_pivot.ccsr_parent_category,\n    dxccsr_body_systems.body_system,\n    dxccsr_body_systems.parent_category_description,\n    ccsr__dx_vertical_pivot.ccsr_category,\n    ccsr__dx_vertical_pivot.ccsr_category_description,\n    ccsr__dx_vertical_pivot.ccsr_category_rank,\n    ccsr__dx_vertical_pivot.is_ip_default_category,\n    ccsr__dx_vertical_pivot.is_op_default_category,\n    '2023.1' as dxccsr_version,\n    '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom condition\nleft join ccsr__dx_vertical_pivot\n    on condition.normalized_code = ccsr__dx_vertical_pivot.code\nleft join dxccsr_body_systems on ccsr__dx_vertical_pivot.ccsr_parent_category = dxccsr_body_systems.ccsr_parent_category", "relation_name": "dev_tom.ccsr.long_condition_category"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:34.988151Z", "completed_at": "2024-08-23T19:21:35.014123Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.014597Z", "completed_at": "2024-08-23T19:21:35.014600Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.03252720832824707, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.chronic_conditions__cms_chronic_conditions_hiv_aids", "compiled": true, "compiled_code": "with  __dbt__cte__cms_chronic_conditions__stg_core__condition as (\n\n\nselect\n      claim_id\n    , patient_id\n    , recorded_date\n    , normalized_code_type\n    , normalized_code\n    , data_source\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.condition\nwhere claim_id is not null\n),  __dbt__cte__cms_chronic_conditions__stg_medical_claim as (\n\n\nselect\n      claim_id\n    , patient_id\n    , claim_start_date\n    , ms_drg_code\n    , data_source\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.medical_claim\n), chronic_conditions as (\n\n    select * from dev_tom.chronic_conditions._value_set_cms_chronic_conditions_hierarchy\n    where condition = 'Human Immunodeficiency Virus and/or Acquired Immunodeficiency Syndrome (HIV/AIDS)'\n\n)\n\n, patient_conditions as (\n\n    select\n          patient_id\n        , claim_id\n        , recorded_date as start_date\n        , normalized_code_type as code_type\n        , replace(normalized_code,'.','') as code\n        , data_source\n    from __dbt__cte__cms_chronic_conditions__stg_core__condition\n\n)\n\n, patient_ms_drgs as (\n\n    select\n          patient_id\n        , claim_id\n        , claim_start_date as start_date\n        , 'MS-DRG' as code_type\n        , ms_drg_code as code\n        , data_source\n    from __dbt__cte__cms_chronic_conditions__stg_medical_claim\n\n)\n\n/*\n    Exception logic: a claim with the diagnosis code R75 requires a second\n    qualifying claim that is not R75 (a screening code)\n\n    This CTE excludes encounters with the exception code. Those encounters\n    will be evaluated separately.\n*/\n, inclusions_diagnosis as (\n\n    select\n          patient_conditions.patient_id\n        , patient_conditions.claim_id\n        , patient_conditions.start_date\n        , patient_conditions.data_source\n        , chronic_conditions.chronic_condition_type\n        , chronic_conditions.condition_category\n        , chronic_conditions.condition\n    from patient_conditions\n         inner join chronic_conditions\n             on patient_conditions.code = chronic_conditions.code\n    where chronic_conditions.inclusion_type = 'Include'\n    and chronic_conditions.code_system = 'ICD-10-CM'\n    and chronic_conditions.code <> 'R75'\n\n)\n\n, inclusions_ms_drg as (\n\n    select\n          patient_ms_drgs.patient_id\n        , patient_ms_drgs.claim_id\n        , patient_ms_drgs.start_date\n        , patient_ms_drgs.data_source\n        , chronic_conditions.chronic_condition_type\n        , chronic_conditions.condition_category\n        , chronic_conditions.condition\n    from patient_ms_drgs\n         inner join chronic_conditions\n             on patient_ms_drgs.code = chronic_conditions.code\n    where chronic_conditions.inclusion_type = 'Include'\n    and chronic_conditions.code_system = 'MS-DRG'\n\n)\n\n/*\n    Exception logic: a claim with the diagnosis code R75 requires a second\n    qualifying claim that is not R75 (a screening code)\n\n    This CTE includes encounters with the exception code only where that\n    patient has another encounter that is not R75.\n*/\n, exception_diagnosis as (\n\n    select\n          patient_conditions.patient_id\n        , patient_conditions.claim_id\n        , patient_conditions.start_date\n        , patient_conditions.data_source\n        , chronic_conditions.chronic_condition_type\n        , chronic_conditions.condition_category\n        , chronic_conditions.condition\n    from patient_conditions\n         inner join chronic_conditions\n             on patient_conditions.code = chronic_conditions.code\n         inner join inclusions_diagnosis\n             on patient_conditions.patient_id = inclusions_diagnosis.patient_id\n    where chronic_conditions.inclusion_type = 'Include'\n    and chronic_conditions.code_system = 'ICD-10-CM'\n    and chronic_conditions.code = 'R75'\n\n)\n\n\n, inclusions_unioned as (\n\n    select * from inclusions_diagnosis\n    union distinct\n    select * from inclusions_ms_drg\n    union distinct\n    select * from exception_diagnosis\n\n)\n\n\nselect distinct\n      cast(inclusions_unioned.patient_id as TEXT) as patient_id\n    , cast(inclusions_unioned.claim_id as TEXT) as claim_id\n    , cast(inclusions_unioned.start_date as date) as start_date\n    , cast(inclusions_unioned.chronic_condition_type as TEXT) as chronic_condition_type\n    , cast(inclusions_unioned.condition_category as TEXT) as condition_category\n    , cast(inclusions_unioned.condition as TEXT) as condition\n    , cast(inclusions_unioned.data_source as TEXT) as data_source\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom inclusions_unioned", "relation_name": "dev_tom.chronic_conditions._int_cms_chronic_condition_hiv_aids"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.000401Z", "completed_at": "2024-08-23T19:21:35.014832Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.015377Z", "completed_at": "2024-08-23T19:21:35.015380Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.027467727661132812, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.cms_hcc__int_eligible_conditions", "compiled": true, "compiled_code": "\n/*\nSteps for staging condition data:\n    1) Filter to risk-adjustable claims per claim type for the collection year.\n    2) Gather diagnosis codes from condition for the eligible claims.\n    3) Map and filter diagnosis codes to HCCs\n\nClaims filtering logic:\n - Professional:\n    - CPT/HCPCS in CPT/HCPCS seed file from CMS\n - Inpatient:\n    - Bill type code in (11X, 41X)\n - Outpatient:\n    - Bill type code in (12X, 13X, 43X, 71X, 73X, 76X, 77X, 85X)\n    - CPT/HCPCS in CPT/HCPCS seed file from CMS\n\nJinja is used to set payment year variable.\n - The payment_year var has been set here so it gets compiled.\n - The collection year is one year prior to the payment year.\n*/\n\nwith  __dbt__cte__cms_hcc__stg_core__medical_claim as (\n\nselect\n      claim_id\n    , claim_line_number\n    , claim_type\n    , patient_id\n    , claim_start_date\n    , claim_end_date\n    , bill_type_code\n    , hcpcs_code\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.medical_claim\n),  __dbt__cte__cms_hcc__stg_core__condition as (\n\nselect\n      claim_id\n    , patient_id\n    , recorded_date\n    , condition_type\n    , normalized_code_type as code_type\n    , normalized_code as code\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.condition\n), medical_claims as (\n\n    select\n          claim_id\n        , claim_line_number\n        , claim_type\n        , patient_id\n        , claim_start_date\n        , claim_end_date\n        , bill_type_code\n        , hcpcs_code\n    from __dbt__cte__cms_hcc__stg_core__medical_claim\n\n)\n\n, conditions as (\n\n    select\n          claim_id\n        , patient_id\n        , code\n    from __dbt__cte__cms_hcc__stg_core__condition\n    where code_type = 'icd-10-cm'\n\n)\n\n, cpt_hcpcs_list as (\n\n    select\n          payment_year\n        , hcpcs_cpt_code\n    from dev_tom.cms_hcc._value_set_cpt_hcpcs\n\n)\n\n, professional_claims as (\n\n    select\n          medical_claims.claim_id\n        , medical_claims.claim_line_number\n        , medical_claims.claim_type\n        , medical_claims.patient_id\n        , medical_claims.claim_start_date\n        , medical_claims.claim_end_date\n        , medical_claims.bill_type_code\n        , medical_claims.hcpcs_code\n    from medical_claims\n        inner join cpt_hcpcs_list\n            on medical_claims.hcpcs_code = cpt_hcpcs_list.hcpcs_cpt_code\n    where claim_type = 'professional'\n              and date_part('year', claim_end_date) = 2023\n        and cpt_hcpcs_list.payment_year = 2024\n\n)\n\n\n, inpatient_claims as (\n\n    select\n          medical_claims.claim_id\n        , medical_claims.claim_line_number\n        , medical_claims.claim_type\n        , medical_claims.patient_id\n        , medical_claims.claim_start_date\n        , medical_claims.claim_end_date\n        , medical_claims.bill_type_code\n        , medical_claims.hcpcs_code\n    from medical_claims\n    where claim_type = 'institutional'\n        \n            and extract(year from claim_end_date) = 2023\n        \n        and substring(bill_type_code, 1, 2) in ('11','41')\n\n)\n\n, outpatient_claims as (\n\n    select\n          medical_claims.claim_id\n        , medical_claims.claim_line_number\n        , medical_claims.claim_type\n        , medical_claims.patient_id\n        , medical_claims.claim_start_date\n        , medical_claims.claim_end_date\n        , medical_claims.bill_type_code\n        , medical_claims.hcpcs_code\n    from medical_claims\n        inner join cpt_hcpcs_list\n            on medical_claims.hcpcs_code = cpt_hcpcs_list.hcpcs_cpt_code\n    where claim_type = 'institutional'\n        \n            and extract(year from claim_end_date) = 2023\n        \n        and cpt_hcpcs_list.payment_year = 2024\n        and substring(bill_type_code, 1, 2) in ('12','13','43','71','73','76','77','85')\n\n)\n\n, eligible_claims as (\n\n    select * from professional_claims\n    union all\n    select * from inpatient_claims\n    union all\n    select * from outpatient_claims\n\n)\n\n, eligible_conditions as (\n\n    select distinct\n          eligible_claims.claim_id\n        , eligible_claims.patient_id\n        , conditions.code\n    from eligible_claims\n        inner join conditions\n            on eligible_claims.claim_id = conditions.claim_id\n            and eligible_claims.patient_id = conditions.patient_id\n\n)\n\n, add_data_types as (\n\n    select distinct\n          cast(patient_id as TEXT) as patient_id\n        , cast(code as TEXT) as condition_code\n        , cast('2024' as integer) as payment_year\n    from eligible_conditions\n\n)\n\nselect\n      patient_id\n    , condition_code\n    , payment_year\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.cms_hcc._int_eligible_conditions"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.016234Z", "completed_at": "2024-08-23T19:21:35.034447Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.036623Z", "completed_at": "2024-08-23T19:21:35.036626Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.021684885025024414, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.hcc_suspecting__int_prep_conditions", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__hcc_suspecting__stg_core__condition as (\n\nselect\n      claim_id\n    , patient_id\n    , recorded_date\n    , condition_type\n    , lower(normalized_code_type) as code_type\n    , normalized_code as code\n    , data_source\nfrom dev_tom.core.condition\n), conditions as (\n\n    select\n          patient_id\n        , recorded_date\n        , condition_type\n        , code_type\n        , code\n        , data_source\n    from __dbt__cte__hcc_suspecting__stg_core__condition\n\n)\n\n/*\n    Default mapping guidance: Most map groups terminate with an unconditional\n    rule \u2013 a rule whose predicate is \u201cTRUE\u201d or, equivalently, \u201cOTHERWISE TRUE\u201d.\n    This rule is considered a \u201cdefault\u201d because it should be applied if\n    nothing further is known about the patient\u2019s condition.\n*/\n, seed_snomed_icd_10_map as (\n\n    select\n          referenced_component_id as snomed_code\n        , map_target as icd_10_code\n    from dev_tom.terminology.snomed_icd_10_map\n    where lower(map_rule) in ('true', 'otherwise true')\n    and map_group = '1'\n\n)\n\n, snomed_conditions as (\n\n    select\n          patient_id\n        , recorded_date\n        , condition_type\n        , 'icd-10-cm' as code_type\n        , icd_10_code as code\n        , data_source\n    from conditions\n         inner join seed_snomed_icd_10_map\n         on conditions.code = seed_snomed_icd_10_map.snomed_code\n    where conditions.code_type = 'snomed-ct'\n\n)\n\n, other_conditions as (\n\n    select\n          patient_id\n        , recorded_date\n        , condition_type\n        , code_type\n        , code\n        , data_source\n    from conditions\n    where conditions.code_type <> 'snomed-ct'\n\n)\n\n, union_conditions as (\n\n    select * from snomed_conditions\n    union all\n    select * from other_conditions\n\n)\n\n, add_data_types as (\n\n    select\n          cast(patient_id as TEXT) as patient_id\n        , cast(recorded_date as date) as recorded_date\n        , cast(condition_type as TEXT) as condition_type\n        , cast(code_type as TEXT) as code_type\n        , cast(code as TEXT) as code\n        , cast(data_source as TEXT) as data_source\n    from union_conditions\n\n)\n\nselect\n      patient_id\n    , recorded_date\n    , condition_type\n    , code_type\n    , code\n    , data_source\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.hcc_suspecting._int_prep_conditions"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.026151Z", "completed_at": "2024-08-23T19:21:35.036901Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.037360Z", "completed_at": "2024-08-23T19:21:35.037363Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.02156805992126465, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_cqm438_denominator_criteria3", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__quality_measures__stg_core__condition as (\n\nselect\n      patient_id\n    , claim_id\n    , encounter_id\n    , recorded_date\n    , source_code_type\n    , source_code\n    , normalized_code_type\n    , normalized_code\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.condition\n), diabetes_codes as (\n\n    select\n          code\n        , code_system\n        , concept_name\n    from dev_tom.quality_measures._value_set_codes\n    where lower(concept_name) in (\n              'diabetes'\n        )\n\n)\n\n, conditions as (\n\n    select\n          patient_id\n        , claim_id\n        , encounter_id\n        , recorded_date\n        , source_code\n        , source_code_type\n        , normalized_code\n        , normalized_code_type\n    from __dbt__cte__quality_measures__stg_core__condition\n\n)\n\n, diabetes_conditions as (\n\n    select\n          conditions.patient_id\n        , conditions.recorded_date as evidence_date\n    from conditions\n    inner join diabetes_codes\n        on coalesce(conditions.normalized_code_type, conditions.source_code_type) = diabetes_codes.code_system\n            and coalesce(conditions.normalized_code, conditions.source_code) = diabetes_codes.code\n\n)\n\n, patients_with_diabetes as (\n\n    select\n        distinct\n          patient_id\n        , performance_period_begin\n        , performance_period_end\n        , measure_id\n        , measure_name\n        , measure_version \n    from diabetes_conditions\n    inner join dev_tom.quality_measures._int_cqm438__performance_period pp\n    on evidence_date <= pp.performance_period_end\n\n)\n\n, add_data_types as (\n\n    select\n          cast(patient_id as TEXT) as patient_id\n        , cast(performance_period_begin as date) as performance_period_begin\n        , cast(performance_period_end as date) as performance_period_end\n        , cast(measure_id as TEXT) as measure_id\n        , cast(measure_name as TEXT) as measure_name\n        , cast(measure_version as TEXT) as measure_version\n    from patients_with_diabetes\n\n)\n\nselect \n      patient_id\n    , performance_period_begin\n    , performance_period_end\n    , measure_id\n    , measure_name\n    , measure_version\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.quality_measures._int_cqm438_denominator_criteria3"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.034666Z", "completed_at": "2024-08-23T19:21:35.037635Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.038179Z", "completed_at": "2024-08-23T19:21:35.038182Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.012275934219360352, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.the_tuva_project.not_null_quality_measures__stg_core__condition_patient_id.1f1222e348", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nwith __dbt__cte__quality_measures__stg_core__condition as (\n\nselect\n      patient_id\n    , claim_id\n    , encounter_id\n    , recorded_date\n    , source_code_type\n    , source_code\n    , normalized_code_type\n    , normalized_code\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.condition\n) select patient_id\nfrom __dbt__cte__quality_measures__stg_core__condition\nwhere patient_id is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.038979Z", "completed_at": "2024-08-23T19:21:35.047664Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.062283Z", "completed_at": "2024-08-23T19:21:35.062287Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.02453899383544922, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.chronic_conditions__tuva_chronic_conditions_long", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__tuva_chronic_conditions__stg_core__condition as (\n\n\nselect \n      patient_id\n    , normalized_code\n    , recorded_date\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.condition\n), all_conditions as (\nselect \n  patient_id,\n  normalized_code,\n  recorded_date\n    from __dbt__cte__tuva_chronic_conditions__stg_core__condition\n),\n\n\nconditions_with_first_and_last_diagnosis_date as (\nselect \n  patient_id,\n  normalized_code as icd_10_cm,\n  min(recorded_date) as first_diagnosis_date,\n  max(recorded_date) as last_diagnosis_date\nfrom all_conditions\ngroup by patient_id, normalized_code\n\n)\n\n\nselect\n  aa.patient_id,\n  bb.concept_name as condition,\n  min(first_diagnosis_date) as first_diagnosis_date,\n  max(last_diagnosis_date) as last_diagnosis_date,\n  '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom conditions_with_first_and_last_diagnosis_date aa\ninner join dev_tom.clinical_concept_library.value_set_member_relevant_fields bb\non aa.icd_10_cm = bb.code\ngroup by aa.patient_id, bb.concept_name", "relation_name": "dev_tom.chronic_conditions.tuva_chronic_conditions_long"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.043608Z", "completed_at": "2024-08-23T19:21:35.062555Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.063802Z", "completed_at": "2024-08-23T19:21:35.063805Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.02524113655090332, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.ccsr__long_procedure_category", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__ccsr__stg_core__procedure as (\n\n\nselect \n      encounter_id\n    , claim_id\n    , patient_id\n    , normalized_code\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.procedure\n), procedures as (\n\n    select * from __dbt__cte__ccsr__stg_core__procedure\n\n)\n\n, ccsr__procedure_category_map as (\n\n    select * from dev_tom.ccsr.procedure_category_map\n\n)\n\nselect distinct\n      procedures.encounter_id\n    , procedures.claim_id\n    , procedures.patient_id\n    , procedures.normalized_code\n    , ccsr__procedure_category_map.code_description\n    , ccsr__procedure_category_map.ccsr_parent_category\n    , ccsr__procedure_category_map.ccsr_category\n    , ccsr__procedure_category_map.ccsr_category_description\n    , ccsr__procedure_category_map.clinical_domain\n    , '2023.1' as prccsr_version\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom procedures\nleft join ccsr__procedure_category_map\n    on procedures.normalized_code = ccsr__procedure_category_map.code", "relation_name": "dev_tom.ccsr.long_procedure_category"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.048183Z", "completed_at": "2024-08-23T19:21:35.064059Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.064811Z", "completed_at": "2024-08-23T19:21:35.064814Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.021467924118041992, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.chronic_conditions__cms_chronic_conditions_all", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__cms_chronic_conditions__stg_core__condition as (\n\n\nselect\n      claim_id\n    , patient_id\n    , recorded_date\n    , normalized_code_type\n    , normalized_code\n    , data_source\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.condition\nwhere claim_id is not null\n),  __dbt__cte__cms_chronic_conditions__stg_medical_claim as (\n\n\nselect\n      claim_id\n    , patient_id\n    , claim_start_date\n    , ms_drg_code\n    , data_source\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.medical_claim\n),  __dbt__cte__cms_chronic_conditions__stg_core__procedure as (\n\n\nselect\n      claim_id\n    , patient_id\n    , procedure_date\n    , normalized_code_type\n    , normalized_code\n    , data_source\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.procedure\nwhere claim_id is not null\n), chronic_conditions as (\n\n    select * from dev_tom.chronic_conditions._value_set_cms_chronic_conditions_hierarchy\n\n)\n\n, patient_conditions as (\n\n    select\n          patient_id\n        , claim_id\n        , recorded_date as start_date\n        , normalized_code_type as code_type\n        , replace(normalized_code,'.','') as code\n        , data_source\n    from __dbt__cte__cms_chronic_conditions__stg_core__condition\n\n)\n\n, patient_ms_drgs as (\n\n    select\n          patient_id\n        , claim_id\n        , claim_start_date as start_date\n        , 'MS-DRG' as code_type\n        , ms_drg_code as code\n        , data_source\n    from __dbt__cte__cms_chronic_conditions__stg_medical_claim\n\n)\n\n, patient_procedures as (\n\n    select\n          patient_id\n        , claim_id\n        , procedure_date as start_date\n        , normalized_code_type as code_type\n        , replace(normalized_code,'.','') as code\n        , data_source\n    from __dbt__cte__cms_chronic_conditions__stg_core__procedure\n\n)\n\n, inclusions_diagnosis as (\n\n    select\n          patient_conditions.patient_id\n        , patient_conditions.claim_id\n        , patient_conditions.start_date\n        , patient_conditions.data_source\n        , chronic_conditions.chronic_condition_type\n        , chronic_conditions.condition_category\n        , chronic_conditions.condition\n    from patient_conditions\n         inner join chronic_conditions\n             on patient_conditions.code = chronic_conditions.code\n    where chronic_conditions.inclusion_type = 'Include'\n    and chronic_conditions.code_system = 'ICD-10-CM'\n    and chronic_conditions.additional_logic = 'None'\n\n)\n\n, inclusions_ms_drg as (\n\n    select\n          patient_ms_drgs.patient_id\n        , patient_ms_drgs.claim_id\n        , patient_ms_drgs.start_date\n        , patient_ms_drgs.data_source\n        , chronic_conditions.chronic_condition_type\n        , chronic_conditions.condition_category\n        , chronic_conditions.condition\n    from patient_ms_drgs\n         inner join chronic_conditions\n             on patient_ms_drgs.code = chronic_conditions.code\n    where chronic_conditions.inclusion_type = 'Include'\n    and chronic_conditions.code_system = 'MS-DRG'\n    and chronic_conditions.additional_logic = 'None'\n\n)\n\n, inclusions_procedure as (\n\n    select\n          patient_procedures.patient_id\n        , patient_procedures.claim_id\n        , patient_procedures.start_date\n        , patient_procedures.data_source\n        , chronic_conditions.chronic_condition_type\n        , chronic_conditions.condition_category\n        , chronic_conditions.condition\n    from patient_procedures\n         inner join chronic_conditions\n             on patient_procedures.code = chronic_conditions.code\n    where chronic_conditions.inclusion_type = 'Include'\n    and chronic_conditions.code_system in ('ICD-10-PCS', 'HCPCS')\n    and chronic_conditions.additional_logic = 'None'\n\n)\n\n, exclusions_diagnosis as (\n\n    select distinct\n          patient_conditions.claim_id\n        , chronic_conditions.condition\n    from patient_conditions\n         inner join chronic_conditions\n             on patient_conditions.code = chronic_conditions.code\n    where chronic_conditions.inclusion_type = 'Exclude'\n    and chronic_conditions.code_system = 'ICD-10-CM'\n\n)\n\n\n, inclusions_unioned as (\n\n    select * from inclusions_diagnosis\n    union distinct\n    select * from inclusions_procedure\n    union distinct\n    select * from inclusions_ms_drg\n\n)\n\n\nselect distinct\n      cast(inclusions_unioned.patient_id as TEXT) as patient_id\n    , cast(inclusions_unioned.claim_id as TEXT) as claim_id\n    , cast(inclusions_unioned.start_date as date) as start_date\n    , cast(inclusions_unioned.chronic_condition_type as TEXT) as chronic_condition_type\n    , cast(inclusions_unioned.condition_category as TEXT) as condition_category\n    , cast(inclusions_unioned.condition as TEXT) as condition\n    , cast(inclusions_unioned.data_source as TEXT) as data_source\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom inclusions_unioned\n     left join exclusions_diagnosis\n         on inclusions_unioned.claim_id = exclusions_diagnosis.claim_id\n         and inclusions_unioned.condition = exclusions_diagnosis.condition\nwhere exclusions_diagnosis.claim_id is null", "relation_name": "dev_tom.chronic_conditions._int_cms_chronic_condition_all"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.067074Z", "completed_at": "2024-08-23T19:21:35.097668Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.098067Z", "completed_at": "2024-08-23T19:21:35.098071Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.03368234634399414, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_cqm438_denominator_criteria1", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__quality_measures__stg_core__condition as (\n\nselect\n      patient_id\n    , claim_id\n    , encounter_id\n    , recorded_date\n    , source_code_type\n    , source_code\n    , normalized_code_type\n    , normalized_code\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.condition\n),  __dbt__cte__quality_measures__stg_core__procedure as (\n\nselect\n      patient_id\n    , encounter_id\n    , procedure_date\n    , source_code_type\n    , source_code\n    , normalized_code_type\n    , normalized_code\n    , modifier_1\n    , modifier_2\n    , modifier_3\n    , modifier_4\n    , modifier_5\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.procedure\n), ascvd_codes as (\n\n    select\n          code\n        , code_system\n    from dev_tom.quality_measures._value_set_codes\n    where lower(concept_name) in (\n              'atherosclerosis and peripheral arterial disease'\n            , 'myocardial infarction'\n            , 'pci'\n            , 'stable and unstable angina'\n            , 'cabg or pci procedure'\n            , 'cabg surgeries'\n            , 'cerebrovascular disease stroke or tia'\n            , 'ischemic heart disease or related diagnoses'\n            , 'carotid intervention'\n        )\n\n)\n\n, conditions as (\n\n    select\n          patient_id\n        , claim_id\n        , encounter_id\n        , recorded_date\n        , source_code\n        , source_code_type\n        , normalized_code\n        , normalized_code_type\n    from __dbt__cte__quality_measures__stg_core__condition\n\n)\n\n, ascvd_conditions as (\n\n    select\n          conditions.patient_id\n        , conditions.recorded_date as evidence_date\n    from conditions\n    inner join ascvd_codes\n        on coalesce(conditions.normalized_code_type, conditions.source_code_type) = ascvd_codes.code_system\n            and coalesce(conditions.normalized_code, conditions.source_code) = ascvd_codes.code\n\n)\n\n, procedures as (\n\n    select\n          patient_id\n        , procedure_date\n        , coalesce (\n              normalized_code_type\n            , case\n                when lower(source_code_type) = 'cpt' then 'hcpcs'\n                when lower(source_code_type) = 'snomed' then 'snomed-ct'\n                else lower(source_code_type)\n              end\n          ) as code_type\n        , coalesce(\n              normalized_code\n            , source_code\n          ) as code\n    from __dbt__cte__quality_measures__stg_core__procedure\n\n)\n\n, ascvd_procedures as (\n\n    select\n          procedures.patient_id\n        , procedures.procedure_date as evidence_date\n    from procedures\n         inner join ascvd_codes\n             on procedures.code = ascvd_codes.code\n             and procedures.code_type = ascvd_codes.code_system\n\n)\n\n, historical_ascvd as (\n\n    select\n          ascvd_conditions.patient_id\n        , ascvd_conditions.evidence_date\n    from ascvd_conditions\n\n    union all\n\n    select\n          ascvd_procedures.patient_id\n        , ascvd_procedures.evidence_date\n    from ascvd_procedures\n\n)\n\n, patients_with_ascvd as (\n\n    select\n        distinct\n          historical_ascvd.patient_id\n        , pp.performance_period_begin\n        , pp.performance_period_end\n        , pp.measure_id\n        , pp.measure_name\n        , pp.measure_version\n    from historical_ascvd\n    inner join dev_tom.quality_measures._int_cqm438__performance_period pp\n    on evidence_date <= pp.performance_period_end\n\n)\n\n, add_data_types as (\n\n    select\n          cast(patient_id as TEXT) as patient_id\n        , cast(performance_period_begin as date) as performance_period_begin\n        , cast(performance_period_end as date) as performance_period_end\n        , cast(measure_id as TEXT) as measure_id\n        , cast(measure_name as TEXT) as measure_name\n        , cast(measure_version as TEXT) as measure_version\n    from patients_with_ascvd\n\n)\n\nselect \n      patient_id\n    , performance_period_begin\n    , performance_period_end\n    , measure_id\n    , measure_name\n    , measure_version\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.quality_measures._int_cqm438_denominator_criteria1"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.080724Z", "completed_at": "2024-08-23T19:21:35.116878Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.117320Z", "completed_at": "2024-08-23T19:21:35.117325Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.05179905891418457, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_cqm438_denominator_criteria2", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__quality_measures__stg_core__condition as (\n\nselect\n      patient_id\n    , claim_id\n    , encounter_id\n    , recorded_date\n    , source_code_type\n    , source_code\n    , normalized_code_type\n    , normalized_code\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.condition\n),  __dbt__cte__quality_measures__stg_core__procedure as (\n\nselect\n      patient_id\n    , encounter_id\n    , procedure_date\n    , source_code_type\n    , source_code\n    , normalized_code_type\n    , normalized_code\n    , modifier_1\n    , modifier_2\n    , modifier_3\n    , modifier_4\n    , modifier_5\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.procedure\n),  __dbt__cte__quality_measures__stg_core__lab_result as (\n\n\nselect\n      patient_id\n    , result\n    , result_date\n    , collection_date\n    , source_code_type\n    , source_code\n    , normalized_code_type\n    , normalized_code\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.lab_result\n\n\n), cholesterol_codes as (\n\n    select\n          code\n        , code_system\n        , concept_name\n    from dev_tom.quality_measures._value_set_codes\n    where lower(concept_name) in (\n              'ldl cholesterol'\n            , 'familial hypercholesterolemia'\n        )\n\n)\n\n, conditions as (\n\n    select\n          patient_id\n        , claim_id\n        , encounter_id\n        , recorded_date\n        , source_code\n        , source_code_type\n        , normalized_code\n        , normalized_code_type\n    from __dbt__cte__quality_measures__stg_core__condition\n\n)\n\n, cholesterol_conditions as (\n\n    select\n          conditions.patient_id\n        , conditions.recorded_date as evidence_date\n    from conditions\n    inner join cholesterol_codes\n        on coalesce(conditions.normalized_code_type, conditions.source_code_type) = cholesterol_codes.code_system\n            and coalesce(conditions.normalized_code, conditions.source_code) = cholesterol_codes.code\n\n)\n\n, procedures as (\n\n    select\n          patient_id\n        , procedure_date\n        , coalesce (\n              normalized_code_type\n            , case\n                when lower(source_code_type) = 'cpt' then 'hcpcs'\n                when lower(source_code_type) = 'snomed' then 'snomed-ct'\n                else lower(source_code_type)\n              end\n          ) as code_type\n        , coalesce(\n              normalized_code\n            , source_code\n          ) as code\n    from __dbt__cte__quality_measures__stg_core__procedure\n\n)\n\n, cholesterol_procedures as (\n\n    select\n          procedures.patient_id\n        , procedures.procedure_date as evidence_date\n    from procedures\n         inner join cholesterol_codes\n             on procedures.code = cholesterol_codes.code\n             and procedures.code_type = cholesterol_codes.code_system\n\n)\n\n, labs as (\n\n    select\n          patient_id\n        , result\n        , result_date\n        , collection_date\n        , source_code_type\n        , source_code\n        , normalized_code_type\n        , normalized_code\n    from __dbt__cte__quality_measures__stg_core__lab_result\n\n)\n\n, cholesterol_tests_with_result as (\n\n    select\n      labs.patient_id\n    , labs.result as evidence_value\n    , coalesce(collection_date, result_date) as evidence_date\n    , cholesterol_codes.concept_name\n    , row_number() over(partition by labs.patient_id order by\n                          labs.result desc\n                        , result_date desc) as rn\n    from labs\n    inner join cholesterol_codes\n      on coalesce(labs.normalized_code, labs.source_code) = cholesterol_codes.code\n        and coalesce(labs.normalized_code_type, labs.source_code_type) = cholesterol_codes.code_system\n   \n        where regexp_like(result, '^[+-]?([0-9]*[.])?[0-9]+$')\n    \n\n)\n\n, cholesterol_labs as (\n\n    select\n          patient_id\n        , evidence_date\n    from cholesterol_tests_with_result\n    where rn= 1\n        and cast(evidence_value as numeric(28,6)) >= 190\n\n)\n\n, all_patients_with_cholesterol as (\n\n    select\n          cholesterol_conditions.patient_id\n        , cholesterol_conditions.evidence_date\n    from cholesterol_conditions\n\n    union all\n\n    select\n          cholesterol_procedures.patient_id\n        , cholesterol_procedures.evidence_date\n    from cholesterol_procedures\n\n    union all\n\n    select\n          cholesterol_labs.patient_id\n        , cholesterol_labs.evidence_date\n    from cholesterol_labs\n\n)\n\n, patients_with_cholesterol as (\n\n    select\n        distinct\n          patient_id\n        , performance_period_begin\n        , performance_period_end\n        , measure_id\n        , measure_name\n        , measure_version\n    from all_patients_with_cholesterol\n    inner join dev_tom.quality_measures._int_cqm438__performance_period pp\n    on evidence_date <= pp.performance_period_end\n\n)\n\n, add_data_types as (\n\n    select\n          cast(patient_id as TEXT) as patient_id\n        , cast(performance_period_begin as date) as performance_period_begin\n        , cast(performance_period_end as date) as performance_period_end\n        , cast(measure_id as TEXT) as measure_id\n        , cast(measure_name as TEXT) as measure_name\n        , cast(measure_version as TEXT) as measure_version\n    from patients_with_cholesterol\n\n)\n\nselect\n      patient_id\n    , performance_period_begin\n    , performance_period_end\n    , measure_id\n    , measure_name\n    , measure_version\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.quality_measures._int_cqm438_denominator_criteria2"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.098394Z", "completed_at": "2024-08-23T19:21:35.117579Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.118100Z", "completed_at": "2024-08-23T19:21:35.118103Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.03775906562805176, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_nqf0034_exclude_colectomy_cancer", "compiled": true, "compiled_code": "\n\n/*\nDENOMINATOR EXCLUSIONS:\nPatients with a diagnosis or past history of total colectomy or colorectal cancer: G9711\n*/\n\n\nwith  __dbt__cte__quality_measures__stg_core__condition as (\n\nselect\n      patient_id\n    , claim_id\n    , encounter_id\n    , recorded_date\n    , source_code_type\n    , source_code\n    , normalized_code_type\n    , normalized_code\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.condition\n),  __dbt__cte__quality_measures__stg_medical_claim as (\n\n\nselect\n      patient_id\n    , claim_id\n    , claim_start_date\n    , claim_end_date\n    , place_of_service_code\n    , hcpcs_code\n    , hcpcs_modifier_1\n    , hcpcs_modifier_2\n    , hcpcs_modifier_3\n    , hcpcs_modifier_4\n    , hcpcs_modifier_5\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.medical_claim\n\n\n),  __dbt__cte__quality_measures__stg_core__observation as (\n\n\nselect\n      patient_id\n    , encounter_id\n    , observation_date\n    , result\n    , source_code_type\n    , source_code\n    , normalized_code_type\n    , normalized_code\n    , normalized_description\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.observation\n\n\n),  __dbt__cte__quality_measures__stg_core__procedure as (\n\nselect\n      patient_id\n    , encounter_id\n    , procedure_date\n    , source_code_type\n    , source_code\n    , normalized_code_type\n    , normalized_code\n    , modifier_1\n    , modifier_2\n    , modifier_3\n    , modifier_4\n    , modifier_5\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.procedure\n), exclusion_codes as (\n\n    select\n          code\n        , case code_system\n            when 'SNOMEDCT' then 'snomed-ct'\n            when 'ICD9CM' then 'icd-9-cm'\n            when 'ICD10CM' then 'icd-10-cm'\n            when 'CPT' then 'hcpcs'\n            when 'ICD10PCS' then 'icd-10-pcs'\n          else lower(code_system) \n          end as code_system\n        , concept_name\n    From dev_tom.quality_measures._value_set_codes\n    where lower(concept_name) in  (\n          'malignant neoplasm of colon'\n        , 'total colectomy'\n    )\n\n)\n\n, conditions as (\n\n    select\n          patient_id\n        , claim_id\n        , recorded_date\n        , coalesce (\n              normalized_code_type\n            , case\n                when lower(source_code_type) = 'snomed' then 'snomed-ct'\n                else lower(source_code_type)\n              end\n          ) as code_type\n        , coalesce (\n              normalized_code\n            , source_code\n          ) as code\n    from __dbt__cte__quality_measures__stg_core__condition\n\n)\n\n, medical_claim as (\n\n    select\n          patient_id\n        , claim_id\n        , claim_start_date\n        , claim_end_date\n        , hcpcs_code\n        , place_of_service_code\n    from __dbt__cte__quality_measures__stg_medical_claim\n\n)\n\n, observations as (\n\n    select\n          patient_id\n        , observation_date\n        , coalesce (\n              normalized_code_type\n            , case\n                when lower(source_code_type) = 'cpt' then 'hcpcs'\n                when lower(source_code_type) = 'snomed' then 'snomed-ct'\n                else lower(source_code_type)\n              end\n          ) as code_type\n        , coalesce (\n              normalized_code\n            , source_code\n          ) as code\n    from __dbt__cte__quality_measures__stg_core__observation\n\n)\n\n, procedures as (\n\n    select\n          patient_id\n        , procedure_date\n        , coalesce (\n              normalized_code_type\n            , case\n                when lower(source_code_type) = 'cpt' then 'hcpcs'\n                when lower(source_code_type) = 'snomed' then 'snomed-ct'\n                else lower(source_code_type)\n              end\n          ) as code_type\n        , coalesce (\n              normalized_code\n            , source_code\n          ) as code\n    from __dbt__cte__quality_measures__stg_core__procedure\n\n)\n\n, condition_exclusions as (\n\n    select\n          conditions.patient_id\n        , conditions.claim_id\n        , conditions.recorded_date\n        , exclusion_codes.concept_name as concept_name\n    from conditions\n         inner join exclusion_codes\n            on conditions.code = exclusion_codes.code\n            and conditions.code_type = exclusion_codes.code_system\n\n)\n\n, med_claim_exclusions as (\n\n    select\n          medical_claim.patient_id\n        , medical_claim.claim_id\n        , medical_claim.claim_start_date\n        , medical_claim.claim_end_date\n        , medical_claim.hcpcs_code\n        , exclusion_codes.concept_name as concept_name\n    from medical_claim\n         inner join exclusion_codes\n            on medical_claim.hcpcs_code = exclusion_codes.code\n    where exclusion_codes.code_system = 'hcpcs'\n\n)\n\n, observation_exclusions as (\n\n    select\n          observations.patient_id\n        , observations.observation_date\n        , exclusion_codes.concept_name as concept_name\n    from observations\n         inner join exclusion_codes\n             on observations.code = exclusion_codes.code\n             and observations.code_type = exclusion_codes.code_system\n\n)\n\n, procedure_exclusions as (\n\n    select\n          procedures.patient_id\n        , procedures.procedure_date\n        , exclusion_codes.concept_name as concept_name\n    from procedures\n         inner join exclusion_codes\n             on procedures.code = exclusion_codes.code\n             and procedures.code_type = exclusion_codes.code_system\n\n)\n\n, patients_with_exclusions as(\n    select patient_id\n        , recorded_date as exclusion_date\n        , concept_name as exclusion_reason\n    from condition_exclusions\n\n    union all\n\n    select patient_id\n        , coalesce(claim_end_date, claim_start_date) as exclusion_date\n        , concept_name as exclusion_reason\n    from med_claim_exclusions\n\n    union all\n\n    select patient_id\n        , observation_date as exclusion_date\n        , concept_name as exclusion_reason\n    from observation_exclusions\n\n    union all\n\n    select patient_id\n        , procedure_date as exclusion_date\n        , concept_name as exclusion_reason\n    from procedure_exclusions\n\n)\n\nselect\n      patient_id\n    , exclusion_date\n    , exclusion_reason\n    , 'measure specific exclusion for historical record of colectomy cancer' as exclusion_type\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom patients_with_exclusions", "relation_name": "dev_tom.quality_measures._int_nqf0034_exclude_colectomy_cancer"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.118376Z", "completed_at": "2024-08-23T19:21:35.142416Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.154556Z", "completed_at": "2024-08-23T19:21:35.154559Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.03750896453857422, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_shared_exclusions_frailty", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__quality_measures__stg_core__patient as (\n\nselect\n      patient_id\n    , sex\n    , birth_date\n    , death_date\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.patient\n),  __dbt__cte__quality_measures__stg_core__condition as (\n\nselect\n      patient_id\n    , claim_id\n    , encounter_id\n    , recorded_date\n    , source_code_type\n    , source_code\n    , normalized_code_type\n    , normalized_code\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.condition\n),  __dbt__cte__quality_measures__stg_medical_claim as (\n\n\nselect\n      patient_id\n    , claim_id\n    , claim_start_date\n    , claim_end_date\n    , place_of_service_code\n    , hcpcs_code\n    , hcpcs_modifier_1\n    , hcpcs_modifier_2\n    , hcpcs_modifier_3\n    , hcpcs_modifier_4\n    , hcpcs_modifier_5\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.medical_claim\n\n\n),  __dbt__cte__quality_measures__stg_core__observation as (\n\n\nselect\n      patient_id\n    , encounter_id\n    , observation_date\n    , result\n    , source_code_type\n    , source_code\n    , normalized_code_type\n    , normalized_code\n    , normalized_description\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.observation\n\n\n),  __dbt__cte__quality_measures__stg_core__procedure as (\n\nselect\n      patient_id\n    , encounter_id\n    , procedure_date\n    , source_code_type\n    , source_code\n    , normalized_code_type\n    , normalized_code\n    , modifier_1\n    , modifier_2\n    , modifier_3\n    , modifier_4\n    , modifier_5\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.procedure\n), patients as (\n\n    select\n          patient_id\n    from __dbt__cte__quality_measures__stg_core__patient\n\n)\n\n, exclusion_codes as (\n\n    select\n          code\n        , code_system\n        , concept_name\n    from dev_tom.quality_measures._value_set_codes\n    where lower(concept_name) in (\n          'frailty device'\n        , 'frailty diagnosis'\n        , 'frailty encounter'\n        , 'frailty symptom'\n    )\n\n)\n\n, conditions as (\n\n    select\n          patient_id\n        , recorded_date\n        , coalesce (\n              normalized_code_type\n            , case\n                when lower(source_code_type) = 'snomed' then 'snomed-ct'\n                else lower(source_code_type)\n              end\n          ) as code_type\n        , coalesce (\n              normalized_code\n            , source_code\n          ) as code\n    from __dbt__cte__quality_measures__stg_core__condition\n\n)\n\n, medical_claim as (\n\n    select\n          patient_id\n        , claim_start_date\n        , claim_end_date\n        , hcpcs_code\n        , place_of_service_code\n    from __dbt__cte__quality_measures__stg_medical_claim\n\n)\n\n, observations as (\n\n    select\n          patient_id\n        , observation_date\n        , coalesce (\n              normalized_code_type\n            , case\n                when lower(source_code_type) = 'cpt' then 'hcpcs'\n                when lower(source_code_type) = 'snomed' then 'snomed-ct'\n                else lower(source_code_type)\n              end\n          ) as code_type\n        , coalesce (\n              normalized_code\n            , source_code\n          ) as code\n    from __dbt__cte__quality_measures__stg_core__observation\n\n)\n\n, procedures as (\n\n    select\n          patient_id\n        , procedure_date\n        , coalesce (\n              normalized_code_type\n            , case\n                when lower(source_code_type) = 'cpt' then 'hcpcs'\n                when lower(source_code_type) = 'snomed' then 'snomed-ct'\n                else lower(source_code_type)\n              end\n          ) as code_type\n        , coalesce (\n              normalized_code\n            , source_code\n          ) as code\n    from __dbt__cte__quality_measures__stg_core__procedure\n\n)\n\n, condition_exclusions as (\n\n    select\n          conditions.patient_id\n        , conditions.recorded_date\n        , exclusion_codes.concept_name\n    from conditions\n         inner join exclusion_codes\n             on conditions.code = exclusion_codes.code\n             and conditions.code_type = exclusion_codes.code_system\n\n)\n\n, med_claim_exclusions as (\n\n    select\n          medical_claim.patient_id\n        , medical_claim.claim_start_date\n        , medical_claim.claim_end_date\n        , medical_claim.hcpcs_code\n        , exclusion_codes.concept_name\n    from medical_claim\n         inner join exclusion_codes\n            on medical_claim.hcpcs_code = exclusion_codes.code\n    where exclusion_codes.code_system = 'hcpcs'\n\n)\n\n, observation_exclusions as (\n\n    select\n          observations.patient_id\n        , observations.observation_date\n        , exclusion_codes.concept_name\n    from observations\n         inner join exclusion_codes\n             on observations.code = exclusion_codes.code\n             and observations.code_type = exclusion_codes.code_system\n\n)\n\n, procedure_exclusions as (\n\n    select\n          procedures.patient_id\n        , procedures.procedure_date\n        , exclusion_codes.concept_name\n    from procedures\n         inner join exclusion_codes\n             on procedures.code = exclusion_codes.code\n             and procedures.code_type = exclusion_codes.code_system\n\n)\n\n, patients_with_frailty as (\n\n    select\n          patients.patient_id\n        , condition_exclusions.recorded_date as exclusion_date\n        , condition_exclusions.concept_name as exclusion_reason\n    from patients\n         inner join condition_exclusions\n            on patients.patient_id = condition_exclusions.patient_id\n\n    union all\n\n    select\n          patients.patient_id\n        , coalesce(\n              med_claim_exclusions.claim_start_date\n            , med_claim_exclusions.claim_end_date\n          ) as exclusion_date\n        , med_claim_exclusions.concept_name as exclusion_reason\n    from patients\n         inner join med_claim_exclusions\n            on patients.patient_id = med_claim_exclusions.patient_id\n\n    union all\n\n    select\n          patients.patient_id\n        , observation_exclusions.observation_date as exclusion_date\n        , observation_exclusions.concept_name as exclusion_reason\n    from patients\n         inner join observation_exclusions\n            on patients.patient_id = observation_exclusions.patient_id\n\n    union all\n\n    select\n          patients.patient_id\n        , procedure_exclusions.procedure_date as exclusion_date\n        , procedure_exclusions.concept_name as exclusion_reason\n    from patients\n         inner join procedure_exclusions\n            on patients.patient_id = procedure_exclusions.patient_id\n\n)\n\nselect\n      patient_id\n    , exclusion_date\n    , exclusion_reason\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom patients_with_frailty", "relation_name": "dev_tom.quality_measures._int_shared_exclusions_frailty"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.136965Z", "completed_at": "2024-08-23T19:21:35.157905Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.158432Z", "completed_at": "2024-08-23T19:21:35.158435Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.022315025329589844, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_shared_exclusions_hospice_palliative", "compiled": true, "compiled_code": "\n\n/*\nDENOMINATOR EXCLUSIONS:\nPatient was provided hospice services any time during the measurement period: G9687\n*/\n\n\nwith  __dbt__cte__quality_measures__stg_core__condition as (\n\nselect\n      patient_id\n    , claim_id\n    , encounter_id\n    , recorded_date\n    , source_code_type\n    , source_code\n    , normalized_code_type\n    , normalized_code\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.condition\n),  __dbt__cte__quality_measures__stg_medical_claim as (\n\n\nselect\n      patient_id\n    , claim_id\n    , claim_start_date\n    , claim_end_date\n    , place_of_service_code\n    , hcpcs_code\n    , hcpcs_modifier_1\n    , hcpcs_modifier_2\n    , hcpcs_modifier_3\n    , hcpcs_modifier_4\n    , hcpcs_modifier_5\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.medical_claim\n\n\n),  __dbt__cte__quality_measures__stg_core__observation as (\n\n\nselect\n      patient_id\n    , encounter_id\n    , observation_date\n    , result\n    , source_code_type\n    , source_code\n    , normalized_code_type\n    , normalized_code\n    , normalized_description\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.observation\n\n\n),  __dbt__cte__quality_measures__stg_core__procedure as (\n\nselect\n      patient_id\n    , encounter_id\n    , procedure_date\n    , source_code_type\n    , source_code\n    , normalized_code_type\n    , normalized_code\n    , modifier_1\n    , modifier_2\n    , modifier_3\n    , modifier_4\n    , modifier_5\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.procedure\n), exclusion_codes as (\n\n    select\n          code\n        , case code_system\n            when 'SNOMEDCT' then 'snomed-ct'\n            when 'ICD9CM' then 'icd-9-cm'\n            when 'ICD10CM' then 'icd-10-cm'\n            when 'CPT' then 'hcpcs'\n            when 'ICD10PCS' then 'icd-10-pcs'\n          else lower(code_system) end as code_system\n        , concept_name\n    From dev_tom.quality_measures._value_set_codes\n    where lower(concept_name) in  (\n            'hospice encounter'\n          , 'hospice care ambulatory'\n          , 'hospice diagnosis'\n          , 'palliative care encounter'\n          , 'palliative care diagnosis'\n          , 'palliative care intervention'\n    )\n)\n\n, conditions as (\n\n    select\n          patient_id\n        , claim_id\n        , recorded_date\n        , coalesce (\n              normalized_code_type\n            , case\n                when lower(source_code_type) = 'snomed' then 'snomed-ct'\n                else lower(source_code_type)\n              end\n          ) as code_type\n        , coalesce (\n              normalized_code\n            , source_code\n          ) as code\n    from __dbt__cte__quality_measures__stg_core__condition \n\n)\n\n, medical_claim as (\n\n    select\n          patient_id\n        , claim_id\n        , claim_start_date\n        , claim_end_date\n        , hcpcs_code\n        , place_of_service_code\n    from __dbt__cte__quality_measures__stg_medical_claim\n\n)\n\n, observations as (\n\n    select\n          patient_id\n        , observation_date\n        , coalesce (\n              normalized_code_type\n            , case\n                when lower(source_code_type) = 'cpt' then 'hcpcs'\n                when lower(source_code_type) = 'snomed' then 'snomed-ct'\n                else lower(source_code_type)\n              end\n          ) as code_type\n        , coalesce (\n              normalized_code\n            , source_code\n          ) as code\n    from __dbt__cte__quality_measures__stg_core__observation\n\n)\n\n, procedures as (\n\n    select\n          patient_id\n        , procedure_date\n        , coalesce (\n              normalized_code_type\n            , case\n                when lower(source_code_type) = 'cpt' then 'hcpcs'\n                when lower(source_code_type) = 'snomed' then 'snomed-ct'\n                else lower(source_code_type)\n              end\n          ) as code_type\n        , coalesce (\n              normalized_code\n            , source_code\n          ) as code\n    from __dbt__cte__quality_measures__stg_core__procedure\n\n)\n\n, condition_exclusions as (\n\n    select\n          conditions.patient_id\n        , conditions.claim_id\n        , conditions.recorded_date\n        , exclusion_codes.concept_name as concept_name\n    from conditions\n         inner join exclusion_codes\n            on conditions.code = exclusion_codes.code\n            and conditions.code_type = exclusion_codes.code_system\n\n)\n\n, med_claim_exclusions as (\n\n    select\n          medical_claim.patient_id\n        , medical_claim.claim_id\n        , medical_claim.claim_start_date\n        , medical_claim.claim_end_date\n        , medical_claim.hcpcs_code\n        , exclusion_codes.concept_name as concept_name\n    from medical_claim\n         inner join exclusion_codes\n            on medical_claim.hcpcs_code = exclusion_codes.code\n    where exclusion_codes.code_system = 'hcpcs'\n\n)\n\n, observation_exclusions as (\n\n    select\n          observations.patient_id\n        , observations.observation_date\n        , exclusion_codes.concept_name as concept_name\n    from observations\n    inner join exclusion_codes\n        on observations.code = exclusion_codes.code\n        and observations.code_type = exclusion_codes.code_system\n\n)\n\n, procedure_exclusions as (\n\n    select\n          procedures.patient_id\n        , procedures.procedure_date\n        , exclusion_codes.concept_name as concept_name\n    from procedures\n         inner join exclusion_codes\n             on procedures.code = exclusion_codes.code\n             and procedures.code_type = exclusion_codes.code_system\n\n)\n\n, patients_with_exclusions as(\n    \n    select patient_id\n        , recorded_date as exclusion_date\n        , concept_name as exclusion_reason\n    from condition_exclusions\n\n    union all\n\n    select patient_id\n        , coalesce(claim_end_date, claim_start_date) as exclusion_date\n        , concept_name as exclusion_reason\n    from med_claim_exclusions\n\n    union all\n\n    select patient_id\n        , observation_date as exclusion_date\n        , concept_name as exclusion_reason\n    from observation_exclusions\n\n    union all\n\n    select patient_id\n        , procedure_date as exclusion_date\n        , concept_name as exclusion_reason\n    from procedure_exclusions\n\n)\n\nselect\n      patient_id\n    , exclusion_date\n    , exclusion_reason\n    , 'hospice_palliative' as exclusion_type\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom patients_with_exclusions", "relation_name": "dev_tom.quality_measures._int_shared_exclusions_hospice_palliative"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.154854Z", "completed_at": "2024-08-23T19:21:35.158281Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.158820Z", "completed_at": "2024-08-23T19:21:35.158823Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.022073984146118164, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.the_tuva_project.not_null_quality_measures__stg_core__procedure_patient_id.0b52ff75d9", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nwith __dbt__cte__quality_measures__stg_core__procedure as (\n\nselect\n      patient_id\n    , encounter_id\n    , procedure_date\n    , source_code_type\n    , source_code\n    , normalized_code_type\n    , normalized_code\n    , modifier_1\n    , modifier_2\n    , modifier_3\n    , modifier_4\n    , modifier_5\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.procedure\n) select patient_id\nfrom __dbt__cte__quality_measures__stg_core__procedure\nwhere patient_id is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.159322Z", "completed_at": "2024-08-23T19:21:35.163516Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.171483Z", "completed_at": "2024-08-23T19:21:35.171487Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.013436079025268555, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.readmissions__procedure_ccs", "compiled": true, "compiled_code": "\n\nwith __dbt__cte__readmissions__stg_core__procedure as (\n\n\nselect\n  encounter_id\n, normalized_code\n, normalized_code_type\n, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.procedure\n) -- Here we map every procedure code to its corresponding\n-- CCS procedure category.\n-- This model may list more than one CCS procedure category\n-- per encounter_id because different procedures associated with the\n-- encounter (different rows on the stg_procedure model) may have\n-- different associated CCS procedure categories.\n\n\n\nselect\n    aa.encounter_id,\n    aa.normalized_code as procedure_code,\n    case\n        when bb.icd_10_pcs is null then 0\n\telse 1\n    end as valid_icd_10_pcs_flag,\n    cc.ccs_procedure_category,\n    '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom\n    __dbt__cte__readmissions__stg_core__procedure aa\n    left join dev_tom.terminology.icd_10_pcs bb\n    on aa.normalized_code = bb.icd_10_pcs\n    left join dev_tom.readmissions._value_set_icd_10_pcs_to_ccs cc\n    on aa.normalized_code = cc.icd_10_pcs\nwhere aa.normalized_code_type = 'icd-10-pcs'", "relation_name": "dev_tom.readmissions._int_procedure_ccs"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.163822Z", "completed_at": "2024-08-23T19:21:35.175139Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.175474Z", "completed_at": "2024-08-23T19:21:35.175477Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.012577056884765625, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.financial_pmpm__service_category_1_allowed_pivot", "compiled": true, "compiled_code": "\n\nwith service_cat_1 as (\n  select\n    patient_id\n  , year_month\n  , payer\n  , plan\n  , service_category_1\n  , data_source\n  , sum(total_allowed) as total_allowed\n  from dev_tom.financial_pmpm._int_patient_spend_with_service_categories\n  group by\n    patient_id\n  , year_month\n  , payer\n  , plan\n  , service_category_1\n  , data_source\n)\n\nselect\n  patient_id\n, year_month\n, payer\n, plan\n, data_source\n, \n  \n    sum(\n      \n      case\n      when service_category_1 = 'Inpatient'\n        then total_allowed\n      else 0\n      end\n    )\n    \n      \n        as inpatient_allowed\n      \n    \n    ,\n  \n    sum(\n      \n      case\n      when service_category_1 = 'Outpatient'\n        then total_allowed\n      else 0\n      end\n    )\n    \n      \n        as outpatient_allowed\n      \n    \n    ,\n  \n    sum(\n      \n      case\n      when service_category_1 = 'Office Visit'\n        then total_allowed\n      else 0\n      end\n    )\n    \n      \n        as office_visit_allowed\n      \n    \n    ,\n  \n    sum(\n      \n      case\n      when service_category_1 = 'Ancillary'\n        then total_allowed\n      else 0\n      end\n    )\n    \n      \n        as ancillary_allowed\n      \n    \n    ,\n  \n    sum(\n      \n      case\n      when service_category_1 = 'Other'\n        then total_allowed\n      else 0\n      end\n    )\n    \n      \n        as other_allowed\n      \n    \n    ,\n  \n    sum(\n      \n      case\n      when service_category_1 = 'Pharmacy'\n        then total_allowed\n      else 0\n      end\n    )\n    \n      \n        as pharmacy_allowed\n      \n    \n    \n  \n\n, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom service_cat_1\ngroup by\n  patient_id\n, year_month\n, payer\n, plan\n, data_source", "relation_name": "dev_tom.financial_pmpm._int_service_category_1_allowed_pivot"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.171779Z", "completed_at": "2024-08-23T19:21:35.175727Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.180179Z", "completed_at": "2024-08-23T19:21:35.180182Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.01706981658935547, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.financial_pmpm__service_category_1_paid_pivot", "compiled": true, "compiled_code": "\n\nwith service_cat_1 as (\n  select\n    patient_id\n  , year_month\n  , payer\n  , plan\n  , service_category_1\n  , data_source\n  , sum(total_paid) as total_paid\n  from dev_tom.financial_pmpm._int_patient_spend_with_service_categories\n  group by\n    patient_id\n  , year_month\n  , payer\n  , plan\n  , service_category_1\n  , data_source\n)\n\nselect\n  patient_id\n, year_month\n, payer\n, plan\n, data_source\n, \n  \n    sum(\n      \n      case\n      when service_category_1 = 'Inpatient'\n        then total_paid\n      else 0\n      end\n    )\n    \n      \n        as inpatient_paid\n      \n    \n    ,\n  \n    sum(\n      \n      case\n      when service_category_1 = 'Outpatient'\n        then total_paid\n      else 0\n      end\n    )\n    \n      \n        as outpatient_paid\n      \n    \n    ,\n  \n    sum(\n      \n      case\n      when service_category_1 = 'Office Visit'\n        then total_paid\n      else 0\n      end\n    )\n    \n      \n        as office_visit_paid\n      \n    \n    ,\n  \n    sum(\n      \n      case\n      when service_category_1 = 'Ancillary'\n        then total_paid\n      else 0\n      end\n    )\n    \n      \n        as ancillary_paid\n      \n    \n    ,\n  \n    sum(\n      \n      case\n      when service_category_1 = 'Other'\n        then total_paid\n      else 0\n      end\n    )\n    \n      \n        as other_paid\n      \n    \n    ,\n  \n    sum(\n      \n      case\n      when service_category_1 = 'Pharmacy'\n        then total_paid\n      else 0\n      end\n    )\n    \n      \n        as pharmacy_paid\n      \n    \n    \n  \n\n, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom service_cat_1\ngroup by\n  patient_id\n, year_month\n, payer\n, plan\n, data_source", "relation_name": "dev_tom.financial_pmpm._int_service_category_1_paid_pivot"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.175905Z", "completed_at": "2024-08-23T19:21:35.181418Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.182166Z", "completed_at": "2024-08-23T19:21:35.182170Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.007245063781738281, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.financial_pmpm__service_category_2_allowed_pivot", "compiled": true, "compiled_code": "\n\nwith service_cat_2 as (\n  select\n    patient_id\n  , year_month\n  , payer\n  , plan\n  , service_category_2\n  , data_source\n  , sum(total_allowed) as total_allowed\n  from dev_tom.financial_pmpm._int_patient_spend_with_service_categories\n  group by\n    patient_id\n  , year_month\n  , payer\n  , plan\n  , service_category_2\n  , data_source\n)\n\nselect\n  patient_id\n, year_month\n, payer\n, plan\n, data_source\n, \n  \n    sum(\n      \n      case\n      when service_category_2 = 'Acute Inpatient'\n        then total_allowed\n      else 0\n      end\n    )\n    \n      \n        as acute_inpatient_allowed\n      \n    \n    ,\n  \n    sum(\n      \n      case\n      when service_category_2 = 'Ambulance'\n        then total_allowed\n      else 0\n      end\n    )\n    \n      \n        as ambulance_allowed\n      \n    \n    ,\n  \n    sum(\n      \n      case\n      when service_category_2 = 'Ambulatory Surgery'\n        then total_allowed\n      else 0\n      end\n    )\n    \n      \n        as ambulatory_surgery_allowed\n      \n    \n    ,\n  \n    sum(\n      \n      case\n      when service_category_2 = 'Dialysis'\n        then total_allowed\n      else 0\n      end\n    )\n    \n      \n        as dialysis_allowed\n      \n    \n    ,\n  \n    sum(\n      \n      case\n      when service_category_2 = 'Durable Medical Equipment'\n        then total_allowed\n      else 0\n      end\n    )\n    \n      \n        as durable_medical_equipment_allowed\n      \n    \n    ,\n  \n    sum(\n      \n      case\n      when service_category_2 = 'Emergency Department'\n        then total_allowed\n      else 0\n      end\n    )\n    \n      \n        as emergency_department_allowed\n      \n    \n    ,\n  \n    sum(\n      \n      case\n      when service_category_2 = 'Home Health'\n        then total_allowed\n      else 0\n      end\n    )\n    \n      \n        as home_health_allowed\n      \n    \n    ,\n  \n    sum(\n      \n      case\n      when service_category_2 = 'Hospice'\n        then total_allowed\n      else 0\n      end\n    )\n    \n      \n        as hospice_allowed\n      \n    \n    ,\n  \n    sum(\n      \n      case\n      when service_category_2 = 'Inpatient Psychiatric'\n        then total_allowed\n      else 0\n      end\n    )\n    \n      \n        as inpatient_psychiatric_allowed\n      \n    \n    ,\n  \n    sum(\n      \n      case\n      when service_category_2 = 'Inpatient Rehabilitation'\n        then total_allowed\n      else 0\n      end\n    )\n    \n      \n        as inpatient_rehabilitation_allowed\n      \n    \n    ,\n  \n    sum(\n      \n      case\n      when service_category_2 = 'Lab'\n        then total_allowed\n      else 0\n      end\n    )\n    \n      \n        as lab_allowed\n      \n    \n    ,\n  \n    sum(\n      \n      case\n      when service_category_2 = 'Office Visit'\n        then total_allowed\n      else 0\n      end\n    )\n    \n      \n        as office_visit_allowed\n      \n    \n    ,\n  \n    sum(\n      \n      case\n      when service_category_2 = 'Outpatient Hospital or Clinic'\n        then total_allowed\n      else 0\n      end\n    )\n    \n      \n        as outpatient_hospital_or_clinic_allowed\n      \n    \n    ,\n  \n    sum(\n      \n      case\n      when service_category_2 = 'Outpatient Psychiatric'\n        then total_allowed\n      else 0\n      end\n    )\n    \n      \n        as outpatient_psychiatric_allowed\n      \n    \n    ,\n  \n    sum(\n      \n      case\n      when service_category_2 = 'Outpatient Rehabilitation'\n        then total_allowed\n      else 0\n      end\n    )\n    \n      \n        as outpatient_rehabilitation_allowed\n      \n    \n    ,\n  \n    sum(\n      \n      case\n      when service_category_2 = 'Skilled Nursing'\n        then total_allowed\n      else 0\n      end\n    )\n    \n      \n        as skilled_nursing_allowed\n      \n    \n    ,\n  \n    sum(\n      \n      case\n      when service_category_2 = 'Urgent Care'\n        then total_allowed\n      else 0\n      end\n    )\n    \n      \n        as urgent_care_allowed\n      \n    \n    \n  \n\n, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom service_cat_2\ngroup by\n  patient_id\n, year_month\n, payer\n, plan\n, data_source", "relation_name": "dev_tom.financial_pmpm._int_service_category_2_allowed_pivot"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.182648Z", "completed_at": "2024-08-23T19:21:35.190336Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.190960Z", "completed_at": "2024-08-23T19:21:35.190963Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.010529041290283203, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.financial_pmpm__service_category_2_paid_pivot", "compiled": true, "compiled_code": "\n\nwith service_cat_2 as (\n  select\n    patient_id\n  , year_month\n  , payer\n  , plan\n  , service_category_2\n  , data_source\n  , sum(total_paid) as total_paid\n  from dev_tom.financial_pmpm._int_patient_spend_with_service_categories\n  group by\n    patient_id\n  , year_month\n  , payer\n  , plan\n  , service_category_2\n  , data_source\n)\n\nselect\n  patient_id\n, year_month\n, payer\n, plan\n, data_source\n, \n  \n    sum(\n      \n      case\n      when service_category_2 = 'Acute Inpatient'\n        then total_paid\n      else 0\n      end\n    )\n    \n      \n        as acute_inpatient_paid\n      \n    \n    ,\n  \n    sum(\n      \n      case\n      when service_category_2 = 'Ambulance'\n        then total_paid\n      else 0\n      end\n    )\n    \n      \n        as ambulance_paid\n      \n    \n    ,\n  \n    sum(\n      \n      case\n      when service_category_2 = 'Ambulatory Surgery'\n        then total_paid\n      else 0\n      end\n    )\n    \n      \n        as ambulatory_surgery_paid\n      \n    \n    ,\n  \n    sum(\n      \n      case\n      when service_category_2 = 'Dialysis'\n        then total_paid\n      else 0\n      end\n    )\n    \n      \n        as dialysis_paid\n      \n    \n    ,\n  \n    sum(\n      \n      case\n      when service_category_2 = 'Durable Medical Equipment'\n        then total_paid\n      else 0\n      end\n    )\n    \n      \n        as durable_medical_equipment_paid\n      \n    \n    ,\n  \n    sum(\n      \n      case\n      when service_category_2 = 'Emergency Department'\n        then total_paid\n      else 0\n      end\n    )\n    \n      \n        as emergency_department_paid\n      \n    \n    ,\n  \n    sum(\n      \n      case\n      when service_category_2 = 'Home Health'\n        then total_paid\n      else 0\n      end\n    )\n    \n      \n        as home_health_paid\n      \n    \n    ,\n  \n    sum(\n      \n      case\n      when service_category_2 = 'Hospice'\n        then total_paid\n      else 0\n      end\n    )\n    \n      \n        as hospice_paid\n      \n    \n    ,\n  \n    sum(\n      \n      case\n      when service_category_2 = 'Inpatient Psychiatric'\n        then total_paid\n      else 0\n      end\n    )\n    \n      \n        as inpatient_psychiatric_paid\n      \n    \n    ,\n  \n    sum(\n      \n      case\n      when service_category_2 = 'Inpatient Rehabilitation'\n        then total_paid\n      else 0\n      end\n    )\n    \n      \n        as inpatient_rehabilitation_paid\n      \n    \n    ,\n  \n    sum(\n      \n      case\n      when service_category_2 = 'Lab'\n        then total_paid\n      else 0\n      end\n    )\n    \n      \n        as lab_paid\n      \n    \n    ,\n  \n    sum(\n      \n      case\n      when service_category_2 = 'Office Visit'\n        then total_paid\n      else 0\n      end\n    )\n    \n      \n        as office_visit_paid\n      \n    \n    ,\n  \n    sum(\n      \n      case\n      when service_category_2 = 'Outpatient Hospital or Clinic'\n        then total_paid\n      else 0\n      end\n    )\n    \n      \n        as outpatient_hospital_or_clinic_paid\n      \n    \n    ,\n  \n    sum(\n      \n      case\n      when service_category_2 = 'Outpatient Psychiatric'\n        then total_paid\n      else 0\n      end\n    )\n    \n      \n        as outpatient_psychiatric_paid\n      \n    \n    ,\n  \n    sum(\n      \n      case\n      when service_category_2 = 'Outpatient Rehabilitation'\n        then total_paid\n      else 0\n      end\n    )\n    \n      \n        as outpatient_rehabilitation_paid\n      \n    \n    ,\n  \n    sum(\n      \n      case\n      when service_category_2 = 'Skilled Nursing'\n        then total_paid\n      else 0\n      end\n    )\n    \n      \n        as skilled_nursing_paid\n      \n    \n    ,\n  \n    sum(\n      \n      case\n      when service_category_2 = 'Urgent Care'\n        then total_paid\n      else 0\n      end\n    )\n    \n      \n        as urgent_care_paid\n      \n    \n    \n  \n\n, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom service_cat_2\ngroup by\n  patient_id\n, year_month\n, payer\n, plan\n, data_source", "relation_name": "dev_tom.financial_pmpm._int_service_category_2_paid_pivot"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.187056Z", "completed_at": "2024-08-23T19:21:35.193398Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.193829Z", "completed_at": "2024-08-23T19:21:35.193832Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.011404037475585938, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.core__encounter", "compiled": true, "compiled_code": "\n\nselect * from dev_tom.core._stg_claims_encounter\nunion all\nselect * from dev_tom.core._stg_clinical_encounter\n\n", "relation_name": "dev_tom.core.encounter"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.191277Z", "completed_at": "2024-08-23T19:21:35.194285Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.194874Z", "completed_at": "2024-08-23T19:21:35.194878Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.008066177368164062, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.ccsr__singular_condition_category", "compiled": true, "compiled_code": "\n\nselect \n    encounter_id,\n    claim_id,\n    patient_id,\n    ccsr_category,\n    ccsr_category_description,\n    ccsr_parent_category,\n    parent_category_description,\n    body_system,\n    '2023.1' as dxccsr_version,\n    '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ccsr.long_condition_category\nwhere\n        is_ip_default_category = 1\n        and condition_rank = 1", "relation_name": "dev_tom.ccsr.singular_condition_category"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.195334Z", "completed_at": "2024-08-23T19:21:35.199720Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.201512Z", "completed_at": "2024-08-23T19:21:35.201515Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.007447242736816406, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.the_tuva_project.accepted_values_chronic_conditions__cms_chronic_conditions_hiv_aids_condition__Human_Immunodeficiency_Virus_and_or_Acquired_Immunodeficiency_Syndrome_HIV_AIDS_.c54d45a2c6", "compiled": true, "compiled_code": "\n    \n    \n\nwith all_values as (\n\n    select\n        condition as value_field,\n        count(*) as n_records\n\n    from dev_tom.chronic_conditions._int_cms_chronic_condition_hiv_aids\n    group by condition\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    'Human Immunodeficiency Virus and/or Acquired Immunodeficiency Syndrome (HIV/AIDS)'\n)\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.197873Z", "completed_at": "2024-08-23T19:21:35.201819Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.202212Z", "completed_at": "2024-08-23T19:21:35.202215Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.0070989131927490234, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.the_tuva_project.not_null_chronic_conditions__cms_chronic_conditions_hiv_aids_claim_id.9baa48027d", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect claim_id\nfrom dev_tom.chronic_conditions._int_cms_chronic_condition_hiv_aids\nwhere claim_id is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.199929Z", "completed_at": "2024-08-23T19:21:35.202477Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.203024Z", "completed_at": "2024-08-23T19:21:35.203027Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.005473136901855469, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.the_tuva_project.not_null_chronic_conditions__cms_chronic_conditions_hiv_aids_condition.da32954f00", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect condition\nfrom dev_tom.chronic_conditions._int_cms_chronic_condition_hiv_aids\nwhere condition is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.203834Z", "completed_at": "2024-08-23T19:21:35.208728Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.210396Z", "completed_at": "2024-08-23T19:21:35.210399Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.00780797004699707, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.the_tuva_project.not_null_chronic_conditions__cms_chronic_conditions_hiv_aids_patient_id.b6c58add4b", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect patient_id\nfrom dev_tom.chronic_conditions._int_cms_chronic_condition_hiv_aids\nwhere patient_id is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.205828Z", "completed_at": "2024-08-23T19:21:35.210691Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.211073Z", "completed_at": "2024-08-23T19:21:35.211076Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.0076448917388916016, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.cms_hcc__int_hcc_mapping", "compiled": true, "compiled_code": "\n/*\nSteps for staging the medical claim data:\n    1) Filter to risk-adjustable claims per claim type for the collection year.\n    2) Gather diagnosis codes from Condition for the eligible claims.\n    3) Map and filter diagnosis codes to HCCs for each CMS model version\n    4) Union results from each CMS model version\n       (note: some payment years may not have results for v28)\n*/\n\nwith conditions as (\n\n    select\n          patient_id\n        , condition_code\n        , payment_year\n    from dev_tom.cms_hcc._int_eligible_conditions\n\n)\n\n, seed_hcc_mapping as (\n\n    select\n          payment_year\n        , diagnosis_code\n        , cms_hcc_v24\n        , cms_hcc_v24_flag\n        , cms_hcc_v28\n        , cms_hcc_v28_flag\n    from dev_tom.cms_hcc._value_set_icd_10_cm_mappings\n\n)\n\n/* casting hcc_code to avoid formatting changes during union */\n, v24_mapped as (\n\n    select distinct\n          conditions.patient_id\n        , conditions.condition_code\n        , conditions.payment_year\n        , 'CMS-HCC-V24' as model_version\n        , cast(seed_hcc_mapping.cms_hcc_v24 as TEXT) as hcc_code\n    from conditions\n        inner join seed_hcc_mapping\n            on conditions.condition_code = seed_hcc_mapping.diagnosis_code\n            and conditions.payment_year = seed_hcc_mapping.payment_year\n    where cms_hcc_v24_flag = 'Yes'\n\n)\n\n, v28_mapped as (\n\n    select distinct\n          conditions.patient_id\n        , conditions.condition_code\n        , conditions.payment_year\n        , 'CMS-HCC-V28' as model_version\n        , cast(seed_hcc_mapping.cms_hcc_v28 as TEXT) as hcc_code\n    from conditions\n        inner join seed_hcc_mapping\n            on conditions.condition_code = seed_hcc_mapping.diagnosis_code\n            and conditions.payment_year = seed_hcc_mapping.payment_year\n    where cms_hcc_v28_flag = 'Yes'\n\n)\n\n, unioned as (\n\n    select * from v24_mapped\n    union all\n    select * from v28_mapped\n\n)\n\n, add_data_types as (\n\n    select\n          cast(patient_id as TEXT) as patient_id\n        , cast(condition_code as TEXT) as condition_code\n        , cast(hcc_code as TEXT) as hcc_code\n        , cast(model_version as TEXT) as model_version\n        , cast(payment_year as integer) as payment_year\n    from unioned\n\n)\n\nselect\n      patient_id\n    , condition_code\n    , hcc_code\n    , model_version\n    , payment_year\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.cms_hcc._int_hcc_mapping"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.208913Z", "completed_at": "2024-08-23T19:21:35.211508Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.212054Z", "completed_at": "2024-08-23T19:21:35.212057Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.006474018096923828, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.the_tuva_project.not_null_cms_hcc__int_eligible_conditions_condition_code.e811a078bc", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect condition_code\nfrom dev_tom.cms_hcc._int_eligible_conditions\nwhere condition_code is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.212511Z", "completed_at": "2024-08-23T19:21:35.223002Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.223370Z", "completed_at": "2024-08-23T19:21:35.223373Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.012063980102539062, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.hcc_suspecting__int_all_conditions", "compiled": true, "compiled_code": "\n\nwith conditions as (\n\n    select\n          patient_id\n        , recorded_date\n        , condition_type\n        , code_type\n        , code\n        , data_source\n    from dev_tom.hcc_suspecting._int_prep_conditions\n\n)\n\n, seed_hcc_mapping as (\n\n    select\n          diagnosis_code\n        , cms_hcc_v28 as hcc_code\n    from dev_tom.hcc_suspecting._value_set_icd_10_cm_mappings\n    where cms_hcc_v28 is not null\n\n)\n\n, seed_hcc_descriptions as (\n\n    select distinct\n          hcc_code\n        , hcc_description\n    from dev_tom.hcc_suspecting._value_set_hcc_descriptions\n\n)\n\n, joined as (\n\n    select\n          conditions.patient_id\n        , conditions.recorded_date\n        , conditions.condition_type\n        , conditions.code\n        , conditions.data_source\n        , seed_hcc_mapping.hcc_code\n        , seed_hcc_descriptions.hcc_description\n    from conditions\n         left join seed_hcc_mapping\n         on conditions.code = seed_hcc_mapping.diagnosis_code\n         left join seed_hcc_descriptions\n         on seed_hcc_mapping.hcc_code = seed_hcc_descriptions.hcc_code\n    where conditions.code_type = 'icd-10-cm'\n\n)\n\n, add_data_types as (\n\n    select\n          cast(patient_id as TEXT) as patient_id\n        , cast(recorded_date as date) as recorded_date\n        , cast(condition_type as TEXT) as condition_type\n        , cast(code as TEXT) as icd_10_cm_code\n        , cast(hcc_code as TEXT) as hcc_code\n        , cast(hcc_description as TEXT) as hcc_description\n        , cast(data_source as TEXT) as data_source\n    from joined\n\n)\n\nselect\n      patient_id\n    , recorded_date\n    , condition_type\n    , icd_10_cm_code\n    , hcc_code\n    , hcc_description\n    , data_source\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.hcc_suspecting._int_all_conditions"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.216787Z", "completed_at": "2024-08-23T19:21:35.226021Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.226427Z", "completed_at": "2024-08-23T19:21:35.226430Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.014135122299194336, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.chronic_conditions__tuva_chronic_conditions_wide", "compiled": true, "compiled_code": "\n\nwith patients as (\nselect distinct patient_id\nfrom dev_tom.chronic_conditions.tuva_chronic_conditions_long\n),\n\nobesity as (\nselect distinct patient_id\nfrom dev_tom.chronic_conditions.tuva_chronic_conditions_long\nwhere condition = 'Obesity'\n),\n\n\nosteoarthritis as (\nselect distinct patient_id\nfrom dev_tom.chronic_conditions.tuva_chronic_conditions_long\nwhere condition = 'Osteoarthritis'\n),\n\ncopd as (\nselect distinct patient_id\nfrom dev_tom.chronic_conditions.tuva_chronic_conditions_long\nwhere condition = 'Chronic Obstructive Pulmonary Disease'\n),\n\nanxiety_disorders as (\nselect distinct patient_id\nfrom dev_tom.chronic_conditions.tuva_chronic_conditions_long\nwhere condition = 'Anxiety Disorders'\n),\n\nckd as (\nselect distinct patient_id\nfrom dev_tom.chronic_conditions.tuva_chronic_conditions_long\nwhere condition = 'Chronic Kidney Disease'\n),\n\nt2d as (\nselect distinct patient_id\nfrom dev_tom.chronic_conditions.tuva_chronic_conditions_long\nwhere condition = 'Type 2 Diabetes Mellitus'\n),\n\ncll as (\nselect distinct patient_id\nfrom dev_tom.chronic_conditions.tuva_chronic_conditions_long\nwhere condition = 'Chronic Lymphocytic Leukemia'\n),\n\ndysplipidemias as (\nselect distinct patient_id\nfrom dev_tom.chronic_conditions.tuva_chronic_conditions_long\nwhere condition = 'Dyslipidemias'\n),\n\nhypertension as (\nselect distinct patient_id\nfrom dev_tom.chronic_conditions.tuva_chronic_conditions_long\nwhere condition = 'Hypertension'\n),\n\natherosclerosis as (\nselect distinct patient_id\nfrom dev_tom.chronic_conditions.tuva_chronic_conditions_long\nwhere condition = 'Atherosclerosis'\n),\n\ndementia as (\nselect distinct patient_id\nfrom dev_tom.chronic_conditions.tuva_chronic_conditions_long\nwhere condition = 'Dementia'\n),\n\nrheumatoid_arthritis as (\nselect distinct patient_id\nfrom dev_tom.chronic_conditions.tuva_chronic_conditions_long\nwhere condition = 'Rheumatoid Arthritis'\n),\n\nceliac as (\nselect distinct patient_id\nfrom dev_tom.chronic_conditions.tuva_chronic_conditions_long\nwhere condition = 'Celiac Disease'\n),\n\nhip_fracture as (\nselect distinct patient_id\nfrom dev_tom.chronic_conditions.tuva_chronic_conditions_long\nwhere condition = 'Hip Fracture'\n),\n\nimmunodeficiencies_and_white_blood_cell_disorders as (\nselect distinct patient_id\nfrom dev_tom.chronic_conditions.tuva_chronic_conditions_long\nwhere condition = 'Specified Immunodeficiencies and White Blood Cell Disorders  (HCC v28 concept #115)'\n),\n\nasthma as (\nselect distinct patient_id\nfrom dev_tom.chronic_conditions.tuva_chronic_conditions_long\nwhere condition = 'Asthma'\n),\n\nt1d as (\nselect distinct patient_id\nfrom dev_tom.chronic_conditions.tuva_chronic_conditions_long\nwhere condition = 'Type 1 Diabetes Mellitus'\n),\n\nulcerative_colitis as (\nselect distinct patient_id\nfrom dev_tom.chronic_conditions.tuva_chronic_conditions_long\nwhere condition = 'Ulcerative colitis'\n),\n\nchrohns as (\nselect distinct patient_id\nfrom dev_tom.chronic_conditions.tuva_chronic_conditions_long\nwhere condition = 'Crohns Disease'\n),\n\nholicobacter as (\nselect distinct patient_id\nfrom dev_tom.chronic_conditions.tuva_chronic_conditions_long\nwhere condition = 'Helicobacter pylori Infection'\n),\n\nbipolar as (\nselect distinct patient_id\nfrom dev_tom.chronic_conditions.tuva_chronic_conditions_long\nwhere condition = 'Bipolar Affective Disorder'\n),\n\nheart_failure as (\nselect distinct patient_id\nfrom dev_tom.chronic_conditions.tuva_chronic_conditions_long\nwhere condition = 'Heart Failure'\n),\n\ntabacco as (\nselect distinct patient_id\nfrom dev_tom.chronic_conditions.tuva_chronic_conditions_long\nwhere condition = 'Tobacco Use'\n),\n\nlyme as (\nselect distinct patient_id\nfrom dev_tom.chronic_conditions.tuva_chronic_conditions_long\nwhere condition = 'Lyme Disease'\n),\n\nbreast_cancer as (\nselect distinct patient_id\nfrom dev_tom.chronic_conditions.tuva_chronic_conditions_long\nwhere condition = 'Breast Cancer'\n),\n\nosteoporosis as (\nselect distinct patient_id\nfrom dev_tom.chronic_conditions.tuva_chronic_conditions_long\nwhere condition = 'Osteoporosis'\n),\n\npulmonary_embolism as (\nselect distinct patient_id\nfrom dev_tom.chronic_conditions.tuva_chronic_conditions_long\nwhere condition = 'Pulmonary Embolism, Thrombotic or Unspecified'\n),\n\nschizophrenia as (\nselect distinct patient_id\nfrom dev_tom.chronic_conditions.tuva_chronic_conditions_long\nwhere condition = 'Schizophrenia'\n),\n\natrial_fibrillation as (\nselect distinct patient_id\nfrom dev_tom.chronic_conditions.tuva_chronic_conditions_long\nwhere condition = 'Atrial Fibrillation'\n),\n\ncolorectal_cancer as (\nselect distinct patient_id\nfrom dev_tom.chronic_conditions.tuva_chronic_conditions_long\nwhere condition = 'Colorectal Cancer'\n),\n\ndepression as (\nselect distinct patient_id\nfrom dev_tom.chronic_conditions.tuva_chronic_conditions_long\nwhere condition = 'Major Depressive Disorder'\n),\n\ndeep_vein_thrombosis as (\nselect distinct patient_id\nfrom dev_tom.chronic_conditions.tuva_chronic_conditions_long\nwhere condition = 'Deep Vein Thrombosis of Extremities or Central Veins'\n),\n\nalzheimer as (\nselect distinct patient_id\nfrom dev_tom.chronic_conditions.tuva_chronic_conditions_long\nwhere condition = 'Alzheimer Disease'\n),\n\nstroke as (\nselect distinct patient_id\nfrom dev_tom.chronic_conditions.tuva_chronic_conditions_long\nwhere condition = 'Stroke'\n),\n\nmyocardial_infraction as (\nselect distinct patient_id\nfrom dev_tom.chronic_conditions.tuva_chronic_conditions_long\nwhere condition = 'Myocardial Infarction'\n),\n\nopiod_use_disorder as (\nselect distinct patient_id\nfrom dev_tom.chronic_conditions.tuva_chronic_conditions_long\nwhere condition = 'Opioid Use Disorder'\n),\n\nlung_cancer as (\nselect distinct patient_id\nfrom dev_tom.chronic_conditions.tuva_chronic_conditions_long\nwhere condition = 'Lung cancer, primary or unspecified'\n),\n\nherpes as (\nselect distinct patient_id\nfrom dev_tom.chronic_conditions.tuva_chronic_conditions_long\nwhere condition = 'Herpes Simplex Infection'\n),\n\nrickettsiosis as (\nselect distinct patient_id\nfrom dev_tom.chronic_conditions.tuva_chronic_conditions_long\nwhere condition = 'Rickettsiosis'\n),\n\nms as (\nselect distinct patient_id\nfrom dev_tom.chronic_conditions.tuva_chronic_conditions_long\nwhere condition = 'Multiple Sclerosis'\n),\n\nalchohol as (\nselect distinct patient_id\nfrom dev_tom.chronic_conditions.tuva_chronic_conditions_long\nwhere condition = 'Alcohol Use Disorder'\n),\n\nadhd as (\nselect distinct patient_id\nfrom dev_tom.chronic_conditions.tuva_chronic_conditions_long\nwhere condition = 'Attention Deficit-Hyperactivity Disorder'\n),\n\nhiv as (\nselect distinct patient_id\nfrom dev_tom.chronic_conditions.tuva_chronic_conditions_long\nwhere condition = 'HIV/AIDS  (HCC v28 concept #1)'\n),\n\nptsd as (\nselect distinct patient_id\nfrom dev_tom.chronic_conditions.tuva_chronic_conditions_long\nwhere condition = 'Post-Traumatic Stress Disorder'\n),\n\nlupus as (\nselect distinct patient_id\nfrom dev_tom.chronic_conditions.tuva_chronic_conditions_long\nwhere condition = 'Systemic Lupus Erythematosus'\n)\n\n\n\n\nselect\n  patient_id,\n  case when patient_id in (select * from obesity) then 1\n       else 0\n  end as obesity,\n  case when patient_id in (select * from osteoarthritis) then 1\n       else 0\n  end as osteoarthritis,\n  case when patient_id in (select * from copd) then 1\n       else 0\n  end as copd,\n  case when patient_id in (select * from anxiety_disorders) then 1\n       else 0\n  end as anxiety_disorders,\n  case when patient_id in (select * from ckd) then 1\n       else 0\n  end as ckd,\n  case when patient_id in (select * from t2d) then 1\n       else 0\n  end as t2d,\n  case when patient_id in (select * from cll) then 1\n       else 0\n  end as cll,\n  case when patient_id in (select * from dysplipidemias) then 1\n       else 0\n  end as dysplipidemias,\n  case when patient_id in (select * from hypertension) then 1\n       else 0\n  end as hypertension,\n  case when patient_id in (select * from atherosclerosis) then 1\n       else 0\n  end as atherosclerosis,\n  case when patient_id in (select * from dementia) then 1\n       else 0\n  end as dementia,\n  case when patient_id in (select * from rheumatoid_arthritis) then 1\n       else 0\n  end as rheumatoid_arthritis,\n  case when patient_id in (select * from celiac) then 1\n       else 0\n  end as celiac,\n  case when patient_id in (select * from hip_fracture) then 1\n       else 0\n  end as hip_fracture,\n  case when patient_id in (select * from immunodeficiencies_and_white_blood_cell_disorders) then 1\n       else 0\n  end as immunodeficiencies_and_white_blood_cell_disorders,\n  case when patient_id in (select * from asthma) then 1\n       else 0\n  end asthma,\n  case when patient_id in (select * from t1d) then 1\n       else 0\n  end as t1d,\n  case when patient_id in (select * from ulcerative_colitis) then 1\n       else 0\n  end as ulcerative_colitis,\n  case when patient_id in (select * from chrohns) then 1\n       else 0\n  end as chrohns,\n  case when patient_id in (select * from holicobacter) then 1\n       else 0\n  end as holicobacter,\n  case when patient_id in (select * from bipolar) then 1\n       else 0\n  end as bipolar,\n  case when patient_id in (select * from heart_failure) then 1\n       else 0\n  end as heart_failure,\n  case when patient_id in (select * from tabacco) then 1\n       else 0\n  end as tabacco,\n  case when patient_id in (select * from lyme) then 1\n       else 0\n  end as lyme,\n  case when patient_id in (select * from breast_cancer) then 1\n       else 0\n  end as breast_cancer,\n  case when patient_id in (select * from osteoporosis) then 1\n       else 0\n  end as osteoporosis,\n  case when patient_id in (select * from pulmonary_embolism) then 1\n       else 0\n  end as pulmonary_embolism,\n  case when patient_id in (select * from schizophrenia) then 1\n       else 0\n  end as schizophrenia,\n  case when patient_id in (select * from atrial_fibrillation) then 1\n       else 0\n  end as atrial_fibrillation,\n  case when patient_id in (select * from colorectal_cancer) then 1\n       else 0\n  end as colorectal_cancer,\n  case when patient_id in (select * from depression) then 1\n       else 0\n  end as depression,\n  case when patient_id in (select * from deep_vein_thrombosis) then 1\n       else 0\n  end as deep_vein_thrombosis,\n  case when patient_id in (select * from alzheimer) then 1\n       else 0\n  end as alzheimer,\n  case when patient_id in (select * from stroke) then 1\n       else 0\n  end as stroke,\n  case when patient_id in (select * from myocardial_infraction) then 1\n       else 0\n  end as myocardial_infraction,\n  case when patient_id in (select * from opiod_use_disorder) then 1\n       else 0\n  end as opiod_use_disorder,\n  case when patient_id in (select * from lung_cancer) then 1\n       else 0\n  end as lung_cancer,\n  case when patient_id in (select * from herpes) then 1\n       else 0\n  end as herpes,\n  case when patient_id in (select * from rickettsiosis) then 1\n       else 0\n  end as rickettsiosis,\n  case when patient_id in (select * from ms) then 1\n       else 0\n  end as ms,\n  case when patient_id in (select * from alchohol) then 1\n       else 0\n  end as alchohol,\n  case when patient_id in (select * from adhd) then 1\n       else 0\n  end as adhd,\n  case when patient_id in (select * from hiv) then 1\n       else 0\n  end as hiv,\n  case when patient_id in (select * from ptsd) then 1\n       else 0\n  end as ptsd,\n  case when patient_id in (select * from lupus) then 1\n       else 0\n  end as lupus,\n  '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\n\nfrom patients", "relation_name": "dev_tom.chronic_conditions.tuva_chronic_conditions_wide"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.223655Z", "completed_at": "2024-08-23T19:21:35.226849Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.229592Z", "completed_at": "2024-08-23T19:21:35.229595Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.013039112091064453, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.mart_review__number_of_conditions", "compiled": true, "compiled_code": "\n\nwith xwalk as (\n    select distinct patient_id, data_source\n    from dev_tom.core.patient\n),\ncte as (\n    select l.patient_id,\n           x.data_source,\n           count(*) as numofconditions\n    from dev_tom.chronic_conditions.tuva_chronic_conditions_long l\n    left join xwalk x on l.patient_id = x.patient_id\n    group by l.patient_id, x.data_source\n)\nselect p.patient_id,\n       p.data_source,\n        p.patient_id || '|' || p.data_source as patient_source_key,\n       coalesce(cte.numofconditions, 0) as numofconditions\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.patient p\nleft join cte on p.patient_id = cte.patient_id and p.data_source = cte.data_source", "relation_name": "dev_tom.data_quality.mart_review__number_of_conditions"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.227238Z", "completed_at": "2024-08-23T19:21:35.230689Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.233149Z", "completed_at": "2024-08-23T19:21:35.233152Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.00695490837097168, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.mart_review__tuva_chronic_conditions", "compiled": true, "compiled_code": "\n\nwith cte as (\n    select distinct\n        patient_id\n    from dev_tom.chronic_conditions.tuva_chronic_conditions_long\n)\n\n, patientxwalk as (\n    select distinct\n        patient_id\n      , data_source\n    from dev_tom.core.patient\n)\n\n, result as (\n    select\n        l.patient_id\n      , p.data_source\n      , l.condition\n    from dev_tom.chronic_conditions.tuva_chronic_conditions_long as l\n    inner join patientxwalk as p\n      on l.patient_id = p.patient_id\n\n    union all\n\n    select\n        p.patient_id\n      , p.data_source\n      , 'No Chronic Conditions' as condition\n    from dev_tom.core.patient as p\n    left join cte\n      on p.patient_id = cte.patient_id\n    where cte.patient_id is null\n)\n\nselect *\n   , patient_id || '|' || data_source as patient_source_key\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom result", "relation_name": "dev_tom.data_quality.mart_review__tuva_chronic_conditions"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.230851Z", "completed_at": "2024-08-23T19:21:35.252323Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.252778Z", "completed_at": "2024-08-23T19:21:35.252782Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.022947072982788086, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.the_tuva_project.dbt_utils_unique_combination_of_columns_chronic_conditions__tuva_chronic_conditions_long_patient_id__condition.9c8c725ff2", "compiled": true, "compiled_code": "\n\n\n\n\n\nwith validation_errors as (\n\n    select\n        patient_id, condition\n    from dev_tom.chronic_conditions.tuva_chronic_conditions_long\n    group by patient_id, condition\n    having count(*) > 1\n\n)\n\nselect *\nfrom validation_errors\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.233469Z", "completed_at": "2024-08-23T19:21:35.253445Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.256355Z", "completed_at": "2024-08-23T19:21:35.256358Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.025882720947265625, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.chronic_conditions__cms_chronic_conditions_oud", "compiled": true, "compiled_code": "with  __dbt__cte__cms_chronic_conditions__stg_core__condition as (\n\n\nselect\n      claim_id\n    , patient_id\n    , recorded_date\n    , normalized_code_type\n    , normalized_code\n    , data_source\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.condition\nwhere claim_id is not null\n),  __dbt__cte__cms_chronic_conditions__stg_pharmacy_claim as (\n\n\nselect\n      claim_id\n    , patient_id\n    , paid_date\n    , ndc_code\n    , data_source\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom tuva.input_layer.pharmacy_claim\n),  __dbt__cte__cms_chronic_conditions__stg_core__procedure as (\n\n\nselect\n      claim_id\n    , patient_id\n    , procedure_date\n    , normalized_code_type\n    , normalized_code\n    , data_source\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.procedure\nwhere claim_id is not null\n), chronic_conditions as (\n\n    select * from dev_tom.chronic_conditions._value_set_cms_chronic_conditions_hierarchy\n    where condition = 'Opioid Use Disorder (OUD)'\n\n)\n\n, patient_conditions as (\n\n    select\n          patient_id\n        , claim_id\n        , recorded_date as start_date\n        , normalized_code_type as code_type\n        , replace(normalized_code,'.','') as code\n        , data_source\n    from __dbt__cte__cms_chronic_conditions__stg_core__condition\n\n)\n\n, patient_medications as (\n\n    select\n          patient_id\n        , claim_id\n        , paid_date as start_date\n        , replace(ndc_code,'.','') as code\n        , data_source\n    from __dbt__cte__cms_chronic_conditions__stg_pharmacy_claim\n\n)\n\n, patient_procedures as (\n\n    select\n          patient_id\n        , claim_id\n        , procedure_date as start_date\n        , normalized_code_type as code_type\n        , replace(normalized_code,'.','') as code\n        , data_source\n    from __dbt__cte__cms_chronic_conditions__stg_core__procedure\n\n)\n\n, inclusions_diagnosis as (\n\n    select\n          patient_conditions.patient_id\n        , patient_conditions.claim_id\n        , patient_conditions.start_date\n        , patient_conditions.data_source\n        , chronic_conditions.chronic_condition_type\n        , chronic_conditions.condition_category\n        , chronic_conditions.condition\n    from patient_conditions\n         inner join chronic_conditions\n             on patient_conditions.code = chronic_conditions.code\n    where chronic_conditions.inclusion_type = 'Include'\n    and chronic_conditions.code_system = 'ICD-10-CM'\n\n)\n\n, inclusions_procedure as (\n\n    select\n          patient_procedures.patient_id\n        , patient_procedures.claim_id\n        , patient_procedures.start_date\n        , patient_procedures.data_source\n        , chronic_conditions.chronic_condition_type\n        , chronic_conditions.condition_category\n        , chronic_conditions.condition\n    from patient_procedures\n         inner join chronic_conditions\n             on patient_procedures.code = chronic_conditions.code\n    where chronic_conditions.inclusion_type = 'Include'\n    and chronic_conditions.code_system in ('ICD-10-PCS', 'HCPCS')\n\n)\n\n/*\n    Exclusion logic: Naltrexone NDCs are excluded if there is evidence of an\n    alcohol or other drug use disorder where opioid DX is not present\n\n    This CTE excludes medication encounters with the exception codes for\n    Naltrexone. Those encounters will be evaluated separately.\n*/\n, inclusions_medication as (\n\n    select\n          patient_medications.patient_id\n        , patient_medications.claim_id\n        , patient_medications.start_date\n        , patient_medications.data_source\n        , chronic_conditions.chronic_condition_type\n        , chronic_conditions.condition_category\n        , chronic_conditions.condition\n    from patient_medications\n         inner join chronic_conditions\n             on patient_medications.code = chronic_conditions.code\n    where chronic_conditions.inclusion_type = 'Include'\n    and chronic_conditions.code_system = 'NDC'\n    and chronic_conditions.code not in ('00056001122', '00056001130', '00056001170', '00056007950', '00056008050', '00185003901', '00185003930', '00406009201', '00406009203', '00406117001', '00406117003', '00555090201', '00555090202', '00904703604', '16729008101', '16729008110', '42291063230', '43063059115', '47335032683', '47335032688', '50090286600', '50436010501', '51224020630', '51224020650', '51285027501', '51285027502', '52152010502', '52152010504', '52152010530', '54868557400', '63459030042', '63629104601', '63629104701', '65694010003', '65694010010', '65757030001', '65757030202', '68084029111', '68084029121', '68094085362', '68115068030')\n\n)\n\n/*\n    Exclusion logic: Naltrexone NDCs are excluded if there is evidence of an\n    alcohol or other drug use disorder where opioid DX is not present\n\n    This CTE includes patients with evidence of the chronic conditions Alcohol\n    Use Disorders or Drug Use Disorders.\n*/\n, exclusions_other_chronic_conditions as (\n\n    select distinct patient_id\n    from dev_tom.chronic_conditions._int_cms_chronic_condition_all\n    where condition in (\n          'Alcohol Use Disorders'\n        , 'Drug Use Disorders'\n    )\n\n)\n\n/*\n    Exclusion logic: Naltrexone NDCs are excluded if there is evidence of an\n    alcohol or other drug use disorder where opioid DX is not present\n\n    This CTE creates the exclusion list which consists of patients with\n    medication encounters for Naltrexone having Alcohol Use Disorder or Drug\n    Use Disorder and missing the Opioid Use Disorder diagnosis codes.\n*/\n, exclusions_medication as (\n    select distinct\n          patient_medications.patient_id\n    from patient_medications\n         inner join chronic_conditions\n             on patient_medications.code = chronic_conditions.code\n         inner join exclusions_other_chronic_conditions\n             on patient_medications.patient_id = exclusions_other_chronic_conditions.patient_id\n         left join inclusions_diagnosis\n             on patient_medications.patient_id = inclusions_diagnosis.patient_id\n    where chronic_conditions.inclusion_type = 'Include'\n    and chronic_conditions.code_system = 'NDC'\n    and chronic_conditions.code in ('00056001122', '00056001130', '00056001170', '00056007950', '00056008050', '00185003901', '00185003930', '00406009201', '00406009203', '00406117001', '00406117003', '00555090201', '00555090202', '00904703604', '16729008101', '16729008110', '42291063230', '43063059115', '47335032683', '47335032688', '50090286600', '50436010501', '51224020630', '51224020650', '51285027501', '51285027502', '52152010502', '52152010504', '52152010530', '54868557400', '63459030042', '63629104601', '63629104701', '65694010003', '65694010010', '65757030001', '65757030202', '68084029111', '68084029121', '68094085362', '68115068030')\n    and inclusions_diagnosis.patient_id is null\n\n)\n\n\n, inclusions_unioned as (\n\n    select * from inclusions_diagnosis\n    union distinct\n    select * from inclusions_procedure\n    union distinct\n    select * from inclusions_medication\n\n)\n\n\nselect distinct\n      cast(inclusions_unioned.patient_id as TEXT) as patient_id\n    , cast(inclusions_unioned.claim_id as TEXT) as claim_id\n    , cast(inclusions_unioned.start_date as date) as start_date\n    , cast(inclusions_unioned.chronic_condition_type as TEXT) as chronic_condition_type\n    , cast(inclusions_unioned.condition_category as TEXT) as condition_category\n    , cast(inclusions_unioned.condition as TEXT) as condition\n    , cast(inclusions_unioned.data_source as TEXT) as data_source\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom inclusions_unioned\n     left join exclusions_medication\n         on inclusions_unioned.patient_id = exclusions_medication.patient_id\nwhere exclusions_medication.patient_id is null", "relation_name": "dev_tom.chronic_conditions._int_cms_chronic_condition_oud"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.253627Z", "completed_at": "2024-08-23T19:21:35.258701Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.259111Z", "completed_at": "2024-08-23T19:21:35.259114Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.006615161895751953, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.the_tuva_project.not_null_chronic_conditions__cms_chronic_conditions_all_claim_id.84015aec48", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect claim_id\nfrom dev_tom.chronic_conditions._int_cms_chronic_condition_all\nwhere claim_id is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.257102Z", "completed_at": "2024-08-23T19:21:35.259540Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.261461Z", "completed_at": "2024-08-23T19:21:35.261465Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.005334138870239258, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.the_tuva_project.not_null_chronic_conditions__cms_chronic_conditions_all_condition.bb780b4840", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect condition\nfrom dev_tom.chronic_conditions._int_cms_chronic_condition_all\nwhere condition is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.259895Z", "completed_at": "2024-08-23T19:21:35.262332Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.287967Z", "completed_at": "2024-08-23T19:21:35.287971Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.029124021530151367, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.the_tuva_project.not_null_chronic_conditions__cms_chronic_conditions_all_patient_id.95fc066008", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect patient_id\nfrom dev_tom.chronic_conditions._int_cms_chronic_condition_all\nwhere patient_id is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.262698Z", "completed_at": "2024-08-23T19:21:35.301750Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.302357Z", "completed_at": "2024-08-23T19:21:35.302360Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.040657997131347656, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_shared_exclusions_advanced_illness", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__quality_measures__stg_core__condition as (\n\nselect\n      patient_id\n    , claim_id\n    , encounter_id\n    , recorded_date\n    , source_code_type\n    , source_code\n    , normalized_code_type\n    , normalized_code\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.condition\n),  __dbt__cte__quality_measures__stg_medical_claim as (\n\n\nselect\n      patient_id\n    , claim_id\n    , claim_start_date\n    , claim_end_date\n    , place_of_service_code\n    , hcpcs_code\n    , hcpcs_modifier_1\n    , hcpcs_modifier_2\n    , hcpcs_modifier_3\n    , hcpcs_modifier_4\n    , hcpcs_modifier_5\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.medical_claim\n\n\n),  __dbt__cte__quality_measures__stg_core__procedure as (\n\nselect\n      patient_id\n    , encounter_id\n    , procedure_date\n    , source_code_type\n    , source_code\n    , normalized_code_type\n    , normalized_code\n    , modifier_1\n    , modifier_2\n    , modifier_3\n    , modifier_4\n    , modifier_5\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.procedure\n), patients_with_frailty as (\n\n    select\n          patient_id\n        , exclusion_date\n        , exclusion_reason\n    from dev_tom.quality_measures._int_shared_exclusions_frailty\n\n)\n\n, exclusion_codes as (\n\n    select\n          code\n        , code_system\n        , concept_name\n    from dev_tom.quality_measures._value_set_codes\n    where lower(concept_name) in (\n          'advanced illness'\n        , 'acute inpatient'\n        , 'encounter inpatient'\n        , 'outpatient'\n        , 'observation'\n        , 'emergency department visit'\n        , 'nonacute inpatient'\n    )\n\n)\n\n, conditions as (\n\n    select\n          patient_id\n        , claim_id\n        , recorded_date\n        , coalesce (\n              normalized_code_type\n            , case\n                when lower(source_code_type) = 'snomed' then 'snomed-ct'\n                else lower(source_code_type)\n              end\n          ) as code_type\n        , coalesce (\n              normalized_code\n            , source_code\n          ) as code\n    from __dbt__cte__quality_measures__stg_core__condition\n\n)\n\n, medical_claim as (\n\n    select\n          patient_id\n        , claim_id\n        , claim_start_date\n        , claim_end_date\n        , hcpcs_code\n        , place_of_service_code\n    from __dbt__cte__quality_measures__stg_medical_claim\n\n)\n\n, procedures as (\n\n    select\n          patient_id\n        , procedure_date\n        , coalesce (\n              normalized_code_type\n            , case\n                when lower(source_code_type) = 'cpt' then 'hcpcs'\n                when lower(source_code_type) = 'snomed' then 'snomed-ct'\n                else lower(source_code_type)\n              end\n          ) as code_type\n        , coalesce (\n              normalized_code\n            , source_code\n          ) as code\n    from __dbt__cte__quality_measures__stg_core__procedure\n\n)\n\n, condition_exclusions as (\n\n    select\n          conditions.patient_id\n        , conditions.claim_id\n        , conditions.recorded_date\n        , exclusion_codes.concept_name\n    from conditions\n         inner join exclusion_codes\n            on conditions.code = exclusion_codes.code\n            and conditions.code_type = exclusion_codes.code_system\n    where lower(exclusion_codes.concept_name) = 'advanced illness'\n\n)\n\n, med_claim_exclusions as (\n\n    select\n          medical_claim.patient_id\n        , medical_claim.claim_id\n        , medical_claim.claim_start_date\n        , medical_claim.claim_end_date\n        , medical_claim.hcpcs_code\n        , exclusion_codes.concept_name\n    from medical_claim\n         inner join exclusion_codes\n            on medical_claim.hcpcs_code = exclusion_codes.code\n    where exclusion_codes.code_system = 'hcpcs'\n\n)\n\n, procedure_exclusions as (\n\n    select\n          procedures.patient_id\n        , procedures.procedure_date\n        , exclusion_codes.concept_name\n    from procedures\n         inner join exclusion_codes\n             on procedures.code = exclusion_codes.code\n             and procedures.code_type = exclusion_codes.code_system\n\n)\n\n, acute_inpatient as (\n\n    select distinct\n          patients_with_frailty.patient_id\n        , coalesce(\n              med_claim_exclusions.claim_start_date\n            , med_claim_exclusions.claim_end_date\n          ) as exclusion_date\n        , patients_with_frailty.exclusion_reason || ' with ' || med_claim_exclusions.concept_name || ' and ' || condition_exclusions.concept_name as exclusion_reason\n        , med_claim_exclusions.claim_start_date\n        , med_claim_exclusions.claim_end_date\n        , cast(null as date) as procedure_date\n    from patients_with_frailty\n         inner join med_claim_exclusions\n            on patients_with_frailty.patient_id = med_claim_exclusions.patient_id\n         inner join condition_exclusions\n            on med_claim_exclusions.claim_id = condition_exclusions.claim_id\n    where lower(med_claim_exclusions.concept_name) = 'acute inpatient'\n\n    union all\n\n    select distinct\n          patients_with_frailty.patient_id\n        , procedure_exclusions.procedure_date as exclusion_date\n        , patients_with_frailty.exclusion_reason || ' with ' || procedure_exclusions.concept_name || ' and ' || condition_exclusions.concept_name as exclusion_reason\n        , cast(null as date) as claim_start_date\n        , cast(null as date) as claim_end_date\n        , procedure_exclusions.procedure_date\n    from patients_with_frailty\n         inner join procedure_exclusions\n         on patients_with_frailty.patient_id = procedure_exclusions.patient_id\n         inner join condition_exclusions\n         on procedure_exclusions.patient_id = condition_exclusions.patient_id\n         and procedure_exclusions.procedure_date = condition_exclusions.recorded_date\n    where lower(procedure_exclusions.concept_name) = 'acute inpatient'\n\n)\n\n, nonacute_outpatient as (\n\n    select distinct\n          patients_with_frailty.patient_id\n        , coalesce(\n              med_claim_exclusions.claim_start_date\n            , med_claim_exclusions.claim_end_date\n          ) as exclusion_date\n        , patients_with_frailty.exclusion_reason || ' with ' || med_claim_exclusions.concept_name || ' and ' || condition_exclusions.concept_name as exclusion_reason\n        , med_claim_exclusions.claim_start_date\n        , med_claim_exclusions.claim_end_date\n        , cast(null as date) as procedure_date\n    from patients_with_frailty\n         inner join med_claim_exclusions\n            on patients_with_frailty.patient_id = med_claim_exclusions.patient_id\n         inner join condition_exclusions\n            on med_claim_exclusions.claim_id = condition_exclusions.claim_id\n    where lower(med_claim_exclusions.concept_name) in (\n              'encounter inpatient'\n            , 'outpatient'\n            , 'observation'\n            , 'emergency department visit'\n            , 'nonacute inpatient'\n        )\n\n    union all\n\n    select distinct\n          patients_with_frailty.patient_id\n        , procedure_exclusions.procedure_date as exclusion_date\n        , patients_with_frailty.exclusion_reason || ' with ' || procedure_exclusions.concept_name || ' and ' || condition_exclusions.concept_name as exclusion_reason\n        , cast(null as date) as claim_start_date\n        , cast(null as date) as claim_end_date\n        , procedure_exclusions.procedure_date\n    from patients_with_frailty\n         inner join procedure_exclusions\n         on patients_with_frailty.patient_id = procedure_exclusions.patient_id\n         inner join condition_exclusions\n         on procedure_exclusions.patient_id = condition_exclusions.patient_id\n         and procedure_exclusions.procedure_date = condition_exclusions.recorded_date\n    where lower(procedure_exclusions.concept_name) in (\n          'encounter inpatient'\n        , 'outpatient'\n        , 'observation'\n        , 'emergency department visit'\n        , 'nonacute inpatient'\n    )\n\n)\n\n, exclusions_unioned as (\n\n    select\n          acute_inpatient.patient_id\n        , acute_inpatient.exclusion_date\n        , acute_inpatient.exclusion_reason\n        , acute_inpatient.claim_start_date\n        , acute_inpatient.claim_end_date\n        , acute_inpatient.procedure_date\n        , 'acute_inpatient' as patient_type\n    from acute_inpatient\n\n    union all\n\n    select\n          nonacute_outpatient.patient_id\n        , nonacute_outpatient.exclusion_date\n        , nonacute_outpatient.exclusion_reason\n        , nonacute_outpatient.claim_start_date\n        , nonacute_outpatient.claim_end_date\n        , nonacute_outpatient.procedure_date\n        , 'nonacute_outpatient' as patient_type\n    from nonacute_outpatient\n\n)\n\nselect\n      patient_id\n    , exclusion_date\n    , exclusion_reason\n    , 'advanced_illness' as exclusion_type\n    , claim_start_date\n    , claim_end_date\n    , procedure_date\n    , patient_type\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom exclusions_unioned", "relation_name": "dev_tom.quality_measures._int_shared_exclusions_advanced_illness"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.289758Z", "completed_at": "2024-08-23T19:21:35.302965Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.306778Z", "completed_at": "2024-08-23T19:21:35.306781Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.04431486129760742, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_shared_exclusions_dementia", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__quality_measures__stg_core__medication as (\n\n\nselect\n      patient_id\n    , encounter_id\n    , prescribing_date  \n    , dispensing_date\n    , source_code_type\n    , source_code\n    , ndc_code\n    , rxnorm_code\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.medication\n\n\n),  __dbt__cte__quality_measures__stg_pharmacy_claim as (\n\n\nselect\n      patient_id\n    , dispensing_date\n    , ndc_code\n    , paid_date\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.pharmacy_claim\n\n\n), patients_with_frailty as (\n\n    select\n          patient_id\n        , exclusion_date\n        , exclusion_reason\n    from dev_tom.quality_measures._int_shared_exclusions_frailty\n\n)\n\n, exclusion_codes as (\n\n    select\n          code\n        , code_system\n        , concept_name\n    from dev_tom.quality_measures._value_set_codes\n    where lower(concept_name) in (\n        'dementia medications'\n    )\n\n)\n\n, medications as (\n\n    select\n          patient_id\n        , dispensing_date\n        , source_code_type\n        , source_code\n        , ndc_code\n        , rxnorm_code\n    from __dbt__cte__quality_measures__stg_core__medication\n\n)\n\n, pharmacy_claim as (\n\n    select\n          patient_id\n        , dispensing_date\n        , ndc_code\n        , paid_date\n    from __dbt__cte__quality_measures__stg_pharmacy_claim\n\n)\n\n, medication_exclusions as (\n\n    select\n          medications.patient_id\n        , medications.dispensing_date\n        , exclusion_codes.concept_name\n    from medications\n         inner join exclusion_codes\n            on medications.ndc_code = exclusion_codes.code\n    where exclusion_codes.code_system = 'ndc'\n\n    union all\n\n    select\n          medications.patient_id\n        , medications.dispensing_date\n        , exclusion_codes.concept_name\n    from medications\n         inner join exclusion_codes\n            on medications.rxnorm_code = exclusion_codes.code\n    where exclusion_codes.code_system = 'rxnorm'\n\n    union all\n\n    select\n          medications.patient_id\n        , medications.dispensing_date\n        , exclusion_codes.concept_name\n    from medications\n         inner join exclusion_codes\n            on medications.source_code = exclusion_codes.code\n            and medications.source_code_type = exclusion_codes.code_system\n\n)\n\n, pharmacy_claim_exclusions as (\n\n    select\n          pharmacy_claim.patient_id\n        , pharmacy_claim.dispensing_date\n        , pharmacy_claim.ndc_code\n        , pharmacy_claim.paid_date\n        , exclusion_codes.concept_name\n    from pharmacy_claim\n         inner join exclusion_codes\n            on pharmacy_claim.ndc_code = exclusion_codes.code\n    where exclusion_codes.code_system = 'ndc'\n\n)\n\n, frailty_with_dementia as (\n\n    select\n          patients_with_frailty.patient_id\n        , patients_with_frailty.exclusion_date\n        , patients_with_frailty.exclusion_reason || ' with ' || pharmacy_claim_exclusions.concept_name as exclusion_reason\n        , pharmacy_claim_exclusions.dispensing_date\n        , pharmacy_claim_exclusions.paid_date\n    from patients_with_frailty\n         inner join pharmacy_claim_exclusions\n            on patients_with_frailty.patient_id = pharmacy_claim_exclusions.patient_id\n\n    union all\n\n    select\n          patients_with_frailty.patient_id\n        , medication_exclusions.dispensing_date as exclusion_date\n        , patients_with_frailty.exclusion_reason || ' with ' || medication_exclusions.concept_name as exclusion_reason\n        , medication_exclusions.dispensing_date\n        , null as paid_date\n    from patients_with_frailty\n         inner join medication_exclusions\n         on patients_with_frailty.patient_id = medication_exclusions.patient_id\n\n)\n\nselect\n      patient_id\n    , exclusion_date\n    , exclusion_reason\n    , 'dementia' as exclusion_type\n    , dispensing_date\n    , paid_date\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom frailty_with_dementia", "relation_name": "dev_tom.quality_measures._int_shared_exclusions_dementia"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.303570Z", "completed_at": "2024-08-23T19:21:35.307910Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.309926Z", "completed_at": "2024-08-23T19:21:35.309930Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.008037805557250977, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.financial_pmpm__pmpm_prep", "compiled": true, "compiled_code": "\n\nwith combine as (\nSELECT\n  a.patient_id,\n  a.year_month,\n  a.payer,\n  a.plan,\n  a.data_source,\n\n  -- service cat 1 paid\n  COALESCE(b.inpatient_paid, 0) AS inpatient_paid,\n  COALESCE(b.outpatient_paid, 0) AS outpatient_paid,\n  COALESCE(b.office_visit_paid, 0) AS office_visit_paid,\n  COALESCE(b.ancillary_paid, 0) AS ancillary_paid,\n  COALESCE(b.pharmacy_paid, 0) AS pharmacy_paid,\n  COALESCE(b.other_paid, 0) AS other_paid,\n\n  -- service cat 2 paid\n  COALESCE(c.acute_inpatient_paid, 0) AS acute_inpatient_paid,\n  COALESCE(c.ambulance_paid, 0) AS ambulance_paid,\n  COALESCE(c.ambulatory_surgery_paid, 0) AS ambulatory_surgery_paid,\n  COALESCE(c.dialysis_paid, 0) AS dialysis_paid,\n  COALESCE(c.durable_medical_equipment_paid, 0) AS durable_medical_equipment_paid,\n  COALESCE(c.emergency_department_paid, 0) AS emergency_department_paid,\n  COALESCE(c.home_health_paid, 0) AS home_health_paid,\n  COALESCE(c.hospice_paid, 0) AS hospice_paid,\n  COALESCE(c.inpatient_psychiatric_paid, 0) AS inpatient_psychiatric_paid,\n  COALESCE(c.inpatient_rehabilitation_paid, 0) AS inpatient_rehabilitation_paid,\n  COALESCE(c.lab_paid, 0) AS lab_paid,\n  COALESCE(c.office_visit_paid, 0) AS office_visit_paid_2,\n  COALESCE(c.outpatient_hospital_or_clinic_paid, 0) AS outpatient_hospital_or_clinic_paid,\n  COALESCE(c.outpatient_psychiatric_paid, 0) AS outpatient_psychiatric_paid,\n  COALESCE(c.outpatient_rehabilitation_paid, 0) AS outpatient_rehabilitation_paid,\n  COALESCE(c.skilled_nursing_paid, 0) AS skilled_nursing_paid,\n  COALESCE(c.urgent_care_paid, 0) AS urgent_care_paid,\n\n  -- service cat 1 allowed\n  COALESCE(d.inpatient_allowed, 0) AS inpatient_allowed,\n  COALESCE(d.outpatient_allowed, 0) AS outpatient_allowed,\n  COALESCE(d.office_visit_allowed, 0) AS office_visit_allowed,\n  COALESCE(d.ancillary_allowed, 0) AS ancillary_allowed,\n  COALESCE(d.pharmacy_allowed, 0) AS pharmacy_allowed,\n  COALESCE(d.other_allowed, 0) AS other_allowed,\n\n  -- service cat 2 allowed\n  COALESCE(e.acute_inpatient_allowed, 0) AS acute_inpatient_allowed,\n  COALESCE(e.ambulance_allowed, 0) AS ambulance_allowed,\n  COALESCE(e.ambulatory_surgery_allowed, 0) AS ambulatory_surgery_allowed,\n  COALESCE(e.dialysis_allowed, 0) AS dialysis_allowed,\n  COALESCE(e.durable_medical_equipment_allowed, 0) AS durable_medical_equipment_allowed,\n  COALESCE(e.emergency_department_allowed, 0) AS emergency_department_allowed,\n  COALESCE(e.home_health_allowed, 0) AS home_health_allowed,\n  COALESCE(e.hospice_allowed, 0) AS hospice_allowed,\n  COALESCE(e.inpatient_psychiatric_allowed, 0) AS inpatient_psychiatric_allowed,\n  COALESCE(e.inpatient_rehabilitation_allowed, 0) AS inpatient_rehabilitation_allowed,\n  COALESCE(e.lab_allowed, 0) AS lab_allowed,\n  COALESCE(e.office_visit_allowed, 0) AS office_visit_allowed_2,\n  COALESCE(e.outpatient_hospital_or_clinic_allowed, 0) AS outpatient_hospital_or_clinic_allowed,\n  COALESCE(e.outpatient_psychiatric_allowed, 0) AS outpatient_psychiatric_allowed,\n  COALESCE(e.outpatient_rehabilitation_allowed, 0) AS outpatient_rehabilitation_allowed,\n  COALESCE(e.skilled_nursing_allowed, 0) AS skilled_nursing_allowed,\n  COALESCE(e.urgent_care_allowed, 0) AS urgent_care_allowed\nFROM dev_tom.core.member_months a\nleft join dev_tom.financial_pmpm._int_service_category_1_paid_pivot b\n  on a.patient_id = b.patient_id\n  and a.year_month = b.year_month\n  and a.payer = b.payer\n  and a.plan = b.plan\n\nleft join dev_tom.financial_pmpm._int_service_category_2_paid_pivot c\n  on a.patient_id = c.patient_id\n  and a.year_month = c.year_month\n  and a.payer = c.payer\n  and a.plan = c.plan\n\nleft join dev_tom.financial_pmpm._int_service_category_1_allowed_pivot d\n  on a.patient_id = d.patient_id\n  and a.year_month = d.year_month\n  and a.payer = d.payer\n  and a.plan = d.plan\n\nleft join dev_tom.financial_pmpm._int_service_category_2_allowed_pivot e\n  on a.patient_id = e.patient_id\n  and a.year_month = e.year_month\n  and a.payer = e.payer\n  and a.plan = e.plan\n\n)\n\nselect *\n, inpatient_paid + outpatient_paid + office_visit_paid + ancillary_paid + other_paid + pharmacy_paid as total_paid\n, inpatient_paid + outpatient_paid + office_visit_paid + ancillary_paid + other_paid as medical_paid\n, inpatient_allowed + outpatient_allowed + office_visit_allowed + ancillary_allowed + other_allowed + pharmacy_allowed as total_allowed\n, inpatient_allowed + outpatient_allowed + office_visit_allowed + ancillary_allowed + other_allowed as medical_allowed\n, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom combine", "relation_name": "dev_tom.financial_pmpm.pmpm_prep"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.308266Z", "completed_at": "2024-08-23T19:21:35.312125Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.312510Z", "completed_at": "2024-08-23T19:21:35.312512Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.005343914031982422, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.ahrq_measures__stg_pqi_inpatient_encounter", "compiled": true, "compiled_code": "\n\nselect \n    encounter_id\n  , data_source\n  , ms_drg_code\n  , ms_drg_description\n  , admit_source_code\n  , encounter_start_date\n  , encounter_end_date\n  , length_of_stay\n  , primary_diagnosis_code\n  , patient_id\n  , facility_id\n  , paid_amount\n  , date_part('year', encounter_start_date) as year_number\nfrom\n    dev_tom.core.encounter\nwhere \n    encounter_type = 'acute inpatient'", "relation_name": "dev_tom.ahrq_measures._stg_pqi_inpatient_encounter"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.313392Z", "completed_at": "2024-08-23T19:21:35.317203Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.321802Z", "completed_at": "2024-08-23T19:21:35.321806Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.009555816650390625, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.mart_review__inpatient", "compiled": true, "compiled_code": "\n\nwith cte as (\n    select distinct\n        location_id\n      , npi\n      , name\n    from dev_tom.core.location\n)\n\n, final as (\n    select\n        e.*\n      , e.patient_id || '|' || e.data_source as patient_source_key\n      , e.encounter_id || '|' || e.data_source as encounter_source_key\n      , e.ms_drg_code || ' | ' || e.ms_drg_description as drgwithdescription\n      , e.primary_diagnosis_code || ' | ' || e.primary_diagnosis_description as primary_diagnosis_and_description\n      , e.admit_source_code || ' | ' || e.admit_source_description as admit_source_code_and_description\n      , e.admit_type_code || ' | ' || e.admit_type_description as admit_type_code_and_description\n      , e.discharge_disposition_code || ' | ' || e.discharge_disposition_description as discharge_code_and_description\n      , p.ccsr_parent_category\n      , p.ccsr_category\n      , p.ccsr_category_description\n      , p.ccsr_category || ' | ' || p.ccsr_category_description as ccsr_category_and_description\n      , b.body_system\n      , case \n            when e.length_of_stay <= 1 then '1. 0-1 day'\n            when e.length_of_stay <= 3 then '2. 2-3 days'\n            when e.length_of_stay <= 5 then '3. 4-5 days'\n            when e.length_of_stay <= 7 then '4. 6-7 days'\n            when e.length_of_stay <= 14 then '5. 8-14 days'\n            when e.length_of_stay <= 30 then '6. 15-30 days'\n        end as los_groups\n    from dev_tom.core.encounter as e\n    left join cte as l\n      on e.facility_id = l.location_id\n    left join dev_tom.ccsr.dx_vertical_pivot as p\n      on e.primary_diagnosis_code = p.code\n      and p.ccsr_category_rank = 1\n    left join dev_tom.ccsr._value_set_dxccsr_v2023_1_body_systems as b\n      on p.ccsr_parent_category = b.ccsr_parent_category\n    where e.encounter_type = 'acute inpatient'\n)\n\nselect * from final", "relation_name": "dev_tom.data_quality.mart_review__inpatient"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.325293Z", "completed_at": "2024-08-23T19:21:35.327818Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.331574Z", "completed_at": "2024-08-23T19:21:35.331578Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.007408857345581055, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.the_tuva_project.unique_core__encounter_encounter_id.d6227f8792", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    encounter_id as unique_field,\n    count(*) as n_records\n\nfrom dev_tom.core.encounter\nwhere encounter_id is not null\ngroup by encounter_id\nhaving count(*) > 1\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.328135Z", "completed_at": "2024-08-23T19:21:35.336818Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.337312Z", "completed_at": "2024-08-23T19:21:35.337316Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.010234832763671875, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.cms_hcc__int_hcc_hierarchy", "compiled": true, "compiled_code": "\n/*\n    Staging HCCs that will be used in disease factor calculations.\n    Final output for each CMS model version includes:\n        - hccs without a hierarchy\n        - lower-level hccs with hierarchy where top-level hcc is missing\n        - top-level hccs from hierarchy\n*/\n\nwith hcc_mapping as (\n\n    select distinct\n          patient_id\n        , hcc_code\n        , model_version\n        , payment_year\n    from dev_tom.cms_hcc._int_hcc_mapping\n\n)\n\n, seed_hcc_hierarchy as (\n\n    select\n          model_version\n        , hcc_code\n        , description\n        , hccs_to_exclude\n    from dev_tom.cms_hcc._value_set_disease_hierarchy\n\n)\n\n/*\n    selecting hccs that do not have a hierarchy\n    all codes in this cte are included in final output\n*/\n, hccs_without_hierarchy as (\n\n    select distinct\n          hcc_mapping.patient_id\n        , hcc_mapping.model_version\n        , hcc_mapping.payment_year\n        , hcc_mapping.hcc_code\n    from hcc_mapping\n        left join seed_hcc_hierarchy as hcc_top_level\n            on hcc_mapping.hcc_code = hcc_top_level.hcc_code\n            and hcc_mapping.model_version = hcc_top_level.model_version\n        left join seed_hcc_hierarchy as hcc_exclusions\n            on hcc_mapping.hcc_code = hcc_exclusions.hccs_to_exclude\n            and hcc_mapping.model_version = hcc_exclusions.model_version\n    where hcc_top_level.hcc_code is null\n        and hcc_exclusions.hccs_to_exclude is null\n\n)\n\n/*\n    selecting hccs that have a hierarchy to be evaluated in the next cte\n*/\n, hccs_with_hierarchy as (\n\n    select\n          hcc_mapping.patient_id\n        , hcc_mapping.model_version\n        , hcc_mapping.payment_year\n        , hcc_mapping.hcc_code\n        , seed_hcc_hierarchy.hcc_code as top_level_hcc\n    from hcc_mapping\n        inner join seed_hcc_hierarchy\n            on hcc_mapping.hcc_code = seed_hcc_hierarchy.hccs_to_exclude\n            and hcc_mapping.model_version = seed_hcc_hierarchy.model_version\n\n)\n\n/*\n    applying hcc hierarchy and grouping by patient and hcc\n    to account for multiple hcc combinations\n    minimum HCC is included following CMS's severity logic\n*/\n, hierarchy_applied as (\n\n    select\n          hccs_with_hierarchy.patient_id\n        , hccs_with_hierarchy.model_version\n        , hccs_with_hierarchy.payment_year\n        , hccs_with_hierarchy.hcc_code\n        , min(hcc_mapping.hcc_code) as top_level_hcc\n    from hccs_with_hierarchy\n        left join hcc_mapping\n            on hcc_mapping.patient_id = hccs_with_hierarchy.patient_id\n            and hcc_mapping.hcc_code = hccs_with_hierarchy.top_level_hcc\n            and hcc_mapping.model_version = hccs_with_hierarchy.model_version\n    group by\n          hccs_with_hierarchy.patient_id\n        , hccs_with_hierarchy.model_version\n        , hccs_with_hierarchy.payment_year\n        , hccs_with_hierarchy.hcc_code\n\n)\n\n/*\n    selecting lower-level hccs in hierarchy\n    all codes in this cte are included in final output\n*/\n, lower_level_inclusions as (\n\n    select distinct\n          patient_id\n        , model_version\n        , payment_year\n        , case\n            when top_level_hcc is not null then top_level_hcc\n            else hcc_code\n          end as hcc_code\n    from hierarchy_applied\n\n)\n\n/*\n    selecting top-level hccs not in previous steps\n    all codes in this cte are included in final output\n*/\n, top_level_inclusions as (\n\n    select distinct\n          hcc_mapping.patient_id\n        , hcc_mapping.model_version\n        , hcc_mapping.payment_year\n        , hcc_mapping.hcc_code\n    from hcc_mapping\n        inner join seed_hcc_hierarchy\n            on hcc_mapping.hcc_code = seed_hcc_hierarchy.hcc_code\n            and hcc_mapping.model_version = seed_hcc_hierarchy.model_version\n        left join lower_level_inclusions\n            on hcc_mapping.patient_id = lower_level_inclusions.patient_id\n            and hcc_mapping.hcc_code = lower_level_inclusions.hcc_code\n            and hcc_mapping.model_version = lower_level_inclusions.model_version\n        left join hierarchy_applied\n            on hcc_mapping.patient_id = hierarchy_applied.patient_id\n            and hcc_mapping.hcc_code = hierarchy_applied.hcc_code\n            and hcc_mapping.model_version = hierarchy_applied.model_version\n    where lower_level_inclusions.hcc_code is null\n        and hierarchy_applied.top_level_hcc is null\n\n)\n\n, unioned as (\n\n    select * from hccs_without_hierarchy\n    union all\n    select * from lower_level_inclusions\n    union all\n    select * from top_level_inclusions\n\n)\n\n, add_data_types as (\n\n    select\n          cast(patient_id as TEXT) as patient_id\n        , cast(model_version as TEXT) as model_version\n        , cast(payment_year as integer) as payment_year\n        , cast(hcc_code as TEXT) as hcc_code\n    from unioned\n\n)\n\nselect\n      patient_id\n    , model_version\n    , payment_year\n    , hcc_code\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.cms_hcc._int_hcc_hierarchy"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.331849Z", "completed_at": "2024-08-23T19:21:35.337150Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.339198Z", "completed_at": "2024-08-23T19:21:35.339201Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.011770963668823242, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.hcc_suspecting__int_patient_hcc_history", "compiled": true, "compiled_code": "\n\nwith all_conditions as (\n\n    select\n          patient_id\n        , data_source\n        , recorded_date\n        , condition_type\n        , icd_10_cm_code\n        , hcc_code\n        , hcc_description\n    from dev_tom.hcc_suspecting._int_all_conditions\n    where hcc_code is not null\n\n)\n\n, hcc_grouped as (\n\n    select\n          patient_id\n        , data_source\n        , hcc_code\n        , hcc_description\n        , min(recorded_date) as first_recorded\n        , max(recorded_date) as last_recorded\n    from all_conditions\n    where hcc_code is not null\n    group by\n          patient_id\n        , hcc_code\n        , hcc_description\n        , data_source\n\n)\n\n, hcc_billed as (\n\n    select\n          patient_id\n        , data_source\n        , hcc_code\n        , hcc_description\n        , max(recorded_date) as last_billed\n    from all_conditions\n    where hcc_code is not null\n    and lower(condition_type) <> 'problem'\n    group by\n          patient_id\n        , hcc_code\n        , hcc_description\n        , data_source\n\n)\n\n, add_flag as (\n\n    select\n          hcc_grouped.patient_id\n        , hcc_grouped.data_source\n        , hcc_grouped.hcc_code\n        , hcc_grouped.hcc_description\n        , hcc_grouped.first_recorded\n        , hcc_grouped.last_recorded\n        , hcc_billed.last_billed\n        , case\n            when date_part('year', hcc_billed.last_billed) = date_part('year', convert_timezone('UTC', current_timestamp()))\n            then 1\n            else 0\n          end as current_year_billed\n\n    from hcc_grouped\n         left join hcc_billed\n         on hcc_grouped.patient_id = hcc_billed.patient_id\n         and hcc_grouped.hcc_code = hcc_billed.hcc_code\n         and hcc_grouped.data_source = hcc_billed.data_source\n\n)\n\n, all_conditions_with_flag as (\n\n    select distinct\n          all_conditions.patient_id\n        , all_conditions.data_source\n        , all_conditions.recorded_date\n        , all_conditions.condition_type\n        , all_conditions.icd_10_cm_code\n        , all_conditions.hcc_code\n        , all_conditions.hcc_description\n        , add_flag.first_recorded\n        , add_flag.last_recorded\n        , add_flag.last_billed\n        , add_flag.current_year_billed\n        , cast('Prior coding history' as TEXT) as reason\n        , icd_10_cm_code || case when last_billed is not null then ' last billed on ' || last_billed when last_billed is null and last_recorded is not null then ' last recorded on ' || last_recorded else ' (missing recorded and billing dates) ' end as contributing_factor\n        , coalesce(last_billed, last_recorded) as condition_date\n    from all_conditions\n         left join add_flag\n            on all_conditions.patient_id = add_flag.patient_id\n            and all_conditions.hcc_code = add_flag.hcc_code\n            and all_conditions.data_source = add_flag.data_source\n\n)\n\n, add_standard_fields as (\n\n    select distinct\n          patient_id\n        , data_source\n        , recorded_date\n        , condition_type\n        , icd_10_cm_code\n        , hcc_code\n        , hcc_description\n        , first_recorded\n        , last_recorded\n        , last_billed\n        , current_year_billed\n        , 'Prior coding history' as reason\n        , icd_10_cm_code || case when last_billed is not null then ' last billed on ' || last_billed when last_billed is null and last_recorded is not null then ' last recorded on ' || last_recorded else ' (missing recorded and billing dates) ' end as contributing_factor\n        , coalesce(last_billed, last_recorded) as suspect_date\n    from all_conditions_with_flag\n\n)\n\n, add_data_types as (\n\n    select\n          cast(patient_id as TEXT) as patient_id\n        , cast(data_source as TEXT) as data_source\n        , cast(recorded_date as date) as recorded_date\n        , cast(condition_type as TEXT) as condition_type\n        , cast(icd_10_cm_code as TEXT) as icd_10_cm_code\n        , cast(hcc_code as TEXT) as hcc_code\n        , cast(hcc_description as TEXT) as hcc_description\n        , cast(first_recorded as date) as first_recorded\n        , cast(last_recorded as date) as last_recorded\n        , cast(last_billed as date) as last_billed\n        \n            , cast(current_year_billed as boolean) as current_year_billed\n        \n        , cast(reason as TEXT) as reason\n        , cast(contributing_factor as TEXT) as contributing_factor\n        , cast(suspect_date as date) as suspect_date\n    from add_standard_fields\n\n)\n\nselect\n      patient_id\n    , data_source\n    , recorded_date\n    , condition_type\n    , icd_10_cm_code\n    , hcc_code\n    , hcc_description\n    , first_recorded\n    , last_recorded\n    , last_billed\n    , current_year_billed\n    , reason\n    , contributing_factor\n    , suspect_date\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.hcc_suspecting._int_patient_hcc_history"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.337588Z", "completed_at": "2024-08-23T19:21:35.340139Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.340642Z", "completed_at": "2024-08-23T19:21:35.340644Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.004025936126708984, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.the_tuva_project.not_null_chronic_conditions__tuva_chronic_conditions_wide_patient_id.705b1ca561", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect patient_id\nfrom dev_tom.chronic_conditions.tuva_chronic_conditions_wide\nwhere patient_id is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.341080Z", "completed_at": "2024-08-23T19:21:35.345581Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.345910Z", "completed_at": "2024-08-23T19:21:35.345913Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.005970954895019531, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.the_tuva_project.unique_chronic_conditions__tuva_chronic_conditions_wide_patient_id.02386b9158", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    patient_id as unique_field,\n    count(*) as n_records\n\nfrom dev_tom.chronic_conditions.tuva_chronic_conditions_wide\nwhere patient_id is not null\ngroup by patient_id\nhaving count(*) > 1\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.342893Z", "completed_at": "2024-08-23T19:21:35.346168Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.348386Z", "completed_at": "2024-08-23T19:21:35.348389Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.008120059967041016, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.chronic_conditions__cms_chronic_conditions_long", "compiled": true, "compiled_code": "\n\n\nwith conditions_unioned as (\n\n    select * from dev_tom.chronic_conditions._int_cms_chronic_condition_all\n    union distinct\n    select * from dev_tom.chronic_conditions._int_cms_chronic_condition_hiv_aids\n    union distinct\n    select * from dev_tom.chronic_conditions._int_cms_chronic_condition_oud\n\n)\n\n\nselect\n      patient_id\n    , claim_id\n    , start_date\n    , chronic_condition_type\n    , condition_category\n    , condition\n    , data_source\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom conditions_unioned", "relation_name": "dev_tom.chronic_conditions.cms_chronic_conditions_long"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.346336Z", "completed_at": "2024-08-23T19:21:35.349092Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.349634Z", "completed_at": "2024-08-23T19:21:35.349637Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0043179988861083984, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.the_tuva_project.accepted_values_chronic_conditions__cms_chronic_conditions_oud_condition__Opioid_Use_Disorder_OUD_.f44489eec5", "compiled": true, "compiled_code": "\n    \n    \n\nwith all_values as (\n\n    select\n        condition as value_field,\n        count(*) as n_records\n\n    from dev_tom.chronic_conditions._int_cms_chronic_condition_oud\n    group by condition\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    'Opioid Use Disorder (OUD)'\n)\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.349909Z", "completed_at": "2024-08-23T19:21:35.353739Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.354116Z", "completed_at": "2024-08-23T19:21:35.354118Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.0054531097412109375, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.the_tuva_project.not_null_chronic_conditions__cms_chronic_conditions_oud_claim_id.7ee5fe28fe", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect claim_id\nfrom dev_tom.chronic_conditions._int_cms_chronic_condition_oud\nwhere claim_id is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.351980Z", "completed_at": "2024-08-23T19:21:35.355910Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.356309Z", "completed_at": "2024-08-23T19:21:35.356311Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.006891012191772461, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.the_tuva_project.not_null_chronic_conditions__cms_chronic_conditions_oud_condition.6800b245ea", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect condition\nfrom dev_tom.chronic_conditions._int_cms_chronic_condition_oud\nwhere condition is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.354390Z", "completed_at": "2024-08-23T19:21:35.356938Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.357433Z", "completed_at": "2024-08-23T19:21:35.357436Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0038940906524658203, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.the_tuva_project.not_null_chronic_conditions__cms_chronic_conditions_oud_patient_id.382354e0d0", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect patient_id\nfrom dev_tom.chronic_conditions._int_cms_chronic_condition_oud\nwhere patient_id is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.357684Z", "completed_at": "2024-08-23T19:21:35.363418Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.363762Z", "completed_at": "2024-08-23T19:21:35.363765Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.0072057247161865234, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.financial_pmpm__pmpm_payer", "compiled": true, "compiled_code": "\n\nselect\n    year_month\n  , payer\n  , data_source\n  , count(1) as member_months\n  , sum(total_paid) / count(1) as total_paid\n  , sum(medical_paid) / count(1) as medical_paid\n  , sum(inpatient_paid) / count(1) as inpatient_paid\n  , sum(outpatient_paid) / count(1) as outpatient_paid\n  , sum(office_visit_paid) / count(1) as office_visit_paid\n  , sum(ancillary_paid) / count(1) as ancillary_paid\n  , sum(pharmacy_paid) / count(1) as pharmacy_paid\n  , sum(other_paid) / count(1) as other_paid\n  , sum(acute_inpatient_paid) / count(1) as acute_inpatient_paid\n  , sum(ambulance_paid) / count(1) as ambulance_paid\n  , sum(ambulatory_surgery_paid) / count(1) as ambulatory_surgery_paid\n  , sum(dialysis_paid) / count(1) as dialysis_paid\n  , sum(durable_medical_equipment_paid) / count(1) as durable_medical_equipment_paid\n  , sum(emergency_department_paid) / count(1) as emergency_department_paid\n  , sum(home_health_paid) / count(1) as home_health_paid\n  , sum(hospice_paid) / count(1) as hospice_paid\n  , sum(inpatient_psychiatric_paid) / count(1) as inpatient_psychiatric_paid\n  , sum(inpatient_rehabilitation_paid) / count(1) as inpatient_rehabilitation_paid\n  , sum(lab_paid) / count(1) as lab_paid\n  , sum(office_visit_paid_2) / count(1) as office_visit_paid_2\n  , sum(outpatient_hospital_or_clinic_paid) / count(1) as outpatient_hospital_or_clinic_paid\n  , sum(outpatient_psychiatric_paid) / count(1) as outpatient_psychiatric_paid\n  , sum(outpatient_rehabilitation_paid) / count(1) as outpatient_rehabilitation_paid\n  , sum(skilled_nursing_paid) / count(1) as skilled_nursing_paid\n  , sum(urgent_care_paid) / count(1) as urgent_care_paid\n  , sum(total_allowed) / count(1) as total_allowed\n  , sum(medical_allowed) / count(1) as medical_allowed\n  , sum(inpatient_allowed) / count(1) as inpatient_allowed\n  , sum(outpatient_allowed) / count(1) as outpatient_allowed\n  , sum(office_visit_allowed) / count(1) as office_visit_allowed\n  , sum(ancillary_allowed) / count(1) as ancillary_allowed\n  , sum(pharmacy_allowed) / count(1) as pharmacy_allowed\n  , sum(other_allowed) / count(1) as other_allowed\n  , sum(acute_inpatient_allowed) / count(1) as acute_inpatient_allowed\n  , sum(ambulance_allowed) / count(1) as ambulance_allowed\n  , sum(ambulatory_surgery_allowed) / count(1) as ambulatory_surgery_allowed\n  , sum(dialysis_allowed) / count(1) as dialysis_allowed\n  , sum(durable_medical_equipment_allowed) / count(1) as durable_medical_equipment_allowed\n  , sum(emergency_department_allowed) / count(1) as emergency_department_allowed\n  , sum(home_health_allowed) / count(1) as home_health_allowed\n  , sum(hospice_allowed) / count(1) as hospice_allowed\n  , sum(inpatient_psychiatric_allowed) / count(1) as inpatient_psychiatric_allowed\n  , sum(inpatient_rehabilitation_allowed) / count(1) as inpatient_rehabilitation_allowed\n  , sum(lab_allowed) / count(1) as lab_allowed\n  , sum(office_visit_allowed_2) / count(1) as office_visit_allowed_2\n  , sum(outpatient_hospital_or_clinic_allowed) / count(1) as outpatient_hospital_or_clinic_allowed\n  , sum(outpatient_psychiatric_allowed) / count(1) as outpatient_psychiatric_allowed\n  , sum(outpatient_rehabilitation_allowed) / count(1) as outpatient_rehabilitation_allowed\n  , sum(skilled_nursing_allowed) / count(1) as skilled_nursing_allowed\n  , sum(urgent_care_allowed) / count(1) as urgent_care_allowed\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.financial_pmpm.pmpm_prep a\ngroup by\n  year_month\n, payer\n, data_source", "relation_name": "dev_tom.financial_pmpm.pmpm_payer"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.361037Z", "completed_at": "2024-08-23T19:21:35.364016Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.366291Z", "completed_at": "2024-08-23T19:21:35.366294Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.009067058563232422, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.financial_pmpm__pmpm_payer_plan", "compiled": true, "compiled_code": "\n\nselect\n    year_month\n  , payer\n  , plan\n  , data_source\n  , count(1) as member_months\n  , sum(total_paid) / count(1) as total_paid\n  , sum(medical_paid) / count(1) as medical_paid\n  , sum(inpatient_paid) / count(1) as inpatient_paid\n  , sum(outpatient_paid) / count(1) as outpatient_paid\n  , sum(office_visit_paid) / count(1) as office_visit_paid\n  , sum(ancillary_paid) / count(1) as ancillary_paid\n  , sum(pharmacy_paid) / count(1) as pharmacy_paid\n  , sum(other_paid) / count(1) as other_paid\n  , sum(acute_inpatient_paid) / count(1) as acute_inpatient_paid\n  , sum(ambulance_paid) / count(1) as ambulance_paid\n  , sum(ambulatory_surgery_paid) / count(1) as ambulatory_surgery_paid\n  , sum(dialysis_paid) / count(1) as dialysis_paid\n  , sum(durable_medical_equipment_paid) / count(1) as durable_medical_equipment_paid\n  , sum(emergency_department_paid) / count(1) as emergency_department_paid\n  , sum(home_health_paid) / count(1) as home_health_paid\n  , sum(hospice_paid) / count(1) as hospice_paid\n  , sum(inpatient_psychiatric_paid) / count(1) as inpatient_psychiatric_paid\n  , sum(inpatient_rehabilitation_paid) / count(1) as inpatient_rehabilitation_paid\n  , sum(lab_paid) / count(1) as lab_paid\n  , sum(office_visit_paid_2) / count(1) as office_visit_paid_2\n  , sum(outpatient_hospital_or_clinic_paid) / count(1) as outpatient_hospital_or_clinic_paid\n  , sum(outpatient_psychiatric_paid) / count(1) as outpatient_psychiatric_paid\n  , sum(outpatient_rehabilitation_paid) / count(1) as outpatient_rehabilitation_paid\n  , sum(skilled_nursing_paid) / count(1) as skilled_nursing_paid\n  , sum(urgent_care_paid) / count(1) as urgent_care_paid\n  , sum(total_allowed) / count(1) as total_allowed\n  , sum(medical_allowed) / count(1) as medical_allowed\n  , sum(inpatient_allowed) / count(1) as inpatient_allowed\n  , sum(outpatient_allowed) / count(1) as outpatient_allowed\n  , sum(office_visit_allowed) / count(1) as office_visit_allowed\n  , sum(ancillary_allowed) / count(1) as ancillary_allowed\n  , sum(pharmacy_allowed) / count(1) as pharmacy_allowed\n  , sum(other_allowed) / count(1) as other_allowed\n  , sum(acute_inpatient_allowed) / count(1) as acute_inpatient_allowed\n  , sum(ambulance_allowed) / count(1) as ambulance_allowed\n  , sum(ambulatory_surgery_allowed) / count(1) as ambulatory_surgery_allowed\n  , sum(dialysis_allowed) / count(1) as dialysis_allowed\n  , sum(durable_medical_equipment_allowed) / count(1) as durable_medical_equipment_allowed\n  , sum(emergency_department_allowed) / count(1) as emergency_department_allowed\n  , sum(home_health_allowed) / count(1) as home_health_allowed\n  , sum(hospice_allowed) / count(1) as hospice_allowed\n  , sum(inpatient_psychiatric_allowed) / count(1) as inpatient_psychiatric_allowed\n  , sum(inpatient_rehabilitation_allowed) / count(1) as inpatient_rehabilitation_allowed\n  , sum(lab_allowed) / count(1) as lab_allowed\n  , sum(office_visit_allowed_2) / count(1) as office_visit_allowed_2\n  , sum(outpatient_hospital_or_clinic_allowed) / count(1) as outpatient_hospital_or_clinic_allowed\n  , sum(outpatient_psychiatric_allowed) / count(1) as outpatient_psychiatric_allowed\n  , sum(outpatient_rehabilitation_allowed) / count(1) as outpatient_rehabilitation_allowed\n  , sum(skilled_nursing_allowed) / count(1) as skilled_nursing_allowed\n  , sum(urgent_care_allowed) / count(1) as urgent_care_allowed\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.financial_pmpm.pmpm_prep a\ngroup by\n    year_month\n  , payer\n  , plan\n  , data_source", "relation_name": "dev_tom.financial_pmpm.pmpm_payer_plan"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.364186Z", "completed_at": "2024-08-23T19:21:35.367163Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.369630Z", "completed_at": "2024-08-23T19:21:35.369633Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.006459236145019531, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.mart_review__member_months", "compiled": true, "compiled_code": "\n\nSELECT m.*,\n    COALESCE(p.total_paid, 0) AS total_paid,\n    COALESCE(p.medical_paid, 0) AS medical_paid,\n    COALESCE(p.pharmacy_paid, 0) AS pharmacy_paid,\n    m.patient_id || ' | ' || m.data_source AS patient_data_source_key,\n    m.patient_id || ' | ' || m.data_source || ' | ' || m.year_month AS member_month_key\nFROM dev_tom.core.member_months m\nLEFT JOIN dev_tom.financial_pmpm.pmpm_prep p ON m.patient_id = p.patient_id\n    AND m.data_source = p.data_source\n    AND m.year_month = p.year_month", "relation_name": "dev_tom.data_quality.mart_review__member_months"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.367506Z", "completed_at": "2024-08-23T19:21:35.372313Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.372693Z", "completed_at": "2024-08-23T19:21:35.372696Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.006125926971435547, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.the_tuva_project.dbt_utils_unique_combination_of_columns_financial_pmpm__pmpm_prep_patient_id__year_month___quote_column_plan_.be60091e23", "compiled": true, "compiled_code": "\n\n\n\n\n\nwith validation_errors as (\n\n    select\n        patient_id, year_month, plan\n    from dev_tom.financial_pmpm.pmpm_prep\n    group by patient_id, year_month, plan\n    having count(*) > 1\n\n)\n\nselect *\nfrom validation_errors\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.370322Z", "completed_at": "2024-08-23T19:21:35.374845Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.375253Z", "completed_at": "2024-08-23T19:21:35.375256Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.007962942123413086, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.ahrq_measures__int_pqi_shared_exclusion_missing_dates", "compiled": true, "compiled_code": "\n-- Exclude encounters with missing start dates\nselect\n    encounter_id\n  , data_source\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ahrq_measures._stg_pqi_inpatient_encounter\nwhere \n  encounter_start_date is null", "relation_name": "dev_tom.ahrq_measures._int_pqi_shared_exclusion_missing_dates"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.372974Z", "completed_at": "2024-08-23T19:21:35.375905Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.376425Z", "completed_at": "2024-08-23T19:21:35.376428Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0043179988861083984, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.ahrq_measures__int_pqi_shared_exclusion_missing_primary_dx", "compiled": true, "compiled_code": "\n\n-- Exclude encounters with missing primary diagnosis code\nselect \n    encounter_id\n  , data_source\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ahrq_measures._stg_pqi_inpatient_encounter\nwhere \n  primary_diagnosis_code is null", "relation_name": "dev_tom.ahrq_measures._int_pqi_shared_exclusion_missing_primary_dx"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.376698Z", "completed_at": "2024-08-23T19:21:35.380860Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.381214Z", "completed_at": "2024-08-23T19:21:35.381217Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.005708932876586914, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.ahrq_measures__int_pqi_shared_exclusion_transfer", "compiled": true, "compiled_code": "\n\n-- Exclude transfers from hospital, SNF, or other healthcare facility\nselect \n    encounter_id\n  , data_source\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ahrq_measures._stg_pqi_inpatient_encounter\nwhere \n  admit_source_code in ('4', '5', '6')", "relation_name": "dev_tom.ahrq_measures._int_pqi_shared_exclusion_transfer"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.378874Z", "completed_at": "2024-08-23T19:21:35.381470Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.390851Z", "completed_at": "2024-08-23T19:21:35.390854Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.01464080810546875, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.ahrq_measures__int_pqi_shared_exclusion_ungroupable_drg", "compiled": true, "compiled_code": "\n\n-- Exclude encounters with ungroupable DRG\nselect \n    encounter_id\n  , data_source\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ahrq_measures._stg_pqi_inpatient_encounter\nwhere \n  ms_drg_code = '999'", "relation_name": "dev_tom.ahrq_measures._int_pqi_shared_exclusion_ungroupable_drg"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.381637Z", "completed_at": "2024-08-23T19:21:35.391578Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.392077Z", "completed_at": "2024-08-23T19:21:35.392080Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.011456966400146484, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.ed_classification__int_map_primary_dx", "compiled": true, "compiled_code": "/*\nAll condition discharge diagnosis left join with probabilistic\nindicators of ED classification terminology\n*/\n\n\n\n\nwith  __dbt__cte__ed_classification__stg_encounter as (\n\n\nselect\n    encounter_id\n    , encounter_type\n    , patient_id\n    , encounter_end_date\n    , facility_id\n    , primary_diagnosis_code_type\n    , primary_diagnosis_code\n    , primary_diagnosis_description\n    , paid_amount\n    , allowed_amount\n    , charge_amount\nfrom dev_tom.core.encounter\n), condition as (\n    select * \n    from __dbt__cte__ed_classification__stg_encounter\n    where encounter_type = 'emergency department'\n)\n, icd9 as (\n  select\n     icd9 as code\n     \n     , edcnnpa\n     \n     , edcnpa\n     \n     , epct\n     \n     , noner\n     \n     , injury\n     \n     , psych\n     \n     , alcohol\n     \n     , drug\n     \n     , 1 as ed_classification_capture\n  from dev_tom.ed_classification._value_set_johnston_icd9\n)\n, icd10 as (\n  select\n     icd10 as code\n     \n     , edcnnpa\n     \n     , edcnpa\n     \n     , epct\n     \n     , noner\n     \n     , injury\n     \n     , psych\n     \n     , alcohol\n     \n     , drug\n     \n     , 1 as ed_classification_capture\n  from dev_tom.ed_classification._value_set_johnston_icd10\n)\n\nselect\n   a.*\n   \n   , icd10.edcnnpa\n   \n   , icd10.edcnpa\n   \n   , icd10.epct\n   \n   , icd10.noner\n   \n   , icd10.injury\n   \n   , icd10.psych\n   \n   , icd10.alcohol\n   \n   , icd10.drug\n   \n   , coalesce(icd10.ed_classification_capture, 0) as ed_classification_capture\nfrom condition a\nleft join icd10\n    on a.primary_diagnosis_code = icd10.code \n    and a.primary_diagnosis_code_type = 'icd-10-cm'\n\nunion all\n\nselect\n   a.*\n   \n   , icd9.edcnnpa\n   \n   , icd9.edcnpa\n   \n   , icd9.epct\n   \n   , icd9.noner\n   \n   , icd9.injury\n   \n   , icd9.psych\n   \n   , icd9.alcohol\n   \n   , icd9.drug\n   \n   , coalesce(icd9.ed_classification_capture, 0) ed_classification_capture\nfrom condition a\ninner join icd9\n    on a.primary_diagnosis_code = icd9.code \n    and a.primary_diagnosis_code_type = 'icd-9-cm'", "relation_name": "dev_tom.ed_classification._int_by_provider_parent_organization"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.392346Z", "completed_at": "2024-08-23T19:21:35.444405Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.444748Z", "completed_at": "2024-08-23T19:21:35.444752Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.053617000579833984, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_cbe0055_denominator", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__quality_measures__stg_core__encounter as (\n\n\nselect\n      patient_id\n    , encounter_id\n    , encounter_type\n    , length_of_stay\n    , encounter_start_date\n    , encounter_end_date\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.encounter\n\n\n),  __dbt__cte__quality_measures__stg_core__procedure as (\n\nselect\n      patient_id\n    , encounter_id\n    , procedure_date\n    , source_code_type\n    , source_code\n    , normalized_code_type\n    , normalized_code\n    , modifier_1\n    , modifier_2\n    , modifier_3\n    , modifier_4\n    , modifier_5\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.procedure\n),  __dbt__cte__quality_measures__stg_medical_claim as (\n\n\nselect\n      patient_id\n    , claim_id\n    , claim_start_date\n    , claim_end_date\n    , place_of_service_code\n    , hcpcs_code\n    , hcpcs_modifier_1\n    , hcpcs_modifier_2\n    , hcpcs_modifier_3\n    , hcpcs_modifier_4\n    , hcpcs_modifier_5\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.medical_claim\n\n\n),  __dbt__cte__quality_measures__stg_core__condition as (\n\nselect\n      patient_id\n    , claim_id\n    , encounter_id\n    , recorded_date\n    , source_code_type\n    , source_code\n    , normalized_code_type\n    , normalized_code\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.condition\n),  __dbt__cte__quality_measures__stg_core__patient as (\n\nselect\n      patient_id\n    , sex\n    , birth_date\n    , death_date\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.patient\n), visit_codes as (\n\n    select\n          code\n        , code_system\n    from dev_tom.quality_measures._value_set_codes\n    where lower(concept_name) in (\n          'office visit'\n        , 'home healthcare services'\n        , 'preventive care services established office visit, 18 and up'        \n        , 'preventive care services initial office visit, 18 and up'\n        , 'annual wellness visit'\n        , 'telephone visits'\n        , 'outpatient'\n        , 'observation'\n        , 'diabetes visit'\n        , 'ophthalmological services'\n        , 'diabetic retinopathy'\n    )\n\n)\n\n, visits_encounters as (\n\n    select patient_id\n         , coalesce(encounter.encounter_start_date,encounter.encounter_end_date) as min_date\n         , coalesce(encounter.encounter_end_date,encounter.encounter_start_date) as max_date\n    from __dbt__cte__quality_measures__stg_core__encounter encounter\n    inner join dev_tom.quality_measures._int_cbe0055__performance_period as pp\n        on coalesce(encounter.encounter_end_date,encounter.encounter_start_date) >= pp.performance_period_begin\n        and  coalesce(encounter.encounter_start_date,encounter.encounter_end_date) <= pp.performance_period_end\n    where lower(encounter_type) in (\n          'home health'\n        , 'office visit'\n        , 'outpatient'\n        , 'outpatient rehabilitation'\n        , 'telehealth'\n     )\n\n)\n\n, procedure_encounters as (\n\n    select \n          patient_id\n        , procedure_date as min_date\n        , procedure_date as max_date\n        from __dbt__cte__quality_measures__stg_core__procedure procs\n    inner join dev_tom.quality_measures._int_cbe0055__performance_period  as pp\n        on procedure_date between pp.performance_period_begin and  pp.performance_period_end\n    inner join visit_codes\n            on coalesce(procs.normalized_code,procs.source_code) = visit_codes.code\n\n)\n\n, claims_encounters as (\n    \n    select patient_id\n    , coalesce(claim_start_date,claim_end_date) as min_date\n    , coalesce(claim_end_date,claim_start_date) as max_date\n    from __dbt__cte__quality_measures__stg_medical_claim medical_claim\n    inner join dev_tom.quality_measures._int_cbe0055__performance_period  as pp on\n        coalesce(claim_end_date,claim_start_date)  >=  pp.performance_period_begin\n         and coalesce(claim_start_date,claim_end_date) <=  pp.performance_period_end\n    inner join  visit_codes\n        on medical_claim.hcpcs_code= visit_codes.code\n\n)\n\n, all_encounters as (\n\n    select *, 'v' as visit_enc,cast(null as TEXT) as proc_enc, cast(null as TEXT) as claim_enc\n    from visits_encounters\n\n    union all\n\n    select *, cast(null as TEXT) as visit_enc, 'p' as proc_enc, cast(null as TEXT) as claim_enc\n    from procedure_encounters\n\n    union all\n    \n    select *, cast(null as TEXT) as visit_enc,cast(null as TEXT) as proc_enc, 'c' as claim_enc\n    from claims_encounters\n\n)\n\n, encounters_by_patient as (\n\n    select patient_id,min(min_date) min_date, max(max_date) max_date,\n        concat(concat(\n            coalesce(min(visit_enc),'')\n            ,coalesce(min(proc_enc),''))\n            ,coalesce(min(claim_enc),'')\n            ) as qualifying_types\n    from all_encounters\n    group by patient_id\n\n)\n\n, diabetics_codes as (\n\n    select\n          code\n        , code_system\n    from dev_tom.quality_measures._value_set_codes\n    where lower(concept_name) in (\n          'diabetes'\n        )\n\n)\n\n, conditions as (\n\n    select\n          patient_id\n        , claim_id\n        , encounter_id\n        , recorded_date\n        , source_code\n        , source_code_type\n        , normalized_code\n        , normalized_code_type\n    from __dbt__cte__quality_measures__stg_core__condition\n\n)\n\n, diabetic_conditions as (\n\n    select\n          conditions.patient_id\n        , conditions.claim_id\n        , conditions.encounter_id\n        , conditions.recorded_date\n        , conditions.source_code\n        , conditions.source_code_type\n    from conditions\n    inner join diabetics_codes\n        on coalesce(conditions.normalized_code_type, conditions.source_code_type) = diabetics_codes.code_system\n            and coalesce(conditions.normalized_code, conditions.source_code) = diabetics_codes.code\n\n)\n\n, patients_with_age as (\n\n    select\n          p.patient_id\n        , min_date\n        , floor(datediff(\n        hour,\n        birth_date,\n        e.min_date\n        ) / 8760.0)  as min_age\n        , max_date\n        , floor(datediff(\n        hour,\n        birth_date,\n        e.max_date\n        ) / 8760.0) as max_age\n        , qualifying_types\n    from __dbt__cte__quality_measures__stg_core__patient p\n    inner join encounters_by_patient e\n        on p.patient_id = e.patient_id\n    where p.death_date is null\n\n)\n\n, qualifying_patients as (\n\n    select\n        distinct\n          diabetic_conditions.patient_id\n        , patients_with_age.max_age as age\n        , pp.performance_period_begin\n        , pp.performance_period_end\n        , pp.measure_id\n        , pp.measure_name\n        , pp.measure_version\n        , 1 as denominator_flag\n    from diabetic_conditions\n    left join patients_with_age\n        on diabetic_conditions.patient_id = patients_with_age.patient_id\n    cross join dev_tom.quality_measures._int_cbe0055__performance_period pp\n    where max_age >= 18 and min_age <=  75\n\n)\n\n, add_data_types as (\n\n    select\n          cast(patient_id as TEXT) as patient_id\n        , cast(age as integer) as age\n        , cast(performance_period_begin as date) as performance_period_begin\n        , cast(performance_period_end as date) as performance_period_end\n        , cast(measure_id as TEXT) as measure_id\n        , cast(measure_name as TEXT) as measure_name\n        , cast(measure_version as TEXT) as measure_version\n        , cast(denominator_flag as integer) as denominator_flag\n    from qualifying_patients\n\n)\n\nselect \n      patient_id\n    , age\n    , performance_period_begin\n    , performance_period_end\n    , measure_id\n    , measure_name\n    , measure_version\n    , denominator_flag\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.quality_measures._int_cbe0055_denominator"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.416067Z", "completed_at": "2024-08-23T19:21:35.445214Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.471070Z", "completed_at": "2024-08-23T19:21:35.471073Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.0792078971862793, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_cbe0101_denominator", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__quality_measures__stg_core__procedure as (\n\nselect\n      patient_id\n    , encounter_id\n    , procedure_date\n    , source_code_type\n    , source_code\n    , normalized_code_type\n    , normalized_code\n    , modifier_1\n    , modifier_2\n    , modifier_3\n    , modifier_4\n    , modifier_5\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.procedure\n),  __dbt__cte__quality_measures__stg_medical_claim as (\n\n\nselect\n      patient_id\n    , claim_id\n    , claim_start_date\n    , claim_end_date\n    , place_of_service_code\n    , hcpcs_code\n    , hcpcs_modifier_1\n    , hcpcs_modifier_2\n    , hcpcs_modifier_3\n    , hcpcs_modifier_4\n    , hcpcs_modifier_5\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.medical_claim\n\n\n),  __dbt__cte__quality_measures__stg_core__encounter as (\n\n\nselect\n      patient_id\n    , encounter_id\n    , encounter_type\n    , length_of_stay\n    , encounter_start_date\n    , encounter_end_date\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.encounter\n\n\n),  __dbt__cte__quality_measures__stg_core__patient as (\n\nselect\n      patient_id\n    , sex\n    , birth_date\n    , death_date\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.patient\n), visit_codes as (\n\n    select\n          code\n        , code_system\n    from dev_tom.quality_measures._value_set_codes\n    where lower(concept_name) in (\n          'annual wellness visit'\n        , 'audiology visit'\n        , 'home healthcare services'\n        , 'nursing facility visit'\n        , 'occupational therapy evaluation'\n        , 'office visit'\n        , 'physical therapy evaluation'\n        , 'online assessments'\n        , 'telephone visits'  \n        , 'care services in long term residential facility'\n        , 'discharge services nursing facility'\n        , 'encounter inpatient'\n        , 'ophthalmological services'\n        , 'preventive care services established office visit, 18 and up'\n        , 'preventive care services individual counseling'\n        , 'preventive care services initial office visit, 18 and up'\n    )\n\n)\n\n, procedures as (\n\n    select\n        patient_id\n      , procedure_date\n      , coalesce (\n              normalized_code_type\n            , case\n                when lower(source_code_type) = 'cpt' then 'hcpcs'\n                when lower(source_code_type) = 'snomed' then 'snomed-ct'\n                else lower(source_code_type)\n              end\n          ) as code_type\n        , coalesce (\n              normalized_code\n            , source_code\n          ) as code\n    from __dbt__cte__quality_measures__stg_core__procedure\n\n)\n\n, medical_claim as (\n    \n    select\n          patient_id\n        , claim_start_date\n        , claim_end_date\n        , hcpcs_code\n    from __dbt__cte__quality_measures__stg_medical_claim\n\n)\n\n, visits_encounters as (\n\n    select patient_id\n         , coalesce(encounter.encounter_start_date,encounter.encounter_end_date) as min_date\n         , coalesce(encounter.encounter_end_date,encounter.encounter_start_date) as max_date\n    from __dbt__cte__quality_measures__stg_core__encounter encounter\n    inner join dev_tom.quality_measures._int_cbe0101__performance_period as pp\n        on coalesce(encounter.encounter_end_date,encounter.encounter_start_date) >= pp.performance_period_begin\n            and  coalesce(encounter.encounter_start_date,encounter.encounter_end_date) <= pp.performance_period_end\n    where lower(encounter_type) in (\n          'home health'\n        , 'office visit'\n        , 'outpatient'\n        , 'outpatient rehabilitation'\n        , 'telehealth'\n    )\n\n)\n\n, procedure_encounters as (\n\n    select \n          patient_id\n        , procedure_date as min_date\n        , procedure_date as max_date\n    from procedures\n    inner join dev_tom.quality_measures._int_cbe0101__performance_period  as pp\n        on procedure_date between pp.performance_period_begin and  pp.performance_period_end\n    inner join visit_codes\n        on procedures.code = visit_codes.code\n\n)\n\n, claims_encounters as (\n    \n    select \n          patient_id\n        , coalesce(claim_start_date,claim_end_date) as min_date\n        , coalesce(claim_end_date,claim_start_date) as max_date\n    from medical_claim\n    inner join dev_tom.quality_measures._int_cbe0101__performance_period  as pp \n        on coalesce(claim_end_date,claim_start_date)  >=  pp.performance_period_begin\n            and coalesce(claim_start_date,claim_end_date) <=  pp.performance_period_end\n    inner join visit_codes\n        on medical_claim.hcpcs_code = visit_codes.code\n\n)\n\n, all_encounters as (\n\n    select *, 'v' as visit_enc, cast(null as TEXT) as proc_enc, cast(null as TEXT) as claim_enc\n    from visits_encounters\n\n    union all\n\n    select *, cast(null as TEXT) as visit_enc, 'p' as proc_enc, cast(null as TEXT) as claim_enc\n    from procedure_encounters\n\n    union all\n    \n    select *, cast(null as TEXT) as visit_enc, cast(null as TEXT) as proc_enc, 'c' as claim_enc\n    from claims_encounters\n\n)\n\n, encounters_by_patient as (\n\n    select patient_id, min(min_date) min_date, max(max_date) max_date,\n        concat(concat(\n              coalesce(min(visit_enc),'')\n            , coalesce(min(proc_enc),''))\n            , coalesce(min(claim_enc),'')\n            ) as qualifying_types\n    from all_encounters\n    group by patient_id\n\n)\n\n, patients_with_age as (\n\n    select\n          p.patient_id\n        , min_date\n        , floor(datediff(\n        hour,\n        birth_date,\n        e.max_date\n        ) / 8760.0) as age\n        , max_date\n        , qualifying_types\n    from __dbt__cte__quality_measures__stg_core__patient p\n    inner join encounters_by_patient e\n        on p.patient_id = e.patient_id\n    where p.death_date is null\n\n)\n\n, falls_screening_code as (\n\n    select\n          code\n        , code_system\n    from dev_tom.quality_measures._value_set_codes\n    where code = '1100F'\n    /* \n        Patient screened for future fall risk; documentation of two or more falls in the past year \n        or any fall with injury in the past year\n    */\n)\n\n, qualifying_procedures as (\n\n    select\n          patient_id\n        , procedure_date as evidence_date\n    from procedures\n    inner join falls_screening_code\n        on procedures.code = falls_screening_code.code\n            and procedures.code_type = falls_screening_code.code_system\n            \n)\n\n, qualifying_claims as (\n\n    select\n          patient_id\n        , coalesce(claim_end_date, claim_start_date) as evidence_date\n    from medical_claim\n    inner join falls_screening_code\n        on medical_claim.hcpcs_code = falls_screening_code.code\n            and lower(falls_screening_code.code_system) = 'hcpcs'\n\n)\n\n, qualifying_cares as (\n\n    select\n          patient_id\n        , evidence_date\n    from qualifying_procedures\n\n    union all\n\n    select\n          patient_id\n        , evidence_date\n    from qualifying_claims\n\n)\n\n, qualifying_cares_past_year as (\n\n    select\n          patient_id\n        , evidence_date\n        , pp.performance_period_begin\n        , pp.performance_period_end\n        , pp.measure_id\n        , pp.measure_name\n        , pp.measure_version\n    from qualifying_cares\n    inner join dev_tom.quality_measures._int_cbe0101__performance_period pp\n        on evidence_date between pp.performance_period_begin and pp.performance_period_end \n    /*  \n        code 1100F is reported if there are two or more falls in the last year itself,\n        so if it's reported in performance year, it indicates the falls in the last year\n    */\n\n)\n\n, qualifying_patients as (\n\n    select\n          qualifying_cares_past_year.patient_id\n        , patients_with_age.age\n        , max_date as encounter_date\n        , qualifying_cares_past_year.performance_period_begin\n        , qualifying_cares_past_year.performance_period_end\n        , qualifying_cares_past_year.measure_id\n        , qualifying_cares_past_year.measure_name\n        , qualifying_cares_past_year.measure_version\n        , 1 as denominator_flag\n    from qualifying_cares_past_year\n    left join patients_with_age\n        on qualifying_cares_past_year.patient_id = patients_with_age.patient_id\n    where age >= 65\n\n)\n\n\n, add_data_types as (\n\n    select distinct\n          cast(patient_id as TEXT) as patient_id\n        , cast(age as integer) as age\n        , cast(encounter_date as date) as encounter_date\n        , cast(performance_period_begin as date) as performance_period_begin\n        , cast(performance_period_end as date) as performance_period_end\n        , cast(measure_id as TEXT) as measure_id\n        , cast(measure_name as TEXT) as measure_name\n        , cast(measure_version as TEXT) as measure_version\n        , cast(denominator_flag as integer) as denominator_flag\n    from qualifying_patients\n\n)\n\nselect \n      patient_id\n    , age\n    , encounter_date\n    , performance_period_begin\n    , performance_period_end\n    , measure_id\n    , measure_name\n    , measure_version\n    , denominator_flag\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.quality_measures._int_cbe0101_denominator"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.445370Z", "completed_at": "2024-08-23T19:21:35.472736Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.498088Z", "completed_at": "2024-08-23T19:21:35.498094Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.05391526222229004, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_cqm236_denominator", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__quality_measures__stg_core__encounter as (\n\n\nselect\n      patient_id\n    , encounter_id\n    , encounter_type\n    , length_of_stay\n    , encounter_start_date\n    , encounter_end_date\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.encounter\n\n\n),  __dbt__cte__quality_measures__stg_core__procedure as (\n\nselect\n      patient_id\n    , encounter_id\n    , procedure_date\n    , source_code_type\n    , source_code\n    , normalized_code_type\n    , normalized_code\n    , modifier_1\n    , modifier_2\n    , modifier_3\n    , modifier_4\n    , modifier_5\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.procedure\n),  __dbt__cte__quality_measures__stg_medical_claim as (\n\n\nselect\n      patient_id\n    , claim_id\n    , claim_start_date\n    , claim_end_date\n    , place_of_service_code\n    , hcpcs_code\n    , hcpcs_modifier_1\n    , hcpcs_modifier_2\n    , hcpcs_modifier_3\n    , hcpcs_modifier_4\n    , hcpcs_modifier_5\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.medical_claim\n\n\n),  __dbt__cte__quality_measures__stg_core__condition as (\n\nselect\n      patient_id\n    , claim_id\n    , encounter_id\n    , recorded_date\n    , source_code_type\n    , source_code\n    , normalized_code_type\n    , normalized_code\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.condition\n),  __dbt__cte__quality_measures__stg_core__patient as (\n\nselect\n      patient_id\n    , sex\n    , birth_date\n    , death_date\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.patient\n), visit_codes as (\n\n    select\n          code\n        , code_system\n    from dev_tom.quality_measures._value_set_codes\n    where lower(concept_name) in (\n          'office visit'\n        , 'home healthcare services'\n        , 'preventive care services established office visit, 18 and up'\n        , 'preventive care services initial office visit, 18 and up'\n        , 'annual wellness visit'\n        , 'telephone visits'\n        , 'emergency department evaluation and management visit'\n    )\n\n)\n\n, visits_encounters as (\n\n    select \n           patient_id\n         , coalesce(encounter.encounter_start_date,encounter.encounter_end_date) as min_date\n         , coalesce(encounter.encounter_end_date,encounter.encounter_start_date) as max_date\n    from __dbt__cte__quality_measures__stg_core__encounter encounter\n    inner join dev_tom.quality_measures._int_cqm236__performance_period as pp\n        on coalesce(encounter.encounter_end_date,encounter.encounter_start_date) >= pp.performance_period_begin\n        and  coalesce(encounter.encounter_start_date,encounter.encounter_end_date) <= pp.performance_period_end\n    where lower(encounter_type) in (\n          'home health'\n        , 'outpatient'\n        , 'nonacute inpatient'\n        , 'encounter inpatient'\n        , 'acute_inpatient'\n        , 'emergency_department'\n    )\n\n)\n\n, procedure_encounters as (\n\n    select \n          patient_id\n        , procedure_date as min_date\n        , procedure_date as max_date\n        from __dbt__cte__quality_measures__stg_core__procedure procs\n    inner join dev_tom.quality_measures._int_cqm236__performance_period  as pp\n        on procedure_date between pp.performance_period_begin and  pp.performance_period_end\n    inner join visit_codes\n            on coalesce(procs.normalized_code,procs.source_code) = visit_codes.code\n\n)\n\n, claims_encounters as (\n\n    select \n          patient_id\n        , coalesce(claim_start_date,claim_end_date) as min_date\n        , coalesce(claim_end_date,claim_start_date) as max_date\n    from __dbt__cte__quality_measures__stg_medical_claim medical_claim\n    inner join dev_tom.quality_measures._int_cqm236__performance_period  as pp on\n        coalesce(claim_end_date,claim_start_date)  >=  pp.performance_period_begin\n         and coalesce(claim_start_date,claim_end_date) <=  pp.performance_period_end\n    inner join visit_codes\n        on medical_claim.hcpcs_code= visit_codes.code\n\n)\n\n, all_encounters as (\n\n    select *, 'v' as visit_enc,cast(null as TEXT) as proc_enc, cast(null as TEXT) as claim_enc\n    from visits_encounters\n    union all\n    select *, cast(null as TEXT) as visit_enc, 'p' as proc_enc, cast(null as TEXT) as claim_enc\n    from procedure_encounters\n    union all\n    select *, cast(null as TEXT) as visit_enc,cast(null as TEXT) as proc_enc, 'c' as claim_enc\n    from claims_encounters\n\n)\n\n, encounters_by_patient as (\n\n    select\n          patient_id\n        , min(min_date) min_date\n        , max(max_date) max_date\n        , concat(concat(\n            coalesce(min(visit_enc),'')\n            ,coalesce(min(proc_enc),''))\n            ,coalesce(min(claim_enc),'')\n            ) as qualifying_types\n    from all_encounters\n    group by patient_id\n\n)\n\n, hypertension_codes as (\n\n    select\n          code\n        , code_system\n    from dev_tom.quality_measures._value_set_codes\n    where lower(concept_name) in (\n          'essential hypertension'\n    )\n\n)\n\n, conditions as (\n\n    select\n          patient_id\n        , claim_id\n        , encounter_id\n        , recorded_date\n        , source_code\n        , source_code_type\n        , normalized_code\n        , normalized_code_type\n    from __dbt__cte__quality_measures__stg_core__condition\n\n)\n\n, hypertension_conditions as (\n\n    select\n          conditions.patient_id\n        , conditions.claim_id\n        , conditions.encounter_id\n        , conditions.recorded_date\n        , conditions.source_code\n        , conditions.source_code_type\n    from conditions\n    inner join hypertension_codes\n        on coalesce(conditions.normalized_code_type, conditions.source_code_type) = hypertension_codes.code_system\n            and coalesce(conditions.normalized_code, conditions.source_code) = hypertension_codes.code\n\n)\n\n, patients_with_age as (\n    \n    select\n          p.patient_id\n        , min_date\n        , floor(datediff(\n        hour,\n        birth_date,\n        e.min_date\n        ) / 8760.0)  as min_age\n        , max_date\n        , floor(datediff(\n        hour,\n        birth_date,\n        e.max_date\n        ) / 8760.0) as max_age\n        , qualifying_types\n    from __dbt__cte__quality_measures__stg_core__patient p\n    inner join encounters_by_patient e\n        on p.patient_id = e.patient_id\n    where p.death_date is null\n\n)\n\n-- Patients 18-85 years of age who had a visit and diagnosis of essential hypertension starting before and continuing into, or starting during the first six months of the measurement period.\n, qualifying_patients as (\n\n    select\n        distinct\n          hypertension_conditions.patient_id\n        , hypertension_conditions.recorded_date\n        , patients_with_age.max_age as age\n        , pp.performance_period_begin\n        , pp.performance_period_end\n        , pp.measure_id\n        , pp.measure_name\n        , pp.measure_version\n        , 1 as denominator_flag\n    from hypertension_conditions\n    left join patients_with_age\n        on hypertension_conditions.patient_id = patients_with_age.patient_id\n    cross join dev_tom.quality_measures._int_cqm236__performance_period pp\n    where max_age >= 18 and min_age <=  85\n        and hypertension_conditions.recorded_date between\n            \n\n    dateadd(\n        month,\n        -12,\n        performance_period_begin\n        )\n\n\n            and \n            \n\n    dateadd(\n        month,\n        6,\n        performance_period_begin\n        )\n\n\n\n)\n\n, add_data_types as (\n\n    select\n          cast(patient_id as TEXT) as patient_id\n        , cast(age as integer) as age\n        , cast(performance_period_begin as date) as performance_period_begin\n        , cast(performance_period_end as date) as performance_period_end\n        , cast(measure_id as TEXT) as measure_id\n        , cast(measure_name as TEXT) as measure_name\n        , cast(measure_version as TEXT) as measure_version\n        , cast(denominator_flag as integer) as denominator_flag\n    from qualifying_patients\n\n)\n\nselect \n      patient_id\n    , age\n    , performance_period_begin\n    , performance_period_end\n    , measure_id\n    , measure_name\n    , measure_version\n    , denominator_flag\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.quality_measures._int_cqm236_denominator"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.473207Z", "completed_at": "2024-08-23T19:21:35.515040Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.525393Z", "completed_at": "2024-08-23T19:21:35.525397Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.05409693717956543, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_cqm438_denominator", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__quality_measures__stg_core__encounter as (\n\n\nselect\n      patient_id\n    , encounter_id\n    , encounter_type\n    , length_of_stay\n    , encounter_start_date\n    , encounter_end_date\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.encounter\n\n\n),  __dbt__cte__quality_measures__stg_core__procedure as (\n\nselect\n      patient_id\n    , encounter_id\n    , procedure_date\n    , source_code_type\n    , source_code\n    , normalized_code_type\n    , normalized_code\n    , modifier_1\n    , modifier_2\n    , modifier_3\n    , modifier_4\n    , modifier_5\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.procedure\n),  __dbt__cte__quality_measures__stg_medical_claim as (\n\n\nselect\n      patient_id\n    , claim_id\n    , claim_start_date\n    , claim_end_date\n    , place_of_service_code\n    , hcpcs_code\n    , hcpcs_modifier_1\n    , hcpcs_modifier_2\n    , hcpcs_modifier_3\n    , hcpcs_modifier_4\n    , hcpcs_modifier_5\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.medical_claim\n\n\n),  __dbt__cte__quality_measures__stg_core__patient as (\n\nselect\n      patient_id\n    , sex\n    , birth_date\n    , death_date\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.patient\n), patients_with_ascvd as (\n\n    select \n          patient_id\n        , performance_period_begin\n        , performance_period_end\n        , measure_id\n        , measure_name\n        , measure_version\n        , 1 as criteria\n    from dev_tom.quality_measures._int_cqm438_denominator_criteria1\n\n)\n\n, patients_with_cholesterol as (\n\n    select \n          patient_id\n        , performance_period_begin\n        , performance_period_end\n        , measure_id\n        , measure_name\n        , measure_version\n        , 2 as criteria\n    from dev_tom.quality_measures._int_cqm438_denominator_criteria2\n\n)\n\n, patients_with_diabetes as (\n\n    select \n          patient_id\n        , performance_period_begin\n        , performance_period_end\n        , measure_id\n        , measure_name\n        , measure_version\n        , 3 as criteria\n    from dev_tom.quality_measures._int_cqm438_denominator_criteria3\n\n)\n\n, visit_codes as (\n\n    select\n          code\n        , code_system\n    from dev_tom.quality_measures._value_set_codes \n    where lower(concept_name) in (\n          'annual wellness visit'\n        , 'office visit'\n        , 'outpatient consultation'\n        , 'preventive care services established office visit, 18 and up'\n        , 'preventive care services individual counseling'\n        , 'preventive care services initial office visit, 18 and up'\n        , 'outpatient encounters for preventive care'\n    )\n\n)\n\n, visits_encounters as (\n\n    select patient_id\n         , coalesce(encounter.encounter_start_date,encounter.encounter_end_date) as min_date\n         , coalesce(encounter.encounter_end_date,encounter.encounter_start_date) as max_date\n    from __dbt__cte__quality_measures__stg_core__encounter encounter\n    inner join dev_tom.quality_measures._int_cqm438__performance_period as pp\n        on coalesce(encounter.encounter_end_date,encounter.encounter_start_date) >= pp.performance_period_begin\n        and  coalesce(encounter.encounter_start_date,encounter.encounter_end_date) <= pp.performance_period_end\n    where lower(encounter_type) in (\n          'home health'\n        , 'office visit'\n        , 'outpatient'\n        , 'outpatient rehabilitation'\n        , 'telehealth'\n    )\n\n)\n\n, procedure_encounters as (\n\n    select \n          patient_id\n        , procedure_date as min_date\n        , procedure_date as max_date\n    from __dbt__cte__quality_measures__stg_core__procedure procedures\n    inner join dev_tom.quality_measures._int_cqm438__performance_period  as pp\n        on procedure_date between pp.performance_period_begin and  pp.performance_period_end\n    inner join visit_codes\n        on coalesce(procedures.normalized_code,procedures.source_code) = visit_codes.code\n\n)\n\n, claims_encounters as (\n    \n    select patient_id\n    , coalesce(claim_start_date,claim_end_date) as min_date\n    , coalesce(claim_end_date,claim_start_date) as max_date\n    from __dbt__cte__quality_measures__stg_medical_claim medical_claim\n    inner join dev_tom.quality_measures._int_cqm438__performance_period  as pp on\n        coalesce(claim_end_date,claim_start_date)  >=  pp.performance_period_begin\n         and coalesce(claim_start_date,claim_end_date) <=  pp.performance_period_end\n    inner join visit_codes\n        on medical_claim.hcpcs_code= visit_codes.code\n\n)\n\n, all_encounters as (\n\n    select *, 'v' as visit_enc,cast(null as TEXT) as proc_enc, cast(null as TEXT) as claim_enc\n    from visits_encounters\n\n    union all\n\n    select *, cast(null as TEXT) as visit_enc, 'p' as proc_enc, cast(null as TEXT) as claim_enc\n    from procedure_encounters\n\n    union all\n    \n    select *, cast(null as TEXT) as visit_enc, cast(null as TEXT) as proc_enc, 'c' as claim_enc\n    from claims_encounters\n\n)\n\n, encounters_by_patient as (\n\n    select patient_id,min(min_date) min_date, max(max_date) max_date,\n        concat(concat(\n            coalesce(min(visit_enc),'')\n            ,coalesce(min(proc_enc),''))\n            ,coalesce(min(claim_enc),'')\n            ) as qualifying_types\n    from all_encounters\n    group by patient_id\n\n)\n\n, patients_with_age as (\n\n    select\n          p.patient_id\n        , floor(datediff(\n        hour,\n        birth_date,\n        performance_period_begin\n        ) / 8760.0)  as age\n    from __dbt__cte__quality_measures__stg_core__patient p\n    inner join encounters_by_patient e\n        on p.patient_id = e.patient_id\n            and p.death_date is null\n    cross join dev_tom.quality_measures._int_cqm438__performance_period\n\n)\n\n, qualifying_patients_from_criteria1 as (\n\n    select\n        distinct\n          patients_with_ascvd.patient_id\n        , patients_with_age.age as age\n        , patients_with_ascvd.performance_period_begin\n        , patients_with_ascvd.performance_period_end\n        , patients_with_ascvd.measure_id\n        , patients_with_ascvd.measure_name\n        , patients_with_ascvd.measure_version\n        , 1 as denominator_flag\n    from patients_with_ascvd\n    left join patients_with_age\n    on patients_with_ascvd.patient_id = patients_with_age.patient_id\n    where age is not null\n\n)\n\n, qualifying_patients_from_criteria2 as (\n\n    select\n        distinct\n          patients_with_cholesterol.patient_id\n        , patients_with_age.age as age\n        , patients_with_cholesterol.performance_period_begin\n        , patients_with_cholesterol.performance_period_end\n        , patients_with_cholesterol.measure_id\n        , patients_with_cholesterol.measure_name\n        , patients_with_cholesterol.measure_version\n        , 1 as denominator_flag\n    from patients_with_cholesterol\n    left join patients_with_age\n    on patients_with_cholesterol.patient_id = patients_with_age.patient_id\n    where age between 20 and 75\n\n)\n\n, qualifying_patients_from_criteria3 as (\n\n    select\n        distinct\n          patients_with_diabetes.patient_id\n        , patients_with_age.age as age\n        , patients_with_diabetes.performance_period_begin\n        , patients_with_diabetes.performance_period_end\n        , patients_with_diabetes.measure_id\n        , patients_with_diabetes.measure_name\n        , patients_with_diabetes.measure_version\n        , 1 as denominator_flag\n    from patients_with_diabetes\n    left join patients_with_age\n    on patients_with_diabetes.patient_id = patients_with_age.patient_id\n    where age between 40 and 75\n\n)\n\n, final_denominator as (\n    \n    select\n          patient_id\n        , age\n        , performance_period_begin\n        , performance_period_end\n        , measure_id\n        , measure_name\n        , measure_version\n        , denominator_flag\n    from qualifying_patients_from_criteria1\n\n    union all\n\n    select\n          patient_id\n        , age\n        , performance_period_begin\n        , performance_period_end\n        , measure_id\n        , measure_name\n        , measure_version\n        , denominator_flag\n    from qualifying_patients_from_criteria2\n    \n    union all\n\n    select\n          patient_id\n        , age\n        , performance_period_begin\n        , performance_period_end\n        , measure_id\n        , measure_name\n        , measure_version\n        , denominator_flag\n    from qualifying_patients_from_criteria3\n\n)\n\n, add_data_types as (\n\n    select\n          cast(patient_id as TEXT) as patient_id\n        , cast(age as integer) as age\n        , cast(performance_period_begin as date) as performance_period_begin\n        , cast(performance_period_end as date) as performance_period_end\n        , cast(measure_id as TEXT) as measure_id\n        , cast(measure_name as TEXT) as measure_name\n        , cast(measure_version as TEXT) as measure_version\n        , cast(denominator_flag as integer) as denominator_flag\n    from final_denominator\n\n)\n\nselect \n      patient_id\n    , age\n    , performance_period_begin\n    , performance_period_end\n    , measure_id\n    , measure_name\n    , measure_version\n    , denominator_flag\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.quality_measures._int_cqm438_denominator"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.502516Z", "completed_at": "2024-08-23T19:21:35.532467Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.542481Z", "completed_at": "2024-08-23T19:21:35.542485Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.06946992874145508, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_cqm48_denominator", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__quality_measures__stg_core__procedure as (\n\nselect\n      patient_id\n    , encounter_id\n    , procedure_date\n    , source_code_type\n    , source_code\n    , normalized_code_type\n    , normalized_code\n    , modifier_1\n    , modifier_2\n    , modifier_3\n    , modifier_4\n    , modifier_5\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.procedure\n),  __dbt__cte__quality_measures__stg_medical_claim as (\n\n\nselect\n      patient_id\n    , claim_id\n    , claim_start_date\n    , claim_end_date\n    , place_of_service_code\n    , hcpcs_code\n    , hcpcs_modifier_1\n    , hcpcs_modifier_2\n    , hcpcs_modifier_3\n    , hcpcs_modifier_4\n    , hcpcs_modifier_5\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.medical_claim\n\n\n),  __dbt__cte__quality_measures__stg_core__encounter as (\n\n\nselect\n      patient_id\n    , encounter_id\n    , encounter_type\n    , length_of_stay\n    , encounter_start_date\n    , encounter_end_date\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.encounter\n\n\n),  __dbt__cte__quality_measures__stg_core__patient as (\n\nselect\n      patient_id\n    , sex\n    , birth_date\n    , death_date\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.patient\n), visit_codes as (\n\n    select\n          code\n        , code_system\n    from dev_tom.quality_measures._value_set_codes\n    where lower(concept_name) in (\n          'occupational therapy evaluation'\n        , 'office visit'\n        , 'outpatient'\n        , 'physical therapy evaluation'\n    )\n\n)\n\n, procedures as (\n\n    select\n        patient_id\n      , procedure_date\n      , coalesce (\n              normalized_code_type\n            , case\n                when lower(source_code_type) = 'cpt' then 'hcpcs'\n                when lower(source_code_type) = 'snomed' then 'snomed-ct'\n                else lower(source_code_type)\n              end\n          ) as code_type\n        , coalesce (\n              normalized_code\n            , source_code\n          ) as code\n    from __dbt__cte__quality_measures__stg_core__procedure\n\n)\n\n, medical_claim as (\n    \n    select\n          patient_id\n        , claim_start_date\n        , claim_end_date\n        , hcpcs_code\n    from __dbt__cte__quality_measures__stg_medical_claim\n\n)\n\n, visits_encounters as (\n\n    select patient_id\n         , coalesce(encounter.encounter_start_date,encounter.encounter_end_date) as min_date\n         , coalesce(encounter.encounter_end_date,encounter.encounter_start_date) as max_date\n    from __dbt__cte__quality_measures__stg_core__encounter encounter\n    inner join dev_tom.quality_measures._int_cqm48__performance_period as pp\n        on coalesce(encounter.encounter_end_date,encounter.encounter_start_date) >= pp.performance_period_begin\n            and  coalesce(encounter.encounter_start_date,encounter.encounter_end_date) <= pp.performance_period_end\n    where lower(encounter_type) in (\n          'home health'\n        , 'office visit'\n        , 'outpatient'\n        , 'outpatient rehabilitation'\n        , 'telehealth'\n    )\n\n)\n\n, procedure_encounters as (\n\n    select \n          patient_id\n        , procedure_date as min_date\n        , procedure_date as max_date\n    from procedures\n    inner join dev_tom.quality_measures._int_cqm48__performance_period  as pp\n        on procedure_date between pp.performance_period_begin and  pp.performance_period_end\n    inner join visit_codes\n        on procedures.code = visit_codes.code\n            and procedures.code_type = visit_codes.code_system\n\n)\n\n, claims_encounters as (\n    \n    select \n          patient_id\n        , coalesce(claim_start_date,claim_end_date) as min_date\n        , coalesce(claim_end_date,claim_start_date) as max_date\n    from medical_claim\n    inner join dev_tom.quality_measures._int_cqm48__performance_period  as pp \n        on coalesce(claim_end_date,claim_start_date)  >=  pp.performance_period_begin\n            and coalesce(claim_start_date,claim_end_date) <=  pp.performance_period_end\n    inner join visit_codes\n        on medical_claim.hcpcs_code = visit_codes.code\n            and visit_codes.code_system = 'hcpcs'\n\n)\n\n, all_encounters as (\n\n    select *, 'v' as visit_enc, cast(null as TEXT) as proc_enc, cast(null as TEXT) as claim_enc\n    from visits_encounters\n\n    union all\n\n    select *, cast(null as TEXT) as visit_enc, 'p' as proc_enc, cast(null as TEXT) as claim_enc\n    from procedure_encounters\n\n    union all\n    \n    select *, cast(null as TEXT) as visit_enc, cast(null as TEXT) as proc_enc, 'c' as claim_enc\n    from claims_encounters\n\n)\n\n, encounters_by_patient as (\n\n    select patient_id, min(min_date) min_date, max(max_date) max_date,\n        concat(concat(\n              coalesce(min(visit_enc),'')\n            , coalesce(min(proc_enc),''))\n            , coalesce(min(claim_enc),'')\n            ) as qualifying_types\n    from all_encounters\n    group by patient_id\n\n)\n\n, patients_with_age as (\n\n    select\n          p.patient_id\n        , min_date\n        , floor(datediff(\n        hour,\n        birth_date,\n        e.max_date\n        ) / 8760.0) as age\n        , max_date\n        , qualifying_types\n    from __dbt__cte__quality_measures__stg_core__patient p\n    inner join encounters_by_patient e\n        on p.patient_id = e.patient_id\n    where p.sex = 'female'\n        and p.death_date is null\n\n)\n\n, qualifying_patients as (\n\n    select\n        distinct\n          patients_with_age.patient_id\n        , patients_with_age.age\n        , patients_with_age.max_date as encounter_date\n        , pp.performance_period_begin\n        , pp.performance_period_end\n        , pp.measure_id\n        , pp.measure_name\n        , pp.measure_version\n        , 1 as denominator_flag\n    from patients_with_age\n    cross join dev_tom.quality_measures._int_cqm48__performance_period pp\n    where age >= 65\n\n)\n\n, add_data_types as (\n\n    select\n          cast(patient_id as TEXT) as patient_id\n        , cast(age as integer) as age\n        , cast(encounter_date as date) as encounter_date\n        , cast(performance_period_begin as date) as performance_period_begin\n        , cast(performance_period_end as date) as performance_period_end\n        , cast(measure_id as TEXT) as measure_id\n        , cast(measure_name as TEXT) as measure_name\n        , cast(measure_version as TEXT) as measure_version\n        , cast(denominator_flag as integer) as denominator_flag\n    from qualifying_patients\n\n)\n\nselect \n      patient_id\n    , age\n    , encounter_date\n    , performance_period_begin\n    , performance_period_end\n    , measure_id\n    , measure_name\n    , measure_version\n    , denominator_flag\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.quality_measures._int_cqm48_denominator"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.526248Z", "completed_at": "2024-08-23T19:21:35.543217Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.563574Z", "completed_at": "2024-08-23T19:21:35.563577Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.042283058166503906, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_nqf0034_denominator", "compiled": true, "compiled_code": "\n\n/*\nDENOMINATOR:\nPatients 45-75 years of age with a visit during the measurement period\nDENOMINATOR NOTE: To assess the age for exclusions, the patient\u2019s age on the date of the encounter\nshould be used\n*Signifies that this CPT Category I code is a non-covered service under the Medicare Part B Physician Fee\nSchedule (PFS). These non-covered services should be counted in the denominator population for MIPS\nCQMs.\nDenominator Criteria (Eligible Cases):\nPatients 45 to 75 years of age on date of encounter\nAND\nPatient encounter during the performance period (CPT or HCPCS): 99202, 99203, 99204, 99205,\n99212, 99213, 99214, 99215, 99341, 99342, 99344, 99345, 99347, 99348, 99349, 99350, 99386*, 99387*,\n99396*, 99397*, G0438, G0439\n*/\n\nwith  __dbt__cte__quality_measures__stg_core__encounter as (\n\n\nselect\n      patient_id\n    , encounter_id\n    , encounter_type\n    , length_of_stay\n    , encounter_start_date\n    , encounter_end_date\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.encounter\n\n\n),  __dbt__cte__quality_measures__stg_core__procedure as (\n\nselect\n      patient_id\n    , encounter_id\n    , procedure_date\n    , source_code_type\n    , source_code\n    , normalized_code_type\n    , normalized_code\n    , modifier_1\n    , modifier_2\n    , modifier_3\n    , modifier_4\n    , modifier_5\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.procedure\n),  __dbt__cte__quality_measures__stg_medical_claim as (\n\n\nselect\n      patient_id\n    , claim_id\n    , claim_start_date\n    , claim_end_date\n    , place_of_service_code\n    , hcpcs_code\n    , hcpcs_modifier_1\n    , hcpcs_modifier_2\n    , hcpcs_modifier_3\n    , hcpcs_modifier_4\n    , hcpcs_modifier_5\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.medical_claim\n\n\n),  __dbt__cte__quality_measures__stg_core__patient as (\n\nselect\n      patient_id\n    , sex\n    , birth_date\n    , death_date\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.patient\n), visit_codes as (\n\n    select\n          code\n        , code_system\n    from dev_tom.quality_measures._value_set_codes\n    where lower(concept_name) in (\n          'office visit'\n        , 'home healthcare services'\n        , 'preventive care services established office visit, 18 and up'\n        , 'preventive care services initial office visit, 18 and up'\n        , 'annual wellness visit'\n        , 'telephone visits'\n        , 'online assessments'\n    )\n\n)\n\n, visits_encounters as (\n\n    select \n          patient_id\n        , coalesce(encounter.encounter_start_date,encounter.encounter_end_date) as min_date\n        , coalesce(encounter.encounter_end_date,encounter.encounter_start_date) as max_date\n    from __dbt__cte__quality_measures__stg_core__encounter encounter\n    inner join dev_tom.quality_measures._int_nqf0034__performance_period as pp\n        on coalesce(encounter.encounter_end_date,encounter.encounter_start_date) >= pp.performance_period_begin\n        and  coalesce(encounter.encounter_start_date,encounter.encounter_end_date) <= pp.performance_period_end\n    where encounter_type in (\n          'home health'\n        , 'office visit'\n        , 'outpatient'\n        , 'outpatient rehabilitation'\n        , 'telehealth'\n    )\n\n)\n\n, procedure_encounters as (\n\n    select \n          patient_id\n        , procedure_date as min_date\n        , procedure_date as max_date\n        from __dbt__cte__quality_measures__stg_core__procedure procs\n    inner join dev_tom.quality_measures._int_nqf0034__performance_period  as pp\n        on procedure_date between pp.performance_period_begin and  pp.performance_period_end\n    inner join visit_codes\n            on coalesce(procs.normalized_code,procs.source_code) = visit_codes.code\n\n)\n\n, claims_encounters as (\n\n    select patient_id\n    , coalesce(claim_start_date,claim_end_date) as min_date\n    , coalesce(claim_end_date,claim_start_date) as max_date\n    from __dbt__cte__quality_measures__stg_medical_claim medical_claim\n    inner join dev_tom.quality_measures._int_nqf0034__performance_period  as pp on\n        coalesce(claim_end_date,claim_start_date)  >=  pp.performance_period_begin\n         and coalesce(claim_start_date,claim_end_date) <=  pp.performance_period_end\n    inner join visit_codes\n        on medical_claim.hcpcs_code= visit_codes.code\n\n)\n\n, all_encounters as (\n\n    select *, 'v' as visit_enc,cast(null as TEXT) as proc_enc, cast(null as TEXT) as claim_enc\n    from visits_encounters\n    union all\n    select *, cast(null as TEXT) as visit_enc, 'p' as proc_enc, cast(null as TEXT) as claim_enc\n    from procedure_encounters\n    union all\n    select *, cast(null as TEXT) as visit_enc,cast(null as TEXT) as proc_enc, 'c' as claim_enc\n    from claims_encounters\n\n)\n\n, encounters_by_patient as (\n\n    select patient_id, min(min_date) min_date, max(max_date) max_date,\n        concat(concat(\n            coalesce(min(visit_enc),'')\n            ,coalesce(min(proc_enc),''))\n            ,coalesce(min(claim_enc),'')\n            ) as qualifying_types\n    from all_encounters\n    group by patient_id\n\n)\n\n, patients_with_age as (\n\n    select\n          p.patient_id\n        , min_date\n        , floor(datediff(\n        hour,\n        birth_date,\n        e.min_date\n        ) / 8766.0)  as min_age\n        , max_date\n        ,floor(datediff(\n        hour,\n        birth_date,\n        e.max_date\n        ) / 8766.0) as max_age\n        , qualifying_types\n    from __dbt__cte__quality_measures__stg_core__patient p\n    inner join encounters_by_patient e\n        on p.patient_id = e.patient_id\n    where p.death_date is null -- ensures deceased patients are not included\n\n)\n\nselect \n      patient_id\n    , min_age\n    , max_age\n    , qualifying_types\nfrom patients_with_age\nwhere max_age >= 45 and min_age <=  75", "relation_name": "dev_tom.quality_measures._int_nqf0034_denominator"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.543367Z", "completed_at": "2024-08-23T19:21:35.570567Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.599743Z", "completed_at": "2024-08-23T19:21:35.599747Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.05749201774597168, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_nqf0041_denominator", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__quality_measures__stg_core__encounter as (\n\n\nselect\n      patient_id\n    , encounter_id\n    , encounter_type\n    , length_of_stay\n    , encounter_start_date\n    , encounter_end_date\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.encounter\n\n\n),  __dbt__cte__quality_measures__stg_core__procedure as (\n\nselect\n      patient_id\n    , encounter_id\n    , procedure_date\n    , source_code_type\n    , source_code\n    , normalized_code_type\n    , normalized_code\n    , modifier_1\n    , modifier_2\n    , modifier_3\n    , modifier_4\n    , modifier_5\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.procedure\n),  __dbt__cte__quality_measures__stg_medical_claim as (\n\n\nselect\n      patient_id\n    , claim_id\n    , claim_start_date\n    , claim_end_date\n    , place_of_service_code\n    , hcpcs_code\n    , hcpcs_modifier_1\n    , hcpcs_modifier_2\n    , hcpcs_modifier_3\n    , hcpcs_modifier_4\n    , hcpcs_modifier_5\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.medical_claim\n\n\n),  __dbt__cte__quality_measures__stg_core__patient as (\n\nselect\n      patient_id\n    , sex\n    , birth_date\n    , death_date\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.patient\n), visit_codes as (\n\n    select\n          code\n        , code_system\n    from dev_tom.quality_measures._value_set_codes\n    where lower(concept_name) in (\n          'annual wellness visit'\n        , 'discharge services nursing facility'\n        , 'hemodialysis'\n        , 'home healthcare services'\n        , 'nursing facility visit'\n        , 'office visit'\n        , 'outpatient consultation'\n        , 'peritoneal dialysis'\n        , 'preventive care services established office visit, 18 and up'\n        , 'preventive care services group counseling'\n        , 'preventive care services individual counseling'\n        , 'preventive care services initial office visit, 18 and up'\n        , 'preventive care services, initial office visit, 0 to 17'\n        , 'preventive care, established office visit, 0 to 17'\n        , 'online assessments'\n        , 'patient provider interaction'\n        , 'telephone visits'\n    )\n\n)\n\n, visits_encounters as (\n\n    select patient_id\n         , coalesce(encounter.encounter_start_date,encounter.encounter_end_date) as min_date\n         , coalesce(encounter.encounter_end_date,encounter.encounter_start_date) as max_date\n    from __dbt__cte__quality_measures__stg_core__encounter encounter\n    inner join dev_tom.quality_measures._int_nqf0041__performance_period as pp\n        on coalesce(encounter.encounter_end_date,encounter.encounter_start_date) >= pp.performance_period_begin\n        and  coalesce(encounter.encounter_start_date,encounter.encounter_end_date) <= pp.performance_period_end\n    where lower(encounter_type) in (\n          'home health'\n        , 'office visit'\n        , 'outpatient'\n        , 'outpatient rehabilitation'\n        , 'telehealth'\n     )\n\n)\n\n, procedure_encounters as (\n\n    select \n          patient_id\n        , procedure_date as min_date\n        , procedure_date as max_date\n    from __dbt__cte__quality_measures__stg_core__procedure procedures\n    inner join dev_tom.quality_measures._int_nqf0041__performance_period  as pp\n        on procedure_date between pp.performance_period_begin and  pp.performance_period_end\n    inner join visit_codes\n        on coalesce(procedures.normalized_code,procedures.source_code) = visit_codes.code\n\n)\n\n, claims_encounters as (\n    \n    select \n          patient_id\n        , coalesce(claim_start_date,claim_end_date) as min_date\n        , coalesce(claim_end_date,claim_start_date) as max_date\n    from __dbt__cte__quality_measures__stg_medical_claim medical_claim\n    inner join dev_tom.quality_measures._int_nqf0041__performance_period  as pp on\n        coalesce(claim_end_date,claim_start_date)  >=  pp.performance_period_begin\n         and coalesce(claim_start_date,claim_end_date) <=  pp.performance_period_end\n    inner join visit_codes\n        on medical_claim.hcpcs_code = visit_codes.code\n\n)\n\n, all_encounters as (\n\n    select *, 'v' as visit_enc, cast(null as TEXT) as proc_enc, cast(null as TEXT) as claim_enc\n    from visits_encounters\n\n    union all\n\n    select *, cast(null as TEXT) as visit_enc, 'p' as proc_enc, cast(null as TEXT) as claim_enc\n    from procedure_encounters\n\n    union all\n    \n    select *, cast(null as TEXT) as visit_enc, cast(null as TEXT) as proc_enc, 'c' as claim_enc\n    from claims_encounters\n\n)\n\n, encounters_by_patient as (\n\n    select patient_id, min(min_date) min_date, max(max_date) max_date,\n        concat(concat(\n              coalesce(min(visit_enc),'')\n            , coalesce(min(proc_enc),''))\n            , coalesce(min(claim_enc),'')\n            ) as qualifying_types\n    from all_encounters\n    group by patient_id\n\n)\n\n, patients_with_age as (\n\n    select\n          p.patient_id\n        , min_date\n        , (datediff(\n        hour,\n        birth_date,\n        e.max_date\n        ) / 8760.0) as age_in_decimal_point\n        , max_date\n        , qualifying_types\n    from __dbt__cte__quality_measures__stg_core__patient p\n    inner join encounters_by_patient e\n        on p.patient_id = e.patient_id\n    where p.death_date is null\n\n)\n\n, qualifying_patients as (\n\n    select\n        distinct\n          patients_with_age.patient_id\n        , patients_with_age.age_in_decimal_point as age\n        , pp.performance_period_begin\n        , pp.performance_period_end\n        , pp.measure_id\n        , pp.measure_name\n        , pp.measure_version\n        , 1 as denominator_flag\n    from patients_with_age\n    cross join dev_tom.quality_measures._int_nqf0041__performance_period pp\n    where age_in_decimal_point >= 0.5 --filters patients aged 6 months or older\n\n)\n\n, add_data_types as (\n\n    select\n          cast(patient_id as TEXT) as patient_id\n        , round(cast(age as numeric(28,6)), 1) as age -- ensures age is seen in one decimal point\n        , cast(performance_period_begin as date) as performance_period_begin\n        , cast(performance_period_end as date) as performance_period_end\n        , cast(measure_id as TEXT) as measure_id\n        , cast(measure_name as TEXT) as measure_name\n        , cast(measure_version as TEXT) as measure_version\n        , cast(denominator_flag as integer) as denominator_flag\n    from qualifying_patients\n\n)\n\nselect \n      patient_id\n    , age\n    , performance_period_begin\n    , performance_period_end\n    , measure_id\n    , measure_name\n    , measure_version\n    , denominator_flag\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.quality_measures._int_nqf0041_denominator"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.564283Z", "completed_at": "2024-08-23T19:21:35.612139Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.623955Z", "completed_at": "2024-08-23T19:21:35.623959Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.060594797134399414, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_nqf0053_denominator", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__quality_measures__stg_core__procedure as (\n\nselect\n      patient_id\n    , encounter_id\n    , procedure_date\n    , source_code_type\n    , source_code\n    , normalized_code_type\n    , normalized_code\n    , modifier_1\n    , modifier_2\n    , modifier_3\n    , modifier_4\n    , modifier_5\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.procedure\n),  __dbt__cte__quality_measures__stg_core__encounter as (\n\n\nselect\n      patient_id\n    , encounter_id\n    , encounter_type\n    , length_of_stay\n    , encounter_start_date\n    , encounter_end_date\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.encounter\n\n\n),  __dbt__cte__quality_measures__stg_medical_claim as (\n\n\nselect\n      patient_id\n    , claim_id\n    , claim_start_date\n    , claim_end_date\n    , place_of_service_code\n    , hcpcs_code\n    , hcpcs_modifier_1\n    , hcpcs_modifier_2\n    , hcpcs_modifier_3\n    , hcpcs_modifier_4\n    , hcpcs_modifier_5\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.medical_claim\n\n\n),  __dbt__cte__quality_measures__stg_core__condition as (\n\nselect\n      patient_id\n    , claim_id\n    , encounter_id\n    , recorded_date\n    , source_code_type\n    , source_code\n    , normalized_code_type\n    , normalized_code\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.condition\n),  __dbt__cte__quality_measures__stg_core__patient as (\n\nselect\n      patient_id\n    , sex\n    , birth_date\n    , death_date\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.patient\n), visit_codes as (\n\n    select\n          code\n        , code_system\n        , concept_name\n    from dev_tom.quality_measures._value_set_codes as value_sets\n\n)\n\n, procedures as (\n\n    select\n          patient_id\n        , procedure_date\n        , coalesce (\n              normalized_code_type\n            , case\n                when lower(source_code_type) = 'cpt' then 'hcpcs'\n                when lower(source_code_type) = 'snomed' then 'snomed-ct'\n                else lower(source_code_type)\n              end\n          ) as code_type\n        , coalesce(\n              normalized_code\n            , source_code\n          ) as code\n    from __dbt__cte__quality_measures__stg_core__procedure\n\n)\n\n, visits_encounters as (\n\n    select \n           patient_id\n         , coalesce(encounter.encounter_start_date,encounter.encounter_end_date) as min_date\n         , coalesce(encounter.encounter_end_date,encounter.encounter_start_date) as max_date\n         , encounter_type\n    from __dbt__cte__quality_measures__stg_core__encounter as encounter\n    inner join dev_tom.quality_measures._int_nqf0053__performance_period as pp\n        on coalesce(encounter.encounter_end_date,encounter.encounter_start_date) >= pp.performance_period_begin\n        and  coalesce(encounter.encounter_start_date,encounter.encounter_end_date) <= pp.performance_period_end\n\n)\n\n, procedure_encounters as (\n\n    select \n          patient_id\n        , procedure_date as min_date\n        , procedure_date as max_date\n        from __dbt__cte__quality_measures__stg_core__procedure procs\n    inner join dev_tom.quality_measures._int_nqf0053__performance_period  as pp\n        on procedure_date between pp.performance_period_begin and  pp.performance_period_end\n    inner join  visit_codes\n            on coalesce(procs.normalized_code,procs.source_code) = visit_codes.code\n\n)\n\n, claims_encounters as (\n\n    select \n          patient_id\n        , coalesce(claim_start_date,claim_end_date) as min_date\n        , coalesce(claim_end_date,claim_start_date) as max_date\n        , place_of_service_code\n    from __dbt__cte__quality_measures__stg_medical_claim medical_claim\n    inner join dev_tom.quality_measures._int_nqf0053__performance_period  as pp on\n        coalesce(claim_end_date,claim_start_date)  >=  pp.performance_period_begin\n         and coalesce(claim_start_date,claim_end_date) <=  pp.performance_period_end\n    inner join  visit_codes\n        on medical_claim.hcpcs_code= visit_codes.code\n\n)\n\n, all_encounters as (\n\n    select\n          patient_id\n        , min_date\n        , max_date\n        , 'v' as visit_enc,cast(null as TEXT) as proc_enc, cast(null as TEXT) as claim_enc\n    from visits_encounters\n    union all\n    select\n          patient_id\n        , min_date\n        , max_date\n        , cast(null as TEXT) as visit_enc, 'p' as proc_enc, cast(null as TEXT) as claim_enc\n    from procedure_encounters\n    union all\n    select\n          patient_id\n        , min_date\n        , max_date\n        , cast(null as TEXT) as visit_enc,cast(null as TEXT) as proc_enc, 'c' as claim_enc\n    from claims_encounters\n\n)\n\n, encounters_by_patient as (\n\n    select\n          patient_id\n        , min(min_date) min_date\n        , max(max_date) max_date\n        , concat(concat(\n            coalesce(min(visit_enc),'')\n            ,coalesce(min(proc_enc),''))\n            ,coalesce(min(claim_enc),'')\n            ) as qualifying_types\n    from all_encounters\n    group by patient_id\n\n)\n\n, bone_fracture_codes as (\n\n    select\n          code\n        , code_system\n    from dev_tom.quality_measures._value_set_codes\n    where lower(concept_name) = 'fracture diagnoses'\n\n)\n\n, conditions as (\n\n    select\n          patient_id\n        , claim_id\n        , encounter_id\n        , recorded_date\n        , source_code\n        , source_code_type\n        , normalized_code\n        , normalized_code_type\n    from __dbt__cte__quality_measures__stg_core__condition\n\n)\n\n, bone_fracture_conditions as (\n\n    select\n          conditions.patient_id\n        , conditions.claim_id\n        , conditions.encounter_id\n        , conditions.recorded_date\n        , conditions.source_code\n        , conditions.source_code_type\n    from conditions\n    inner join bone_fracture_codes\n        on coalesce(conditions.normalized_code_type, conditions.source_code_type) = bone_fracture_codes.code_system\n            and coalesce(conditions.normalized_code, conditions.source_code) = bone_fracture_codes.code\n\n)\n\n, patients_with_age as (\n\n    select\n          patient.patient_id\n        , patient.sex\n        , min_date\n        , floor(datediff(\n        hour,\n        birth_date,\n        e.min_date\n        ) / 8760.0)  as min_age\n        , max_date\n        , floor(datediff(\n        hour,\n        birth_date,\n        e.max_date\n        ) / 8760.0) as max_age\n        , qualifying_types\n    from __dbt__cte__quality_measures__stg_core__patient patient\n    inner join encounters_by_patient e\n        on patient.patient_id = e.patient_id\n    where patient.death_date is null\n\n)\n\n, qualifying_patients_w_fractures as (\n\n    select\n        distinct\n          bone_fracture_conditions.patient_id\n        , bone_fracture_conditions.recorded_date\n        , patients_with_age.max_age as age\n        , pp.performance_period_begin\n        , pp.performance_period_end\n        , pp.measure_id\n        , pp.measure_name\n        , pp.measure_version\n        , 1 as denominator_flag\n    from bone_fracture_conditions\n    left join patients_with_age\n        on bone_fracture_conditions.patient_id = patients_with_age.patient_id\n    cross join dev_tom.quality_measures._int_nqf0053__performance_period pp\n    where max_age >= 50 and min_age <=  85\n        and bone_fracture_conditions.recorded_date between\n            \n\n    dateadd(\n        month,\n        -6,\n        performance_period_begin\n        )\n\n\n            and\n                pp.lookback_period_june\n        and lower(patients_with_age.sex) = 'female'\n\n)\n\n, fracture_procedures as (\n\n    select\n        procedures.*\n    from procedures\n    inner join visit_codes\n        on procedures.code = visit_codes.code\n            and procedures.code_type = visit_codes.code_system\n    inner join dev_tom.quality_measures._int_nqf0053__performance_period as pp\n        on procedures.procedure_date \n            between pp.performance_period_begin and pp.performance_period_end\n    where lower(visit_codes.concept_name) = 'fracture procedures'\n\n)\n\n, qualifying_patients_w_encounter as (\n\n    select\n        qualifying_patients_w_fractures.*\n    from qualifying_patients_w_fractures\n    inner join visits_encounters\n        on qualifying_patients_w_fractures.patient_id = visits_encounters.patient_id\n    where \n        lower(visits_encounters.encounter_type) in (\n              'acute inpatient'\n            , 'annual wellness visit'\n            , 'emergency department visit'\n            , 'emergency department'\n            , 'home healthcare services'\n            , 'office visit'\n            , 'preventive care services established office visit, 18 and up'\n            , 'preventive care services initial office visit, 18 and up'\n            , 'emergency department evaluation and management visit'\n            , 'outpatient'\n        )\n)\n\n, qualifying_patients_w_procedure as (\n\n    select\n        qualifying_patients_w_fractures.*\n    from qualifying_patients_w_fractures\n    inner join fracture_procedures\n        on qualifying_patients_w_fractures.patient_id = fracture_procedures.patient_id\n\n)\n\n, qualifying_patients as (\n\n    select\n        distinct\n        qualifying_patients_w_encounter.*\n    from qualifying_patients_w_encounter\n    left join qualifying_patients_w_procedure\n        on qualifying_patients_w_encounter.patient_id = qualifying_patients_w_procedure.patient_id\n    left join claims_encounters\n        on qualifying_patients_w_encounter.patient_id = claims_encounters.patient_id\n    where (cast(claims_encounters.place_of_service_code as TEXT) not in ('21')\n        or claims_encounters.patient_id is null)\n\n    union all\n\n    select\n        distinct\n        qualifying_patients_w_procedure.*\n    from qualifying_patients_w_procedure\n    left join qualifying_patients_w_encounter\n        on qualifying_patients_w_encounter.patient_id = qualifying_patients_w_procedure.patient_id\n    where qualifying_patients_w_encounter.patient_id is null\n\n)\n\n, add_data_types as (\n\n    select\n          cast(patient_id as TEXT) as patient_id\n        , cast(recorded_date as date) as recorded_date\n        , cast(age as integer) as age\n        , cast(performance_period_begin as date) as performance_period_begin\n        , cast(performance_period_end as date) as performance_period_end\n        , cast(measure_id as TEXT) as measure_id\n        , cast(measure_name as TEXT) as measure_name\n        , cast(measure_version as TEXT) as measure_version\n        , cast(denominator_flag as integer) as denominator_flag\n    from qualifying_patients\n\n)\n\nselect \n      patient_id\n    , recorded_date  \n    , age\n    , performance_period_begin\n    , performance_period_end\n    , measure_id\n    , measure_name\n    , measure_version\n    , denominator_flag\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.quality_measures._int_nqf0053_denominator"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.600445Z", "completed_at": "2024-08-23T19:21:35.630566Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.647945Z", "completed_at": "2024-08-23T19:21:35.647949Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.05861687660217285, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_nqf0059_denominator", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__quality_measures__stg_core__encounter as (\n\n\nselect\n      patient_id\n    , encounter_id\n    , encounter_type\n    , length_of_stay\n    , encounter_start_date\n    , encounter_end_date\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.encounter\n\n\n),  __dbt__cte__quality_measures__stg_core__procedure as (\n\nselect\n      patient_id\n    , encounter_id\n    , procedure_date\n    , source_code_type\n    , source_code\n    , normalized_code_type\n    , normalized_code\n    , modifier_1\n    , modifier_2\n    , modifier_3\n    , modifier_4\n    , modifier_5\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.procedure\n),  __dbt__cte__quality_measures__stg_medical_claim as (\n\n\nselect\n      patient_id\n    , claim_id\n    , claim_start_date\n    , claim_end_date\n    , place_of_service_code\n    , hcpcs_code\n    , hcpcs_modifier_1\n    , hcpcs_modifier_2\n    , hcpcs_modifier_3\n    , hcpcs_modifier_4\n    , hcpcs_modifier_5\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.medical_claim\n\n\n),  __dbt__cte__quality_measures__stg_core__condition as (\n\nselect\n      patient_id\n    , claim_id\n    , encounter_id\n    , recorded_date\n    , source_code_type\n    , source_code\n    , normalized_code_type\n    , normalized_code\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.condition\n),  __dbt__cte__quality_measures__stg_core__patient as (\n\nselect\n      patient_id\n    , sex\n    , birth_date\n    , death_date\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.patient\n), visit_codes as (\n\n    select\n          code\n        , code_system\n    from dev_tom.quality_measures._value_set_codes\n    where lower(concept_name) in (\n          'office visit'\n        , 'home healthcare services'\n        , 'preventive care services established office visit, 18 and up'\n        , 'preventive care services initial office visit, 18 and up'\n        , 'annual wellness visit'\n        , 'telephone visits'\n        , 'nutrition services'\n    )\n\n)\n\n, visits_encounters as (\n\n    select patient_id\n         , coalesce(encounter.encounter_start_date,encounter.encounter_end_date) as min_date\n         , coalesce(encounter.encounter_end_date,encounter.encounter_start_date) as max_date\n    from __dbt__cte__quality_measures__stg_core__encounter encounter\n    inner join dev_tom.quality_measures._int_nqf0059__performance_period as pp\n        on coalesce(encounter.encounter_end_date,encounter.encounter_start_date) >= pp.performance_period_begin\n        and  coalesce(encounter.encounter_start_date,encounter.encounter_end_date) <= pp.performance_period_end\n    where lower(encounter_type) in (\n          'home health'\n        , 'office visit'\n        , 'outpatient'\n        , 'outpatient rehabilitation'\n        , 'telehealth'\n    )\n\n)\n\n, procedure_encounters as (\n\n    select \n          patient_id\n        , procedure_date as min_date\n        , procedure_date as max_date\n        from __dbt__cte__quality_measures__stg_core__procedure procs\n    inner join dev_tom.quality_measures._int_nqf0059__performance_period  as pp\n        on procedure_date between pp.performance_period_begin and  pp.performance_period_end\n    inner join  visit_codes\n            on coalesce(procs.normalized_code,procs.source_code) = visit_codes.code\n\n)\n\n, claims_encounters as (\n\n    select \n          patient_id\n        , coalesce(claim_start_date,claim_end_date) as min_date\n        , coalesce(claim_end_date,claim_start_date) as max_date\n    from __dbt__cte__quality_measures__stg_medical_claim medical_claim\n    inner join dev_tom.quality_measures._int_nqf0059__performance_period  as pp on\n        coalesce(claim_end_date,claim_start_date)  >=  pp.performance_period_begin\n         and coalesce(claim_start_date,claim_end_date) <=  pp.performance_period_end\n    inner join  visit_codes\n        on medical_claim.hcpcs_code= visit_codes.code\n\n)\n\n, all_encounters as (\n    select *, 'v' as visit_enc,cast(null as TEXT) as proc_enc, cast(null as TEXT) as claim_enc\n    from visits_encounters\n    union all\n    select *, cast(null as TEXT) as visit_enc, 'p' as proc_enc, cast(null as TEXT) as claim_enc\n    from procedure_encounters\n    union all\n    select *, cast(null as TEXT) as visit_enc,cast(null as TEXT) as proc_enc, 'c' as claim_enc\n    from claims_encounters\n)\n\n, encounters_by_patient as (\n    select patient_id,min(min_date) min_date, max(max_date) max_date,\n        concat(concat(\n            coalesce(min(visit_enc),'')\n            ,coalesce(min(proc_enc),''))\n            ,coalesce(min(claim_enc),'')\n            ) as qualifying_types\n    from all_encounters\n    group by patient_id\n)\n\n, diabetics_codes as (\n\n    select\n          code\n        , code_system\n    from dev_tom.quality_measures._value_set_codes\n    where lower(concept_name) in (\n          'diabetes'\n        , 'hba1c laboratory test'\n    )\n)\n\n, conditions as (\n\n    select\n          patient_id\n        , recorded_date\n        , source_code\n        , source_code_type\n        , normalized_code\n        , normalized_code_type\n    from __dbt__cte__quality_measures__stg_core__condition\n\n)\n\n, diabetic_conditions as (\n\n    select\n          conditions.patient_id\n        , conditions.recorded_date\n    from conditions\n    inner join diabetics_codes\n        on coalesce(conditions.normalized_code_type, conditions.source_code_type) = diabetics_codes.code_system\n            and coalesce(conditions.normalized_code, conditions.source_code) = diabetics_codes.code\n\n)\n\n, patients_with_age as (\n    select\n          p.patient_id\n        , min_date\n        , floor(datediff(\n        hour,\n        birth_date,\n        e.min_date\n        ) / 8760.0)  as min_age\n        , max_date\n        , floor(datediff(\n        hour,\n        birth_date,\n        e.max_date\n        ) / 8760.0) as max_age\n        , qualifying_types\n    from __dbt__cte__quality_measures__stg_core__patient p\n    inner join encounters_by_patient e\n        on p.patient_id = e.patient_id\n    where p.death_date is null\n\n)\n\n, qualifying_patients as (\n\n    select\n        distinct\n          diabetic_conditions.patient_id\n        , patients_with_age.max_age as age\n        , pp.performance_period_begin\n        , pp.performance_period_end\n        , pp.measure_id\n        , pp.measure_name\n        , pp.measure_version\n        , 1 as denominator_flag\n    from diabetic_conditions\n    left join patients_with_age\n        on diabetic_conditions.patient_id = patients_with_age.patient_id\n    cross join dev_tom.quality_measures._int_nqf0059__performance_period pp\n    where max_age >= 18 and min_age <=  75\n\n)\n\n, add_data_types as (\n\n    select\n          cast(patient_id as TEXT) as patient_id\n        , cast(age as integer) as age\n        , cast(performance_period_begin as date) as performance_period_begin\n        , cast(performance_period_end as date) as performance_period_end\n        , cast(measure_id as TEXT) as measure_id\n        , cast(measure_name as TEXT) as measure_name\n        , cast(measure_version as TEXT) as measure_version\n        , cast(denominator_flag as integer) as denominator_flag\n    from qualifying_patients\n\n)\n\nselect \n      patient_id\n    , age\n    , performance_period_begin\n    , performance_period_end\n    , measure_id\n    , measure_name\n    , measure_version\n    , denominator_flag\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.quality_measures._int_nqf0059_denominator"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.624670Z", "completed_at": "2024-08-23T19:21:35.654043Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.670911Z", "completed_at": "2024-08-23T19:21:35.670916Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.04719424247741699, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_nqf0097_denominator", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__quality_measures__stg_core__encounter as (\n\n\nselect\n      patient_id\n    , encounter_id\n    , encounter_type\n    , length_of_stay\n    , encounter_start_date\n    , encounter_end_date\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.encounter\n\n\n),  __dbt__cte__quality_measures__stg_core__procedure as (\n\nselect\n      patient_id\n    , encounter_id\n    , procedure_date\n    , source_code_type\n    , source_code\n    , normalized_code_type\n    , normalized_code\n    , modifier_1\n    , modifier_2\n    , modifier_3\n    , modifier_4\n    , modifier_5\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.procedure\n),  __dbt__cte__quality_measures__stg_medical_claim as (\n\n\nselect\n      patient_id\n    , claim_id\n    , claim_start_date\n    , claim_end_date\n    , place_of_service_code\n    , hcpcs_code\n    , hcpcs_modifier_1\n    , hcpcs_modifier_2\n    , hcpcs_modifier_3\n    , hcpcs_modifier_4\n    , hcpcs_modifier_5\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.medical_claim\n\n\n),  __dbt__cte__quality_measures__stg_core__patient as (\n\nselect\n      patient_id\n    , sex\n    , birth_date\n    , death_date\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.patient\n), visit_codes as (\n\n    select\n          concept_name\n        , code\n        , code_system\n    from dev_tom.quality_measures._value_set_codes\n\n)\n\n, valid_concepts as (\n\n    select\n        concept_name\n    from dev_tom.quality_measures._value_set_concepts\n    where concept_name in (\n          'annual wellness visit'\n        , 'care services in long term residential facility'\n        , 'encounter to document medications'\n        , 'home healthcare services'\n        , 'office visit'\n        , 'outpatient'\n        , 'psychoanalysis'\n    )\n\n)\n\n, valid_visit_codes as (\n\n    select\n          visit_codes.concept_name\n        , visit_codes.code\n        , visit_codes.code_system\n    from visit_codes\n    inner join valid_concepts\n        on visit_codes.concept_name = valid_concepts.concept_name\n\n)\n\n, visits_encounters as (\n\n    select patient_id\n         , length_of_stay\n         , encounter.encounter_end_date\n         , coalesce(encounter.encounter_start_date,encounter.encounter_end_date) as min_date\n         , coalesce(encounter.encounter_end_date,encounter.encounter_start_date) as max_date\n    from __dbt__cte__quality_measures__stg_core__encounter encounter\n    inner join dev_tom.quality_measures._int_nqf0097__performance_period as pp\n        on coalesce(encounter.encounter_end_date,encounter.encounter_start_date) >= pp.performance_period_begin\n            and coalesce(encounter.encounter_start_date,encounter.encounter_end_date) <= pp.performance_period_end\n    -- all encounter types considered; inpatient encounters are filtered by length of stay being more than 0 days\n\n)\n\n, procedure_encounters as (\n\n    select \n          patient_id\n        , procedure_date as min_date\n        , procedure_date as max_date\n        from __dbt__cte__quality_measures__stg_core__procedure procs\n\n    inner join dev_tom.quality_measures._int_nqf0097__performance_period  as pp\n        on procedure_date between pp.performance_period_begin and  pp.performance_period_end\n    inner join valid_visit_codes\n            on coalesce(procs.normalized_code,procs.source_code) = valid_visit_codes.code\n\n)\n\n, claims_encounters as (\n    \n    select patient_id\n    , coalesce(claim_start_date,claim_end_date) as min_date\n    , coalesce(claim_end_date,claim_start_date) as max_date\n    from __dbt__cte__quality_measures__stg_medical_claim medical_claim\n    inner join dev_tom.quality_measures._int_nqf0097__performance_period  as pp on\n        coalesce(claim_end_date,claim_start_date)  >=  pp.performance_period_begin\n         and coalesce(claim_start_date,claim_end_date) <=  pp.performance_period_end\n    inner join  valid_visit_codes\n        on medical_claim.hcpcs_code= valid_visit_codes.code\n\n)\n\n, all_encounters as (\n\n    select\n          patient_id\n        , min_date\n        , max_date\n        , 'v' as visit_enc\n        , cast(null as TEXT) as proc_enc\n        , cast(null as TEXT) as claim_enc\n    from visits_encounters\n\n    union all\n\n    select\n          patient_id\n        , min_date\n        , max_date\n        , cast(null as TEXT) as visit_enc\n        , 'p' as proc_enc\n        , cast(null as TEXT) as claim_enc\n    from procedure_encounters\n\n    union all\n    \n    select\n          patient_id\n        , min_date\n        , max_date\n        , cast(null as TEXT) as visit_enc\n        , cast(null as TEXT) as proc_enc\n        , 'c' as claim_enc\n    from claims_encounters\n\n)\n\n, encounters_by_patient as (\n\n    select patient_id,min(min_date) min_date, max(max_date) max_date,\n        concat(concat(\n            coalesce(min(visit_enc),'')\n            ,coalesce(min(proc_enc),''))\n            ,coalesce(min(claim_enc),'')\n            ) as qualifying_types\n    from all_encounters\n    group by patient_id\n\n)\n\n, patients_with_age as (\n\n    select\n          p.patient_id\n        , min_date\n        , floor(datediff(\n        hour,\n        birth_date,\n        e.min_date\n        ) / 8760.0)  as min_age\n        , max_date\n        , floor(datediff(\n        hour,\n        birth_date,\n        e.max_date\n        ) / 8760.0) as max_age\n        , qualifying_types\n    from __dbt__cte__quality_measures__stg_core__patient p\n    inner join encounters_by_patient e\n        on p.patient_id = e.patient_id\n    where p.death_date is null\n\n)\n\n, qualifying_patients as (\n\n    select\n        distinct\n          patients_with_age.patient_id\n        , patients_with_age.max_age as age\n        , pp.performance_period_begin\n        , pp.performance_period_end\n        , pp.measure_id\n        , pp.measure_name\n        , pp.measure_version\n        , visits_encounters.encounter_end_date as discharge_date\n        , 1 as denominator_flag\n    from patients_with_age\n    cross join dev_tom.quality_measures._int_nqf0097__performance_period pp\n    inner join visits_encounters\n        on patients_with_age.patient_id = visits_encounters.patient_id\n    where max_age >= 18\n        and visits_encounters.length_of_stay > 0 --ensures inpatient\n)\n\n, add_data_types as (\n\n    select\n          cast(patient_id as TEXT) as patient_id\n        , cast(age as integer) as age\n        , cast(performance_period_begin as date) as performance_period_begin\n        , cast(performance_period_end as date) as performance_period_end\n        , cast(measure_id as TEXT) as measure_id\n        , cast(measure_name as TEXT) as measure_name\n        , cast(measure_version as TEXT) as measure_version\n        , cast(discharge_date as date) as discharge_date\n        , cast(denominator_flag as integer) as denominator_flag\n    from qualifying_patients\n\n)\n\nselect \n      patient_id\n    , age\n    , performance_period_begin\n    , performance_period_end\n    , measure_id\n    , measure_name\n    , measure_version\n    , discharge_date\n    , denominator_flag\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.quality_measures._int_nqf0097_denominator"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.648673Z", "completed_at": "2024-08-23T19:21:35.674884Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.675349Z", "completed_at": "2024-08-23T19:21:35.675353Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.0276339054107666, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_nqf2372_denominator", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__quality_measures__stg_core__patient as (\n\nselect\n      patient_id\n    , sex\n    , birth_date\n    , death_date\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.patient\n),  __dbt__cte__quality_measures__stg_core__encounter as (\n\n\nselect\n      patient_id\n    , encounter_id\n    , encounter_type\n    , length_of_stay\n    , encounter_start_date\n    , encounter_end_date\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.encounter\n\n\n),  __dbt__cte__quality_measures__stg_medical_claim as (\n\n\nselect\n      patient_id\n    , claim_id\n    , claim_start_date\n    , claim_end_date\n    , place_of_service_code\n    , hcpcs_code\n    , hcpcs_modifier_1\n    , hcpcs_modifier_2\n    , hcpcs_modifier_3\n    , hcpcs_modifier_4\n    , hcpcs_modifier_5\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.medical_claim\n\n\n),  __dbt__cte__quality_measures__stg_core__procedure as (\n\nselect\n      patient_id\n    , encounter_id\n    , procedure_date\n    , source_code_type\n    , source_code\n    , normalized_code_type\n    , normalized_code\n    , modifier_1\n    , modifier_2\n    , modifier_3\n    , modifier_4\n    , modifier_5\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.procedure\n), performance_period as (\n\n    select\n          measure_id\n        , measure_name\n        , measure_version\n        , performance_period_end\n        , performance_period_begin\n        , performance_period_lookback\n    from dev_tom.quality_measures._int_nqf2372__performance_period\n\n)\n\n, patient as (\n\n    select\n          patient_id\n        , sex\n        , birth_date\n        , death_date\n    from __dbt__cte__quality_measures__stg_core__patient\n\n)\n\n, encounters as (\n\n    select\n          patient_id\n        , encounter_type\n        , encounter_start_date\n    from __dbt__cte__quality_measures__stg_core__encounter\n\n)\n\n, medical_claim as (\n\n    select\n          patient_id\n        , claim_start_date\n        , claim_end_date\n        , hcpcs_code\n    from __dbt__cte__quality_measures__stg_medical_claim\n\n)\n\n, procedures as (\n\n    select\n          patient_id\n        , procedure_date\n        , coalesce (\n              normalized_code_type\n            , case\n                when lower(source_code_type) = 'cpt' then 'hcpcs'\n                when lower(source_code_type) = 'snomed' then 'snomed-ct'\n                else lower(source_code_type)\n              end\n          ) as code_type\n        , coalesce (\n              normalized_code\n            , source_code\n          ) as code\n    from __dbt__cte__quality_measures__stg_core__procedure\n\n)\n\n, visit_codes as (\n\n    select\n          code\n        , code_system\n    from dev_tom.quality_measures._value_set_codes\n    where concept_name in (\n          'Office Visit'\n        , 'Home Healthcare Services'\n        , 'Preventive Care Services Established Office Visit, 18 and Up'\n        , 'Preventive Care Services Initial Office Visit, 18 and Up'\n        , 'Annual Wellness Visit'\n        , 'Telephone Visits'\n        , 'Online Assessments'\n    )\n\n)\n\n, patient_with_age as (\n\n    select\n          patient.patient_id\n        , patient.sex\n        , patient.birth_date\n        , patient.death_date\n        , performance_period.measure_id\n        , performance_period.measure_name\n        , performance_period.measure_version\n        , performance_period.performance_period_begin\n        , performance_period.performance_period_end\n        , performance_period.performance_period_lookback\n        , floor(datediff(\n        hour,\n        patient.birth_date,\n        performance_period.performance_period_begin\n        ) / 8760.0) as age  -- 365*24 hours in a year\n    from patient\n         cross join performance_period\n\n)\n\n/*\n    Filter patient to living women 51 - 74 years of age\n    at the beginning of the measurement period\n*/\n, patient_filtered as (\n\n    select\n          patient_id\n        , age\n        , measure_id\n        , measure_name\n        , measure_version\n        , performance_period_begin\n        , performance_period_end\n        , performance_period_lookback\n        , 1 as denominator_flag\n    from patient_with_age\n    where lower(sex) = 'female'\n        and age between 51 and 74\n        and death_date is null\n\n)\n\n/*\n    Filter to qualifying visit types by claim procedures\n*/\n, visit_claims as (\n\n    select\n          medical_claim.patient_id\n        , medical_claim.claim_start_date\n        , medical_claim.claim_end_date\n        , medical_claim.hcpcs_code\n    from medical_claim\n         inner join visit_codes\n            on medical_claim.hcpcs_code = visit_codes.code\n    where visit_codes.code_system = 'hcpcs'\n\n)\n\n/*\n    Filter encounters to qualifying visit type\n*/\n, visit_encounters as (\n\n    select\n          patient_id\n        , encounter_start_date\n    from encounters\n    where lower(encounter_type) in (\n          'home health'\n        , 'office visit'\n        , 'outpatient'\n        , 'outpatient rehabilitation'\n        , 'telehealth'\n        )\n\n)\n\n/*\n    Filter to qualifying visit types by procedure\n*/\n, visit_procedures as (\n\n    select\n          procedures.patient_id\n        , procedures.procedure_date\n    from procedures\n         inner join visit_codes\n             on procedures.code = visit_codes.code\n             and procedures.code_type = visit_codes.code_system\n\n)\n\n/*\n    Filter to final eligible population/denominator before exclusions\n    with a qualifying visit during the measurement period\n*/\n, eligible_population as (\n\n    select\n          patient_filtered.patient_id\n        , patient_filtered.age\n        , patient_filtered.measure_id\n        , patient_filtered.measure_name\n        , patient_filtered.measure_version\n        , patient_filtered.performance_period_begin\n        , patient_filtered.performance_period_end\n        , performance_period_lookback\n        , patient_filtered.denominator_flag\n    from patient_filtered\n         left join visit_claims\n            on patient_filtered.patient_id = visit_claims.patient_id\n         left join visit_procedures\n            on patient_filtered.patient_id = visit_procedures.patient_id\n         left join visit_encounters\n            on patient_filtered.patient_id = visit_encounters.patient_id\n    where (\n        visit_claims.claim_start_date\n            between patient_filtered.performance_period_begin\n            and patient_filtered.performance_period_end\n        or visit_claims.claim_end_date\n            between patient_filtered.performance_period_begin\n            and patient_filtered.performance_period_end\n        or visit_procedures.procedure_date\n            between patient_filtered.performance_period_begin\n            and patient_filtered.performance_period_end\n        or visit_encounters.encounter_start_date\n            between patient_filtered.performance_period_begin\n            and patient_filtered.performance_period_end\n    )\n\n)\n\n, add_data_types as (\n\n    select distinct\n          cast(patient_id as TEXT) as patient_id\n        , cast(age as integer) as age\n        , cast(performance_period_begin as date) as performance_period_begin\n        , cast(performance_period_end as date) as performance_period_end\n        , cast(performance_period_lookback as date) as performance_period_lookback\n        , cast(measure_id as TEXT) as measure_id\n        , cast(measure_name as TEXT) as measure_name\n        , cast(measure_version as TEXT) as measure_version\n        , cast(denominator_flag as integer) as denominator_flag\n    from eligible_population\n\n)\n\n select distinct\n      patient_id\n    , age\n    , performance_period_begin\n    , performance_period_end\n    , performance_period_lookback\n    , measure_id\n    , measure_name\n    , measure_version\n    , denominator_flag\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.quality_measures._int_nqf2372_denominator"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.671760Z", "completed_at": "2024-08-23T19:21:35.675832Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.681243Z", "completed_at": "2024-08-23T19:21:35.681246Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.010605812072753906, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.the_tuva_project.not_null_quality_measures__stg_core__encounter_patient_id.a0d82e2159", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nwith __dbt__cte__quality_measures__stg_core__encounter as (\n\n\nselect\n      patient_id\n    , encounter_id\n    , encounter_type\n    , length_of_stay\n    , encounter_start_date\n    , encounter_end_date\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.encounter\n\n\n) select patient_id\nfrom __dbt__cte__quality_measures__stg_core__encounter\nwhere patient_id is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.676247Z", "completed_at": "2024-08-23T19:21:35.682154Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.685379Z", "completed_at": "2024-08-23T19:21:35.685383Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.010337114334106445, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.readmissions__encounter", "compiled": true, "compiled_code": "\n\nwith __dbt__cte__readmissions__stg_core__encounter as (\n\n\nselect\n    encounter_id,\n    patient_id,\n    encounter_start_date,\n    encounter_end_date,\n    discharge_disposition_code,\n    facility_id,\n    ms_drg_code,\n    paid_amount,\n    primary_diagnosis_code,\n    '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.encounter\nwhere encounter_type = 'acute inpatient'\n) -- Staging model for the input layer:\n-- stg_encounter input layer model.\n-- This contains one row for every unique encounter in the dataset.\n\nselect\n    cast(encounter_id as TEXT) as encounter_id,\n    cast(patient_id as TEXT) as patient_id,\n    cast(encounter_start_date as date) as admit_date,\n    cast(encounter_end_date as date) as discharge_date,\n    cast(discharge_disposition_code as TEXT) as discharge_disposition_code,\n    cast(facility_id as TEXT) as facility_id,\n    cast(ms_drg_code as TEXT) as ms_drg_code,\n    cast(paid_amount as numeric(28,6)) as paid_amount,\n    cast(primary_diagnosis_code as TEXT) as primary_diagnosis_code,\n    '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom __dbt__cte__readmissions__stg_core__encounter", "relation_name": "dev_tom.readmissions._int_encounter"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.682519Z", "completed_at": "2024-08-23T19:21:35.688954Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.689332Z", "completed_at": "2024-08-23T19:21:35.689335Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.007828950881958008, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.cms_hcc__int_disabled_interaction_factors", "compiled": true, "compiled_code": "\n\nwith demographics as (\n\n    select\n          patient_id\n        , enrollment_status\n        , institutional_status\n        , model_version\n        , payment_year\n    from dev_tom.cms_hcc._int_demographic_factors\n\n)\n\n, hcc_hierarchy as (\n\n    select\n          patient_id\n        , hcc_code\n        , model_version\n    from dev_tom.cms_hcc._int_hcc_hierarchy\n\n)\n\n, seed_interaction_factors as (\n\n    select\n          model_version\n        , factor_type\n        , enrollment_status\n        , institutional_status\n        , short_name\n        , description\n        , hcc_code\n        , coefficient\n    from dev_tom.cms_hcc._value_set_disabled_interaction_factors\n\n)\n\n, demographics_with_hccs as (\n\n    select\n          demographics.patient_id\n        , demographics.enrollment_status\n        , demographics.institutional_status\n        , demographics.model_version\n        , demographics.payment_year\n        , hcc_hierarchy.hcc_code\n    from demographics\n        inner join hcc_hierarchy\n            on demographics.patient_id = hcc_hierarchy.patient_id\n            and demographics.model_version = hcc_hierarchy.model_version\n\n)\n\n, interactions as (\n\n    select\n          demographics_with_hccs.patient_id\n        , demographics_with_hccs.model_version\n        , demographics_with_hccs.payment_year\n        , seed_interaction_factors.factor_type\n        , seed_interaction_factors.description\n        , seed_interaction_factors.coefficient\n    from demographics_with_hccs\n        inner join seed_interaction_factors\n            on demographics_with_hccs.enrollment_status = seed_interaction_factors.enrollment_status\n            and demographics_with_hccs.institutional_status = seed_interaction_factors.institutional_status\n            and demographics_with_hccs.hcc_code = seed_interaction_factors.hcc_code\n            and demographics_with_hccs.model_version = seed_interaction_factors.model_version\n\n)\n\n, add_data_types as (\n\nselect\n      cast(patient_id as TEXT) as patient_id\n    , cast(description as TEXT) as description\n    , round(cast(coefficient as numeric(28,6)),3) as coefficient\n    , cast(factor_type as TEXT) as factor_type\n    , cast(model_version as TEXT) as model_version\n    , cast(payment_year as integer) as payment_year\nfrom interactions\n\n)\n\nselect\n      patient_id\n    , description\n    , coefficient\n    , factor_type\n    , model_version\n    , payment_year\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.cms_hcc._int_disabled_interaction_factors"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.686118Z", "completed_at": "2024-08-23T19:21:35.689954Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.693387Z", "completed_at": "2024-08-23T19:21:35.693389Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.011097192764282227, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.cms_hcc__int_disease_factors", "compiled": true, "compiled_code": "\n\nwith demographics as (\n\n    select\n          patient_id\n        , enrollment_status\n        , gender\n        , age_group\n        , medicaid_status\n        , dual_status\n        , orec\n        , institutional_status\n        , model_version\n        , payment_year\n    from dev_tom.cms_hcc._int_demographic_factors\n\n)\n\n, hcc_hierarchy as (\n\n    select\n          patient_id\n        , hcc_code\n        , model_version\n    from dev_tom.cms_hcc._int_hcc_hierarchy\n\n)\n\n, seed_disease_factors as (\n\n    select\n          model_version\n        , factor_type\n        , enrollment_status\n        , medicaid_status\n        , dual_status\n        , orec\n        , institutional_status\n        , hcc_code\n        , description\n        , coefficient\n    from dev_tom.cms_hcc._value_set_disease_factors\n\n)\n\n, demographics_with_hccs as (\n\n    select\n          demographics.patient_id\n        , demographics.enrollment_status\n        , demographics.gender\n        , demographics.age_group\n        , demographics.medicaid_status\n        , demographics.dual_status\n        , demographics.orec\n        , demographics.institutional_status\n        , demographics.model_version\n        , demographics.payment_year\n        , hcc_hierarchy.hcc_code\n    from demographics\n        inner join hcc_hierarchy\n            on demographics.patient_id = hcc_hierarchy.patient_id\n            and demographics.model_version = hcc_hierarchy.model_version\n\n)\n\n, disease_factors as (\n\n    select\n          demographics_with_hccs.patient_id\n        , demographics_with_hccs.hcc_code\n        , demographics_with_hccs.model_version\n        , demographics_with_hccs.payment_year\n        , seed_disease_factors.factor_type\n        , seed_disease_factors.description\n        , seed_disease_factors.coefficient\n    from demographics_with_hccs\n        inner join seed_disease_factors\n            on demographics_with_hccs.enrollment_status = seed_disease_factors.enrollment_status\n            and demographics_with_hccs.medicaid_status = seed_disease_factors.medicaid_status\n            and demographics_with_hccs.dual_status = seed_disease_factors.dual_status\n            and demographics_with_hccs.orec = seed_disease_factors.orec\n            and demographics_with_hccs.institutional_status = seed_disease_factors.institutional_status\n            and demographics_with_hccs.hcc_code = seed_disease_factors.hcc_code\n            and demographics_with_hccs.model_version = seed_disease_factors.model_version\n\n)\n\n, add_data_types as (\n\n    select\n          cast(patient_id as TEXT) as patient_id\n        , cast(hcc_code as TEXT) as hcc_code\n        , cast(description as TEXT) as hcc_description\n        , round(cast(coefficient as numeric(28,6)),3) as coefficient\n        , cast(factor_type as TEXT) as factor_type\n        , cast(model_version as TEXT) as model_version\n        , cast(payment_year as integer) as payment_year\n    from disease_factors\n\n)\n\nselect\n      patient_id\n    , hcc_code\n    , hcc_description\n    , coefficient\n    , factor_type\n    , model_version\n    , payment_year\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.cms_hcc._int_disease_factors"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.690141Z", "completed_at": "2024-08-23T19:21:35.694048Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.697300Z", "completed_at": "2024-08-23T19:21:35.697304Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.008209228515625, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.cms_hcc__int_disease_interaction_factors", "compiled": true, "compiled_code": "\n\nwith demographics as (\n\n    select\n          patient_id\n        , enrollment_status\n        , gender\n        , age_group\n        , medicaid_status\n        , dual_status\n        , orec\n        , institutional_status\n        , model_version\n        , payment_year\n    from dev_tom.cms_hcc._int_demographic_factors\n\n)\n\n, hcc_hierarchy as (\n\n    select\n          patient_id\n        , hcc_code\n        , model_version\n    from dev_tom.cms_hcc._int_hcc_hierarchy\n\n)\n\n, seed_interaction_factors as (\n\n    select\n          model_version\n        , factor_type\n        , enrollment_status\n        , medicaid_status\n        , dual_status\n        , orec\n        , institutional_status\n        , short_name\n        , description\n        , hcc_code_1\n        , hcc_code_2\n        , coefficient\n    from dev_tom.cms_hcc._value_set_disease_interaction_factors\n\n)\n\n, demographics_with_hccs as (\n\n    select\n          demographics.patient_id\n        , demographics.enrollment_status\n        , demographics.medicaid_status\n        , demographics.dual_status\n        , demographics.orec\n        , demographics.institutional_status\n        , demographics.model_version\n        , demographics.payment_year\n        , hcc_hierarchy.hcc_code\n    from demographics\n        inner join hcc_hierarchy\n            on demographics.patient_id = hcc_hierarchy.patient_id\n            and demographics.model_version = hcc_hierarchy.model_version\n\n)\n\n, demographics_with_interactions as (\n\n    select\n          demographics_with_hccs.patient_id\n        , demographics_with_hccs.model_version\n        , demographics_with_hccs.payment_year\n        , interactions_code_1.factor_type\n        , interactions_code_1.description\n        , interactions_code_1.hcc_code_1\n        , interactions_code_1.hcc_code_2\n        , interactions_code_1.coefficient\n    from demographics_with_hccs\n        inner join seed_interaction_factors as interactions_code_1\n            on demographics_with_hccs.enrollment_status = interactions_code_1.enrollment_status\n            and demographics_with_hccs.medicaid_status = interactions_code_1.medicaid_status\n            and demographics_with_hccs.dual_status = interactions_code_1.dual_status\n            and demographics_with_hccs.orec = interactions_code_1.orec\n            and demographics_with_hccs.institutional_status = interactions_code_1.institutional_status\n            and demographics_with_hccs.hcc_code = interactions_code_1.hcc_code_1\n            and demographics_with_hccs.model_version = interactions_code_1.model_version\n\n)\n\n, disease_interactions as (\n\n    select\n          demographics_with_interactions.patient_id\n        , demographics_with_interactions.factor_type\n        , demographics_with_interactions.hcc_code_1\n        , demographics_with_interactions.hcc_code_2\n        , demographics_with_interactions.description\n        , demographics_with_interactions.coefficient\n        , demographics_with_interactions.model_version\n        , demographics_with_interactions.payment_year\n    from demographics_with_interactions\n        inner join demographics_with_hccs as interactions_code_2\n            on demographics_with_interactions.patient_id = interactions_code_2.patient_id\n            and demographics_with_interactions.hcc_code_2 = interactions_code_2.hcc_code\n            and demographics_with_interactions.model_version = interactions_code_2.model_version\n)\n\n, add_data_types as (\n\n    select\n          cast(patient_id as TEXT) as patient_id\n        , cast(hcc_code_1 as TEXT) as hcc_code_1\n        , cast(hcc_code_2 as TEXT) as hcc_code_2\n        , cast(description as TEXT) as description\n        , round(cast(coefficient as numeric(28,6)),3) as coefficient\n        , cast(factor_type as TEXT) as factor_type\n        , cast(model_version as TEXT) as model_version\n        , cast(payment_year as integer) as payment_year\n    from disease_interactions\n\n)\n\nselect\n      patient_id\n    , hcc_code_1\n    , hcc_code_2\n    , description\n    , coefficient\n    , factor_type\n    , model_version\n    , payment_year\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.cms_hcc._int_disease_interaction_factors"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.694221Z", "completed_at": "2024-08-23T19:21:35.702442Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.702834Z", "completed_at": "2024-08-23T19:21:35.702837Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.009649038314819336, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.cms_hcc__int_hcc_count_factors", "compiled": true, "compiled_code": "\n\nwith demographics as (\n\n    select\n          patient_id\n        , enrollment_status\n        , medicaid_status\n        , dual_status\n        , orec\n        , institutional_status\n        , model_version\n        , payment_year\n    from dev_tom.cms_hcc._int_demographic_factors\n\n)\n\n, seed_payment_hcc_count_factors as (\n\n    select\n          model_version\n        , factor_type\n        , enrollment_status\n        , medicaid_status\n        , dual_status\n        , orec\n        , institutional_status\n        , payment_hcc_count\n        , description\n        , coefficient\n    from dev_tom.cms_hcc._value_set_payment_hcc_count_factors\n\n)\n\n, hcc_hierarchy as (\n\n    select\n          patient_id\n        , hcc_code\n        , model_version\n    from dev_tom.cms_hcc._int_hcc_hierarchy\n\n)\n\n, demographics_with_hcc_counts as (\n\n    select\n          demographics.patient_id\n        , demographics.enrollment_status\n        , demographics.medicaid_status\n        , demographics.dual_status\n        , demographics.orec\n        , demographics.institutional_status\n        , demographics.model_version\n        , demographics.payment_year\n        , count(hcc_hierarchy.hcc_code) as hcc_count\n    from demographics\n        inner join hcc_hierarchy\n            on demographics.patient_id = hcc_hierarchy.patient_id\n            and demographics.model_version = hcc_hierarchy.model_version\n    group by\n          demographics.patient_id\n        , demographics.enrollment_status\n        , demographics.medicaid_status\n        , demographics.dual_status\n        , demographics.orec\n        , demographics.institutional_status\n        , demographics.model_version\n        , demographics.payment_year\n\n)\n\n, hcc_counts_normalized as (\n\n    select\n          patient_id\n        , enrollment_status\n        , medicaid_status\n        , dual_status\n        , orec\n        , institutional_status\n        , model_version\n        , payment_year\n        , case\n            when hcc_count >= 10 then '>=10'\n            else cast(hcc_count as TEXT)\n          end as hcc_count_string\n    from demographics_with_hcc_counts\n\n)\n\n, hcc_counts as (\n\n    select\n          hcc_counts_normalized.patient_id\n        , hcc_counts_normalized.model_version\n        , hcc_counts_normalized.payment_year\n        , seed_payment_hcc_count_factors.factor_type\n        , seed_payment_hcc_count_factors.description\n        , seed_payment_hcc_count_factors.coefficient\n    from hcc_counts_normalized\n        inner join seed_payment_hcc_count_factors\n            on hcc_counts_normalized.enrollment_status = seed_payment_hcc_count_factors.enrollment_status\n            and hcc_counts_normalized.medicaid_status = seed_payment_hcc_count_factors.medicaid_status\n            and hcc_counts_normalized.dual_status = seed_payment_hcc_count_factors.dual_status\n            and hcc_counts_normalized.orec = seed_payment_hcc_count_factors.orec\n            and hcc_counts_normalized.institutional_status = seed_payment_hcc_count_factors.institutional_status\n            and hcc_counts_normalized.hcc_count_string = seed_payment_hcc_count_factors.payment_hcc_count\n            and hcc_counts_normalized.model_version = seed_payment_hcc_count_factors.model_version\n\n)\n\n, add_data_types as (\n\n    select\n          cast(patient_id as TEXT) as patient_id\n        , cast(description as TEXT) as description\n        , round(cast(coefficient as numeric(28,6)),3) as coefficient\n        , cast(factor_type as TEXT) as factor_type\n        , cast(model_version as TEXT) as model_version\n        , cast(payment_year as integer) as payment_year\n    from hcc_counts\n\n)\n\nselect\n      patient_id\n    , description\n    , coefficient\n    , factor_type\n    , model_version\n    , payment_year\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.cms_hcc._int_hcc_count_factors"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.698021Z", "completed_at": "2024-08-23T19:21:35.703465Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.708341Z", "completed_at": "2024-08-23T19:21:35.708344Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.011254072189331055, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.hcc_suspecting__int_comorbidity_suspects", "compiled": true, "compiled_code": "\n\nwith conditions as (\n\n    select\n          patient_id\n        , recorded_date\n        , condition_type\n        , code_type\n        , code\n        , data_source\n    from dev_tom.hcc_suspecting._int_prep_conditions\n\n)\n\n, seed_clinical_concepts as (\n\n    select\n          concept_name\n        , code\n        , code_system\n    from dev_tom.hcc_suspecting._value_set_clinical_concepts\n\n)\n\n, seed_hcc_descriptions as (\n\n    select distinct\n          hcc_code\n        , hcc_description\n    from dev_tom.hcc_suspecting._value_set_hcc_descriptions\n\n)\n\n, billed_hccs as (\n\n    select distinct\n          patient_id\n        , data_source\n        , hcc_code\n        , current_year_billed\n    from dev_tom.hcc_suspecting._int_patient_hcc_history\n\n)\n\n/* BEGIN HCC 37 logic */\n, ckd_stage_1_or_2 as (\n\n    select\n          conditions.patient_id\n        , conditions.recorded_date\n        , conditions.condition_type\n        , conditions.code_type\n        , conditions.code\n        , conditions.data_source\n        , seed_clinical_concepts.concept_name\n        , row_number() over (\n            partition by\n                  conditions.patient_id\n                , conditions.data_source\n            order by\n                  conditions.recorded_date desc\n                , conditions.code desc\n          ) as row_num\n    from conditions\n        inner join seed_clinical_concepts\n            on conditions.code_type = seed_clinical_concepts.code_system\n            and conditions.code = seed_clinical_concepts.code\n    where lower(seed_clinical_concepts.concept_name) in (\n          'chronic kidney disease, stage 1'\n        , 'chronic kidney disease, stage 2'\n    )\n\n)\n\n, ckd_stage_1_or_2_dedupe as (\n\n    select\n          patient_id\n        , recorded_date\n        , condition_type\n        , code_type\n        , code\n        , data_source\n        , concept_name\n    from ckd_stage_1_or_2\n    where row_num = 1\n\n)\n\n, diabetes as (\n\n    select\n          conditions.patient_id\n        , conditions.recorded_date\n        , conditions.condition_type\n        , conditions.code_type\n        , conditions.code\n        , conditions.data_source\n        , seed_clinical_concepts.concept_name\n        , row_number() over (\n            partition by\n                  conditions.patient_id\n                , conditions.data_source\n            order by\n                  conditions.recorded_date desc\n                , conditions.code desc\n          ) as row_num\n    from conditions\n        inner join seed_clinical_concepts\n            on conditions.code_type = seed_clinical_concepts.code_system\n            and conditions.code = seed_clinical_concepts.code\n    where lower(seed_clinical_concepts.concept_name) = 'diabetes'\n)\n\n, diabetes_dedupe as (\n\n    select\n          patient_id\n        , recorded_date\n        , condition_type\n        , code_type\n        , code\n        , data_source\n        , concept_name\n    from diabetes\n    where row_num = 1\n\n)\n\n, hcc_37_suspect as (\n\n    select\n          diabetes_dedupe.patient_id\n        , diabetes_dedupe.data_source\n        , seed_hcc_descriptions.hcc_code\n        , seed_hcc_descriptions.hcc_description\n        , diabetes_dedupe.concept_name as condition_1_concept_name\n        , diabetes_dedupe.code as condition_1_code\n        , diabetes_dedupe.recorded_date as condition_1_recorded_date\n        , ckd_stage_1_or_2_dedupe.concept_name as condition_2_concept_name\n        , ckd_stage_1_or_2_dedupe.code as condition_2_code\n        , ckd_stage_1_or_2_dedupe.recorded_date as condition_2_recorded_date\n    from diabetes_dedupe\n        inner join ckd_stage_1_or_2_dedupe\n            on diabetes_dedupe.patient_id = ckd_stage_1_or_2_dedupe.patient_id\n            and diabetes_dedupe.data_source = ckd_stage_1_or_2_dedupe.data_source\n            /* ensure conditions overlap in the same year */\n            and date_part('year', diabetes_dedupe.recorded_date) = date_part('year', ckd_stage_1_or_2_dedupe.recorded_date)\n        inner join seed_hcc_descriptions\n            on hcc_code = '37'\n\n)\n/* END HCC 37 logic */\n\n, unioned as (\n\n    select * from hcc_37_suspect\n\n)\n\n, add_billed_flag as (\n\n    select\n          unioned.patient_id\n        , unioned.data_source\n        , unioned.hcc_code\n        , unioned.hcc_description\n        , unioned.condition_1_concept_name\n        , unioned.condition_1_code\n        , unioned.condition_1_recorded_date\n        , unioned.condition_2_concept_name\n        , unioned.condition_2_code\n        , unioned.condition_2_recorded_date\n        , billed_hccs.current_year_billed\n    from unioned\n        left join billed_hccs\n            on unioned.patient_id = billed_hccs.patient_id\n            and unioned.data_source = billed_hccs.data_source\n            and unioned.hcc_code = billed_hccs.hcc_code\n\n)\n\n, add_standard_fields as (\n\n    select\n          patient_id\n        , data_source\n        , hcc_code\n        , hcc_description\n        , condition_1_concept_name\n        , condition_1_code\n        , condition_1_recorded_date\n        , condition_2_concept_name\n        , condition_2_code\n        , condition_2_recorded_date\n        , current_year_billed\n        , cast('Comorbidity suspect' as TEXT) as reason\n        , condition_1_concept_name || ' (' || condition_1_code || ') on ' || condition_1_recorded_date || ') and ' || condition_2_concept_name || ' (' || condition_2_code || ') on ' || condition_2_recorded_date as contributing_factor\n        , condition_1_recorded_date as suspect_date\n    from add_billed_flag\n\n)\n\n\n, add_data_types as (\n\n    select\n          cast(patient_id as TEXT) as patient_id\n        , cast(data_source as TEXT) as data_source\n        , cast(hcc_code as TEXT) as hcc_code\n        , cast(hcc_description as TEXT) as hcc_description\n        , cast(condition_1_concept_name as TEXT) as condition_1_concept_name\n        , cast(condition_1_code as TEXT) as condition_1_code\n        , cast(condition_1_recorded_date as date) as condition_1_recorded_date\n        , cast(condition_2_concept_name as TEXT) as condition_2_concept_name\n        , cast(condition_2_code as TEXT) as condition_2_code\n        , cast(condition_2_recorded_date as date) as condition_2_recorded_date\n        \n            , cast(current_year_billed as boolean) as current_year_billed\n        \n        , cast(reason as TEXT) as reason\n        , cast(contributing_factor as TEXT) as contributing_factor\n        , cast(suspect_date as date) as suspect_date\n    from add_standard_fields\n\n)\n\nselect\n      patient_id\n    , data_source\n    , hcc_code\n    , hcc_description\n    , condition_1_concept_name\n    , condition_1_code\n    , condition_1_recorded_date\n    , condition_2_concept_name\n    , condition_2_code\n    , condition_2_recorded_date\n    , current_year_billed\n    , reason\n    , contributing_factor\n    , suspect_date\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.hcc_suspecting._int_comorbidity_suspects"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.703644Z", "completed_at": "2024-08-23T19:21:35.709029Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.713129Z", "completed_at": "2024-08-23T19:21:35.713132Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.010548114776611328, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.hcc_suspecting__int_lab_suspects", "compiled": true, "compiled_code": "\n\nwith egfr_labs as (\n\n    select\n          patient_id\n        , data_source\n        , code_type\n        , code\n        , result_date\n        , result\n    from dev_tom.hcc_suspecting._int_prep_egfr_labs\n\n)\n\n, seed_hcc_descriptions as (\n\n    select distinct\n          hcc_code\n        , hcc_description\n    from dev_tom.hcc_suspecting._value_set_hcc_descriptions\n\n)\n\n, billed_hccs as (\n\n    select distinct\n          patient_id\n        , data_source\n        , hcc_code\n        , current_year_billed\n    from dev_tom.hcc_suspecting._int_patient_hcc_history\n\n)\n\n/* BEGIN CKD logic */\n\n/*\n    Find a patient\u2019s two most recent eGFR lab results that are spaced by at\n    least 90 days.\n*/\n, max_lab_date as (\n\n    select\n          patient_id\n        , data_source\n        , max(result_date) as max_result_date\n    from egfr_labs\n    group by\n          patient_id\n        , data_source\n\n)\n\n, lab_lookback as (\n\n    select\n          egfr_labs.patient_id\n        , egfr_labs.data_source\n        , max_lab_date.max_result_date\n        , max(egfr_labs.result_date) as lookback_result_date\n    from egfr_labs\n        left join max_lab_date\n        on egfr_labs.patient_id = max_lab_date.patient_id\n        and egfr_labs.data_source = max_lab_date.data_source\n    where egfr_labs.result_date <= \n\n    dateadd(\n        day,\n        -90,\n        max_result_date\n        )\n\n\n    group by\n          egfr_labs.patient_id\n        , egfr_labs.data_source\n        , max_lab_date.max_result_date\n\n)\n\n/*\n    Take the highest eGFR result that occurred between the date range.\n*/\n, eligible_labs as (\n\n    select\n          egfr_labs.patient_id\n        , egfr_labs.data_source\n        , egfr_labs.code_type\n        , egfr_labs.code\n        , egfr_labs.result_date\n        , egfr_labs.result\n        , row_number() over (\n            partition by\n                  egfr_labs.patient_id\n                , egfr_labs.data_source\n            order by egfr_labs.result desc\n        ) as row_num\n    from egfr_labs\n        inner join lab_lookback\n        on egfr_labs.patient_id = lab_lookback.patient_id\n        and egfr_labs.data_source = lab_lookback.data_source\n    where egfr_labs.result_date >= lab_lookback.lookback_result_date\n\n)\n\n/*\n    Assign a patient's kidney disease stage based on the highest eGFR based on\n    the following range:\n\n    CKD 3a: eGFR in the range (45-59)\n    CKD 3b: eGFR in the range (30-44)\n    CKD 4: eGFR in the range (15-29)\n    CKD 5: eGFR in the range (0-14)\n*/\n, ckd_suspects as (\n\n    select\n          patient_id\n        , data_source\n        , code_type\n        , code as lab_code\n        , result_date\n        , result\n        , case\n            when result between 0 and 14 then '326'\n            when result between 15 and 29 then '327'\n            when result between 30 and 44 then '328'\n            when result between 45 and 59 then '329'\n          end as hcc_code\n        , 'eGFR (' || code || ') result ' || result || ' on ' || result_date as contributing_factor\n    from eligible_labs\n    where row_num = 1\n\n)\n/* END CKD logic */\n\n, unioned as (\n\n    select * from ckd_suspects\n\n)\n\n, add_billed_flag as (\n\n    select\n          unioned.patient_id\n        , unioned.data_source\n        , unioned.result_date\n        , unioned.result\n        , unioned.lab_code\n        , unioned.hcc_code\n        , unioned.contributing_factor\n        , seed_hcc_descriptions.hcc_description\n        , billed_hccs.current_year_billed\n    from unioned\n        inner join seed_hcc_descriptions\n            on unioned.hcc_code = seed_hcc_descriptions.hcc_code\n        left join billed_hccs\n            on unioned.patient_id = billed_hccs.patient_id\n            and unioned.data_source = billed_hccs.data_source\n            and unioned.hcc_code = billed_hccs.hcc_code\n\n)\n\n, add_standard_fields as (\n\n    select\n          patient_id\n        , data_source\n        , result_date\n        , result\n        , lab_code\n        , hcc_code\n        , hcc_description\n        , contributing_factor\n        , current_year_billed\n        , cast('Lab result suspect' as TEXT) as reason\n        , result_date as suspect_date\n    from add_billed_flag\n\n)\n\n, add_data_types as (\n\n    select\n          cast(patient_id as TEXT) as patient_id\n        , cast(data_source as TEXT) as data_source\n        , cast(result_date as date) as result_date\n        , cast(result as numeric(28,6)) as result\n        , cast(lab_code as TEXT) as lab_code\n        , cast(hcc_code as TEXT) as hcc_code\n        , cast(hcc_description as TEXT) as hcc_description\n        \n            , cast(current_year_billed as boolean) as current_year_billed\n        \n        , cast(reason as TEXT) as reason\n        , cast(contributing_factor as TEXT) as contributing_factor\n        , cast(suspect_date as date) as suspect_date\n    from add_standard_fields\n\n)\n\nselect\n      patient_id\n    , data_source\n    , result_date\n    , result\n    , lab_code\n    , hcc_code\n    , hcc_description\n    , current_year_billed\n    , reason\n    , contributing_factor\n    , suspect_date\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.hcc_suspecting._int_lab_suspects"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.709192Z", "completed_at": "2024-08-23T19:21:35.713799Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.760233Z", "completed_at": "2024-08-23T19:21:35.760237Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.05212211608886719, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.hcc_suspecting__int_medication_suspects", "compiled": true, "compiled_code": "\n\nwith all_medications as (\n\n    select\n          patient_id\n        , dispensing_date\n        , drug_code\n        , code_system\n        , data_source\n    from dev_tom.hcc_suspecting._int_all_medications\n\n)\n\n, seed_clinical_concepts as (\n\n    select\n          concept_name\n        , code\n        , code_system\n    from dev_tom.hcc_suspecting._value_set_clinical_concepts\n\n)\n\n, seed_hcc_descriptions as (\n\n    select distinct\n          hcc_code\n        , hcc_description\n    from dev_tom.hcc_suspecting._value_set_hcc_descriptions\n\n)\n\n, billed_hccs as (\n\n    select distinct\n          patient_id\n        , data_source\n        , hcc_code\n        , current_year_billed\n    from dev_tom.hcc_suspecting._int_patient_hcc_history\n\n)\n\n/* BEGIN HCC 155 logic (Major Depression, Moderate or Severe, without Psychosis)\n\n   antidepressant medication taken within the past five years\n*/\n, hcc_155_suspect as (\n\n    select\n          all_medications.patient_id\n        , all_medications.dispensing_date\n        , all_medications.drug_code\n        , all_medications.code_system\n        , all_medications.data_source\n        , seed_clinical_concepts.concept_name\n        , seed_hcc_descriptions.hcc_code\n        , seed_hcc_descriptions.hcc_description\n    from all_medications\n        inner join seed_clinical_concepts\n            on all_medications.code_system = seed_clinical_concepts.code_system\n            and all_medications.drug_code = seed_clinical_concepts.code\n        inner join seed_hcc_descriptions\n            on hcc_code = '155'\n    where lower(seed_clinical_concepts.concept_name) = 'antidepressant medication'\n    and all_medications.dispensing_date >= \n\n    dateadd(\n        year,\n        -5,\n        convert_timezone('UTC', current_timestamp())\n        )\n\n\n\n)\n/* END HCC 155 logic */\n\n, unioned as (\n\n    select * from hcc_155_suspect\n\n)\n\n, add_billed_flag as (\n\n    select\n          unioned.patient_id\n        , unioned.data_source\n        , unioned.hcc_code\n        , unioned.hcc_description\n        , unioned.concept_name\n        , unioned.dispensing_date\n        , unioned.drug_code\n        , billed_hccs.current_year_billed\n    from unioned\n        left join billed_hccs\n            on unioned.patient_id = billed_hccs.patient_id\n            and unioned.data_source = billed_hccs.data_source\n            and unioned.hcc_code = billed_hccs.hcc_code\n)\n\n, add_standard_fields as (\n\n    select\n          patient_id\n        , data_source\n        , hcc_code\n        , hcc_description\n        , dispensing_date\n        , drug_code\n        , current_year_billed\n        , cast('Medication suspect' as TEXT) as reason\n        , concept_name || drug_code || ') dispensed on ' || dispensing_date as contributing_factor\n        , dispensing_date as suspect_date\n    from add_billed_flag\n\n)\n\n, add_data_types as (\n\n    select\n          cast(patient_id as TEXT) as patient_id\n        , cast(data_source as TEXT) as data_source\n        , cast(hcc_code as TEXT) as hcc_code\n        , cast(hcc_description as TEXT) as hcc_description\n        , cast(dispensing_date as date) as dispensing_date\n        , cast(drug_code as TEXT) as drug_code\n        \n            , cast(current_year_billed as boolean) as current_year_billed\n        \n        , cast(reason as TEXT) as reason\n        , cast(contributing_factor as TEXT) as contributing_factor\n        , cast(suspect_date as date) as suspect_date\n    from add_standard_fields\n\n)\n\nselect\n      patient_id\n    , data_source\n    , hcc_code\n    , hcc_description\n    , dispensing_date\n    , drug_code\n    , current_year_billed\n    , reason\n    , contributing_factor\n    , suspect_date\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.hcc_suspecting._int_medication_suspects"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.713949Z", "completed_at": "2024-08-23T19:21:35.770276Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.770770Z", "completed_at": "2024-08-23T19:21:35.770774Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.05784201622009277, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.hcc_suspecting__int_observation_suspects", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__hcc_suspecting__stg_core__observation as (\n\n\nselect\n      patient_id\n    , observation_date\n    , result\n    , lower(coalesce(normalized_code_type,source_code_type)) as code_type\n    , coalesce(normalized_code,source_code) as code\n    , data_source\nfrom dev_tom.core.observation\n\n\n), conditions as (\n\n    select\n          patient_id\n        , recorded_date\n        , condition_type\n        , code_type\n        , code\n        , data_source\n    from dev_tom.hcc_suspecting._int_prep_conditions\n\n)\n\n, observations as (\n\n    select\n          patient_id\n        , observation_date\n        , result\n        , code_type\n        , code\n        , data_source\n    from __dbt__cte__hcc_suspecting__stg_core__observation\n\n)\n\n, numeric_observations as (\n\n    select\n          patient_id\n        , observation_date\n        \n        , CAST(result AS numeric(28,6)) AS result\n        \n        , code_type\n        , code\n        , data_source\n    from observations\n   \n        where regexp_like(result, '^[+-]?([0-9]*[.])?[0-9]+$')\n    \n\n)\n\n, seed_clinical_concepts as (\n\n    select\n          concept_name\n        , code\n        , code_system\n    from dev_tom.hcc_suspecting._value_set_clinical_concepts\n\n)\n\n, seed_hcc_descriptions as (\n\n    select distinct\n          hcc_code\n        , hcc_description\n    from dev_tom.hcc_suspecting._value_set_hcc_descriptions\n\n)\n\n, billed_hccs as (\n\n    select distinct\n          patient_id\n        , data_source\n        , hcc_code\n        , current_year_billed\n    from dev_tom.hcc_suspecting._int_patient_hcc_history\n\n)\n\n, depression_assessment as (\n\n    select\n          numeric_observations.patient_id\n        , numeric_observations.observation_date\n        , numeric_observations.result\n        , numeric_observations.code_type\n        , numeric_observations.code\n        , numeric_observations.data_source\n        , seed_clinical_concepts.concept_name\n    from numeric_observations\n        inner join seed_clinical_concepts\n            on numeric_observations.code_type = seed_clinical_concepts.code_system\n            and numeric_observations.code = seed_clinical_concepts.code\n    where lower(seed_clinical_concepts.concept_name) = 'depression assessment (phq-9)'\n\n)\n\n, diabetes as (\n\n     select\n          conditions.patient_id\n        , conditions.recorded_date\n        , conditions.condition_type\n        , conditions.code_type\n        , conditions.code\n        , conditions.data_source\n        , seed_clinical_concepts.concept_name\n    from conditions\n        inner join seed_clinical_concepts\n            on conditions.code_type = seed_clinical_concepts.code_system\n            and conditions.code = seed_clinical_concepts.code\n    where lower(seed_clinical_concepts.concept_name) = 'diabetes'\n\n)\n\n, hypertension as (\n\n     select\n          conditions.patient_id\n        , conditions.recorded_date\n        , conditions.condition_type\n        , conditions.code_type\n        , conditions.code\n        , conditions.data_source\n        , seed_clinical_concepts.concept_name\n    from conditions\n        inner join seed_clinical_concepts\n            on conditions.code_type = seed_clinical_concepts.code_system\n            and conditions.code = seed_clinical_concepts.code\n    where lower(seed_clinical_concepts.concept_name) = 'essential hypertension'\n\n)\n\n, obstructive_sleep_apnea as (\n\n     select\n          conditions.patient_id\n        , conditions.recorded_date\n        , conditions.condition_type\n        , conditions.code_type\n        , conditions.code\n        , conditions.data_source\n        , seed_clinical_concepts.concept_name\n    from conditions\n        inner join seed_clinical_concepts\n            on conditions.code_type = seed_clinical_concepts.code_system\n            and conditions.code = seed_clinical_concepts.code\n    where lower(seed_clinical_concepts.concept_name) = 'obstructive sleep apnea'\n\n)\n\n/* BEGIN HCC 48 logic (Morbid Obesity) */\n, bmi_over_30_with_osa as (\n\n    select\n          numeric_observations.patient_id\n        , numeric_observations.data_source\n        , numeric_observations.observation_date\n        , numeric_observations.result as observation_result\n        , obstructive_sleep_apnea.code as condition_code\n        , obstructive_sleep_apnea.recorded_date as condition_date\n        , obstructive_sleep_apnea.concept_name as condition_concept_name\n        , seed_hcc_descriptions.hcc_code\n        , seed_hcc_descriptions.hcc_description\n    from numeric_observations\n        inner join seed_clinical_concepts\n            on numeric_observations.code_type = seed_clinical_concepts.code_system\n            and numeric_observations.code = seed_clinical_concepts.code\n        inner join obstructive_sleep_apnea\n            on numeric_observations.patient_id = obstructive_sleep_apnea.patient_id\n            /* ensure bmi and condition overlaps in the same year */\n            and date_part('year', numeric_observations.observation_date) = date_part('year', obstructive_sleep_apnea.recorded_date)\n        inner join seed_hcc_descriptions\n            on hcc_code = '48'\n    where lower(seed_clinical_concepts.concept_name) = 'bmi'\n    and result >= 30\n\n)\n\n, bmi_over_35_with_diabetes as (\n\n    select\n          numeric_observations.patient_id\n        , numeric_observations.data_source\n        , numeric_observations.observation_date\n        , numeric_observations.result as observation_result\n        , diabetes.code as condition_code\n        , diabetes.recorded_date as condition_date\n        , diabetes.concept_name as condition_concept_name\n        , seed_hcc_descriptions.hcc_code\n        , seed_hcc_descriptions.hcc_description\n    from numeric_observations\n        inner join seed_clinical_concepts\n            on numeric_observations.code_type = seed_clinical_concepts.code_system\n            and numeric_observations.code = seed_clinical_concepts.code\n        inner join diabetes\n            on numeric_observations.patient_id = diabetes.patient_id\n            /* ensure bmi and condition overlaps in the same year */\n            and date_part('year', numeric_observations.observation_date) = date_part('year', diabetes.recorded_date)\n        inner join seed_hcc_descriptions\n            on hcc_code = '48'\n    where lower(seed_clinical_concepts.concept_name) = 'bmi'\n    and result >= 35\n\n)\n\n, bmi_over_35_with_hypertension as (\n\n    select\n          numeric_observations.patient_id\n        , numeric_observations.data_source\n        , numeric_observations.observation_date\n        , numeric_observations.result as observation_result\n        , hypertension.code as condition_code\n        , hypertension.recorded_date as condition_date\n        , hypertension.concept_name as condition_concept_name\n        , seed_hcc_descriptions.hcc_code\n        , seed_hcc_descriptions.hcc_description\n    from numeric_observations\n        inner join seed_clinical_concepts\n            on numeric_observations.code_type = seed_clinical_concepts.code_system\n            and numeric_observations.code = seed_clinical_concepts.code\n        inner join hypertension\n            on numeric_observations.patient_id = hypertension.patient_id\n            /* ensure bmi and condition overlaps in the same year */\n            and date_part('year', numeric_observations.observation_date) = date_part('year', hypertension.recorded_date)\n        inner join seed_hcc_descriptions\n            on hcc_code = '48'\n    where lower(seed_clinical_concepts.concept_name) = 'bmi'\n    and result >= 35\n\n)\n\n, bmi_over_40 as (\n\n    select\n          numeric_observations.patient_id\n        , numeric_observations.data_source\n        , numeric_observations.observation_date\n        , numeric_observations.result as observation_result\n        , cast(null as TEXT) as condition_code\n        , cast(null as date) as condition_date\n        , cast(null as TEXT) as condition_concept_name\n        , seed_hcc_descriptions.hcc_code\n        , seed_hcc_descriptions.hcc_description\n    from numeric_observations\n        inner join seed_clinical_concepts\n            on numeric_observations.code_type = seed_clinical_concepts.code_system\n            and numeric_observations.code = seed_clinical_concepts.code\n        inner join seed_hcc_descriptions\n            on hcc_code = '48'\n    where lower(seed_clinical_concepts.concept_name) = 'bmi'\n    and result >= 40\n\n)\n\n, hcc_48_unioned as (\n\n    select * from bmi_over_30_with_osa\n    union all\n    select * from bmi_over_35_with_diabetes\n    union all\n    select * from bmi_over_35_with_hypertension\n    union all\n    select * from bmi_over_40\n\n)\n\n, hcc_48_suspect as (\n\n    select\n          patient_id\n        , data_source\n        , observation_date\n        , observation_result\n        , condition_code\n        , condition_date\n        , condition_concept_name\n        , hcc_code\n        , hcc_description\n        , 'BMI result ' || observation_result || case when condition_code is null then ''  else ' with ' || condition_concept_name || '(' || condition_code || ' on ' || condition_date || ')' end as contributing_factor\n    from hcc_48_unioned\n\n)\n/* END HCC 48 logic */\n\n/* BEGIN HCC 155 logic (Major Depression, Moderate or Severe, without Psychosis)\n\n   to determine a positive PHQ-9 assessment, we look at the past 3 screenings\n   for a patient and take the highest result\n*/\n, eligible_depression_assessments as (\n\n    select\n          depression_assessment.patient_id\n        , depression_assessment.observation_date\n        , depression_assessment.result\n        , depression_assessment.code_type\n        , depression_assessment.code\n        , depression_assessment.data_source\n        , depression_assessment.concept_name\n        , row_number() over (\n            partition by\n                  depression_assessment.patient_id\n                , depression_assessment.data_source\n            order by\n                case when depression_assessment.observation_date is null then 1 else 0 end,\n                depression_assessment.observation_date desc\n        ) assessment_order\n    from depression_assessment\n\n)\n\n, depression_assessments_ordered as (\n\n    select\n          patient_id\n        , observation_date\n        , code_type\n        , code\n        , data_source\n        , concept_name\n        , result\n        , row_number() over (\n            partition by\n                  patient_id\n                , data_source\n            --order by result desc nulls last\n            order by\n                case when result is null then 1 else 0 end,\n                result desc\n        ) as result_order --order the last three assessments by result value\n    from eligible_depression_assessments\n    where assessment_order <= 3\n\n)\n\n, hcc_155_suspect as (\n\n    select\n          depression_assessments_ordered.patient_id\n        , depression_assessments_ordered.data_source\n        , depression_assessments_ordered.observation_date\n        , depression_assessments_ordered.result as observation_result\n        , cast(null as TEXT) as condition_code\n        , cast(null as date) as condition_date\n        , depression_assessments_ordered.concept_name as condition_concept_name\n        , seed_hcc_descriptions.hcc_code\n        , seed_hcc_descriptions.hcc_description\n        , 'PHQ-9 result ' || depression_assessments_ordered.result || ' on ' || depression_assessments_ordered.observation_date as contributing_factor\n    from depression_assessments_ordered\n        inner join seed_hcc_descriptions\n            on hcc_code = '155'\n    where result_order = 1\n    and result >= 15\n\n)\n\n/* END HCC 155 logic */\n\n, unioned as (\n\n    select * from hcc_48_suspect\n    union all\n    select * from hcc_155_suspect\n\n)\n\n, add_billed_flag as (\n\n    select\n          unioned.patient_id\n        , unioned.data_source\n        , unioned.observation_date\n        , unioned.observation_result\n        , unioned.condition_code\n        , unioned.condition_date\n        , unioned.condition_concept_name\n        , unioned.hcc_code\n        , unioned.hcc_description\n        , unioned.contributing_factor\n        , billed_hccs.current_year_billed\n    from unioned\n        left join billed_hccs\n            on unioned.patient_id = billed_hccs.patient_id\n            and unioned.data_source = billed_hccs.data_source\n            and unioned.hcc_code = billed_hccs.hcc_code\n\n)\n\n, add_standard_fields as (\n\n    select\n          patient_id\n        , data_source\n        , observation_date\n        , observation_result\n        , condition_code\n        , condition_date\n        , condition_concept_name\n        , hcc_code\n        , hcc_description\n        , contributing_factor\n        , current_year_billed\n        , cast('Observation suspect' as TEXT) as reason\n        , observation_date as suspect_date\n    from add_billed_flag\n\n)\n\n, add_data_types as (\n\n    select\n          cast(patient_id as TEXT) as patient_id\n        , cast(data_source as TEXT) as data_source\n        , cast(observation_date as date) as observation_date\n        , cast(observation_result as TEXT) as observation_result\n        , cast(condition_code as TEXT) as condition_code\n        , cast(condition_date as date) as condition_date\n        , cast(condition_concept_name as TEXT) as condition_concept_name\n        , cast(hcc_code as TEXT) as hcc_code\n        , cast(hcc_description as TEXT) as hcc_description\n        \n            , cast(current_year_billed as boolean) as current_year_billed\n        \n        , cast(reason as TEXT) as reason\n        , cast(contributing_factor as TEXT) as contributing_factor\n        , cast(suspect_date as date) as suspect_date\n    from add_standard_fields\n\n)\n\nselect\n      patient_id\n    , data_source\n    , observation_date\n    , observation_result\n    , condition_code\n    , condition_date\n    , condition_concept_name\n    , hcc_code\n    , hcc_description\n    , current_year_billed\n    , reason\n    , contributing_factor\n    , suspect_date\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.hcc_suspecting._int_observation_suspects"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.771032Z", "completed_at": "2024-08-23T19:21:35.775997Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.776413Z", "completed_at": "2024-08-23T19:21:35.776416Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.006562232971191406, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.the_tuva_project.dbt_utils_unique_combination_of_columns_chronic_conditions__cms_chronic_conditions_long_patient_id__claim_id__start_date__condition.8088fbf90d", "compiled": true, "compiled_code": "\n\n\n\n\n\nwith validation_errors as (\n\n    select\n        patient_id, claim_id, start_date, condition\n    from dev_tom.chronic_conditions.cms_chronic_conditions_long\n    group by patient_id, claim_id, start_date, condition\n    having count(*) > 1\n\n)\n\nselect *\nfrom validation_errors\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.774345Z", "completed_at": "2024-08-23T19:21:35.777037Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.777438Z", "completed_at": "2024-08-23T19:21:35.777441Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.003525972366333008, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.the_tuva_project.not_null_chronic_conditions__cms_chronic_conditions_long_claim_id.74242d2abc", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect claim_id\nfrom dev_tom.chronic_conditions.cms_chronic_conditions_long\nwhere claim_id is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.778064Z", "completed_at": "2024-08-23T19:21:35.781953Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.782359Z", "completed_at": "2024-08-23T19:21:35.782362Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.005151987075805664, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.the_tuva_project.not_null_chronic_conditions__cms_chronic_conditions_long_condition.e794460ae3", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect condition\nfrom dev_tom.chronic_conditions.cms_chronic_conditions_long\nwhere condition is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.780197Z", "completed_at": "2024-08-23T19:21:35.783008Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.783360Z", "completed_at": "2024-08-23T19:21:35.783363Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.003622770309448242, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.the_tuva_project.not_null_chronic_conditions__cms_chronic_conditions_long_patient_id.551c145c85", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect patient_id\nfrom dev_tom.chronic_conditions.cms_chronic_conditions_long\nwhere patient_id is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.783646Z", "completed_at": "2024-08-23T19:21:35.791437Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.791650Z", "completed_at": "2024-08-23T19:21:35.791653Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.008850812911987305, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.mart_review__pmpm", "compiled": true, "compiled_code": "\n\n\nSELECT *,\n       total_paid * member_months AS total_paid_absolute,\n       medical_paid * member_months AS medical_paid_absolute,\n       pharmacy_paid * member_months AS pharmacy_paid_absolute,\n       inpatient_paid * member_months AS inpatient_paid_absolute,\n       outpatient_paid * member_months AS outpatient_paid_absolute,\n       office_visit_paid * member_months AS office_visit_paid_absolute,\n       ancillary_paid * member_months AS ancillary_paid_absolute,\n       other_paid * member_months AS other_paid_absolute,\n        data_source || '|' || year_month as data_source_month_key\nFROM dev_tom.financial_pmpm.pmpm_payer", "relation_name": "dev_tom.data_quality.mart_review__pmpm"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.785915Z", "completed_at": "2024-08-23T19:21:35.792136Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.792559Z", "completed_at": "2024-08-23T19:21:35.792562Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0070378780364990234, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.ahrq_measures__int_pqi_shared_exclusion_union", "compiled": true, "compiled_code": "\n\n-- Missing Age Exclusion\nselect \n    denom.encounter_id\n  , denom.data_source\n  , 'missing age' as exclusion_reason\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ahrq_measures._stg_pqi_inpatient_encounter as denom\ninner join dev_tom.ahrq_measures._int_pqi_shared_exclusions_missing_age as age\n  on denom.patient_id = age.patient_id\n  and denom.data_source = age.data_source\n\nunion all\n\n-- Missing Gender Exclusion\nselect \n    denom.encounter_id\n  , denom.data_source\n  , 'missing gender' as exclusion_reason\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ahrq_measures._stg_pqi_inpatient_encounter as denom\ninner join dev_tom.ahrq_measures._int_pqi_shared_exclusion_missing_gender as gender\n  on denom.patient_id = gender.patient_id\n  and denom.data_source = gender.data_source\n\nunion all\n\n-- Missing Dates Exclusion\nselect \n    denom.encounter_id\n  , denom.data_source\n  , 'missing dates' as exclusion_reason\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ahrq_measures._stg_pqi_inpatient_encounter as denom\ninner join dev_tom.ahrq_measures._int_pqi_shared_exclusion_missing_dates as dates\n  on denom.encounter_id = dates.encounter_id\n  and denom.data_source = dates.data_source\n\nunion all\n\n-- Missing Primary Diagnosis Exclusion\nselect \n    denom.encounter_id\n  , denom.data_source\n  , 'missing primary diagnosis' as exclusion_reason\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ahrq_measures._stg_pqi_inpatient_encounter as denom\ninner join dev_tom.ahrq_measures._int_pqi_shared_exclusion_missing_primary_dx as dx\n  on denom.encounter_id = dx.encounter_id\n  and denom.data_source = dx.data_source\n\nunion all\n\n-- Transfer Exclusion\nselect \n    denom.encounter_id\n  , denom.data_source\n  , 'transfer' as exclusion_reason\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ahrq_measures._stg_pqi_inpatient_encounter as denom\ninner join dev_tom.ahrq_measures._int_pqi_shared_exclusion_transfer as tx\n  on denom.encounter_id = tx.encounter_id\n  and denom.data_source = tx.data_source\n\nunion all\n\n-- Ungroupable DRG Exclusion\nselect \n    denom.encounter_id\n  , denom.data_source\n  , 'ungroupable DRG' as exclusion_reason\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ahrq_measures._stg_pqi_inpatient_encounter as denom\ninner join dev_tom.ahrq_measures._int_pqi_shared_exclusion_ungroupable_drg as drg\n  on denom.encounter_id = drg.encounter_id\n  and denom.data_source = drg.data_source", "relation_name": "dev_tom.ahrq_measures._int_pqi_shared_exclusion_union"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.793244Z", "completed_at": "2024-08-23T19:21:35.799241Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.799432Z", "completed_at": "2024-08-23T19:21:35.799435Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.007182121276855469, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.ed_classification__int_filter_encounter_with_classification", "compiled": true, "compiled_code": "/*\nFilter conditions to those that were classified and pick the classification\nwith the greatest probability (that's the greatest logic). This logic removes\nany rows that were not classified.\n*/\n\n\nselect\n   a.*\n   , case greatest(edcnnpa, edcnpa, epct, noner, injury, psych, alcohol, drug)\n          when edcnnpa then 'edcnnpa'\n          when edcnpa then 'edcnpa'\n          when epct then 'epct'\n          when noner then 'noner'\n          when injury then 'injury'\n          when psych then 'psych'\n          when alcohol then 'alcohol'\n          when drug then 'drug'\n          else 'unclassified'\n   end as classification\nfrom dev_tom.ed_classification._int_by_provider_parent_organization a\nwhere ed_classification_capture = 1", "relation_name": "dev_tom.ed_classification._int_filter_encounter_with_classification"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.795122Z", "completed_at": "2024-08-23T19:21:35.800086Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.800417Z", "completed_at": "2024-08-23T19:21:35.800420Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.005712747573852539, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_cbe0055_exclusions", "compiled": true, "compiled_code": "with frailty as (\n\n  select\n    *\n  from dev_tom.quality_measures._int_shared_exclusions_frailty\n  where exclusion_date between (\n  select \n    performance_period_begin\n  from dev_tom.quality_measures._int_cbe0055__performance_period\n\n) and (\n  select \n    performance_period_end\n  from dev_tom.quality_measures._int_cbe0055__performance_period\n\n)\n\n)\n\n, valid_hospice_palliative as (\n\n  select\n      patient_id\n    , exclusion_date\n    , exclusion_reason\n    , exclusion_type\n  from dev_tom.quality_measures._int_shared_exclusions_hospice_palliative\n  where exclusion_date between (\n  select \n    performance_period_begin\n  from dev_tom.quality_measures._int_cbe0055__performance_period\n\n) and (\n  select \n    performance_period_end\n  from dev_tom.quality_measures._int_cbe0055__performance_period\n\n)\n\n)\n\n, valid_institutional_snp as (\n\n  select \n      patient_id\n    , exclusion_date\n    , exclusion_reason\n    , exclusion_type\n  from dev_tom.quality_measures._int_shared_exclusions_institutional_snp\n  where exclusion_date between (\n  select \n    performance_period_begin\n  from dev_tom.quality_measures._int_cbe0055__performance_period\n\n) and (\n  select \n    performance_period_end\n  from dev_tom.quality_measures._int_cbe0055__performance_period\n\n)\n\n)\n\n, valid_dementia_exclusions as (\n\n  select\n      source.patient_id\n    , source.exclusion_date\n    , source.exclusion_reason\n    , source.exclusion_type\n  from dev_tom.quality_measures._int_shared_exclusions_dementia source\n  inner join frailty\n    on source.patient_id = frailty.patient_id\n  where (\n    source.dispensing_date\n      between \n\n    dateadd(\n        year,\n        -1,\n        (\n  select \n    performance_period_begin\n  from dev_tom.quality_measures._int_cbe0055__performance_period\n\n)\n        )\n\n\n          and (\n  select \n    performance_period_end\n  from dev_tom.quality_measures._int_cbe0055__performance_period\n\n)\n    or source.paid_date\n      between \n\n    dateadd(\n        year,\n        -1,\n        (\n  select \n    performance_period_begin\n  from dev_tom.quality_measures._int_cbe0055__performance_period\n\n)\n        )\n\n\n          and (\n  select \n    performance_period_end\n  from dev_tom.quality_measures._int_cbe0055__performance_period\n\n)\n    )\n\n)\n\n-- advanced illness start\n, advanced_illness_exclusion as (\n\n  select\n    source.*\n  from dev_tom.quality_measures._int_shared_exclusions_advanced_illness as source\n  inner join frailty\n    on source.patient_id = frailty.patient_id\n  where source.exclusion_date\n    between\n      \n\n    dateadd(\n        year,\n        -1,\n        (\n  select \n    performance_period_begin\n  from dev_tom.quality_measures._int_cbe0055__performance_period\n\n)\n        )\n\n\n      and (\n  select \n    performance_period_end\n  from dev_tom.quality_measures._int_cbe0055__performance_period\n\n)\n\n)\n\n, acute_inpatient_advanced_illness as (\n\n  select\n    *\n  from advanced_illness_exclusion\n  where patient_type = 'acute_inpatient'\n\n)\n\n, nonacute_outpatient_advanced_illness as (\n\n  select\n    *\n  from advanced_illness_exclusion\n  where patient_type = 'nonacute_outpatient'\n\n)\n\n, acute_inpatient_counts as (\n\n    select\n          patient_id\n        , exclusion_type\n        , count(distinct exclusion_date) as encounter_count\n    from acute_inpatient_advanced_illness\n    group by patient_id, exclusion_type\n\n)\n\n, nonacute_outpatient_counts as (\n\n    select\n          patient_id\n        , exclusion_type\n        , count(distinct exclusion_date) as encounter_count\n    from nonacute_outpatient_advanced_illness\n    group by patient_id, exclusion_type\n\n)\n\n, valid_advanced_illness_exclusions as (\n\n    select\n          acute_inpatient_advanced_illness.patient_id\n        , acute_inpatient_advanced_illness.exclusion_date\n        , acute_inpatient_advanced_illness.exclusion_reason\n        , acute_inpatient_advanced_illness.exclusion_type\n    from acute_inpatient_advanced_illness\n    left join acute_inpatient_counts\n      on acute_inpatient_advanced_illness.patient_id = acute_inpatient_counts.patient_id\n    where acute_inpatient_counts.encounter_count >= 1\n\n    union all\n\n    select\n        nonacute_outpatient_advanced_illness.patient_id\n      , nonacute_outpatient_advanced_illness.exclusion_date\n      , nonacute_outpatient_advanced_illness.exclusion_reason\n      , nonacute_outpatient_advanced_illness.exclusion_type\n    from nonacute_outpatient_advanced_illness\n    left join nonacute_outpatient_counts\n      on nonacute_outpatient_advanced_illness.patient_id = nonacute_outpatient_counts.patient_id\n    where nonacute_outpatient_counts.encounter_count >= 2\n\n\n)\n-- advanced illness end\n\n, exclusions as (\n\n  select * from valid_advanced_illness_exclusions\n  union all\n  select * from valid_dementia_exclusions\n  union all\n  select * from valid_hospice_palliative\n  union all\n  select * from valid_institutional_snp\n\n)\n\n, combined_exclusions as (\n\n  select \n      exclusions.*\n    , denominator.age\n  from exclusions\n  inner join dev_tom.quality_measures._int_cbe0055_denominator as denominator\n      on exclusions.patient_id = denominator.patient_id\n\n)\n\n, valid_exclusions as (\n\n  select\n    *\n  from combined_exclusions\n  where exclusion_type != 'hospice_palliative'\n    and age >= 66\n\n  union all\n\n  select\n    *\n  from combined_exclusions\n  where exclusion_type = 'hospice_palliative'\n\n)\n\n, add_data_types as (\n\n    select\n        distinct\n          cast(patient_id as TEXT) as patient_id\n        , cast(exclusion_date as date) as exclusion_date\n        , cast(exclusion_reason as TEXT) as exclusion_reason\n        , 1 as exclusion_flag\n    from valid_exclusions\n\n)\n\nselect\n      patient_id\n    , exclusion_date\n    , exclusion_reason\n    , exclusion_flag\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.quality_measures._int_cbe0055_exclusions"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.800670Z", "completed_at": "2024-08-23T19:21:35.812285Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.826597Z", "completed_at": "2024-08-23T19:21:35.826601Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.02671194076538086, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_cbe0055_numerator", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__quality_measures__stg_core__procedure as (\n\nselect\n      patient_id\n    , encounter_id\n    , procedure_date\n    , source_code_type\n    , source_code\n    , normalized_code_type\n    , normalized_code\n    , modifier_1\n    , modifier_2\n    , modifier_3\n    , modifier_4\n    , modifier_5\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.procedure\n), denominator as (\n\n    select\n          patient_id\n        , performance_period_begin\n        , performance_period_end\n        , measure_id\n        , measure_name\n        , measure_version\n    from dev_tom.quality_measures._int_cbe0055_denominator\n\n)\n\n, retina_test_code as (\n\n    select\n          code\n        , code_system\n        , concept_name\n    from dev_tom.quality_measures._value_set_codes\n    where lower(concept_name) in  (\n          'diabetic retinal eye exam met'\n        , 'retinal or dilated eye exam'\n    )\n\n)\n\n, procedures as (\n\n    select\n        patient_id\n      , procedure_date\n      , coalesce (\n              normalized_code_type\n            , case\n                when lower(source_code_type) = 'cpt' then 'hcpcs'\n                when lower(source_code_type) = 'snomed' then 'snomed-ct'\n                else lower(source_code_type)\n              end\n          ) as code_type\n        , coalesce (\n              normalized_code\n            , source_code\n          ) as code\n    from __dbt__cte__quality_measures__stg_core__procedure\n\n)\n\n, qualifying_patients as (\n\n    select \n          procedures.patient_id\n        , procedures.procedure_date as evidence_date\n    from procedures\n    inner join dev_tom.quality_measures._int_cbe0055__performance_period pp\n    on procedure_date between\n        performance_period_begin and performance_period_end\n    inner join retina_test_code\n        on procedures.code = retina_test_code.code\n            and procedures.code_type = retina_test_code.code_system\n\n)\n\n, qualifying_patients_with_denominator as (\n\n    select \n          qualifying_patients.patient_id\n        , qualifying_patients.evidence_date\n        , denominator.performance_period_begin\n        , denominator.performance_period_end\n        , denominator.measure_id\n        , denominator.measure_name\n        , denominator.measure_version\n        , cast('1' as integer) as numerator_flag\n    from qualifying_patients\n    inner join denominator\n    on qualifying_patients.patient_id = denominator.patient_id\n\n)\n\n, add_data_types as (\n\n     select distinct\n          cast(patient_id as TEXT) as patient_id\n        , cast(performance_period_begin as date) as performance_period_begin\n        , cast(performance_period_end as date) as performance_period_end\n        , cast(measure_id as TEXT) as measure_id\n        , cast(measure_name as TEXT) as measure_name\n        , cast(measure_version as TEXT) as measure_version\n        , cast(evidence_date as date) as evidence_date\n        , cast(null as TEXT) as evidence_value\n        , cast(numerator_flag as integer) as numerator_flag\n    from qualifying_patients_with_denominator\n\n)\n\nselect\n      patient_id\n    , performance_period_begin\n    , performance_period_end\n    , measure_id\n    , measure_name\n    , measure_version\n    , evidence_date\n    , evidence_value\n    , numerator_flag\nfrom add_data_types", "relation_name": "dev_tom.quality_measures._int_cbe0055_numerator"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.812461Z", "completed_at": "2024-08-23T19:21:35.827506Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.842422Z", "completed_at": "2024-08-23T19:21:35.842425Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.03050971031188965, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_cbe0101_exclusions", "compiled": true, "compiled_code": "with  __dbt__cte__quality_measures__stg_core__procedure as (\n\nselect\n      patient_id\n    , encounter_id\n    , procedure_date\n    , source_code_type\n    , source_code\n    , normalized_code_type\n    , normalized_code\n    , modifier_1\n    , modifier_2\n    , modifier_3\n    , modifier_4\n    , modifier_5\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.procedure\n),  __dbt__cte__quality_measures__stg_medical_claim as (\n\n\nselect\n      patient_id\n    , claim_id\n    , claim_start_date\n    , claim_end_date\n    , place_of_service_code\n    , hcpcs_code\n    , hcpcs_modifier_1\n    , hcpcs_modifier_2\n    , hcpcs_modifier_3\n    , hcpcs_modifier_4\n    , hcpcs_modifier_5\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.medical_claim\n\n\n), denominator as (\n    \n    select\n        patient_id\n    from dev_tom.quality_measures._int_cbe0101_denominator\n\n)\n\n, exclusion_code as (\n\n    select\n        code\n      , code_system\n    from dev_tom.quality_measures._value_set_codes\n    where code = '0518F'\n    -- further 1P modifier are only excluded\n)\n\n, hospice_palliative as (\n\n    select\n          patient_id\n        , exclusion_date\n        , exclusion_reason\n    from dev_tom.quality_measures._int_shared_exclusions_hospice_palliative\n    where exclusion_date between (\n\n  select \n    performance_period_begin\n  from dev_tom.quality_measures._int_cbe0101__performance_period\n\n) and (\n\n  select \n    performance_period_end\n  from dev_tom.quality_measures._int_cbe0101__performance_period\n\n)\n\n)\n\n, valid_hospice as (\n\n    select\n          patient_id\n        , exclusion_date\n        , exclusion_reason\n    from hospice_palliative\n    where lower(exclusion_reason) in (\n            'hospice encounter'\n          , 'hospice care ambulatory'\n          , 'hospice diagnosis'\n    )\n\n)\n\n, procedures as (\n\n    select\n        patient_id\n      , procedure_date\n      , coalesce (\n              normalized_code_type\n            , case\n                when lower(source_code_type) = 'cpt' then 'hcpcs'\n                when lower(source_code_type) = 'snomed' then 'snomed-ct'\n                else lower(source_code_type)\n              end\n          ) as code_type\n        , coalesce (\n              normalized_code\n            , source_code\n          ) as code\n        , modifier_1\n        , modifier_2\n        , modifier_3\n        , modifier_4\n        , modifier_5\n    from __dbt__cte__quality_measures__stg_core__procedure\n\n)\n\n, exclusion_procedures as (\n\n    select\n          patient_id\n        , procedure_date as exclusion_date\n        , 'Limited Mobility' as exclusion_reason\n    from procedures\n    inner join exclusion_code\n        on procedures.code = exclusion_code.code\n            and procedures.code_type = exclusion_code.code_system\n    where '1P' in (modifier_1, modifier_2, modifier_3, modifier_4, modifier_5)\n            \n)\n\n, exclusion_claims as (\n\n    select\n          patient_id\n        , coalesce(claim_end_date, claim_start_date) as exclusion_date\n        , 'Limited mobility' as exclusion_reason\n    from __dbt__cte__quality_measures__stg_medical_claim medical_claim\n    inner join exclusion_code\n        on medical_claim.hcpcs_code = exclusion_code.code\n            and lower(exclusion_code.code_system) = 'hcpcs'\n    where '1P' in (hcpcs_modifier_1, hcpcs_modifier_2, hcpcs_modifier_3, hcpcs_modifier_4, hcpcs_modifier_5)\n\n)\n\n, exclusion_patients as (\n\n    select\n        patient_id\n      , exclusion_date\n      , exclusion_reason\n    from valid_hospice\n\n    union all\n\n    select\n        patient_id\n      , exclusion_date\n      , exclusion_reason\n    from exclusion_procedures\n\n    union all\n\n    select\n        patient_id\n      , exclusion_date\n      , exclusion_reason\n    from exclusion_claims\n\n)\n\n, combined_exclusions as (\n\n    select\n        exclusion_patients.patient_id\n      , exclusion_patients.exclusion_date\n      , exclusion_patients.exclusion_reason\n    from exclusion_patients\n    inner join denominator\n      on exclusion_patients.patient_id = denominator.patient_id\n\n)\n\n, add_data_types as (\n\n    select\n        distinct\n          cast(patient_id as TEXT) as patient_id\n        , cast(exclusion_date as date) as exclusion_date\n        , cast(exclusion_reason as TEXT) as exclusion_reason\n        , cast(1 as integer) as exclusion_flag\n    from combined_exclusions\n\n)\n\nselect\n      patient_id\n    , exclusion_date\n    , exclusion_reason\n    , exclusion_flag\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.quality_measures._int_cbe0101_exclusions"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.827645Z", "completed_at": "2024-08-23T19:21:35.843494Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.859027Z", "completed_at": "2024-08-23T19:21:35.859030Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.03191089630126953, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_cbe0101_numerator", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__quality_measures__stg_core__procedure as (\n\nselect\n      patient_id\n    , encounter_id\n    , procedure_date\n    , source_code_type\n    , source_code\n    , normalized_code_type\n    , normalized_code\n    , modifier_1\n    , modifier_2\n    , modifier_3\n    , modifier_4\n    , modifier_5\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.procedure\n),  __dbt__cte__quality_measures__stg_medical_claim as (\n\n\nselect\n      patient_id\n    , claim_id\n    , claim_start_date\n    , claim_end_date\n    , place_of_service_code\n    , hcpcs_code\n    , hcpcs_modifier_1\n    , hcpcs_modifier_2\n    , hcpcs_modifier_3\n    , hcpcs_modifier_4\n    , hcpcs_modifier_5\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.medical_claim\n\n\n), denominator as (\n\n    select \n          patient_id\n        , encounter_date\n        , performance_period_begin\n        , performance_period_end\n        , measure_id\n        , measure_name\n        , measure_version\n    from dev_tom.quality_measures._int_cbe0101_denominator\n\n)\n\n, fallcare_codes as (\n\n    select\n          code\n        , code_system\n        , concept_name\n    from dev_tom.quality_measures._value_set_codes\n    where code = '0518F' -- Falls plan of care documented\n\n)\n\n, procedures as (\n\n    select\n        patient_id\n      , procedure_date\n      , coalesce (\n              normalized_code_type\n            , case\n                when lower(source_code_type) = 'cpt' then 'hcpcs'\n                when lower(source_code_type) = 'snomed' then 'snomed-ct'\n                else lower(source_code_type)\n              end\n          ) as code_type\n        , coalesce (\n              normalized_code\n            , source_code\n          ) as code\n    from __dbt__cte__quality_measures__stg_core__procedure\n\n)\n\n, qualifying_procedures as (\n\n    select\n          patient_id\n        , procedure_date as evidence_date\n    from procedures\n    inner join fallcare_codes\n        on procedures.code = fallcare_codes.code\n            and procedures.code_type = fallcare_codes.code_system\n            \n)\n\n, qualifying_claims as (\n\n    select\n          patient_id\n        , coalesce(claim_end_date, claim_start_date) as evidence_date\n    from __dbt__cte__quality_measures__stg_medical_claim medical_claim\n    inner join fallcare_codes\n        on medical_claim.hcpcs_code = fallcare_codes.code\n            and lower(fallcare_codes.code_system) = 'hcpcs'\n\n)\n\n, qualifying_cares as (\n\n    select\n          patient_id\n        , evidence_date\n    from qualifying_procedures\n\n    union all\n\n    select\n          patient_id\n        , evidence_date\n    from qualifying_claims\n\n)\n\n, combined_qualifying_patients as (\n\n    select\n          qualifying_cares.patient_id\n        , qualifying_cares.evidence_date\n        , cast(null as TEXT) as evidence_value\n        , denominator.performance_period_begin\n        , denominator.performance_period_end\n        , denominator.measure_id\n        , denominator.measure_name\n        , denominator.measure_version\n        , 1 as numerator_flag\n    from qualifying_cares\n    inner join denominator\n        on qualifying_cares.patient_id = denominator.patient_id\n    where evidence_date between\n        \n\n    dateadd(\n        year,\n        -1,\n        denominator.encounter_date\n        )\n\n\n        and \n        denominator.encounter_date -- within last 12 months of falls screening visit\n\n)\n\n, add_data_types as (\n\n     select distinct\n          cast(patient_id as TEXT) as patient_id\n        , cast(performance_period_begin as date) as performance_period_begin\n        , cast(performance_period_end as date) as performance_period_end\n        , cast(measure_id as TEXT) as measure_id\n        , cast(measure_name as TEXT) as measure_name\n        , cast(measure_version as TEXT) as measure_version\n        , cast(evidence_date as date) as evidence_date\n        , cast(evidence_value as TEXT) as evidence_value\n        , cast(numerator_flag as integer) as numerator_flag\n    from combined_qualifying_patients\n\n)\n\nselect\n      patient_id\n    , performance_period_begin\n    , performance_period_end\n    , measure_id\n    , measure_name\n    , measure_version\n    , evidence_date\n    , evidence_value\n    , numerator_flag\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.quality_measures._int_cbe0101_numerator"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.843633Z", "completed_at": "2024-08-23T19:21:35.859977Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.891435Z", "completed_at": "2024-08-23T19:21:35.891439Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.048519134521484375, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_cqm236_exclude_procedures_observations", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__quality_measures__stg_core__condition as (\n\nselect\n      patient_id\n    , claim_id\n    , encounter_id\n    , recorded_date\n    , source_code_type\n    , source_code\n    , normalized_code_type\n    , normalized_code\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.condition\n),  __dbt__cte__quality_measures__stg_core__procedure as (\n\nselect\n      patient_id\n    , encounter_id\n    , procedure_date\n    , source_code_type\n    , source_code\n    , normalized_code_type\n    , normalized_code\n    , modifier_1\n    , modifier_2\n    , modifier_3\n    , modifier_4\n    , modifier_5\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.procedure\n), denominator as (\n\n    select\n          patient_id\n        , age\n        , performance_period_begin\n        , performance_period_end\n    from dev_tom.quality_measures._int_cqm236_denominator\n\n)\n\n\n, conditions as (\n\n    select\n          patient_id\n        , claim_id\n        , recorded_date\n        , coalesce (\n              normalized_code_type\n            , case\n                when lower(source_code_type) = 'snomed' then 'snomed-ct'\n                else lower(source_code_type)\n              end\n          ) as code_type\n        , coalesce (\n              normalized_code\n            , source_code\n          ) as code\n    from __dbt__cte__quality_measures__stg_core__condition\n\n)\n\n, procedures as (\n\n    select\n          patient_id\n        , procedure_date\n        , coalesce (\n              normalized_code_type\n            , case\n                when lower(source_code_type) = 'cpt' then 'hcpcs'\n                when lower(source_code_type) = 'snomed' then 'snomed-ct'\n                else lower(source_code_type)\n              end\n          ) as code_type\n        , coalesce (\n              normalized_code\n            , source_code\n          ) as code\n    from __dbt__cte__quality_measures__stg_core__procedure\n\n)\n\n, exclusion_codes as (\n\n    select\n          code\n        , code_system\n        , concept_name\n    from dev_tom.quality_measures._value_set_codes\n    where lower(concept_name) in (\n          'dialysis services'\n        , 'end stage renal disease'\n        , 'esrd monthly outpatient services'\n        , 'kidney transplant'\n        , 'kidney transplant recipient'\n        , 'pregnancy'\n    )\n\n)\n\n, condition_exclusions as (\n\n    select\n          conditions.patient_id\n        , conditions.claim_id\n        , conditions.recorded_date\n        , exclusion_codes.concept_name\n    from conditions\n         inner join exclusion_codes\n            on conditions.code = exclusion_codes.code\n            and conditions.code_type = exclusion_codes.code_system\n\n)\n\n, procedure_exclusions as (\n\n    select\n          procedures.patient_id\n        , procedures.procedure_date\n        , exclusion_codes.concept_name\n    from procedures\n         inner join exclusion_codes\n             on procedures.code = exclusion_codes.code\n             and procedures.code_type = exclusion_codes.code_system\n\n)\n\n, exclusions_unioned as (\n\n    select\n          patient_id\n        , recorded_date as exclusion_date\n        , concept_name as exclusion_reason\n    from condition_exclusions\n\n    union all\n\n    select\n          patient_id\n        , procedure_date as exclusion_date\n        , concept_name as exclusion_reason\n    from procedure_exclusions\n\n)\n\n, excluded_patients as (\n\n    select\n          exclusions_unioned.patient_id\n        , exclusions_unioned.exclusion_date\n        , exclusions_unioned.exclusion_reason\n        , case\n            when exclusion_reason = 'pregnancy' then 1\n            else 0\n          end as is_pregnant\n        , denominator.performance_period_begin\n        , denominator.performance_period_end\n        , denominator.age\n    from exclusions_unioned\n    inner join denominator\n        on exclusions_unioned.patient_id = denominator.patient_id\n\n)\n\n, exclusions_filtered as (\n\n    select\n          patient_id\n        , age\n        , exclusion_date\n        , exclusion_reason\n    from excluded_patients\n    where is_pregnant = 1\n        and exclusion_date between performance_period_begin and performance_period_end\n    \n    union all\n\n    select\n          patient_id\n        , age\n        , exclusion_date\n        , exclusion_reason\n    from excluded_patients\n    where is_pregnant = 0\n        and exclusion_date between performance_period_begin and performance_period_end\n          or (exclusion_date between \n\n    dateadd(\n        year,\n        -1,\n        performance_period_begin\n        )\n\n\n            and performance_period_end)\n\n)\n\nselect\n      patient_id\n    , exclusion_date\n    , exclusion_reason\n    , age\n    , 'measure specific exclusion for observation procedure' as exclusion_type\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom\n    exclusions_filtered", "relation_name": "dev_tom.quality_measures._int_cqm236_exclude_procedures_observations"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.860125Z", "completed_at": "2024-08-23T19:21:35.907964Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:35.982264Z", "completed_at": "2024-08-23T19:21:35.982272Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.12274599075317383, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_cqm236_numerator", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__quality_measures__stg_core__encounter as (\n\n\nselect\n      patient_id\n    , encounter_id\n    , encounter_type\n    , length_of_stay\n    , encounter_start_date\n    , encounter_end_date\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.encounter\n\n\n),  __dbt__cte__quality_measures__stg_core__observation as (\n\n\nselect\n      patient_id\n    , encounter_id\n    , observation_date\n    , result\n    , source_code_type\n    , source_code\n    , normalized_code_type\n    , normalized_code\n    , normalized_description\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.observation\n\n\n),  __dbt__cte__quality_measures__stg_core__lab_result as (\n\n\nselect\n      patient_id\n    , result\n    , result_date\n    , collection_date\n    , source_code_type\n    , source_code\n    , normalized_code_type\n    , normalized_code\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.lab_result\n\n\n),  __dbt__cte__quality_measures__stg_core__procedure as (\n\nselect\n      patient_id\n    , encounter_id\n    , procedure_date\n    , source_code_type\n    , source_code\n    , normalized_code_type\n    , normalized_code\n    , modifier_1\n    , modifier_2\n    , modifier_3\n    , modifier_4\n    , modifier_5\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.procedure\n),  __dbt__cte__quality_measures__stg_medical_claim as (\n\n\nselect\n      patient_id\n    , claim_id\n    , claim_start_date\n    , claim_end_date\n    , place_of_service_code\n    , hcpcs_code\n    , hcpcs_modifier_1\n    , hcpcs_modifier_2\n    , hcpcs_modifier_3\n    , hcpcs_modifier_4\n    , hcpcs_modifier_5\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.medical_claim\n\n\n), controlled_bp_codes as (\n\n    select\n          code\n        , code_system\n        , concept_name\n    from dev_tom.quality_measures._value_set_codes\n    where lower(concept_name) in (\n          'most recent systolic blood pressure < 140 mmhg'  --G8752 hcpcs\n        , 'most recent diastolic blood pressure < 90 mmhg'  --G8754 hcpcs\n    )\n    \n)\n\n, denominator as (\n\n    select\n          patient_id\n        , measure_id\n        , measure_name\n        , measure_version\n        , performance_period_begin\n        , performance_period_end\n    from dev_tom.quality_measures._int_cqm236_denominator\n\n)\n\n, encounters as (\n\n    select\n          patient_id\n        , encounter_type\n        , encounter_start_date\n        , encounter_end_date\n    from __dbt__cte__quality_measures__stg_core__encounter\n\n)\n\n, observations as (\n\n    select\n          patient_id\n        , observation_date\n        , normalized_code\n        , normalized_description\n        , result\n    from __dbt__cte__quality_measures__stg_core__observation\n    where lower(normalized_description) in \n        (\n              'systolic blood pressure'\n            , 'diastolic blood pressure'\n        )\n        and normalized_code not in (\n              '99473' -- Self-measured blood pressure using a device validated for clinical accuracy; patient education/training and device calibration\n            , '99474' -- Separate self-measurements of two readings one minute apart, twice daily over a 30-day period (minimum of 12 readings), collection of data reported by the patient and/or caregiver to the physician or other qualified health care professional, with report of average systolic and diastolic pressures and subsequent communication of a treatment plan to the patient\n        )\n\n)\n\n, labs as (\n\n    select \n          patient_id\n        , result_date\n        , collection_date\n        , result\n        , normalized_code\n    from __dbt__cte__quality_measures__stg_core__lab_result\n    where normalized_code in \n    ('8480-6' --systolic\n    ,'8462-4') --diastolic\n    and\n    normalized_code_type = 'loinc'\n\n)\n\n, all_procedures as (\n\n    select\n        patient_id\n      , procedure_date\n      , coalesce (\n              normalized_code_type\n            , case\n                when lower(source_code_type) = 'cpt' then 'hcpcs'\n                when lower(source_code_type) = 'snomed' then 'snomed-ct'\n                else lower(source_code_type)\n              end\n          ) as code_type\n        , coalesce (\n              normalized_code\n            , source_code\n          ) as code\n    from __dbt__cte__quality_measures__stg_core__procedure\n\n)\n\n, all_medical_claims as (\n    \n    select\n          patient_id\n        , claim_start_date\n        , claim_end_date\n        , hcpcs_code\n    from __dbt__cte__quality_measures__stg_medical_claim\n\n)\n\n, controlled_bp_procedures as (\n\n    select\n          all_procedures.patient_id\n        , all_procedures.procedure_date as evidence_date\n        , controlled_bp_codes.code\n    from all_procedures\n    inner join controlled_bp_codes\n        on all_procedures.code_type = controlled_bp_codes.code_system\n            and all_procedures.code = controlled_bp_codes.code\n\n)\n\n, controlled_bp_medical_claims as (\n\n    select\n          all_medical_claims.patient_id\n        , coalesce(all_medical_claims.claim_end_date, all_medical_claims.claim_start_date) as evidence_date\n        , controlled_bp_codes.code\n    from all_medical_claims\n    inner join controlled_bp_codes\n        on all_medical_claims.hcpcs_code = controlled_bp_codes.code\n            and controlled_bp_codes.code_system = 'hcpcs'\n\n)\n\n, controlled_bp_patients_proc_claims as (\n\n    select\n          patient_id\n        , evidence_date\n        , code\n    from controlled_bp_procedures\n\n    union all\n    \n    select\n          patient_id\n        , evidence_date\n        , code\n    from controlled_bp_medical_claims\n\n)\n\n, controlled_bp_within_range_proc_claims as (\n\n    select\n          controlled_bp_patients_proc_claims.patient_id\n        , controlled_bp_patients_proc_claims.evidence_date\n        , controlled_bp_patients_proc_claims.code\n        , denominator.measure_id\n        , denominator.measure_name\n        , denominator.measure_version\n        , denominator.performance_period_begin\n        , denominator.performance_period_end\n    from controlled_bp_patients_proc_claims\n    inner join denominator\n        on controlled_bp_patients_proc_claims.patient_id = denominator.patient_id\n            and controlled_bp_patients_proc_claims.evidence_date between\n                denominator.performance_period_begin and denominator.performance_period_end\n\n)\n\n, procedure_claims_w_encounters as (\n\n    select\n          controlled_bp_within_range_proc_claims.patient_id\n        , controlled_bp_within_range_proc_claims.evidence_date\n        , controlled_bp_within_range_proc_claims.code\n        , case\n            when lower(encounters.encounter_type) in (\n                  'emergency department'\n                , 'acute inpatient'\n            )\n            then 0\n            else 1\n          end as is_valid_procedure_claims\n        , controlled_bp_within_range_proc_claims.measure_id\n        , controlled_bp_within_range_proc_claims.measure_name\n        , controlled_bp_within_range_proc_claims.measure_version\n        , controlled_bp_within_range_proc_claims.performance_period_begin\n        , controlled_bp_within_range_proc_claims.performance_period_end\n    from controlled_bp_within_range_proc_claims\n    left join encounters\n        on controlled_bp_within_range_proc_claims.patient_id = encounters.patient_id\n        and controlled_bp_within_range_proc_claims.evidence_date between \n            encounters.encounter_start_date and encounters.encounter_end_date \n    \n)\n\n, valid_procedures_and_claims as (\n\n    select\n          patient_id\n        , evidence_date\n        , code\n        , measure_id\n        , measure_name\n        , measure_version\n        , performance_period_begin\n        , performance_period_end\n    from procedure_claims_w_encounters\n    where is_valid_procedure_claims = 1\n\n)\n\n, systolic_bp_from_procedure_claims as (\n\n    select\n          patient_id\n        , evidence_date\n        , measure_id\n        , measure_name\n        , measure_version\n        , performance_period_begin\n        , performance_period_end\n    from valid_procedures_and_claims\n    where code = 'G8752' --systolic\n\n)\n\n, diastolic_bp_from_procedure_claims as (\n\n    select\n          patient_id\n        , evidence_date\n    from valid_procedures_and_claims\n    where code = 'G8754' --diastolic\n\n)\n\n, qualifying_controlled_bp_proc_claims as (\n\n    select\n          systolic_bp_from_procedure_claims.patient_id\n        , systolic_bp_from_procedure_claims.evidence_date\n        , measure_id\n        , measure_name\n        , measure_version\n        , performance_period_begin\n        , performance_period_end\n    from systolic_bp_from_procedure_claims\n    inner join diastolic_bp_from_procedure_claims\n        on systolic_bp_from_procedure_claims.patient_id = diastolic_bp_from_procedure_claims.patient_id\n            and systolic_bp_from_procedure_claims.evidence_date = diastolic_bp_from_procedure_claims.evidence_date\n\n)\n\n, observations_within_range as (\n\n    select\n          observations.patient_id\n        , observations.observation_date\n        , observations.normalized_code\n        , observations.normalized_description\n        , observations.result\n        , denominator.measure_id\n        , denominator.measure_name\n        , denominator.measure_version\n        , denominator.performance_period_begin\n        , denominator.performance_period_end\n    from observations\n    inner join denominator\n        on observations.patient_id = denominator.patient_id\n        and observations.observation_date between \n            denominator.performance_period_begin and denominator.performance_period_end\n\n)\n\n, labs_within_range as (\n\n    select\n          labs.patient_id\n        , labs.normalized_code\n        , coalesce(labs.result_date, labs.collection_date) as observation_date\n        , labs.result\n        , denominator.measure_id\n        , denominator.measure_name\n        , denominator.measure_version\n        , denominator.performance_period_begin\n        , denominator.performance_period_end\n    from labs\n    inner join denominator\n        on labs.patient_id = denominator.patient_id\n        and coalesce(labs.result_date,labs.collection_date) between \n            denominator.performance_period_begin and denominator.performance_period_end\n\n)\n\n, observations_with_encounters as (\n\n    select\n          observations_within_range.patient_id\n        , observations_within_range.observation_date\n        , observations_within_range.normalized_description\n        , observations_within_range.result\n        , observations_within_range.normalized_code\n        , case\n            when lower(encounters.encounter_type) in (\n                  'emergency department'\n                , 'acute inpatient'\n            )\n            then 0\n            else 1\n          end as is_valid_encounter_observation\n        , observations_within_range.measure_id\n        , observations_within_range.measure_name\n        , observations_within_range.measure_version\n        , observations_within_range.performance_period_begin\n        , observations_within_range.performance_period_end\n    from observations_within_range\n    left join encounters\n        on observations_within_range.patient_id = encounters.patient_id\n        and observations_within_range.observation_date between \n            encounters.encounter_start_date and encounters.encounter_end_date\n\n)\n\n, labs_with_encounters as (\n\n    select\n          labs_within_range.patient_id\n        , labs_within_range.normalized_code\n        , labs_within_range.observation_date\n        , labs_within_range.result\n        , case\n            when lower(encounters.encounter_type) in (\n                  'emergency department'\n                , 'acute inpatient'\n            )\n            then 0\n            else 1\n          end as is_valid_encounter_labs\n        , labs_within_range.measure_id\n        , labs_within_range.measure_name\n        , labs_within_range.measure_version\n        , labs_within_range.performance_period_begin\n        , labs_within_range.performance_period_end\n    from labs_within_range\n    left join encounters\n        on labs_within_range.patient_id = encounters.patient_id\n        and labs_within_range.observation_date between\n            encounters.encounter_start_date and encounters.encounter_end_date\n            \n)\n\n, obs_and_labs as (\n\n    select\n          patient_id\n        , observation_date\n        \n        , cast(result as float) as bp_reading\n        \n        , normalized_description\n        , measure_id\n        , measure_name\n        , measure_version\n        , performance_period_begin\n        , performance_period_end\n        , normalized_code\n    from observations_with_encounters\n    where is_valid_encounter_observation = 1\n\n    union all\n\n    select\n          patient_id\n        , observation_date\n        \n            , cast(result as float) as bp_reading\n        \n        , cast(null as TEXT) as normalized_description\n        , measure_id\n        , measure_name\n        , measure_version\n        , performance_period_begin\n        , performance_period_end\n        , normalized_code\n    from labs_with_encounters labs\n    where is_valid_encounter_labs = 1\n\n)\n\n, systolic_bp as (\n\n    select\n          patient_id\n        , observation_date\n        , bp_reading\n        , measure_id\n        , measure_name\n        , measure_version\n        , performance_period_begin\n        , performance_period_end\n        , row_number() over(partition by patient_id order by observation_date desc, bp_reading asc) as rn\n    from obs_and_labs\n    where lower(normalized_description) = 'systolic blood pressure'\n    or\n    normalized_code = '8480-6'\n\n)\n\n, diastolic_bp as (\n\n    select\n          patient_id\n        , observation_date\n        , bp_reading\n        , row_number() over(partition by patient_id order by observation_date desc, bp_reading asc) as rn\n    from obs_and_labs\n    where lower(normalized_description) = 'diastolic blood pressure'\n    or\n    normalized_code = '8462-4'\n\n)\n\n, least_recent_systolic_bp as (\n\n    select\n          patient_id\n        , observation_date\n        , bp_reading as systolic_bp\n        , measure_id\n        , measure_name\n        , measure_version\n        , performance_period_begin\n        , performance_period_end\n    from systolic_bp\n    where rn = 1\n\n)\n\n, least_recent_diastolic_bp as (\n\n    select\n          patient_id\n        , observation_date\n        , bp_reading as diastolic_bp\n    from diastolic_bp\n    where rn = 1\n\n)\n\n, patients_with_bp_readings as (\n\n    select\n          least_recent_systolic_bp.patient_id\n        , least_recent_systolic_bp.systolic_bp\n        , least_recent_diastolic_bp.diastolic_bp\n        , least_recent_systolic_bp.observation_date\n        , least_recent_systolic_bp.measure_id\n        , least_recent_systolic_bp.measure_name\n        , least_recent_systolic_bp.measure_version\n        , least_recent_systolic_bp.performance_period_begin\n        , least_recent_systolic_bp.performance_period_end\n    from least_recent_systolic_bp\n    inner join least_recent_diastolic_bp\n        on least_recent_systolic_bp.patient_id = least_recent_diastolic_bp.patient_id\n            and least_recent_systolic_bp.observation_date = least_recent_diastolic_bp.observation_date\n\n)\n\n, numerator as (\n\n    select\n          patient_id\n        , observation_date\n        , performance_period_begin\n        , performance_period_end\n        , measure_id\n        , measure_name\n        , measure_version\n        , case\n            when systolic_bp < 140.0 and diastolic_bp < 90.0\n            then 1\n            else 0\n          end as numerator_flag\n    from patients_with_bp_readings\n\n    union all\n\n    select\n          patient_id\n        , evidence_date as observation_date\n        , performance_period_begin\n        , performance_period_end\n        , measure_id\n        , measure_name\n        , measure_version\n        , 1 as numerator_flag\n    from qualifying_controlled_bp_proc_claims\n\n)\n\n, add_data_types as (\n\n     select distinct\n          cast(patient_id as TEXT) as patient_id\n        , cast(performance_period_begin as date) as performance_period_begin\n        , cast(performance_period_end as date) as performance_period_end\n        , cast(measure_id as TEXT) as measure_id\n        , cast(measure_name as TEXT) as measure_name\n        , cast(measure_version as TEXT) as measure_version\n        , cast(observation_date as date) as observation_date\n        , cast(numerator_flag as integer) as numerator_flag\n    from numerator\n\n)\n\nselect\n      patient_id\n    , performance_period_begin\n    , performance_period_end\n    , measure_id\n    , measure_name\n    , measure_version\n    , observation_date\n    , numerator_flag\nfrom add_data_types", "relation_name": "dev_tom.quality_measures._int_cqm236_numerator"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.908123Z", "completed_at": "2024-08-23T19:21:35.994987Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.001246Z", "completed_at": "2024-08-23T19:21:36.001250Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.09393787384033203, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_cqm438_exclusions", "compiled": true, "compiled_code": "with  __dbt__cte__quality_measures__stg_core__condition as (\n\nselect\n      patient_id\n    , claim_id\n    , encounter_id\n    , recorded_date\n    , source_code_type\n    , source_code\n    , normalized_code_type\n    , normalized_code\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.condition\n),  __dbt__cte__quality_measures__stg_medical_claim as (\n\n\nselect\n      patient_id\n    , claim_id\n    , claim_start_date\n    , claim_end_date\n    , place_of_service_code\n    , hcpcs_code\n    , hcpcs_modifier_1\n    , hcpcs_modifier_2\n    , hcpcs_modifier_3\n    , hcpcs_modifier_4\n    , hcpcs_modifier_5\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.medical_claim\n\n\n),  __dbt__cte__quality_measures__stg_core__observation as (\n\n\nselect\n      patient_id\n    , encounter_id\n    , observation_date\n    , result\n    , source_code_type\n    , source_code\n    , normalized_code_type\n    , normalized_code\n    , normalized_description\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.observation\n\n\n),  __dbt__cte__quality_measures__stg_core__procedure as (\n\nselect\n      patient_id\n    , encounter_id\n    , procedure_date\n    , source_code_type\n    , source_code\n    , normalized_code_type\n    , normalized_code\n    , modifier_1\n    , modifier_2\n    , modifier_3\n    , modifier_4\n    , modifier_5\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.procedure\n),  __dbt__cte__quality_measures__stg_core__medication as (\n\n\nselect\n      patient_id\n    , encounter_id\n    , prescribing_date  \n    , dispensing_date\n    , source_code_type\n    , source_code\n    , ndc_code\n    , rxnorm_code\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.medication\n\n\n),  __dbt__cte__quality_measures__stg_pharmacy_claim as (\n\n\nselect\n      patient_id\n    , dispensing_date\n    , ndc_code\n    , paid_date\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.pharmacy_claim\n\n\n), exclusion_codes as (\n\n    select\n          code\n        , case code_system\n            when 'SNOMEDCT' then 'snomed-ct'\n            when 'ICD9CM' then 'icd-9-cm'\n            when 'ICD10CM' then 'icd-10-cm'\n            when 'CPT' then 'hcpcs'\n            when 'ICD10PCS' then 'icd-10-pcs'\n          else lower(code_system) end as code_system\n        , concept_name\n    from dev_tom.quality_measures._value_set_codes\n    where lower(concept_name) in  (\n            'rhabdomyolysis'\n          , 'breastfeeding'\n          , 'liver disease'\n          , 'hepatitis a'\n          , 'hepatitis b'\n          , 'documentation of medical reason for no statin therapy'\n          , 'statin allergen'\n          , 'end stage renal disease'\n          , 'statin associated muscle symptoms'\n          , 'medical reason'\n    )\n\n)\n\n, valid_hospice_palliative as (\n\n  select\n      patient_id\n    , exclusion_date\n    , exclusion_reason\n    , exclusion_type\n  from dev_tom.quality_measures._int_shared_exclusions_hospice_palliative\n  where exclusion_date between (\n  select \n    performance_period_begin\n  from dev_tom.quality_measures._int_cqm438__performance_period\n\n) and (\n  select \n    performance_period_end\n  from dev_tom.quality_measures._int_cqm438__performance_period\n\n)\n\n)\n\n, conditions as (\n\n    select\n          patient_id\n        , claim_id\n        , recorded_date\n        , coalesce (\n              normalized_code_type\n            , case\n                when lower(source_code_type) = 'snomed' then 'snomed-ct'\n                else lower(source_code_type)\n              end\n          ) as code_type\n        , coalesce (\n              normalized_code\n            , source_code\n          ) as code\n    from __dbt__cte__quality_measures__stg_core__condition\n    where recorded_date between (\n  select \n    performance_period_begin\n  from dev_tom.quality_measures._int_cqm438__performance_period\n\n) and (\n  select \n    performance_period_end\n  from dev_tom.quality_measures._int_cqm438__performance_period\n\n)\n\n)\n\n, medical_claim as (\n\n    select\n          patient_id\n        , claim_id\n        , claim_start_date\n        , claim_end_date\n        , hcpcs_code\n        , place_of_service_code\n    from __dbt__cte__quality_measures__stg_medical_claim\n    where coalesce(claim_end_date, claim_start_date) between (\n  select \n    performance_period_begin\n  from dev_tom.quality_measures._int_cqm438__performance_period\n\n) and (\n  select \n    performance_period_end\n  from dev_tom.quality_measures._int_cqm438__performance_period\n\n)\n\n)\n\n, observations as (\n\n    select\n          patient_id\n        , observation_date\n        , coalesce (\n              normalized_code_type\n            , case\n                when lower(source_code_type) = 'cpt' then 'hcpcs'\n                when lower(source_code_type) = 'snomed' then 'snomed-ct'\n                else lower(source_code_type)\n              end\n          ) as code_type\n        , coalesce (\n              normalized_code\n            , source_code\n          ) as code\n    from __dbt__cte__quality_measures__stg_core__observation\n    where observation_date between (\n  select \n    performance_period_begin\n  from dev_tom.quality_measures._int_cqm438__performance_period\n\n) and (\n  select \n    performance_period_end\n  from dev_tom.quality_measures._int_cqm438__performance_period\n\n)\n\n)\n\n, procedures as (\n\n    select\n          patient_id\n        , procedure_date\n        , coalesce (\n              normalized_code_type\n            , case\n                when lower(source_code_type) = 'cpt' then 'hcpcs'\n                when lower(source_code_type) = 'snomed' then 'snomed-ct'\n                else lower(source_code_type)\n              end\n          ) as code_type\n        , coalesce (\n              normalized_code\n            , source_code\n          ) as code\n    from __dbt__cte__quality_measures__stg_core__procedure\n    where procedure_date between (\n  select \n    performance_period_begin\n  from dev_tom.quality_measures._int_cqm438__performance_period\n\n) and (\n  select \n    performance_period_end\n  from dev_tom.quality_measures._int_cqm438__performance_period\n\n)\n\n)\n\n, medications as (\n    \n    select\n        patient_id\n      , coalesce(prescribing_date, dispensing_date) as exclusion_date\n      , source_code\n      , source_code_type\n    from __dbt__cte__quality_measures__stg_core__medication\n\n)\n\n, pharmacy_claims as (\n\n    select\n        patient_id\n      , dispensing_date\n      , ndc_code\n    from __dbt__cte__quality_measures__stg_pharmacy_claim \n\n)\n\n, condition_exclusions as (\n\n    select\n          conditions.patient_id\n        , conditions.claim_id\n        , conditions.recorded_date\n        , exclusion_codes.concept_name as concept_name\n    from conditions\n         inner join exclusion_codes\n            on conditions.code = exclusion_codes.code\n            and conditions.code_type = exclusion_codes.code_system\n\n)\n\n, med_claim_exclusions as (\n\n    select\n          medical_claim.patient_id\n        , medical_claim.claim_id\n        , medical_claim.claim_start_date\n        , medical_claim.claim_end_date\n        , medical_claim.hcpcs_code\n        , exclusion_codes.concept_name as concept_name\n    from medical_claim\n         inner join exclusion_codes\n            on medical_claim.hcpcs_code = exclusion_codes.code\n    where exclusion_codes.code_system = 'hcpcs'\n\n)\n\n, observation_exclusions as (\n\n    select\n          observations.patient_id\n        , observations.observation_date\n        , exclusion_codes.concept_name as concept_name\n    from observations\n    inner join exclusion_codes\n        on observations.code = exclusion_codes.code\n        and observations.code_type = exclusion_codes.code_system\n\n)\n\n, procedure_exclusions as (\n\n    select\n          procedures.patient_id\n        , procedures.procedure_date\n        , exclusion_codes.concept_name as concept_name\n    from procedures\n    inner join exclusion_codes\n        on procedures.code = exclusion_codes.code\n          and procedures.code_type = exclusion_codes.code_system\n\n)\n\n, medication_exclusions as (\n\n    select\n          medications.patient_id\n        , medications.exclusion_date\n        , exclusion_codes.concept_name as concept_name\n    from medications\n    inner join exclusion_codes\n        on medications.source_code = exclusion_codes.code\n          and medications.source_code_type = exclusion_codes.code_system\n\n)\n\n, pharmacy_claims_exclusions as (\n\n    select\n          pharmacy_claims.patient_id\n        , pharmacy_claims.dispensing_date\n        , exclusion_codes.concept_name as concept_name\n    from pharmacy_claims\n    inner join exclusion_codes\n        on pharmacy_claims.ndc_code = exclusion_codes.code\n        and lower(exclusion_codes.code_system) = 'ndc'\n\n)\n\n, patients_with_exclusions as(\n    \n    select \n          patient_id\n        , recorded_date as exclusion_date\n        , concept_name as exclusion_reason\n    from condition_exclusions\n\n    union all\n\n    select \n          patient_id\n        , coalesce(claim_end_date, claim_start_date) as exclusion_date\n        , concept_name as exclusion_reason\n    from med_claim_exclusions\n\n    union all\n\n    select \n          patient_id\n        , observation_date as exclusion_date\n        , concept_name as exclusion_reason\n    from observation_exclusions\n\n    union all\n\n    select \n          patient_id\n        , procedure_date as exclusion_date\n        , concept_name as exclusion_reason\n    from procedure_exclusions\n\n    union all\n\n    select \n          patient_id\n        , exclusion_date\n        , concept_name as exclusion_reason\n    from medication_exclusions\n\n    union all\n\n    select\n          patient_id\n        , dispensing_date as exclusion_date\n        , concept_name as exclusion_reason\n    from pharmacy_claims_exclusions\n\n    union all\n\n    select\n          patient_id\n        , exclusion_date\n        , exclusion_reason\n    from valid_hospice_palliative\n\n)\n\n, valid_exclusions as (\n\n  select \n        patients_with_exclusions.patient_id\n      , patients_with_exclusions.exclusion_date\n      , patients_with_exclusions.exclusion_reason  \n  from patients_with_exclusions\n  inner join dev_tom.quality_measures._int_cqm438_denominator as denominator\n      on patients_with_exclusions.patient_id = denominator.patient_id\n\n)\n\n, add_data_types as (\n\n    select\n        distinct\n          cast(patient_id as TEXT) as patient_id\n        , cast(exclusion_date as date) as exclusion_date\n        , cast(exclusion_reason as TEXT) as exclusion_reason\n        , cast(1 as integer) as exclusion_flag\n    from valid_exclusions\n\n)\n\nselect\n      patient_id\n    , exclusion_date\n    , exclusion_reason\n    , exclusion_flag\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.quality_measures._int_cqm438_exclusions"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.989192Z", "completed_at": "2024-08-23T19:21:36.008310Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.008496Z", "completed_at": "2024-08-23T19:21:36.008499Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.019703149795532227, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_cqm438_numerator", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__quality_measures__stg_core__procedure as (\n\nselect\n      patient_id\n    , encounter_id\n    , procedure_date\n    , source_code_type\n    , source_code\n    , normalized_code_type\n    , normalized_code\n    , modifier_1\n    , modifier_2\n    , modifier_3\n    , modifier_4\n    , modifier_5\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.procedure\n),  __dbt__cte__quality_measures__stg_pharmacy_claim as (\n\n\nselect\n      patient_id\n    , dispensing_date\n    , ndc_code\n    , paid_date\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.pharmacy_claim\n\n\n),  __dbt__cte__quality_measures__stg_core__medication as (\n\n\nselect\n      patient_id\n    , encounter_id\n    , prescribing_date  \n    , dispensing_date\n    , source_code_type\n    , source_code\n    , ndc_code\n    , rxnorm_code\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.medication\n\n\n), denominator as (\n\n    select\n          patient_id\n        , performance_period_begin\n        , performance_period_end\n        , measure_id\n        , measure_name\n        , measure_version\n    from dev_tom.quality_measures._int_cqm438_denominator\n\n)\n\n, statin_codes as (\n\n    select\n          code\n        , code_system\n        , concept_name\n    from dev_tom.quality_measures._value_set_codes\n    where lower(concept_name) in  (\n          'high intensity statin therapy'\n        , 'low intensity statin therapy'\n        , 'moderate intensity statin therapy'\n        , 'statin therapy'\n    )\n\n)\n\n, procedures as (\n\n    select\n        patient_id\n      , procedure_date\n      , coalesce (\n              normalized_code_type\n            , case\n                when lower(source_code_type) = 'cpt' then 'hcpcs'\n                when lower(source_code_type) = 'snomed' then 'snomed-ct'\n                else lower(source_code_type)\n              end\n          ) as code_type\n        , coalesce (\n              normalized_code\n            , source_code\n          ) as code\n    from __dbt__cte__quality_measures__stg_core__procedure\n\n)\n\n, procedure_statin_related as (\n\n    select \n          procedures.patient_id\n        , procedures.procedure_date as evidence_date\n    from procedures\n    inner join statin_codes\n        on procedures.code = statin_codes.code\n            and procedures.code_type = statin_codes.code_system\n\n)\n\n, pharmacy_claims_statin_related as (\n\n    select\n        patient_id\n      , dispensing_date as evidence_date\n      , ndc_code\n    from __dbt__cte__quality_measures__stg_pharmacy_claim as pharmacy_claims\n    inner join statin_codes\n    on pharmacy_claims.ndc_code = statin_codes.code\n        and lower(statin_codes.code_system) = 'ndc'\n\n)\n\n, medication_statin_related as (\n\n    select\n          patient_id\n        , coalesce(dispensing_date, prescribing_date) as evidence_date\n        , source_code\n        , source_code_type\n    from __dbt__cte__quality_measures__stg_core__medication as medications\n    inner join statin_codes\n        on medications.source_code = statin_codes.code\n        and medications.source_code_type = statin_codes.code_system\n        \n)\n\n, qualifying_patients as (\n\n    select\n          procedure_statin_related.patient_id\n        , procedure_statin_related.evidence_date\n    from procedure_statin_related\n\n    union all\n\n    select\n          pharmacy_claims_statin_related.patient_id\n        , pharmacy_claims_statin_related.evidence_date\n    from pharmacy_claims_statin_related\n\n    union all\n\n    select\n          medication_statin_related.patient_id\n        , medication_statin_related.evidence_date\n    from medication_statin_related\n\n)\n\n, qualifying_patients_with_denominator as (\n\n    select \n          qualifying_patients.patient_id\n        , qualifying_patients.evidence_date\n        , denominator.performance_period_begin\n        , denominator.performance_period_end\n        , denominator.measure_id\n        , denominator.measure_name\n        , denominator.measure_version\n        , cast(1 as integer) as numerator_flag\n    from qualifying_patients\n    inner join denominator\n    on qualifying_patients.patient_id = denominator.patient_id\n    and evidence_date between \n            denominator.performance_period_begin and \n                denominator.performance_period_end\n\n)\n\n, add_data_types as (\n\n     select distinct\n          cast(patient_id as TEXT) as patient_id\n        , cast(performance_period_begin as date) as performance_period_begin\n        , cast(performance_period_end as date) as performance_period_end\n        , cast(measure_id as TEXT) as measure_id\n        , cast(measure_name as TEXT) as measure_name\n        , cast(measure_version as TEXT) as measure_version\n        , cast(evidence_date as date) as evidence_date\n        , cast(null as TEXT) as evidence_value\n        , cast(numerator_flag as integer) as numerator_flag\n    from qualifying_patients_with_denominator\n\n)\n\nselect\n      patient_id\n    , performance_period_begin\n    , performance_period_end\n    , measure_id\n    , measure_name\n    , measure_version\n    , evidence_date\n    , evidence_value\n    , numerator_flag\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.quality_measures._int_cqm438_numerator"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.005453Z", "completed_at": "2024-08-23T19:21:36.009132Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.009452Z", "completed_at": "2024-08-23T19:21:36.009455Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.004381895065307617, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_cqm48_exclusions", "compiled": true, "compiled_code": "with valid_hospice_exclusions as (\n\n  select\n      patient_id\n    , exclusion_date\n    , exclusion_reason\n  from dev_tom.quality_measures._int_shared_exclusions_hospice_palliative\n  where exclusion_date between (\n  select \n    performance_period_begin\n  from dev_tom.quality_measures._int_cqm48__performance_period\n) and (\n  select \n    performance_period_end\n  from dev_tom.quality_measures._int_cqm48__performance_period\n)\n    and lower(exclusion_reason) in (\n            'hospice encounter'\n    )\n\n)\n\n, combined_exclusions as (\n\n  select\n      valid_hospice_exclusions.patient_id\n    , valid_hospice_exclusions.exclusion_date\n    , valid_hospice_exclusions.exclusion_reason\n  from valid_hospice_exclusions\n  inner join dev_tom.quality_measures._int_cqm48_denominator as denominator\n      on valid_hospice_exclusions.patient_id = denominator.patient_id\n\n)\n\n, add_data_types as (\n\n    select\n        distinct\n          cast(patient_id as TEXT) as patient_id\n        , cast(exclusion_date as date) as exclusion_date\n        , cast(exclusion_reason as TEXT) as exclusion_reason\n        , cast(1 as integer) as exclusion_flag\n    from combined_exclusions\n\n)\n\nselect\n      patient_id\n    , exclusion_date\n    , exclusion_reason\n    , exclusion_flag\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.quality_measures._int_cqm48_exclusions"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.009710Z", "completed_at": "2024-08-23T19:21:36.029356Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.029537Z", "completed_at": "2024-08-23T19:21:36.029540Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.020601749420166016, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_cqm48_numerator", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__quality_measures__stg_core__procedure as (\n\nselect\n      patient_id\n    , encounter_id\n    , procedure_date\n    , source_code_type\n    , source_code\n    , normalized_code_type\n    , normalized_code\n    , modifier_1\n    , modifier_2\n    , modifier_3\n    , modifier_4\n    , modifier_5\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.procedure\n),  __dbt__cte__quality_measures__stg_medical_claim as (\n\n\nselect\n      patient_id\n    , claim_id\n    , claim_start_date\n    , claim_end_date\n    , place_of_service_code\n    , hcpcs_code\n    , hcpcs_modifier_1\n    , hcpcs_modifier_2\n    , hcpcs_modifier_3\n    , hcpcs_modifier_4\n    , hcpcs_modifier_5\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.medical_claim\n\n\n), denominator as (\n\n    select \n          patient_id\n        , encounter_date\n        , performance_period_begin\n        , performance_period_end\n        , measure_id\n        , measure_name\n        , measure_version\n    from dev_tom.quality_measures._int_cqm48_denominator\n\n)\n\n, involuntary_urination_codes as (\n\n    select\n          code\n        , code_system\n        , concept_name\n    from dev_tom.quality_measures._value_set_codes\n    where lower(concept_name) in (\n            'presence or absence of urinary incontinence assessed'\n    )\n\n)\n\n, procedures as (\n\n    select\n        patient_id\n      , procedure_date\n      , coalesce (\n              normalized_code_type\n            , case\n                when lower(source_code_type) = 'cpt' then 'hcpcs'\n                when lower(source_code_type) = 'snomed' then 'snomed-ct'\n                else lower(source_code_type)\n              end\n          ) as code_type\n        , coalesce (\n              normalized_code\n            , source_code\n          ) as code\n    from __dbt__cte__quality_measures__stg_core__procedure\n\n)\n\n, qualifying_procedures as (\n\n    select\n          patient_id\n        , procedure_date as evidence_date\n    from procedures\n    inner join involuntary_urination_codes\n        on procedures.code = involuntary_urination_codes.code\n            and procedures.code_type = involuntary_urination_codes.code_system\n            \n)\n\n, qualifying_claims as (\n\n    select\n          patient_id\n        , coalesce(claim_end_date, claim_start_date) as evidence_date\n    from __dbt__cte__quality_measures__stg_medical_claim medical_claim\n    inner join involuntary_urination_codes\n        on medical_claim.hcpcs_code = involuntary_urination_codes.code\n            and lower(involuntary_urination_codes.code_system) = 'hcpcs'\n\n)\n\n, qualifying_cares as (\n\n    select\n          patient_id\n        , evidence_date\n    from qualifying_procedures\n\n    union all\n\n    select\n          patient_id\n        , evidence_date\n    from qualifying_claims\n\n)\n\n, combined_qualifying_patients as (\n\n    select\n          qualifying_cares.patient_id\n        , qualifying_cares.evidence_date\n        , cast(null as TEXT) as evidence_value\n        , denominator.performance_period_begin\n        , denominator.performance_period_end\n        , denominator.measure_id\n        , denominator.measure_name\n        , denominator.measure_version\n        , 1 as numerator_flag\n    from qualifying_cares\n    inner join denominator\n        on qualifying_cares.patient_id = denominator.patient_id\n    where evidence_date between\n        \n\n    dateadd(\n        year,\n        -1,\n        denominator.encounter_date\n        )\n\n\n        and \n        denominator.encounter_date -- within last 12 months of visit\n\n)\n\n, add_data_types as (\n\n     select distinct\n          cast(patient_id as TEXT) as patient_id\n        , cast(performance_period_begin as date) as performance_period_begin\n        , cast(performance_period_end as date) as performance_period_end\n        , cast(measure_id as TEXT) as measure_id\n        , cast(measure_name as TEXT) as measure_name\n        , cast(measure_version as TEXT) as measure_version\n        , cast(evidence_date as date) as evidence_date\n        , cast(evidence_value as TEXT) as evidence_value\n        , cast(numerator_flag as integer) as numerator_flag\n    from combined_qualifying_patients\n\n)\n\nselect\n      patient_id\n    , performance_period_begin\n    , performance_period_end\n    , measure_id\n    , measure_name\n    , measure_version\n    , evidence_date\n    , evidence_value\n    , numerator_flag\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.quality_measures._int_cqm48_numerator"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.025129Z", "completed_at": "2024-08-23T19:21:36.030015Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.030348Z", "completed_at": "2024-08-23T19:21:36.030351Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0056040287017822266, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_nqf0034_exclusions", "compiled": true, "compiled_code": "with frailty as (\n\n  select\n      patient_id\n    , exclusion_date\n    , exclusion_reason\n  from dev_tom.quality_measures._int_shared_exclusions_frailty\n  where exclusion_date between (\n  select \n    performance_period_begin\n  from dev_tom.quality_measures._int_nqf0034__performance_period\n\n) and (\n  select \n    performance_period_end\n  from dev_tom.quality_measures._int_nqf0034__performance_period\n\n)\n\n)\n\n, denominator as (\n\n  select\n      patient_id\n    , max_age as age\n  from dev_tom.quality_measures._int_nqf0034_denominator\n\n)\n-- advanced illness start\n, advanced_illness_exclusion as (\n\n  select\n    source.*\n  from dev_tom.quality_measures._int_shared_exclusions_advanced_illness as source\n  inner join frailty\n    on source.patient_id = frailty.patient_id\n  where source.exclusion_date\n    between\n      \n\n    dateadd(\n        year,\n        -1,\n        (\n  select \n    performance_period_begin\n  from dev_tom.quality_measures._int_nqf0034__performance_period\n\n)\n        )\n\n\n      and (\n  select \n    performance_period_end\n  from dev_tom.quality_measures._int_nqf0034__performance_period\n\n)\n\n)\n\n, acute_inpatient_advanced_illness as (\n\n  select\n    *\n  from advanced_illness_exclusion\n  where patient_type = 'acute_inpatient'\n\n)\n\n, nonacute_outpatient_advanced_illness as (\n\n  select\n    *\n  from advanced_illness_exclusion\n  where patient_type = 'nonacute_outpatient'\n\n)\n\n, acute_inpatient_counts as (\n\n    select\n          patient_id\n        , exclusion_type\n        , count(distinct exclusion_date) as encounter_count\n    from acute_inpatient_advanced_illness\n    group by patient_id, exclusion_type\n\n)\n\n, nonacute_outpatient_counts as (\n\n    select\n          patient_id\n        , exclusion_type\n        , count(distinct exclusion_date) as encounter_count\n    from nonacute_outpatient_advanced_illness\n    group by patient_id, exclusion_type\n\n)\n\n, valid_advanced_illness_exclusions as (\n\n    select\n          acute_inpatient_advanced_illness.patient_id\n        , acute_inpatient_advanced_illness.exclusion_date\n        , acute_inpatient_advanced_illness.exclusion_reason\n        , acute_inpatient_advanced_illness.exclusion_type\n    from acute_inpatient_advanced_illness\n    left join acute_inpatient_counts\n      on acute_inpatient_advanced_illness.patient_id = acute_inpatient_counts.patient_id\n    where acute_inpatient_counts.encounter_count >= 1\n\n    union all\n\n    select\n        nonacute_outpatient_advanced_illness.patient_id\n      , nonacute_outpatient_advanced_illness.exclusion_date\n      , nonacute_outpatient_advanced_illness.exclusion_reason\n      , nonacute_outpatient_advanced_illness.exclusion_type\n    from nonacute_outpatient_advanced_illness\n    left join nonacute_outpatient_counts\n      on nonacute_outpatient_advanced_illness.patient_id = nonacute_outpatient_counts.patient_id\n    where nonacute_outpatient_counts.encounter_count >= 2\n\n\n)\n-- advanced illness end\n\n, valid_dementia_exclusions as (\n\n  select\n      source.patient_id\n    , source.exclusion_date\n    , source.exclusion_reason\n    , source.exclusion_type\n  from dev_tom.quality_measures._int_shared_exclusions_dementia source\n  inner join frailty\n    on source.patient_id = frailty.patient_id\n  where (\n    source.dispensing_date\n      between \n\n    dateadd(\n        year,\n        -1,\n        (\n  select \n    performance_period_begin\n  from dev_tom.quality_measures._int_nqf0034__performance_period\n\n)\n        )\n\n\n          and (\n  select \n    performance_period_end\n  from dev_tom.quality_measures._int_nqf0034__performance_period\n\n)\n    or source.paid_date\n      between \n\n    dateadd(\n        year,\n        -1,\n        (\n  select \n    performance_period_begin\n  from dev_tom.quality_measures._int_nqf0034__performance_period\n\n)\n        )\n\n\n          and (\n  select \n    performance_period_end\n  from dev_tom.quality_measures._int_nqf0034__performance_period\n\n)\n    )\n\n)\n\n, valid_hospice_palliative as (\n\n  select\n      patient_id\n    , exclusion_date\n    , exclusion_reason\n    , exclusion_type\n  from dev_tom.quality_measures._int_shared_exclusions_hospice_palliative\n  where exclusion_date between (\n  select \n    performance_period_begin\n  from dev_tom.quality_measures._int_nqf0034__performance_period\n\n) and (\n  select \n    performance_period_end\n  from dev_tom.quality_measures._int_nqf0034__performance_period\n\n)\n    and lower(exclusion_reason) in \n  (\n        'palliative care encounter'\n      , 'palliative care intervention'\n      , 'hospice care ambulatory'\n      , 'hospice encounter'\n  )\n\n)\n\n, valid_institutional_snp as (\n\n  select \n      patient_id\n    , exclusion_date\n    , exclusion_reason\n    , exclusion_type\n  from dev_tom.quality_measures._int_shared_exclusions_institutional_snp\n  where exclusion_date between (\n  select \n    performance_period_begin\n  from dev_tom.quality_measures._int_nqf0034__performance_period\n\n) and (\n  select \n    performance_period_end\n  from dev_tom.quality_measures._int_nqf0034__performance_period\n\n)\n\n)\n\n, measure_specific_colectomy_colorectal_cancer_exclusion as (\n\n  select\n      patient_id\n    , exclusion_date\n    , exclusion_reason\n    , exclusion_type\n  from dev_tom.quality_measures._int_nqf0034_exclude_colectomy_cancer\n\n)\n\n, exclusions as (\n\n    select *\n    from valid_advanced_illness_exclusions\n  \n    union all\n\n    select *\n    from valid_dementia_exclusions\n\n    union all\n\n    select *\n    from valid_hospice_palliative\n\n    union all\n\n    select *\n    from valid_institutional_snp\n\n    union all\n\n    select *\n    from valid_dementia_exclusions\n\n    union all\n\n    select *\n    from measure_specific_colectomy_colorectal_cancer_exclusion\n\n)\n\n, combined_exclusions as (\n\n  select \n      exclusions.*\n    , denominator.age\n  from exclusions\n  inner join denominator\n      on exclusions.patient_id = denominator.patient_id\n\n)\n\n, valid_exclusions as (\n\n  select * from combined_exclusions\n  where exclusion_type not in (\n      'measure specific exclusion for historical record of colectomy cancer'\n    , 'hospice_palliative'\n    ) \n    and age >= 66\n\n  union all\n\n  select * from combined_exclusions --age irrelvant exclusions\n  where exclusion_type in (\n      'measure specific exclusion for historical record of colectomy cancer'\n    , 'hospice_palliative'\n    ) \n\n)\n\n, add_data_types as (\n\n    select\n        distinct\n          cast(patient_id as TEXT) as patient_id\n        , cast(exclusion_date as date) as exclusion_date\n        , cast(exclusion_reason as TEXT) as exclusion_reason\n        , 1 as exclusion_flag\n    from valid_exclusions\n\n)\n\nselect\n      patient_id\n    , exclusion_date\n    , exclusion_reason\n    , exclusion_flag\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.quality_measures._int_nqf0034_exclusions"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.030951Z", "completed_at": "2024-08-23T19:21:36.068241Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.071613Z", "completed_at": "2024-08-23T19:21:36.071617Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.041493892669677734, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_nqf0034_numerator", "compiled": true, "compiled_code": "\n\n\n/*\nPatients with one or more screenings for colorectal cancer. Appropriate screenings are defined by any one of the\nfollowing criteria:\n- Fecal occult blood test (FOBT) during the measurement period\n- Flexible sigmoidoscopy during the measurement period or the four years prior to the measurement period\n- Colonoscopy during the measurement period or the nine years prior to the measurement period\n- Computed tomography (CT) colonography during the measurement period or the four years prior to the\nmeasurement period.\n- Fecal immunochemical DNA test (FIT-DNA) during the measurement period or the two years prior to the\nmeasurement period.\n\n*/\n\nwith  __dbt__cte__quality_measures__stg_medical_claim as (\n\n\nselect\n      patient_id\n    , claim_id\n    , claim_start_date\n    , claim_end_date\n    , place_of_service_code\n    , hcpcs_code\n    , hcpcs_modifier_1\n    , hcpcs_modifier_2\n    , hcpcs_modifier_3\n    , hcpcs_modifier_4\n    , hcpcs_modifier_5\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.medical_claim\n\n\n),  __dbt__cte__quality_measures__stg_core__observation as (\n\n\nselect\n      patient_id\n    , encounter_id\n    , observation_date\n    , result\n    , source_code_type\n    , source_code\n    , normalized_code_type\n    , normalized_code\n    , normalized_description\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.observation\n\n\n),  __dbt__cte__quality_measures__stg_core__procedure as (\n\nselect\n      patient_id\n    , encounter_id\n    , procedure_date\n    , source_code_type\n    , source_code\n    , normalized_code_type\n    , normalized_code\n    , modifier_1\n    , modifier_2\n    , modifier_3\n    , modifier_4\n    , modifier_5\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.procedure\n),  __dbt__cte__quality_measures__stg_core__lab_result as (\n\n\nselect\n      patient_id\n    , result\n    , result_date\n    , collection_date\n    , source_code_type\n    , source_code\n    , normalized_code_type\n    , normalized_code\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.lab_result\n\n\n), denominator as (\n\n    select\n          patient_id\n    from dev_tom.quality_measures._int_nqf0034_denominator\n\n)\n\n, screening_codes as (\n\n    select\n        code\n      , case code_system\n          when 'SNOMEDCT' then 'snomed-ct'\n          when 'ICD9CM' then 'icd-9-cm'\n          when 'ICD10CM' then 'icd-10-cm'\n          when 'CPT' then 'hcpcs'\n          when 'ICD10PCS' then 'icd-10-pcs'\n        else lower(code_system) \n        end as code_system\n      , concept_name\n    from dev_tom.quality_measures._value_set_codes\n    where lower(concept_name) in  (\n          'fecal occult blood test (fobt)' -- mp\n        , 'flexible sigmoidoscopy' --mp+4\n        , 'colonoscopy' -- mp+9\n        , 'ct colonography' -- mp+4\n        , 'sdna fit test' -- mp+2\n    )\n\n)\n\n, screening_periods  as (\n\n    select \n          code\n        , code_system\n        , concept_name\n        , case concept_name\n            when 'Fecal Occult Blood Test (FOBT)' then pp.performance_period_begin --mp\n            when 'Flexible Sigmoidoscopy' then pp.performance_period_begin_4yp --mp+4\n            when 'Colonoscopy' then pp.performance_period_begin_9yp -- mp+9\n            when 'CT Colonography' then pp.performance_period_begin_4yp -- mp+4\n            when 'sDNA FIT Test' then pp.performance_period_begin_2yp -- mp+2\n          else pp.performance_period_begin \n          end as effective_performance_period_begin\n        , performance_period_end\n    from screening_codes\n    inner join dev_tom.quality_measures._int_nqf0034__performance_period pp\n        on 1 = 1\n    \n)\n\n, medical_claim as (\n\n    select\n          patient_id\n        , claim_start_date\n        , claim_end_date\n        , hcpcs_code\n    from __dbt__cte__quality_measures__stg_medical_claim\n\n)\n\n, observations as (\n\n    select\n          patient_id\n        , observation_date\n        , coalesce (\n              normalized_code_type\n            , case\n                when lower(source_code_type) = 'cpt' then 'hcpcs'\n                when lower(source_code_type) = 'snomed' then 'snomed-ct'\n                else lower(source_code_type)\n              end\n          ) as code_type\n        , coalesce (\n              normalized_code\n            , source_code\n          ) as code\n    from __dbt__cte__quality_measures__stg_core__observation\n\n)\n\n, procedures as (\n\n    select\n          patient_id\n        , procedure_date\n        , coalesce(\n              normalized_code_type\n            , case\n                when lower(source_code_type) = 'cpt' then 'hcpcs'\n                when lower(source_code_type) = 'snomed' then 'snomed-ct'\n                else lower(source_code_type)\n              end\n          ) as code_type\n        , coalesce(\n              normalized_code\n            , source_code\n          ) as code\n    from __dbt__cte__quality_measures__stg_core__procedure\n\n)\n\n, labs as (\n\n    select  \n      patient_id\n    , result_date\n    , collection_date\n    , source_code_type\n    , source_code\n    , normalized_code_type\n    , normalized_code\n    from __dbt__cte__quality_measures__stg_core__lab_result\n\n)\n\n, qualifying_claims as (\n\n    select\n          medical_claim.patient_id\n        , coalesce( medical_claim.claim_start_date, medical_claim.claim_end_date) as claim_date\n    , screening_codes.concept_name\n    from medical_claim\n    inner join screening_periods\n        on medical_claim.claim_start_date between screening_periods.effective_performance_period_begin and screening_periods.performance_period_end\n        or medical_claim.claim_end_date between screening_periods.effective_performance_period_begin and screening_periods.performance_period_end\n    inner join screening_codes\n            on medical_claim.hcpcs_code = screening_codes.code\n    where screening_codes.code_system in ('hcpcs', 'cpt' )\n\n)\n\n, qualifying_observations as (\n\n    select\n          observations.patient_id\n        , observations.observation_date\n        , screening_codes.concept_name\n    from observations\n    inner join screening_periods\n        on observations.observation_date between screening_periods.effective_performance_period_begin and screening_periods.performance_period_end\n     inner join screening_codes\n         on observations.code = screening_codes.code\n         and observations.code_type = screening_codes.code_system\n)\n\n, qualifying_procedures as (\n\n    select\n          procedures.patient_id\n        , procedures.procedure_date\n        , screening_codes.concept_name\n    from procedures\n    inner join screening_periods\n        on procedures.procedure_date between screening_periods.effective_performance_period_begin and screening_periods.performance_period_end\n     inner join screening_codes\n         on procedures.code = screening_codes.code\n         and procedures.code_type = screening_codes.code_system\n\n)\n\n, normalized_code_labs as (\n  select\n      patient_id\n    , coalesce(collection_date, result_date) as lab_date\n    , screening_codes.concept_name\n  from labs\n  inner join screening_periods\n    on coalesce(labs.collection_date, labs.result_date) >= screening_periods.effective_performance_period_begin\n    and coalesce(labs.collection_date, labs.result_date) <= screening_periods.performance_period_end\n  inner join screening_codes\n    on labs.normalized_code = screening_codes.code\n    and labs.normalized_code_type = screening_codes.code_system\n)\n\n, source_code_labs as (\n\n  select\n      patient_id\n    , coalesce(collection_date, result_date) as lab_date\n    , screening_codes.concept_name\n  from labs\n  inner join screening_periods\n    on coalesce(labs.collection_date, labs.result_date) >= screening_periods.effective_performance_period_begin\n    and coalesce(labs.collection_date, labs.result_date) <= screening_periods.performance_period_end\n  inner join screening_codes\n    on labs.source_code = screening_codes.code\n    and labs.source_code_type = screening_codes.code_system\n\n)\n\n, qualifying_labs_union as (\n\n  select \n        patient_id\n      , lab_date\n      , concept_name\n  from normalized_code_labs\n\n  union all\n\n  select \n        patient_id\n      , lab_date\n      , concept_name\n  from source_code_labs\n\n)\n\n, qualifying_labs as (\n\n  select distinct\n        patient_id\n      , lab_date\n      , concept_name\n  from qualifying_labs_union\n\n)\n\n, qualifying_events as (\n\n    select\n          patient_id\n        , claim_date as evidence_date\n        , concept_name as evidence\n    from qualifying_claims\n\n    union all\n\n    select\n          patient_id\n        , observation_date as evidence_date\n        , concept_name as evidence\n    from qualifying_observations\n\n    union all\n\n    select\n          patient_id\n        , procedure_date as evidence_date\n        , concept_name as evidence\n    from qualifying_procedures\n\n    union all\n\n    select\n          patient_id\n        , lab_date as evidence_date\n        , concept_name as evidence\n    from qualifying_labs\n\n)\n\nselect\n      cast( qualifying_events.patient_id as TEXT) as patient_id\n    , cast( evidence_date as date) as evidence_date\n    , cast( evidence as TEXT) as evidence\nfrom qualifying_events\ninner join denominator\n    on qualifying_events.patient_id = denominator.patient_id", "relation_name": "dev_tom.quality_measures._int_nqf0034_numerator"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.054977Z", "completed_at": "2024-08-23T19:21:36.072392Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.075282Z", "completed_at": "2024-08-23T19:21:36.075286Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.020763158798217773, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_nqf0041_exclusions", "compiled": true, "compiled_code": "with  __dbt__cte__quality_measures__stg_core__procedure as (\n\nselect\n      patient_id\n    , encounter_id\n    , procedure_date\n    , source_code_type\n    , source_code\n    , normalized_code_type\n    , normalized_code\n    , modifier_1\n    , modifier_2\n    , modifier_3\n    , modifier_4\n    , modifier_5\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.procedure\n),  __dbt__cte__quality_measures__stg_medical_claim as (\n\n\nselect\n      patient_id\n    , claim_id\n    , claim_start_date\n    , claim_end_date\n    , place_of_service_code\n    , hcpcs_code\n    , hcpcs_modifier_1\n    , hcpcs_modifier_2\n    , hcpcs_modifier_3\n    , hcpcs_modifier_4\n    , hcpcs_modifier_5\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.medical_claim\n\n\n), denominator as (\n    \n    select\n        patient_id\n    from dev_tom.quality_measures._int_nqf0041_denominator\n\n)\n\n, exclusion_codes as (\n\n  select \n      code\n    , code_system\n    , concept_name\n  from dev_tom.quality_measures._value_set_codes\n  where lower(concept_name) in (\n        'influenza immunization not ordered or administered reason documented'\n    )\n\n)\n\n, procedures as (\n\n    select\n          patient_id\n        , procedure_date\n        , coalesce (\n              normalized_code_type\n            , case\n                when lower(source_code_type) = 'cpt' then 'hcpcs'\n                when lower(source_code_type) = 'snomed' then 'snomed-ct'\n                else lower(source_code_type)\n              end\n          ) as code_type\n        , coalesce (\n              normalized_code\n            , source_code\n          ) as code\n    from __dbt__cte__quality_measures__stg_core__procedure\n    where procedure_date between (\n\n  select \n    performance_period_begin\n  from dev_tom.quality_measures._int_nqf0041__performance_period\n\n) and (\n\n  select \n    performance_period_end\n  from dev_tom.quality_measures._int_nqf0041__performance_period\n\n)\n\n)\n\n, medical_claim as (\n\n    select\n          patient_id\n        , claim_start_date\n        , claim_end_date\n        , hcpcs_code\n    from __dbt__cte__quality_measures__stg_medical_claim\n    where coalesce(claim_end_date, claim_start_date) between (\n\n  select \n    performance_period_begin\n  from dev_tom.quality_measures._int_nqf0041__performance_period\n\n) and (\n\n  select \n    performance_period_end\n  from dev_tom.quality_measures._int_nqf0041__performance_period\n\n)\n\n)\n\n, procedure_exclusions as (\n\n    select\n          procedures.patient_id\n        , procedures.procedure_date\n        , exclusion_codes.concept_name as concept_name\n    from procedures\n    inner join exclusion_codes\n        on procedures.code = exclusion_codes.code\n          and procedures.code_type = exclusion_codes.code_system\n\n)\n\n, med_claim_exclusions as (\n\n    select\n          medical_claim.patient_id\n        , coalesce(medical_claim.claim_end_date, medical_claim.claim_start_date) as exclusion_date\n        , medical_claim.hcpcs_code\n        , exclusion_codes.concept_name as concept_name\n    from medical_claim\n    inner join exclusion_codes\n      on medical_claim.hcpcs_code = exclusion_codes.code\n        and exclusion_codes.code_system = 'hcpcs'\n\n)\n\n, hospice_palliative as (\n\n    select\n          patient_id\n        , exclusion_date\n        , exclusion_reason\n        , exclusion_type\n    from dev_tom.quality_measures._int_shared_exclusions_hospice_palliative\n    where exclusion_date between (\n\n  select \n    performance_period_begin\n  from dev_tom.quality_measures._int_nqf0041__performance_period\n\n) and (\n\n  select \n    performance_period_end\n  from dev_tom.quality_measures._int_nqf0041__performance_period\n\n)\n\n)\n\n, valid_hospice_palliative as (\n\n    select\n          patient_id\n        , exclusion_date\n        , exclusion_reason\n        , exclusion_type\n    from hospice_palliative\n    where exclusion_reason in (\n          'hospice care ambulatory'\n        , 'hospice encounter'\n    )\n\n)\n\n, valid_exclusions as (\n\n    select\n        patient_id\n      , procedure_date as exclusion_date\n      , concept_name as exclusion_reason\n    from procedure_exclusions\n\n    union all\n\n    select\n        patient_id\n      , exclusion_date\n      , concept_name as exclusion_reason\n    from med_claim_exclusions\n\n    union all\n\n    select\n        patient_id\n      , exclusion_date\n      , exclusion_reason\n    from valid_hospice_palliative\n\n)\n\n, combined_exclusions as (\n\n    select\n        valid_exclusions.patient_id\n      , valid_exclusions.exclusion_date\n      , valid_exclusions.exclusion_reason\n    from valid_exclusions\n    inner join denominator\n      on valid_exclusions.patient_id = denominator.patient_id\n\n)\n\n, add_data_types as (\n\n    select\n        distinct\n          cast(patient_id as TEXT) as patient_id\n        , cast(exclusion_date as date) as exclusion_date\n        , cast(exclusion_reason as TEXT) as exclusion_reason\n        , cast(1 as integer) as exclusion_flag\n    from combined_exclusions\n\n)\n\nselect\n      patient_id\n    , exclusion_date\n    , exclusion_reason\n    , exclusion_flag\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.quality_measures._int_nqf0041_exclusions"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.075625Z", "completed_at": "2024-08-23T19:21:36.095998Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.108074Z", "completed_at": "2024-08-23T19:21:36.108078Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.03589510917663574, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_nqf0041_numerator", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__quality_measures__stg_core__procedure as (\n\nselect\n      patient_id\n    , encounter_id\n    , procedure_date\n    , source_code_type\n    , source_code\n    , normalized_code_type\n    , normalized_code\n    , modifier_1\n    , modifier_2\n    , modifier_3\n    , modifier_4\n    , modifier_5\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.procedure\n),  __dbt__cte__quality_measures__stg_medical_claim as (\n\n\nselect\n      patient_id\n    , claim_id\n    , claim_start_date\n    , claim_end_date\n    , place_of_service_code\n    , hcpcs_code\n    , hcpcs_modifier_1\n    , hcpcs_modifier_2\n    , hcpcs_modifier_3\n    , hcpcs_modifier_4\n    , hcpcs_modifier_5\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.medical_claim\n\n\n), denominator as (\n\n    select \n          patient_id\n        , performance_period_begin\n        , performance_period_end\n        , measure_id\n        , measure_name\n        , measure_version\n    from dev_tom.quality_measures._int_nqf0041_denominator\n\n)\n\n, influenza_vaccination_code as (\n\n    select\n          code\n        , code_system\n        , concept_name\n    from dev_tom.quality_measures._value_set_codes\n    where lower(concept_name) in (\n          'influenza vaccination'\n        , 'influenza vaccine'\n        , 'influenza virus laiv immunization'\n        , 'influenza virus laiv procedure'\n    )\n\n)\n\n, procedure_vaccination as (\n\n    select\n        patient_id\n      , procedure_date\n    from __dbt__cte__quality_measures__stg_core__procedure as procedures\n    inner join influenza_vaccination_code\n        on coalesce(procedures.normalized_code, procedures.source_code) = influenza_vaccination_code.code\n            and coalesce(procedures.normalized_code_type, procedures.source_code_type) = influenza_vaccination_code.code_system\n\n)\n\n, claims_vaccination as (\n    \n    select \n          patient_id\n        , coalesce(claim_start_date,claim_end_date) as min_date\n        , coalesce(claim_end_date,claim_start_date) as max_date\n    from __dbt__cte__quality_measures__stg_medical_claim medical_claim\n    inner join influenza_vaccination_code\n        on medical_claim.hcpcs_code = influenza_vaccination_code.code\n\n)\n\n, qualifying_procedures as (\n\n    select\n          procedure_vaccination.patient_id\n        , procedure_vaccination.procedure_date as evidence_date\n    from procedure_vaccination\n    inner join dev_tom.quality_measures._int_nqf0041__performance_period pp\n        on procedure_date between \n            pp.lookback_period_august and\n                pp.performance_period_end\n\n)\n\n, qualifying_claims as (\n\n    select \n          claims_vaccination.patient_id\n        , claims_vaccination.max_date as evidence_date\n    from claims_vaccination\n    inner join dev_tom.quality_measures._int_nqf0041__performance_period pp\n        on max_date between\n            pp.lookback_period_august and\n                pp.performance_period_end\n\n)\n\n, qualified_patients as (\n\n    select\n          patient_id\n        , evidence_date\n    from qualifying_procedures\n\n    union all\n\n    select\n          patient_id\n        , evidence_date\n    from qualifying_claims\n\n)\n\n, combined_qualifying_patients as (\n\n    select\n          qualified_patients.patient_id\n        , qualified_patients.evidence_date\n        , denominator.measure_id\n        , denominator.measure_name\n        , denominator.measure_version\n        , denominator.performance_period_begin\n        , denominator.performance_period_end\n        , 1 as numerator_flag\n    from qualified_patients\n    inner join denominator\n        on qualified_patients.patient_id = denominator.patient_id\n\n)\n\n, add_data_types as (\n\n     select distinct\n          cast(patient_id as TEXT) as patient_id\n        , cast(performance_period_begin as date) as performance_period_begin\n        , cast(performance_period_end as date) as performance_period_end\n        , cast(measure_id as TEXT) as measure_id\n        , cast(measure_name as TEXT) as measure_name\n        , cast(measure_version as TEXT) as measure_version\n        , cast(evidence_date as date) as evidence_date\n        , cast(null as TEXT) as evidence_value\n        , cast(numerator_flag as integer) as numerator_flag\n    from combined_qualifying_patients\n\n)\n\nselect\n      patient_id\n    , performance_period_begin\n    , performance_period_end\n    , measure_id\n    , measure_name\n    , measure_version\n    , evidence_date\n    , evidence_value\n    , numerator_flag\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.quality_measures._int_nqf0041_numerator"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.089699Z", "completed_at": "2024-08-23T19:21:36.108980Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.133461Z", "completed_at": "2024-08-23T19:21:36.133465Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.044157981872558594, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_nqf0053_exclude_procedures_medications", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__quality_measures__stg_core__procedure as (\n\nselect\n      patient_id\n    , encounter_id\n    , procedure_date\n    , source_code_type\n    , source_code\n    , normalized_code_type\n    , normalized_code\n    , modifier_1\n    , modifier_2\n    , modifier_3\n    , modifier_4\n    , modifier_5\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.procedure\n),  __dbt__cte__quality_measures__stg_pharmacy_claim as (\n\n\nselect\n      patient_id\n    , dispensing_date\n    , ndc_code\n    , paid_date\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.pharmacy_claim\n\n\n),  __dbt__cte__quality_measures__stg_core__medication as (\n\n\nselect\n      patient_id\n    , encounter_id\n    , prescribing_date  \n    , dispensing_date\n    , source_code_type\n    , source_code\n    , ndc_code\n    , rxnorm_code\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.medication\n\n\n), denominator as (\n\n    select\n          patient_id\n        , performance_period_begin\n    from dev_tom.quality_measures._int_nqf0053_denominator\n\n)\n\n, value_sets as (\n\n    select\n          concept_name\n        , code\n        , code_system\n    from dev_tom.quality_measures._value_set_codes\n\n)\n\n, procedures as (\n\n    select\n          patient_id\n        , procedure_date\n        , coalesce (\n              normalized_code_type\n            , case\n                when lower(source_code_type) = 'cpt' then 'hcpcs'\n                when lower(source_code_type) = 'snomed' then 'snomed-ct'\n                else lower(source_code_type)\n              end\n          ) as code_type\n        , coalesce(\n              normalized_code\n            , source_code\n          ) as code\n    from __dbt__cte__quality_measures__stg_core__procedure\n\n)\n\n, pharmacy_claims as (\n\n    select\n          patient_id\n        , dispensing_date\n        , ndc_code\n    from __dbt__cte__quality_measures__stg_pharmacy_claim\n\n)\n\n, medications as (\n\n    select\n        patient_id\n      , encounter_id\n      , prescribing_date\n      , dispensing_date\n      , source_code\n      , source_code_type\n    from __dbt__cte__quality_measures__stg_core__medication\n\n)\n\n, bone_density_test_codes as (\n\n    select\n          concept_name\n        , code\n        , code_system\n    from value_sets\n    where lower(concept_name) in (\n          'bone mineral density test'\n        , 'bone mineral density tests cpt'\n        , 'bone mineral density tests hcpcs'\n        , 'bone mineral density tests icd10pcs'\n        , 'dexa dual energy xray absorptiometry, bone density'\n    )\n\n)\n\n, osteoporosis_medication_codes as (\n\n    select\n          code\n        , code_system\n        , concept_name\n    from value_sets\n    where lower(concept_name) in \n        ( \n          'osteoporosis medications for urology care'\n        , 'osteoporosis medication'\n        , 'bisphosphonates'\n        )\n\n)\n\n, bone_density_test_procedures as (\n\n    select\n          procedures.*\n        , bone_density_test_codes.concept_name\n    from procedures\n    inner join bone_density_test_codes\n        on procedures.code = bone_density_test_codes.code\n            and procedures.code_type = bone_density_test_codes.code_system\n\n)\n\n, osteoporosis_pharmacy_claims as (\n\n    select\n        pharmacy_claims.patient_id\n      , pharmacy_claims.dispensing_date\n      , pharmacy_claims.ndc_code\n      , osteoporosis_medication_codes.concept_name\n    from pharmacy_claims\n    inner join osteoporosis_medication_codes\n        on pharmacy_claims.ndc_code = osteoporosis_medication_codes.code\n            and lower(osteoporosis_medication_codes.code_system) = 'ndc'\n            \n)\n\n, osteoporosis_medications as (\n\n    select\n        medications.patient_id\n      , medications.encounter_id\n      , medications.prescribing_date\n      , medications.dispensing_date\n      , medications.source_code\n      , medications.source_code_type\n      , osteoporosis_medication_codes.concept_name\n    from medications\n    inner join osteoporosis_medication_codes\n        on medications.source_code = osteoporosis_medication_codes.code\n            and medications.source_code_type = osteoporosis_medication_codes.code_system\n\n)\n\n, valid_osteoporosis_medications_procedures as (\n\n    select\n          denominator.patient_id\n        , osteoporosis_pharmacy_claims.concept_name as exclusion_reason\n        , osteoporosis_pharmacy_claims.dispensing_date as exclusion_date\n    from denominator\n    inner join osteoporosis_pharmacy_claims\n        on denominator.patient_id = osteoporosis_pharmacy_claims.patient_id\n    where osteoporosis_pharmacy_claims.dispensing_date\n        between\n            \n\n    dateadd(\n        month,\n        -12,\n        denominator.performance_period_begin\n        )\n\n\n            and denominator.performance_period_begin\n    \n    union all\n\n    select\n          denominator.patient_id\n        , osteoporosis_medications.concept_name as exclusion_reason\n        , coalesce(osteoporosis_medications.prescribing_date, osteoporosis_medications.dispensing_date) as exclusion_date\n    from denominator\n    inner join osteoporosis_medications\n        on denominator.patient_id = osteoporosis_medications.patient_id\n            and coalesce(osteoporosis_medications.prescribing_date, osteoporosis_medications.dispensing_date)\n            between\n                \n\n    dateadd(\n        month,\n        -12,\n        denominator.performance_period_begin\n        )\n\n\n                and denominator.performance_period_begin\n\n)\n\n, valid_tests_performed as (\n\n    select\n          denominator.patient_id\n        , bone_density_test_procedures.concept_name as exclusion_reason\n        , procedure_date as exclusion_date\n    from denominator\n    inner join bone_density_test_procedures\n        on denominator.patient_id = bone_density_test_procedures.patient_id\n    where bone_density_test_procedures.procedure_date\n        between \n            \n\n    dateadd(\n        year,\n        -2,\n        denominator.performance_period_begin\n        )\n\n\n            and denominator.performance_period_begin\n\n)\n\n, valid_exclusions as (\n\n    select * from valid_tests_performed\n\n    union all\n\n    select * from valid_osteoporosis_medications_procedures\n\n)\n\nselect\n      patient_id\n    , exclusion_date\n    , exclusion_reason\n    , 'measure specific exclusion for procedure medication' as exclusion_type\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom\n    valid_exclusions", "relation_name": "dev_tom.quality_measures._int_nqf0053_exclude_procedures_medications"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.109134Z", "completed_at": "2024-08-23T19:21:36.134373Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.138762Z", "completed_at": "2024-08-23T19:21:36.138764Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.03013896942138672, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_nqf0053_numerator", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__quality_measures__stg_core__procedure as (\n\nselect\n      patient_id\n    , encounter_id\n    , procedure_date\n    , source_code_type\n    , source_code\n    , normalized_code_type\n    , normalized_code\n    , modifier_1\n    , modifier_2\n    , modifier_3\n    , modifier_4\n    , modifier_5\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.procedure\n),  __dbt__cte__quality_measures__stg_pharmacy_claim as (\n\n\nselect\n      patient_id\n    , dispensing_date\n    , ndc_code\n    , paid_date\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.pharmacy_claim\n\n\n),  __dbt__cte__quality_measures__stg_core__medication as (\n\n\nselect\n      patient_id\n    , encounter_id\n    , prescribing_date  \n    , dispensing_date\n    , source_code_type\n    , source_code\n    , ndc_code\n    , rxnorm_code\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.medication\n\n\n), denominator as (\n\n    select \n          patient_id\n        , performance_period_begin\n        , performance_period_end\n        , recorded_date\n        , measure_id\n        , measure_name\n        , measure_version\n    from dev_tom.quality_measures._int_nqf0053_denominator\n\n)\n\n, value_sets as (\n\n    select\n          code\n        , code_system\n        , concept_name\n    from dev_tom.quality_measures._value_set_codes\n    \n)\n\n, osteo_procedure_codes as (\n\n    select\n          code\n        , code_system\n        , concept_name\n    from value_sets\n    where lower(concept_name) in (\n          'bone mineral density test'\n        , 'bone mineral density tests cpt'\n        , 'bone mineral density tests icd10pcs'\n        , 'bone mineral density tests hcpcs'\n        , 'dexa dual energy xray absorptiometry, bone density'\n        , 'central dual energy x-ray absorptiometry (dxa)'\n        , 'spinal densitometry x-ray' \n        , 'ultrasonography for densitometry' \n        , 'ct bone density axial'\n        , 'peripheral dual-energy x-ray absorptiometry (dxa)'\n        , 'osteoporosis medication'\n    )\n\n)\n\n, procedures_osteo_related as (\n\n    select\n        patient_id\n      , procedure_date\n    from __dbt__cte__quality_measures__stg_core__procedure as procs\n    inner join osteo_procedure_codes\n        on coalesce(procs.normalized_code, procs.source_code) = osteo_procedure_codes.code\n        and coalesce(procs.normalized_code_type, procs.source_code_type) = osteo_procedure_codes.code_system\n\n)\n\n, qualifying_procedures as (\n\n    select\n          procedures_osteo_related.patient_id\n        , procedures_osteo_related.procedure_date\n        , denominator.measure_id\n        , denominator.measure_name\n        , denominator.measure_version\n        , denominator.recorded_date\n        , denominator.performance_period_begin\n        , denominator.performance_period_end\n    from procedures_osteo_related\n    inner join denominator\n        on procedures_osteo_related.patient_id = denominator.patient_id\n        and \n            procedures_osteo_related.procedure_date between\n            denominator.recorded_date \n            and\n            \n\n    dateadd(\n        month,\n        6,\n        denominator.recorded_date\n        )\n\n \n\n)\n\n, denominator_patients_disqualified_from_procedure as (\n    \n    select \n          denominator.patient_id\n        , denominator.measure_id\n        , denominator.measure_name\n        , denominator.measure_version\n        , denominator.recorded_date\n        , denominator.performance_period_begin\n        , denominator.performance_period_end  \n    from denominator\n    left join qualifying_procedures \n    on denominator.patient_id = qualifying_procedures.patient_id\n    where qualifying_procedures.patient_id is null\n\n)\n\n-- pharmacy_claim begin\n\n, osteo_rx_codes as (\n\n    select\n          code\n        , code_system\n        , concept_name\n    from value_sets\n    where lower(concept_name) \n        in \n        ( \n          'osteoporosis medications for urology care'\n        , 'osteoporosis medication'\n        , 'bisphosphonates'\n        )\n\n)\n\n, pharmacy_claims_osteo_related as (\n\n    select\n        patient_id\n      , dispensing_date\n      , ndc_code  \n    from __dbt__cte__quality_measures__stg_pharmacy_claim as pharmacy_claims\n    inner join osteo_rx_codes\n    on pharmacy_claims.ndc_code = osteo_rx_codes.code\n        and lower(osteo_rx_codes.code_system) = 'ndc'\n\n)\n\n, qualifying_pharmacy_claims as (\n\n    select \n          pharmacy_claims_osteo_related.patient_id\n        , pharmacy_claims_osteo_related.dispensing_date\n        , pharmacy_claims_osteo_related.ndc_code\n        , denominator_patients_disqualified_from_procedure.measure_id\n        , denominator_patients_disqualified_from_procedure.measure_name\n        , denominator_patients_disqualified_from_procedure.measure_version\n        , denominator_patients_disqualified_from_procedure.recorded_date\n        , denominator_patients_disqualified_from_procedure.performance_period_begin\n        , denominator_patients_disqualified_from_procedure.performance_period_end\n    from pharmacy_claims_osteo_related\n    inner join denominator_patients_disqualified_from_procedure\n        on pharmacy_claims_osteo_related.patient_id = denominator_patients_disqualified_from_procedure.patient_id\n        and pharmacy_claims_osteo_related.dispensing_date \n            between             \n            denominator_patients_disqualified_from_procedure.recorded_date \n                and \n                \n\n    dateadd(\n        month,\n        6,\n        denominator_patients_disqualified_from_procedure.recorded_date\n        )\n\n\n)\n\n-- medication begin\n\n, medication_osteo_related as (\n\n    select\n        patient_id\n      , encounter_id\n      , prescribing_date\n      , dispensing_date\n      , source_code\n      , source_code_type\n      , ndc_code\n      , rxnorm_code\n    from __dbt__cte__quality_measures__stg_core__medication as medications\n    inner join osteo_rx_codes\n        on medications.source_code = osteo_rx_codes.code\n        and medications.source_code_type = osteo_rx_codes.code_system\n\n)\n\n, qualifying_medications as (\n\n    select\n          medication_osteo_related.patient_id\n        , medication_osteo_related.encounter_id\n        , denominator_patients_disqualified_from_procedure.measure_id\n        , denominator_patients_disqualified_from_procedure.measure_name\n        , denominator_patients_disqualified_from_procedure.measure_version\n        , denominator_patients_disqualified_from_procedure.recorded_date\n        , denominator_patients_disqualified_from_procedure.performance_period_begin\n        , denominator_patients_disqualified_from_procedure.performance_period_end\n    from medication_osteo_related\n    inner join denominator_patients_disqualified_from_procedure\n        on medication_osteo_related.patient_id = denominator_patients_disqualified_from_procedure.patient_id\n            and coalesce(medication_osteo_related.prescribing_date, medication_osteo_related.dispensing_date) between \n                denominator_patients_disqualified_from_procedure.recorded_date \n                and \n                \n\n    dateadd(\n        month,\n        6,\n        denominator_patients_disqualified_from_procedure.recorded_date\n        )\n\n\n\n)\n\n, numerator as (\n\n    select\n          qualifying_procedures.patient_id\n        , qualifying_procedures.performance_period_begin\n        , qualifying_procedures.performance_period_end\n        , qualifying_procedures.measure_id\n        , qualifying_procedures.measure_name\n        , qualifying_procedures.measure_version\n        , recorded_date as evidence_date\n        , 1 as numerator_flag\n    from qualifying_procedures\n\n    union all\n\n    select \n          qualifying_pharmacy_claims.patient_id\n        , qualifying_pharmacy_claims.performance_period_begin\n        , qualifying_pharmacy_claims.performance_period_end\n        , qualifying_pharmacy_claims.measure_id\n        , qualifying_pharmacy_claims.measure_name\n        , qualifying_pharmacy_claims.measure_version\n        , recorded_date as evidence_date\n        , 1 as numerator_flag\n    from qualifying_pharmacy_claims\n\n    union all\n\n    select \n          qualifying_medications.patient_id\n        , qualifying_medications.performance_period_begin\n        , qualifying_medications.performance_period_end\n        , qualifying_medications.measure_id\n        , qualifying_medications.measure_name\n        , qualifying_medications.measure_version\n        , recorded_date as evidence_date\n        , 1 as numerator_flag\n    from qualifying_medications\n\n)\n\n, add_data_types as (\n\n     select distinct\n          cast(patient_id as TEXT) as patient_id\n        , cast(performance_period_begin as date) as performance_period_begin\n        , cast(performance_period_end as date) as performance_period_end\n        , cast(measure_id as TEXT) as measure_id\n        , cast(measure_name as TEXT) as measure_name\n        , cast(measure_version as TEXT) as measure_version\n        , cast(evidence_date as date) as evidence_date\n        , cast(null as TEXT) as evidence_value\n        , cast(numerator_flag as integer) as numerator_flag\n    from numerator\n\n)\n\nselect\n      patient_id\n    , performance_period_begin\n    , performance_period_end\n    , measure_id\n    , measure_name\n    , measure_version\n    , evidence_date\n    , evidence_value\n    , numerator_flag\nfrom add_data_types", "relation_name": "dev_tom.quality_measures._int_nqf0053_numerator"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.134515Z", "completed_at": "2024-08-23T19:21:36.139604Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.154719Z", "completed_at": "2024-08-23T19:21:36.154722Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0207211971282959, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_nqf0059_exclusions", "compiled": true, "compiled_code": "with frailty as (\n\n  select\n    *\n  from dev_tom.quality_measures._int_shared_exclusions_frailty\n  where exclusion_date between (\n  select \n    performance_period_begin\n  from dev_tom.quality_measures._int_nqf0059__performance_period\n\n) and (\n  select \n    performance_period_end\n  from dev_tom.quality_measures._int_nqf0059__performance_period\n\n)\n\n)\n-- advanced illness start\n, advanced_illness_exclusion as (\n\n  select\n    source.*\n  from dev_tom.quality_measures._int_shared_exclusions_advanced_illness as source\n  inner join frailty\n    on source.patient_id = frailty.patient_id\n  where source.exclusion_date\n    between\n      \n\n    dateadd(\n        year,\n        -1,\n        (\n  select \n    performance_period_begin\n  from dev_tom.quality_measures._int_nqf0059__performance_period\n\n)\n        )\n\n\n      and (\n  select \n    performance_period_end\n  from dev_tom.quality_measures._int_nqf0059__performance_period\n\n)\n\n)\n\n, acute_inpatient_advanced_illness as (\n\n  select\n    *\n  from advanced_illness_exclusion\n  where patient_type = 'acute_inpatient'\n\n)\n\n, nonacute_outpatient_advanced_illness as (\n\n  select\n    *\n  from advanced_illness_exclusion\n  where patient_type = 'nonacute_outpatient'\n\n)\n\n, acute_inpatient_counts as (\n\n    select\n          patient_id\n        , exclusion_type\n        , count(distinct exclusion_date) as encounter_count\n    from acute_inpatient_advanced_illness\n    group by patient_id, exclusion_type\n\n)\n\n, nonacute_outpatient_counts as (\n\n    select\n          patient_id\n        , exclusion_type\n        , count(distinct exclusion_date) as encounter_count\n    from nonacute_outpatient_advanced_illness\n    group by patient_id, exclusion_type\n\n)\n\n, valid_advanced_illness_exclusions as (\n\n    select\n          acute_inpatient_advanced_illness.patient_id\n        , acute_inpatient_advanced_illness.exclusion_date\n        , acute_inpatient_advanced_illness.exclusion_reason\n        , acute_inpatient_advanced_illness.exclusion_type\n    from acute_inpatient_advanced_illness\n    left join acute_inpatient_counts\n      on acute_inpatient_advanced_illness.patient_id = acute_inpatient_counts.patient_id\n    where acute_inpatient_counts.encounter_count >= 1\n\n    union all\n\n    select\n        nonacute_outpatient_advanced_illness.patient_id\n      , nonacute_outpatient_advanced_illness.exclusion_date\n      , nonacute_outpatient_advanced_illness.exclusion_reason\n      , nonacute_outpatient_advanced_illness.exclusion_type\n    from nonacute_outpatient_advanced_illness\n    left join nonacute_outpatient_counts\n      on nonacute_outpatient_advanced_illness.patient_id = nonacute_outpatient_counts.patient_id\n    where nonacute_outpatient_counts.encounter_count >= 2\n\n\n)\n-- advanced illness end\n\n, valid_dementia_exclusions as (\n\n  select\n      source.patient_id\n    , source.exclusion_date\n    , source.exclusion_reason\n    , source.exclusion_type\n  from dev_tom.quality_measures._int_shared_exclusions_dementia source\n  inner join frailty\n    on source.patient_id = frailty.patient_id\n  where (\n    source.dispensing_date\n      between \n\n    dateadd(\n        year,\n        -1,\n        (\n  select \n    performance_period_begin\n  from dev_tom.quality_measures._int_nqf0059__performance_period\n\n)\n        )\n\n\n          and (\n  select \n    performance_period_end\n  from dev_tom.quality_measures._int_nqf0059__performance_period\n\n)\n    or source.paid_date\n      between \n\n    dateadd(\n        year,\n        -1,\n        (\n  select \n    performance_period_begin\n  from dev_tom.quality_measures._int_nqf0059__performance_period\n\n)\n        )\n\n\n          and (\n  select \n    performance_period_end\n  from dev_tom.quality_measures._int_nqf0059__performance_period\n\n)\n    )\n\n)\n\n, valid_hospice_palliative as (\n\n  select\n      patient_id\n    , exclusion_date\n    , exclusion_reason\n    , exclusion_type\n  from dev_tom.quality_measures._int_shared_exclusions_hospice_palliative\n  where exclusion_date between (\n  select \n    performance_period_begin\n  from dev_tom.quality_measures._int_nqf0059__performance_period\n\n) and (\n  select \n    performance_period_end\n  from dev_tom.quality_measures._int_nqf0059__performance_period\n\n)\n\n)\n\n, valid_institutional_snp as (\n\n  select \n      patient_id\n    , exclusion_date\n    , exclusion_reason\n    , exclusion_type\n  from dev_tom.quality_measures._int_shared_exclusions_institutional_snp\n  where exclusion_date between (\n  select \n    performance_period_begin\n  from dev_tom.quality_measures._int_nqf0059__performance_period\n\n) and (\n  select \n    performance_period_end\n  from dev_tom.quality_measures._int_nqf0059__performance_period\n\n)\n\n)\n\n, exclusions as (\n\n  select * from valid_advanced_illness_exclusions\n  union all\n  select * from valid_dementia_exclusions\n  union all\n  select * from valid_hospice_palliative\n  union all\n  select * from valid_institutional_snp\n\n)\n\n, combined_exclusions as (\n\n  select \n      exclusions.*\n    , denominator.age\n  from exclusions\n  inner join dev_tom.quality_measures._int_nqf0059_denominator as denominator\n      on exclusions.patient_id = denominator.patient_id\n\n)\n\n, valid_exclusions as (\n\n  select\n    *\n  from combined_exclusions\n  where exclusion_type != 'hospice_palliative'\n    and age >= 66\n\n  union all\n\n  select\n    *\n  from combined_exclusions\n  where exclusion_type = 'hospice_palliative'\n\n)\n\n, add_data_types as (\n\n    select\n        distinct\n          cast(patient_id as TEXT) as patient_id\n        , cast(exclusion_date as date) as exclusion_date\n        , cast(exclusion_reason as TEXT) as exclusion_reason\n        , 1 as exclusion_flag\n    from valid_exclusions\n\n)\n\nselect\n      patient_id\n    , exclusion_date\n    , exclusion_reason\n    , exclusion_flag\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.quality_measures._int_nqf0059_exclusions"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.139775Z", "completed_at": "2024-08-23T19:21:36.155551Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.158445Z", "completed_at": "2024-08-23T19:21:36.158447Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.01920294761657715, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_nqf0059_numerator", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__quality_measures__stg_core__lab_result as (\n\n\nselect\n      patient_id\n    , result\n    , result_date\n    , collection_date\n    , source_code_type\n    , source_code\n    , normalized_code_type\n    , normalized_code\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.lab_result\n\n\n), denominator as (\n\n    select\n          patient_id\n        , performance_period_begin\n        , performance_period_end\n        , measure_id\n        , measure_name\n        , measure_version\n    from dev_tom.quality_measures._int_nqf0059_denominator\n\n)\n\n, hba1c_test_code as (\n\n    select\n          code\n        , code_system\n        , concept_name\n    From dev_tom.quality_measures._value_set_codes\n    where lower(concept_name) in  (\n        'hba1c laboratory test'\n    )\n\n)\n\n, labs as (\n\n    select\n        patient_id\n        , result\n        , result_date\n        , collection_date\n        , source_code_type\n        , source_code\n        , normalized_code_type\n        , normalized_code\n    from __dbt__cte__quality_measures__stg_core__lab_result\n\n)\n\n, qualifying_labs as (\n\n    select\n      labs.patient_id\n    , labs.result as evidence_value\n    , coalesce(collection_date,result_date) as evidence_date\n    , hba1c_test_code.concept_name\n    , row_number() over(partition by labs.patient_id order by coalesce(collection_date,result_date) desc) as rn\n    from labs\n    inner join hba1c_test_code\n        on coalesce(labs.normalized_code, labs.source_code) = hba1c_test_code.code\n            and coalesce(labs.normalized_code_type, labs.source_code_type) = hba1c_test_code.code_system\n    left join denominator\n        on labs.patient_id = denominator.patient_id\n    where coalesce(collection_date,result_date) <= denominator.performance_period_end\n   \n        and regexp_like(result, '^[+-]?([0-9]*[.])?[0-9]+$')\n    \n\n)\n\n, recent_readings as (\n\n    select\n          patient_id\n        , evidence_date\n        , evidence_value\n    from qualifying_labs\n    where rn = 1\n\n)\n\n, qualifying_patients as (\n\n    select\n          denominator.*\n        , recent_readings.evidence_date\n        , recent_readings.evidence_value\n    from denominator\n    left join recent_readings\n        on denominator.patient_id = recent_readings.patient_id\n\n)\n\n, test_not_performed as (\n\n    select\n          patient_id\n        , performance_period_begin\n        , performance_period_end\n        , measure_id\n        , measure_name\n        , measure_version\n        , evidence_date\n        , evidence_value\n        , 1 as numerator_flag\n    from qualifying_patients\n    where\n        (evidence_date not between performance_period_begin and performance_period_end)\n        or evidence_date is null\n\n)\n\n, valid_patients as (\n\n    select\n          patient_id\n        , performance_period_begin\n        , performance_period_end\n        , measure_id\n        , measure_name\n        , measure_version\n        , evidence_date\n        , evidence_value\n        , case\n            when cast(evidence_value as numeric(28,6)) > 9.0 then 1\n            else 0\n          end as numerator_flag\n    from qualifying_patients\n    where evidence_date between performance_period_begin and performance_period_end\n\n)\n\n, numerator as (\n\n    select * from valid_patients\n\n    union all\n\n    select * from test_not_performed\n\n)\n\n, add_data_types as (\n\n     select distinct\n          cast(patient_id as TEXT) as patient_id\n        , cast(performance_period_begin as date) as performance_period_begin\n        , cast(performance_period_end as date) as performance_period_end\n        , cast(measure_id as TEXT) as measure_id\n        , cast(measure_name as TEXT) as measure_name\n        , cast(measure_version as TEXT) as measure_version\n        , cast(evidence_date as date) as evidence_date\n        , cast(evidence_value as TEXT) as evidence_value\n        , cast(numerator_flag as integer) as numerator_flag\n    from numerator\n\n)\n\nselect\n      patient_id\n    , performance_period_begin\n    , performance_period_end\n    , measure_id\n    , measure_name\n    , measure_version\n    , evidence_date\n    , evidence_value\n    , numerator_flag\nfrom add_data_types", "relation_name": "dev_tom.quality_measures._int_nqf0059_numerator"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.155691Z", "completed_at": "2024-08-23T19:21:36.159146Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.159457Z", "completed_at": "2024-08-23T19:21:36.159460Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.004266023635864258, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_nqf0097_exclusions", "compiled": true, "compiled_code": "with valid_hospice_exclusions as (\n\n  select\n      patient_id\n    , exclusion_date\n    , exclusion_reason\n    , exclusion_type\n  from dev_tom.quality_measures._int_shared_exclusions_hospice_palliative\n  where exclusion_date between (\n  select \n    performance_period_begin\n  from dev_tom.quality_measures._int_nqf0097__performance_period\n\n) and (\n  select \n    performance_period_end\n  from dev_tom.quality_measures._int_nqf0097__performance_period\n\n)\n    and lower(exclusion_reason) in (\n            'hospice encounter'\n    )\n\n)\n\n, combined_exclusions as (\n\n  select \n      valid_hospice_exclusions.patient_id\n    , valid_hospice_exclusions.exclusion_date\n    , valid_hospice_exclusions.exclusion_reason\n    , valid_hospice_exclusions.exclusion_type\n  from valid_hospice_exclusions\n  inner join dev_tom.quality_measures._int_nqf0097_denominator as denominator\n      on valid_hospice_exclusions.patient_id = denominator.patient_id\n\n)\n\n, add_data_types as (\n\n    select\n        distinct\n          cast(patient_id as TEXT) as patient_id\n        , cast(exclusion_date as date) as exclusion_date\n        , cast(exclusion_reason as TEXT) as exclusion_reason\n        , 1 as exclusion_flag\n    from combined_exclusions\n\n)\n\nselect\n      patient_id\n    , exclusion_date\n    , exclusion_reason\n    , exclusion_flag\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.quality_measures._int_nqf0097_exclusions"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.159711Z", "completed_at": "2024-08-23T19:21:36.178661Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.194242Z", "completed_at": "2024-08-23T19:21:36.194246Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.03530716896057129, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_nqf0097_numerator", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__quality_measures__stg_core__procedure as (\n\nselect\n      patient_id\n    , encounter_id\n    , procedure_date\n    , source_code_type\n    , source_code\n    , normalized_code_type\n    , normalized_code\n    , modifier_1\n    , modifier_2\n    , modifier_3\n    , modifier_4\n    , modifier_5\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.procedure\n), denominator as (\n\n    select\n          patient_id\n        , performance_period_begin\n        , performance_period_end\n        , measure_id\n        , measure_name\n        , measure_version\n        , discharge_date\n    from dev_tom.quality_measures._int_nqf0097_denominator\n\n)\n\n, reconciliation_codes as (\n\n    select\n          concept_name\n        , code\n        , code_system\n    from dev_tom.quality_measures._value_set_codes\n    where lower(concept_name) in (\n        'medication reconciliation post discharge'\n    )\n\n)\n\n, procedures as (\n\n    select\n          patient_id\n        , procedure_date\n        , coalesce (\n              normalized_code_type\n            , case\n                when lower(source_code_type) = 'cpt' then 'hcpcs'\n                when lower(source_code_type) = 'snomed' then 'snomed-ct'\n                else lower(source_code_type)\n              end\n          ) as code_type\n        , coalesce(\n              normalized_code\n            , source_code\n          ) as code\n    from __dbt__cte__quality_measures__stg_core__procedure\n\n)\n\n, reconciliation_procedures as (\n\n    select\n          procedures.patient_id\n        , procedures.procedure_date\n    from procedures\n    inner join reconciliation_codes\n        on procedures.code = reconciliation_codes.code\n            and procedures.code_type = reconciliation_codes.code_system\n\n)\n\n, qualifying_patients_with_denominator as (\n\n    select\n        denominator.patient_id\n        , denominator.performance_period_begin\n        , denominator.performance_period_end\n        , denominator.measure_id\n        , denominator.measure_name\n        , denominator.measure_version\n        , reconciliation_procedures.procedure_date as evidence_date\n        , 1 as numerator_flag\n    from denominator\n    inner join reconciliation_procedures\n        on denominator.patient_id = reconciliation_procedures.patient_id\n    where datediff(\n        day,\n        denominator.discharge_date,\n        reconciliation_procedures.procedure_date\n        ) between 0 and 30\n\n)\n\n, add_data_types as (\n\n     select distinct\n          cast(patient_id as TEXT) as patient_id\n        , cast(performance_period_begin as date) as performance_period_begin\n        , cast(performance_period_end as date) as performance_period_end\n        , cast(measure_id as TEXT) as measure_id\n        , cast(measure_name as TEXT) as measure_name\n        , cast(measure_version as TEXT) as measure_version\n        , cast(evidence_date as date) as evidence_date\n        , cast(null as TEXT) as evidence_value\n        , cast(numerator_flag as integer) as numerator_flag\n    from qualifying_patients_with_denominator\n\n)\n\nselect\n      patient_id\n    , performance_period_begin\n    , performance_period_end\n    , measure_id\n    , measure_name\n    , measure_version\n    , evidence_date\n    , evidence_value\n    , numerator_flag\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.quality_measures._int_nqf0097_numerator"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.172981Z", "completed_at": "2024-08-23T19:21:36.196151Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.214384Z", "completed_at": "2024-08-23T19:21:36.214389Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.041784048080444336, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_nqf2372_exclude_mastectomy", "compiled": true, "compiled_code": "\n\n/*\n    Women who had a bilateral mastectomy or who have a history of a bilateral\n    mastectomy or for whom there is evidence of a right and a left\n    unilateral mastectomy\n*/\n\nwith  __dbt__cte__quality_measures__stg_core__condition as (\n\nselect\n      patient_id\n    , claim_id\n    , encounter_id\n    , recorded_date\n    , source_code_type\n    , source_code\n    , normalized_code_type\n    , normalized_code\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.condition\n),  __dbt__cte__quality_measures__stg_core__observation as (\n\n\nselect\n      patient_id\n    , encounter_id\n    , observation_date\n    , result\n    , source_code_type\n    , source_code\n    , normalized_code_type\n    , normalized_code\n    , normalized_description\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.observation\n\n\n),  __dbt__cte__quality_measures__stg_core__procedure as (\n\nselect\n      patient_id\n    , encounter_id\n    , procedure_date\n    , source_code_type\n    , source_code\n    , normalized_code_type\n    , normalized_code\n    , modifier_1\n    , modifier_2\n    , modifier_3\n    , modifier_4\n    , modifier_5\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.procedure\n), denominator as (\n\n    select\n          patient_id\n        , performance_period_begin\n        , performance_period_end\n    from dev_tom.quality_measures._int_nqf2372_denominator\n\n)\n\n, exclusion_codes as (\n\n    select\n          code\n        , code_system\n        , concept_name\n    from dev_tom.quality_measures._value_set_codes\n    where concept_name in (\n          'Bilateral Mastectomy'\n        , 'History of bilateral mastectomy'\n        , 'Status Post Left Mastectomy'\n        , 'Status Post Right Mastectomy'\n        , 'Unilateral Mastectomy Left'\n        , 'Unilateral Mastectomy Right'\n        , 'Unilateral Mastectomy, Unspecified Laterality'\n    )\n\n)\n\n, conditions as (\n\n    select\n          patient_id\n        , recorded_date\n        , coalesce (\n              normalized_code_type\n            , case\n                when lower(source_code_type) = 'snomed' then 'snomed-ct'\n                else lower(source_code_type)\n              end\n          ) as code_type\n        , coalesce(\n              normalized_code\n            , source_code\n          ) as code\n    from __dbt__cte__quality_measures__stg_core__condition\n\n)\n\n, observations as (\n\n    select\n          patient_id\n        , observation_date\n        , coalesce (\n              normalized_code_type\n            , case\n                when lower(source_code_type) = 'cpt' then 'hcpcs'\n                when lower(source_code_type) = 'snomed' then 'snomed-ct'\n                else lower(source_code_type)\n              end\n          ) as code_type\n        , coalesce(\n              normalized_code\n            , source_code\n          ) as code\n    from __dbt__cte__quality_measures__stg_core__observation\n\n)\n\n, procedures as (\n\n    select\n          patient_id\n        , procedure_date\n        , coalesce (\n              normalized_code_type\n            , case\n                when lower(source_code_type) = 'cpt' then 'hcpcs'\n                when lower(source_code_type) = 'snomed' then 'snomed-ct'\n                else lower(source_code_type)\n              end\n          ) as code_type\n        , coalesce(\n              normalized_code\n            , source_code\n          ) as code\n    from __dbt__cte__quality_measures__stg_core__procedure\n\n)\n\n, condition_exclusions as (\n\n    select\n          conditions.patient_id\n        , conditions.recorded_date\n        , exclusion_codes.concept_name\n    from conditions\n         inner join exclusion_codes\n             on conditions.code = exclusion_codes.code\n             and conditions.code_type = exclusion_codes.code_system\n\n)\n\n, observation_exclusions as (\n\n    select\n          observations.patient_id\n        , observations.observation_date\n        , exclusion_codes.concept_name\n    from observations\n         inner join exclusion_codes\n             on observations.code = exclusion_codes.code\n             and observations.code_type = exclusion_codes.code_system\n\n)\n\n, procedure_exclusions as (\n\n    select\n          procedures.patient_id\n        , procedures.procedure_date\n        , exclusion_codes.concept_name\n    from procedures\n         inner join exclusion_codes\n             on procedures.code = exclusion_codes.code\n             and procedures.code_type = exclusion_codes.code_system\n\n)\n\n, all_mastectomy as (\n\n    select\n          denominator.patient_id\n        , condition_exclusions.recorded_date as exclusion_date\n        , condition_exclusions.concept_name as exclusion_reason\n    from denominator\n         inner join condition_exclusions\n            on denominator.patient_id = condition_exclusions.patient_id\n\n    union all\n\n    select\n          denominator.patient_id\n        , observation_exclusions.observation_date as exclusion_date\n        , observation_exclusions.concept_name as exclusion_reason\n    from denominator\n         inner join observation_exclusions\n            on denominator.patient_id = observation_exclusions.patient_id\n\n    union all\n\n    select\n          denominator.patient_id\n        , procedure_exclusions.procedure_date as exclusion_date\n        , procedure_exclusions.concept_name as exclusion_reason\n    from denominator\n         inner join procedure_exclusions\n            on denominator.patient_id = procedure_exclusions.patient_id\n\n)\n\n/*\n    Women who had a bilateral mastectomy or who have a history of a bilateral\n    mastectomy\n*/\n, bilateral_mastectomy as (\n\n    select\n          patient_id\n        , exclusion_date\n        , exclusion_reason\n    from all_mastectomy\n    where exclusion_reason in (\n          'Bilateral Mastectomy'\n        , 'History of bilateral mastectomy'\n    )\n\n)\n\n, right_mastectomy as (\n\n    select\n          patient_id\n        , exclusion_date\n        , exclusion_reason\n    from all_mastectomy\n    where exclusion_reason in (\n          'Status Post Right Mastectomy'\n        , 'Unilateral Mastectomy Right'\n    )\n\n)\n\n, left_mastectomy as (\n\n    select\n          patient_id\n        , exclusion_date\n        , exclusion_reason\n    from all_mastectomy\n    where exclusion_reason in (\n          'Status Post Left Mastectomy'\n        , 'Unilateral Mastectomy Left'\n    )\n\n)\n\n, unspecified_mastectomy as (\n\n    select\n          patient_id\n        , exclusion_date\n        , exclusion_reason\n    from all_mastectomy\n    where exclusion_reason in (\n        'Unilateral Mastectomy, Unspecified Laterality'\n    )\n\n)\n\n/*\n    Women for whom there is evidence of a right AND a left unilateral mastectomy\n    or unspecific mastectomies on different dates\n*/\n, unilateral_mastectomy as (\n\n    select\n          right_mastectomy.patient_id\n        , right_mastectomy.exclusion_date\n        , right_mastectomy.exclusion_reason\n    from right_mastectomy\n         inner join left_mastectomy\n            on right_mastectomy.patient_id = left_mastectomy.patient_id\n\n    union all\n\n    select\n          unspecified_mastectomy.patient_id\n        , unspecified_mastectomy.exclusion_date\n        , unspecified_mastectomy.exclusion_reason\n    from unspecified_mastectomy\n         inner join unspecified_mastectomy as self_join\n            on unspecified_mastectomy.patient_id = self_join.patient_id\n            and unspecified_mastectomy.exclusion_date <> self_join.exclusion_date\n\n)\n\n, unioned as (\n\n    select * from bilateral_mastectomy\n    union all\n    select * from unilateral_mastectomy\n)\n\nselect\n      patient_id\n    , exclusion_date\n    , exclusion_reason\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom unioned", "relation_name": "dev_tom.quality_measures._int_nqf2372_exclude_mastectomy"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.196298Z", "completed_at": "2024-08-23T19:21:36.218524Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.220611Z", "completed_at": "2024-08-23T19:21:36.220614Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.024899005889892578, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_nqf2372_numerator", "compiled": true, "compiled_code": "\n\n/*\n    Eligible population from the denominator model before exclusions\n*/\nwith  __dbt__cte__quality_measures__stg_medical_claim as (\n\n\nselect\n      patient_id\n    , claim_id\n    , claim_start_date\n    , claim_end_date\n    , place_of_service_code\n    , hcpcs_code\n    , hcpcs_modifier_1\n    , hcpcs_modifier_2\n    , hcpcs_modifier_3\n    , hcpcs_modifier_4\n    , hcpcs_modifier_5\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.medical_claim\n\n\n),  __dbt__cte__quality_measures__stg_core__observation as (\n\n\nselect\n      patient_id\n    , encounter_id\n    , observation_date\n    , result\n    , source_code_type\n    , source_code\n    , normalized_code_type\n    , normalized_code\n    , normalized_description\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.observation\n\n\n),  __dbt__cte__quality_measures__stg_core__procedure as (\n\nselect\n      patient_id\n    , encounter_id\n    , procedure_date\n    , source_code_type\n    , source_code\n    , normalized_code_type\n    , normalized_code\n    , modifier_1\n    , modifier_2\n    , modifier_3\n    , modifier_4\n    , modifier_5\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.procedure\n), denominator as (\n\n    select\n          patient_id\n        , performance_period_begin\n        , performance_period_end\n        , performance_period_lookback\n        , measure_id\n        , measure_name\n        , measure_version\n    from dev_tom.quality_measures._int_nqf2372_denominator\n\n)\n\n, mammography_codes as (\n\n    select\n          code\n        , code_system\n    from dev_tom.quality_measures._value_set_codes\n    where concept_name = 'Mammography'\n\n)\n\n, medical_claim as (\n\n    select\n          patient_id\n        , claim_start_date\n        , claim_end_date\n        , hcpcs_code\n    from __dbt__cte__quality_measures__stg_medical_claim\n\n)\n\n, observations as (\n\n    select\n          patient_id\n        , observation_date\n        , coalesce (\n              normalized_code_type\n            , case\n                when lower(source_code_type) = 'cpt' then 'hcpcs'\n                when lower(source_code_type) = 'snomed' then 'snomed-ct'\n                else lower(source_code_type)\n              end\n          ) as code_type\n        , coalesce (\n              normalized_code\n            , source_code\n          ) as code\n    from __dbt__cte__quality_measures__stg_core__observation\n\n)\n\n, procedures as (\n\n    select\n          patient_id\n        , procedure_date\n        , coalesce(\n              normalized_code_type\n            , case\n                when lower(source_code_type) = 'cpt' then 'hcpcs'\n                when lower(source_code_type) = 'snomed' then 'snomed-ct'\n                else lower(source_code_type)\n              end\n          ) as code_type\n        , coalesce(\n              normalized_code\n            , source_code\n          ) as code\n    from __dbt__cte__quality_measures__stg_core__procedure\n\n)\n\n, qualifying_claims as (\n\n    select\n          medical_claim.patient_id\n        , medical_claim.claim_start_date\n        , medical_claim.claim_end_date\n    from medical_claim\n         inner join mammography_codes\n            on medical_claim.hcpcs_code = mammography_codes.code\n    where mammography_codes.code_system = 'hcpcs'\n\n)\n\n, qualifying_observations as (\n\n    select\n          observations.patient_id\n        , observations.observation_date\n    from observations\n         inner join mammography_codes\n             on observations.code = mammography_codes.code\n             and observations.code_type = mammography_codes.code_system\n)\n\n, qualifying_procedures as (\n\n    select\n          procedures.patient_id\n        , procedures.procedure_date\n    from procedures\n         inner join mammography_codes\n             on procedures.code = mammography_codes.code\n             and procedures.code_type = mammography_codes.code_system\n\n)\n\n/*\n    Check if patients in the eligible population have had a screening,\n    diagnostic, film, digital or digital breast tomosynthesis (3D)\n    mammography results documented and reviewed.\n*/\n\n, patients_with_mammograms as (\n\n    select\n          denominator.patient_id\n        , denominator.performance_period_begin\n        , denominator.performance_period_end\n        , denominator.performance_period_lookback\n        , denominator.measure_id\n        , denominator.measure_name\n        , denominator.measure_version\n        , case\n            when qualifying_claims.claim_start_date\n                between denominator.performance_period_lookback\n                and denominator.performance_period_end\n                then qualifying_claims.claim_start_date\n            when qualifying_claims.claim_end_date\n                between denominator.performance_period_lookback\n                and denominator.performance_period_end\n                then qualifying_claims.claim_end_date\n            when qualifying_observations.observation_date\n                between denominator.performance_period_lookback\n                and denominator.performance_period_end\n                then qualifying_observations.observation_date\n            when qualifying_procedures.procedure_date\n                between denominator.performance_period_lookback\n                and denominator.performance_period_end\n                then qualifying_procedures.procedure_date\n            else null\n          end as evidence_date\n        , case\n            when qualifying_claims.claim_start_date\n                between denominator.performance_period_lookback\n                and denominator.performance_period_end\n                then 1\n            when qualifying_claims.claim_end_date\n                between denominator.performance_period_lookback\n                and denominator.performance_period_end\n                then 1\n            when qualifying_observations.observation_date\n                between denominator.performance_period_lookback\n                and denominator.performance_period_end\n                then 1\n            when qualifying_procedures.procedure_date\n                between denominator.performance_period_lookback\n                and denominator.performance_period_end\n                then 1\n            else 0\n          end as numerator_flag\n    from denominator\n         left join qualifying_claims\n            on denominator.patient_id = qualifying_claims.patient_id\n        left join qualifying_observations\n            on denominator.patient_id = qualifying_observations.patient_id\n        left join qualifying_procedures\n            on denominator.patient_id = qualifying_procedures.patient_id\n\n)\n\n, add_data_types as (\n\n     select distinct\n          cast(patient_id as TEXT) as patient_id\n        , cast(performance_period_begin as date) as performance_period_begin\n        , cast(performance_period_end as date) as performance_period_end\n        , cast(measure_id as TEXT) as measure_id\n        , cast(measure_name as TEXT) as measure_name\n        , cast(measure_version as TEXT) as measure_version\n        , cast(evidence_date as date) as evidence_date\n        , cast(numerator_flag as integer) as numerator_flag\n    from patients_with_mammograms\n\n)\n\nselect\n      patient_id\n    , performance_period_begin\n    , performance_period_end\n    , measure_id\n    , measure_name\n    , measure_version\n    , evidence_date\n    , numerator_flag\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.quality_measures._int_nqf2372_numerator"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.218662Z", "completed_at": "2024-08-23T19:21:36.221430Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.223672Z", "completed_at": "2024-08-23T19:21:36.223675Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0055370330810546875, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.readmissions__encounter_overlap", "compiled": true, "compiled_code": "\n\n-- Here we give a list of all pairs of encounters\n-- that have some date overlap.\n\n\nwith encounters_with_row_num as (\nselect\n    encounter_id,\n    patient_id,\n    admit_date,\n    discharge_date,\n    row_number() over (\n        partition by patient_id order by encounter_id\n\t) as row_num\nfrom dev_tom.readmissions._int_encounter\n),\n\n\ncartesian as (\nselect\n    aa.encounter_id as encounter_id_A,\n    bb.encounter_id as encounter_id_B,\n    aa.patient_id,\n    aa.admit_date as Ai,\n    aa.discharge_date as Af,\n    bb.admit_date as Bi,\n    bb.discharge_date as Bf,\n    case\n        when (aa.admit_date between bb.admit_date and bb.discharge_date) or (aa.discharge_date between bb.admit_date and bb.discharge_date) or\n             (bb.admit_date between aa.admit_date and aa.discharge_date) or (bb.discharge_date between aa.admit_date and aa.discharge_date)\n        then 1\n        else 0\n    end as overlap\n    from encounters_with_row_num aa\n    left join encounters_with_row_num bb\n    on aa.patient_id = bb.patient_id and aa.row_num < bb.row_num\n),\n\n\noverlapping_pairs\nas\n(\n    select\n        patient_id,\n        encounter_id_A,\n\tencounter_id_B\n    from cartesian\n    where overlap = 1\n)\n\n\n\nselect *, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom overlapping_pairs", "relation_name": "dev_tom.readmissions._int_encounter_overlap"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.221584Z", "completed_at": "2024-08-23T19:21:36.224490Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.226549Z", "completed_at": "2024-08-23T19:21:36.226552Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.005475044250488281, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.readmissions__encounter_with_ccs", "compiled": true, "compiled_code": "\n\n-- Here we add a CCS diagnosis category to\n-- every encounter that we can add a CCS diagnosis category to.\n-- The CCS diagnosis category is found using\n-- the encounter's primary diagnosis code.\n\n\nselect\n    aa.encounter_id,\n    aa.patient_id,\n    aa.admit_date,\n    aa.discharge_date,\n    aa.discharge_disposition_code,\n    aa.facility_id,\n    aa.ms_drg_code,\n    aa.paid_amount,\n    aa.primary_diagnosis_code,\n\n    case\n      when bb.icd_10_cm is not null then 1\n      else 0\n    end as valid_primary_diagnosis_code_flag,\n\n    cc.ccs_diagnosis_category,\n\n    '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\n\nfrom\n    dev_tom.readmissions._int_encounter aa\n    left join dev_tom.terminology.icd_10_cm bb\n    on aa.primary_diagnosis_code = bb.icd_10_cm\n    left join dev_tom.readmissions._value_set_icd_10_cm_to_ccs cc\n    on aa.primary_diagnosis_code = cc.icd_10_cm", "relation_name": "dev_tom.readmissions._int_encounter_with_ccs"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.224641Z", "completed_at": "2024-08-23T19:21:36.227235Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.227554Z", "completed_at": "2024-08-23T19:21:36.227557Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0034339427947998047, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.readmissions__index_discharge_requirement", "compiled": true, "compiled_code": "\n\n-- Here we list encounter_ids that meet\n-- the discharge_disposition_code requirements to be an\n-- index admission:\n--    *** Must NOT be discharged to another acute care hospital\n--    *** Must NOT have left against medical advice\n--    *** Patient must be alive at discharge\n\n\n\nwith all_invalid_discharges as (\nselect encounter_id\nfrom dev_tom.readmissions._int_encounter\nwhere discharge_disposition_code in (\n     '02' -- Patient discharged/transferred to other short term general hospital for inpatient care.\n    ,'07' -- Patient left against medical advice\n    ,'20' -- Patient died\n    )\n)\n\n-- All discharges that meet the discharge_disposition_code\n-- requirements to be an index admission\nselect a.encounter_id, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.readmissions._int_encounter a\nleft join all_invalid_discharges b\n    on a.encounter_id = b.encounter_id\nwhere b.encounter_id is null", "relation_name": "dev_tom.readmissions._int_index_discharge_requirement"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.227831Z", "completed_at": "2024-08-23T19:21:36.234541Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.234739Z", "completed_at": "2024-08-23T19:21:36.234742Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.007709980010986328, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.readmissions__index_time_requirement", "compiled": true, "compiled_code": "\n\n-- Here we list encounter_ids that meet\n-- the time requirement to be an index admission:\n-- The discharge date must be at least 30 days\n-- earlier than the last discharge date available\n-- in the dataset.\n\n\nwith cte as (\n  select max(discharge_date) max_discharge\n  from dev_tom.readmissions._int_encounter\n)\n\nselect encounter_id\n, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.readmissions._int_encounter\ncross join cte\nwhere discharge_date <= \n\n    dateadd(\n        day,\n        -30,\n        cte.max_discharge\n        )\n\n", "relation_name": "dev_tom.readmissions._int_index_time_requirement"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.230498Z", "completed_at": "2024-08-23T19:21:36.235343Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.235649Z", "completed_at": "2024-08-23T19:21:36.235652Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.005518198013305664, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.cms_hcc__patient_risk_factors", "compiled": true, "compiled_code": "\nwith demographic_factors as (\n\n    select\n          patient_id\n        /* concatenate demographic risk factors */\n\n    , gender || ', ' || age_group || ' Years' || ', ' || enrollment_status || ' Enrollee' || ', ' || CASE   WHEN medicaid_status = 'Yes' THEN 'Medicaid'   ELSE 'Non-Medicaid' END || ', ' || dual_status || ' Dual' || ', ' || orec || ', ' || CASE   WHEN institutional_status = 'Yes' THEN 'Institutional'   ELSE 'Non-Institutional' END as description\n\n        , coefficient\n        , factor_type\n        , model_version\n        , payment_year\n    from dev_tom.cms_hcc._int_demographic_factors\n\n)\n\n, demographic_defaults as (\n\n    select\n          patient_id\n        , model_version\n        , enrollment_status_default\n        , medicaid_dual_status_default\n        , orec_default\n        , institutional_status_default\n    from dev_tom.cms_hcc._int_demographic_factors\n\n)\n\n, disease_factors as (\n\n    select\n          patient_id\n        , hcc_description || ' (HCC ' || hcc_code || ')' as description\n        , coefficient\n        , factor_type\n        , model_version\n        , payment_year\n    from dev_tom.cms_hcc._int_disease_factors\n\n)\n\n, enrollment_interactions as (\n\n    select\n          patient_id\n        , description\n        , coefficient\n        , factor_type\n        , model_version\n        , payment_year\n    from dev_tom.cms_hcc._int_enrollment_interaction_factors\n\n)\n\n, disabled_interactions as (\n\n    select\n          patient_id\n        , description\n        , coefficient\n        , factor_type\n        , model_version\n        , payment_year\n    from dev_tom.cms_hcc._int_disabled_interaction_factors\n\n)\n\n, disease_interactions as (\n\n    select\n          patient_id\n        , description\n        , coefficient\n        , factor_type\n        , model_version\n        , payment_year\n    from dev_tom.cms_hcc._int_disease_interaction_factors\n\n)\n\n, hcc_counts as (\n\n    select\n          patient_id\n        , description\n        , coefficient\n        , factor_type\n        , model_version\n        , payment_year\n    from dev_tom.cms_hcc._int_hcc_count_factors\n\n)\n\n, unioned as (\n\n    select * from demographic_factors\n    union all\n    select * from disease_factors\n    union all\n    select * from enrollment_interactions\n    union all\n    select * from disabled_interactions\n    union all\n    select * from disease_interactions\n    union all\n    select * from hcc_counts\n\n)\n\n, add_defaults as (\n\n    select\n          unioned.patient_id\n        , demographic_defaults.enrollment_status_default\n        , demographic_defaults.medicaid_dual_status_default\n        , demographic_defaults.orec_default\n        , demographic_defaults.institutional_status_default\n        , unioned.description as risk_factor_description\n        , unioned.coefficient\n        , unioned.factor_type\n        , unioned.model_version\n        , unioned.payment_year\n    from unioned\n        left join demographic_defaults\n            on unioned.patient_id = demographic_defaults.patient_id\n            and unioned.model_version = demographic_defaults.model_version\n\n)\n\n, add_data_types as (\n\n    select\n          cast(patient_id as TEXT) as patient_id\n        \n            , cast(enrollment_status_default as boolean) as enrollment_status_default\n            , cast(medicaid_dual_status_default as boolean) as medicaid_dual_status_default\n            , cast(orec_default as boolean) as orec_default\n            , cast(institutional_status_default as boolean) as institutional_status_default\n        \n        , cast(factor_type as TEXT) as factor_type\n        , cast(risk_factor_description as TEXT) as risk_factor_description\n        , round(cast(coefficient as numeric(28,6)),3) as coefficient\n        , cast(model_version as TEXT) as model_version\n        , cast(payment_year as integer) as payment_year\n    from add_defaults\n\n)\n\nselect\n      patient_id\n    , enrollment_status_default\n    , medicaid_dual_status_default\n    , orec_default\n    , institutional_status_default\n    , factor_type\n    , risk_factor_description\n    , coefficient\n    , model_version\n    , payment_year\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.cms_hcc.patient_risk_factors"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.235892Z", "completed_at": "2024-08-23T19:21:36.242998Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.243204Z", "completed_at": "2024-08-23T19:21:36.243206Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.008054971694946289, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.hcc_suspecting__list", "compiled": true, "compiled_code": "\n\nwith hcc_history_suspects as (\n\n    select distinct\n          patient_id\n        , data_source\n        , hcc_code\n        , hcc_description\n        , reason\n        , contributing_factor\n        , suspect_date\n    from dev_tom.hcc_suspecting._int_patient_hcc_history\n    \n        where (current_year_billed = false\n            or current_year_billed is null)\n    \n\n)\n\n, comorbidity_suspects as (\n\n    select distinct\n          patient_id\n        , data_source\n        , hcc_code\n        , hcc_description\n        , reason\n        , contributing_factor\n        , suspect_date\n    from dev_tom.hcc_suspecting._int_comorbidity_suspects\n    \n        where (current_year_billed = false\n            or current_year_billed is null)\n    \n\n)\n\n, observation_suspects as (\n\n    select distinct\n          patient_id\n        , data_source\n        , hcc_code\n        , hcc_description\n        , reason\n        , contributing_factor\n        , suspect_date\n    from dev_tom.hcc_suspecting._int_observation_suspects\n    \n        where (current_year_billed = false\n            or current_year_billed is null)\n    \n\n)\n\n, lab_suspects as (\n\n    select distinct\n          patient_id\n        , data_source\n        , hcc_code\n        , hcc_description\n        , reason\n        , contributing_factor\n        , suspect_date\n    from dev_tom.hcc_suspecting._int_lab_suspects\n    \n        where (current_year_billed = false\n            or current_year_billed is null)\n    \n\n)\n\n, medication_suspects as (\n\n    select distinct\n          patient_id\n        , data_source\n        , hcc_code\n        , hcc_description\n        , reason\n        , contributing_factor\n        , suspect_date\n    from dev_tom.hcc_suspecting._int_medication_suspects\n    \n        where (current_year_billed = false\n            or current_year_billed is null)\n    \n\n)\n\n, unioned as (\n\n    select * from hcc_history_suspects\n    union all\n    select * from comorbidity_suspects\n    union all\n    select * from observation_suspects\n    union all\n    select * from lab_suspects\n    union all\n    select * from medication_suspects\n\n)\n\n, add_data_types as (\n\n    select\n          cast(patient_id as TEXT) as patient_id\n        , cast(data_source as TEXT) as data_source\n        , cast(hcc_code as TEXT) as hcc_code\n        , cast(hcc_description as TEXT) as hcc_description\n        , cast(reason as TEXT) as reason\n        , cast(contributing_factor as TEXT) as contributing_factor\n        , cast(suspect_date as date) as suspect_date\n    from unioned\n\n)\n\nselect\n      patient_id\n    , data_source\n    , hcc_code\n    , hcc_description\n    , reason\n    , contributing_factor\n    , suspect_date\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.hcc_suspecting.list"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.240398Z", "completed_at": "2024-08-23T19:21:36.243690Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.244049Z", "completed_at": "2024-08-23T19:21:36.244052Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.004029273986816406, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.ahrq_measures__int_pqi_01_exclusions", "compiled": true, "compiled_code": "\n\nselect\n    encounter_id\n  , data_source\n  , exclusion_reason\n  , row_number() over (\n      partition by encounter_id, data_source \n      order by exclusion_reason\n    ) as exclusion_number\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ahrq_measures._int_pqi_shared_exclusion_union", "relation_name": "dev_tom.ahrq_measures._int_pqi_01_exclusions"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.244692Z", "completed_at": "2024-08-23T19:21:36.251770Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.251955Z", "completed_at": "2024-08-23T19:21:36.251958Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.008141040802001953, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.ahrq_measures__int_pqi_03_exclusions", "compiled": true, "compiled_code": "\n\nselect\n    encounter_id\n  , data_source\n  , exclusion_reason\n  , row_number() over (\n      partition by encounter_id, data_source \n      order by exclusion_reason\n    ) as exclusion_number\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ahrq_measures._int_pqi_shared_exclusion_union", "relation_name": "dev_tom.ahrq_measures._int_pqi_03_exclusions"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.246966Z", "completed_at": "2024-08-23T19:21:36.252208Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.252577Z", "completed_at": "2024-08-23T19:21:36.252579Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.006024837493896484, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.ahrq_measures__int_pqi_05_exclusions", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__ahrq_measures__stg_pqi_condition as (\n\n\nselect \n    normalized_code_type\n  , normalized_code\n  , encounter_id\n  , data_source\nfrom \n    dev_tom.core.condition\n), resp_an as (\n    select distinct\n        encounter_id\n      , data_source\n      , 'cystic fibrosis' as exclusion_reason\n    from __dbt__cte__ahrq_measures__stg_pqi_condition as c\n    inner join dev_tom.ahrq_measures._value_set_pqi as pqi\n      on c.normalized_code = pqi.code\n      and c.normalized_code_type = 'icd-10-cm'\n      and pqi.value_set_name = 'cystic_fibrosis_and_anomalies_of_the_respiratory_system'\n      and pqi_number = '05'\n    where c.encounter_id is not null\n),\n\nunion_cte as (\n    select\n        encounter_id\n      , data_source\n      , exclusion_reason\n    from dev_tom.ahrq_measures._int_pqi_shared_exclusion_union\n\n    union all\n\n    select\n        encounter_id\n      , data_source\n      , exclusion_reason\n    from resp_an\n)\n\nselect\n    encounter_id\n  , data_source\n  , exclusion_reason\n  , row_number() over (\n      partition by encounter_id, data_source \n      order by exclusion_reason\n    ) as exclusion_number\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom union_cte", "relation_name": "dev_tom.ahrq_measures._int_pqi_05_exclusions"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.253605Z", "completed_at": "2024-08-23T19:21:36.268117Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.268294Z", "completed_at": "2024-08-23T19:21:36.268298Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.015475988388061523, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.ahrq_measures__int_pqi_07_exclusions", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__ahrq_measures__stg_pqi_procedure as (\n\n\nselect \n    normalized_code_type\n  , normalized_code\n  , encounter_id\n  , data_source\nfrom \n    dev_tom.core.procedure\n),  __dbt__cte__ahrq_measures__stg_pqi_condition as (\n\n\nselect \n    normalized_code_type\n  , normalized_code\n  , encounter_id\n  , data_source\nfrom \n    dev_tom.core.condition\n), cardiac as (\n    select distinct\n        encounter_id\n      , data_source\n      , 'cardiac procedure' as exclusion_reason\n    from __dbt__cte__ahrq_measures__stg_pqi_procedure as c\n    inner join dev_tom.ahrq_measures._value_set_pqi as pqi \n      on c.normalized_code = pqi.code\n      and c.normalized_code_type = 'icd-10-pcs'\n      and pqi.value_set_name = 'cardiac_procedure_codes'\n      and pqi_number = 'appendix_b'\n    where c.encounter_id is not null\n),\n\nckd as (\n    select distinct\n        encounter_id\n      , data_source\n    from __dbt__cte__ahrq_measures__stg_pqi_condition as c\n    inner join dev_tom.ahrq_measures._value_set_pqi as pqi \n      on c.normalized_code = pqi.code\n      and c.normalized_code_type = 'icd-10-cm'\n      and pqi.value_set_name = 'exclusion_kidney_disease_diagnosis_codes'\n      and pqi_number = '07'\n    where c.encounter_id is not null\n),\n\naccess as (\n    select distinct\n        encounter_id\n      , data_source\n    from __dbt__cte__ahrq_measures__stg_pqi_procedure as c\n    inner join dev_tom.ahrq_measures._value_set_pqi as pqi \n      on c.normalized_code = pqi.code\n      and c.normalized_code_type = 'icd-10-pcs'\n      and pqi.value_set_name = 'exclusion_dialysis_access_procedure_codes'\n      and pqi.pqi_number = '07'\n    where c.encounter_id is not null\n),\n\ncombine as (\n    select\n        c.encounter_id\n      , c.data_source\n      , 'ckd' as exclusion_reason\n    from __dbt__cte__ahrq_measures__stg_pqi_condition as c\n    inner join ckd \n      on c.encounter_id = ckd.encounter_id\n      and c.data_source = ckd.data_source\n    inner join access as a \n      on c.encounter_id = a.encounter_id\n      and c.data_source = a.data_source\n),\n\nunion_cte as (\n    select\n        encounter_id\n      , data_source\n      , exclusion_reason\n    from dev_tom.ahrq_measures._int_pqi_shared_exclusion_union\n    \n    union all\n    \n    select\n        encounter_id\n      , data_source\n      , exclusion_reason\n    from cardiac\n    \n    union all\n    \n    select\n        encounter_id\n      , data_source\n      , exclusion_reason\n    from combine\n)\n\nselect\n    encounter_id\n  , data_source\n  , exclusion_reason\n  , row_number() over (\n      partition by encounter_id, data_source \n      order by exclusion_reason\n    ) as exclusion_number\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom union_cte", "relation_name": "dev_tom.ahrq_measures._int_pqi_07_exclusions"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.263255Z", "completed_at": "2024-08-23T19:21:36.268734Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.269126Z", "completed_at": "2024-08-23T19:21:36.269129Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.015748023986816406, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.ahrq_measures__int_pqi_08_exclusions", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__ahrq_measures__stg_pqi_procedure as (\n\n\nselect \n    normalized_code_type\n  , normalized_code\n  , encounter_id\n  , data_source\nfrom \n    dev_tom.core.procedure\n), cardiac as (\n    select distinct\n        encounter_id\n      , data_source\n      , 'cardiac procedure' as exclusion_reason\n    from __dbt__cte__ahrq_measures__stg_pqi_procedure as c\n    inner join dev_tom.ahrq_measures._value_set_pqi as pqi \n      on c.normalized_code = pqi.code\n      and c.normalized_code_type = 'icd-10-pcs'\n      and pqi.value_set_name = 'cardiac_procedure_codes'\n      and pqi.pqi_number = 'appendix_b'\n    where c.encounter_id is not null\n),\n\nunion_cte as (\n    select\n        encounter_id\n      , data_source\n      , exclusion_reason\n    from dev_tom.ahrq_measures._int_pqi_shared_exclusion_union\n\n    union all\n\n    select\n        encounter_id\n      , data_source\n      , exclusion_reason\n    from cardiac\n)\n\nselect\n    encounter_id\n  , data_source\n  , exclusion_reason\n  , row_number() over (\n      partition by encounter_id, data_source \n      order by exclusion_reason\n    ) as exclusion_number\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom union_cte", "relation_name": "dev_tom.ahrq_measures._int_pqi_08_exclusions"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.269759Z", "completed_at": "2024-08-23T19:21:36.287757Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.287957Z", "completed_at": "2024-08-23T19:21:36.287960Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.019077777862548828, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.ahrq_measures__int_pqi_11_exclusions", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__ahrq_measures__stg_pqi_condition as (\n\n\nselect \n    normalized_code_type\n  , normalized_code\n  , encounter_id\n  , data_source\nfrom \n    dev_tom.core.condition\n),  __dbt__cte__ahrq_measures__stg_pqi_procedure as (\n\n\nselect \n    normalized_code_type\n  , normalized_code\n  , encounter_id\n  , data_source\nfrom \n    dev_tom.core.procedure\n), sickle_cell as (\n    select distinct\n        encounter_id\n      , data_source\n      , 'sickle cell' as exclusion_reason\n    from __dbt__cte__ahrq_measures__stg_pqi_condition as c\n    inner join dev_tom.ahrq_measures._value_set_pqi as pqi \n      on c.normalized_code = pqi.code\n      and c.normalized_code_type = 'icd-10-cm'\n      and pqi.value_set_name = 'sickle_cell_anemia_or_hb-s_disease_diagnosis_codes'\n      and pqi.pqi_number = '11'\n    where c.encounter_id is not null\n),\n\nimmune_dx as (\n    select distinct\n        encounter_id\n      , data_source\n      , 'immunocompromised diagnosis' as exclusion_reason\n    from __dbt__cte__ahrq_measures__stg_pqi_condition as c\n    inner join dev_tom.ahrq_measures._value_set_pqi as pqi \n      on c.normalized_code = pqi.code\n      and c.normalized_code_type = 'icd-10-cm'\n      and pqi.value_set_name = 'immunocompromised_state_diagnosis_codes'\n      and pqi.pqi_number = 'appendix_c'\n    where c.encounter_id is not null\n),\n\nimmune_px as (\n    select distinct\n        encounter_id\n      , data_source\n      , 'immunocompromised procedure' as exclusion_reason\n    from __dbt__cte__ahrq_measures__stg_pqi_procedure as c\n    inner join dev_tom.ahrq_measures._value_set_pqi as pqi \n      on c.normalized_code = pqi.code\n      and c.normalized_code_type = 'icd-10-pcs'\n      and pqi.value_set_name = 'immunocompromised_state_procedure_codes'\n      and pqi.pqi_number = 'appendix_c'\n    where c.encounter_id is not null\n),\n\nunion_cte as (\n    select\n        encounter_id\n      , data_source\n      , exclusion_reason\n    from dev_tom.ahrq_measures._int_pqi_shared_exclusion_union\n\n    union all\n\n    select\n        encounter_id\n      , data_source\n      , exclusion_reason\n    from sickle_cell\n\n    union all\n\n    select\n        encounter_id\n      , data_source\n      , exclusion_reason\n    from immune_dx\n\n    union all\n\n    select\n        encounter_id\n      , data_source\n      , exclusion_reason\n    from immune_px\n)\n\nselect\n    encounter_id\n  , data_source\n  , exclusion_reason\n  , row_number() over (\n      partition by encounter_id, data_source \n      order by exclusion_reason\n    ) as exclusion_number\n, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom union_cte", "relation_name": "dev_tom.ahrq_measures._int_pqi_11_exclusions"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.278630Z", "completed_at": "2024-08-23T19:21:36.288601Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.288911Z", "completed_at": "2024-08-23T19:21:36.288914Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.010708093643188477, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.ahrq_measures__int_pqi_12_exclusions", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__ahrq_measures__stg_pqi_condition as (\n\n\nselect \n    normalized_code_type\n  , normalized_code\n  , encounter_id\n  , data_source\nfrom \n    dev_tom.core.condition\n),  __dbt__cte__ahrq_measures__stg_pqi_procedure as (\n\n\nselect \n    normalized_code_type\n  , normalized_code\n  , encounter_id\n  , data_source\nfrom \n    dev_tom.core.procedure\n), kidney as (\n    select distinct\n        encounter_id\n      , data_source\n      , 'kidney' as exclusion_reason\n    from __dbt__cte__ahrq_measures__stg_pqi_condition as c\n    inner join dev_tom.ahrq_measures._value_set_pqi as pqi \n      on c.normalized_code = pqi.code\n      and c.normalized_code_type = 'icd-10-cm'\n      and pqi.value_set_name = 'kidney_or_urinary_tract_disorder_diagnosis_codes'\n      and pqi.pqi_number = '12'\n    where c.encounter_id is not null\n),\n\nimmune_dx as (\n    select distinct\n        encounter_id\n      , data_source\n      , 'immunocompromised diagnosis' as exclusion_reason\n    from __dbt__cte__ahrq_measures__stg_pqi_condition as c\n    inner join dev_tom.ahrq_measures._value_set_pqi as pqi \n      on c.normalized_code = pqi.code\n      and c.normalized_code_type = 'icd-10-cm'\n      and pqi.value_set_name = 'immunocompromised_state_diagnosis_codes'\n      and pqi.pqi_number = 'appendix_c'\n    where c.encounter_id is not null\n),\n\nimmune_px as (\n    select distinct\n        encounter_id\n      , data_source\n      , 'immunocompromised procedure' as exclusion_reason\n    from __dbt__cte__ahrq_measures__stg_pqi_procedure as c\n    inner join dev_tom.ahrq_measures._value_set_pqi as pqi \n      on c.normalized_code = pqi.code\n      and c.normalized_code_type = 'icd-10-pcs'\n      and pqi.value_set_name = 'immunocompromised_state_procedure_codes'\n      and pqi.pqi_number = 'appendix_c'\n    where c.encounter_id is not null\n),\n\nunion_cte as (\n    select\n        encounter_id\n      , data_source\n      , exclusion_reason\n    from dev_tom.ahrq_measures._int_pqi_shared_exclusion_union\n\n    union all\n\n    select\n        encounter_id\n      , data_source\n      , exclusion_reason\n    from kidney\n\n    union all\n\n    select\n        encounter_id\n      , data_source\n      , exclusion_reason\n    from immune_dx\n\n    union all\n\n    select\n        encounter_id\n      , data_source\n      , exclusion_reason\n    from immune_px\n)\n\nselect\n    encounter_id\n  , data_source\n  , exclusion_reason\n  , row_number() over (\n      partition by encounter_id, data_source \n      order by exclusion_reason\n    ) as exclusion_number\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom union_cte", "relation_name": "dev_tom.ahrq_measures._int_pqi_12_exclusions"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.289174Z", "completed_at": "2024-08-23T19:21:36.296341Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.296540Z", "completed_at": "2024-08-23T19:21:36.296543Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.00814199447631836, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.ahrq_measures__int_pqi_14_exclusions", "compiled": true, "compiled_code": "\n\nselect\n    encounter_id\n  , data_source\n  , exclusion_reason\n  , row_number() over (\n      partition by encounter_id, data_source \n      order by exclusion_reason\n    ) as exclusion_number\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ahrq_measures._int_pqi_shared_exclusion_union", "relation_name": "dev_tom.ahrq_measures._int_pqi_14_exclusions"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.291588Z", "completed_at": "2024-08-23T19:21:36.297182Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.297511Z", "completed_at": "2024-08-23T19:21:36.297513Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.006292104721069336, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.ahrq_measures__int_pqi_15_exclusions", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__ahrq_measures__stg_pqi_condition as (\n\n\nselect \n    normalized_code_type\n  , normalized_code\n  , encounter_id\n  , data_source\nfrom \n    dev_tom.core.condition\n), resp_an as (\n    select distinct\n        encounter_id\n      , data_source\n      , 'cystic fibrosis' as exclusion_reason\n    from __dbt__cte__ahrq_measures__stg_pqi_condition as c\n    inner join dev_tom.ahrq_measures._value_set_pqi as pqi \n      on c.normalized_code = pqi.code\n      and c.normalized_code_type = 'icd-10-cm'\n      and pqi.value_set_name = 'cystic_fibrosis_and_anomalies_of_the_respiratory_system_diagnosis_codes'\n      and pqi.pqi_number = '15'\n    where c.encounter_id is not null\n),\n\nunion_cte as (\n    select\n        encounter_id\n      , data_source\n      , exclusion_reason\n    from dev_tom.ahrq_measures._int_pqi_shared_exclusion_union\n\n    union all\n\n    select\n        encounter_id\n      , data_source\n      , exclusion_reason\n    from resp_an\n)\n\nselect\n    encounter_id\n  , data_source\n  , exclusion_reason\n  , row_number() over (\n      partition by encounter_id, data_source \n      order by exclusion_reason\n    ) as exclusion_number\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom union_cte", "relation_name": "dev_tom.ahrq_measures._int_pqi_15_exclusions"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.297763Z", "completed_at": "2024-08-23T19:21:36.310907Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.312040Z", "completed_at": "2024-08-23T19:21:36.312043Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.015067100524902344, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.ahrq_measures__int_pqi_16_exclusions", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__ahrq_measures__stg_pqi_condition as (\n\n\nselect \n    normalized_code_type\n  , normalized_code\n  , encounter_id\n  , data_source\nfrom \n    dev_tom.core.condition\n), amputation as (\n    select distinct\n        encounter_id\n      , data_source\n      , 'amputation' as exclusion_reason\n    from __dbt__cte__ahrq_measures__stg_pqi_condition as c\n    inner join dev_tom.ahrq_measures._value_set_pqi as pqi \n      on c.normalized_code = pqi.code\n      and c.normalized_code_type = 'icd-10-cm'\n      and pqi.value_set_name = 'traumatic_amputation_of_the_lower_extremity_diagnosis_codes'\n      and pqi.pqi_number = '16'\n    where c.encounter_id is not null\n),\n\npregnancy as (\n    select distinct\n        encounter_id\n      , data_source\n      , 'pregnancy' as exclusion_reason\n    from __dbt__cte__ahrq_measures__stg_pqi_condition as c\n    inner join dev_tom.ahrq_measures._value_set_pqi as pqi \n      on c.normalized_code = pqi.code\n      and c.normalized_code_type = 'icd-10-cm'\n      and pqi.value_set_name = 'mdc_14_principal_diagnosis_codes'\n      and pqi.pqi_number = 'appendix_f'\n    where c.encounter_id is not null\n),\n\nunion_cte as (\n    select\n        encounter_id\n      , data_source\n      , exclusion_reason\n    from dev_tom.ahrq_measures._int_pqi_shared_exclusion_union\n\n    union all\n\n    select\n        encounter_id\n      , data_source\n      , exclusion_reason\n    from amputation\n\n    union all\n\n    select\n        encounter_id\n      , data_source\n      , exclusion_reason\n    from pregnancy\n)\n\nselect\n    encounter_id\n  , data_source\n  , exclusion_reason\n  , row_number() over (\n      partition by encounter_id, data_source \n      order by exclusion_reason\n    ) as exclusion_number\n   , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom union_cte", "relation_name": "dev_tom.ahrq_measures._int_pqi_16_exclusions"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.305053Z", "completed_at": "2024-08-23T19:21:36.312888Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.315928Z", "completed_at": "2024-08-23T19:21:36.315931Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.011243104934692383, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.ed_classification__summary", "compiled": true, "compiled_code": "\n\n\nwith __dbt__cte__ed_classification__stg_patient as (\n\n\nselect\n    patient_id\n    , sex\n    , birth_date\n    , race\n    , state\n    , zip_code\n    , latitude\n    , longitude\nfrom dev_tom.core.patient\n) select\n    class.encounter_id\n    , cat.classification_name as ed_classification_description\n    , cat.classification_order as ed_classification_order\n    , class.patient_id\n    , class.encounter_end_date\n    , date_part('year', class.encounter_end_date) || \n\n    case when 2 = 0\n        then ''\n    else\n        right(\n            '00' || date_part('month', class.encounter_end_date),\n            2\n        )\n    end as year_month\n    , class.primary_diagnosis_code\n    , class.primary_diagnosis_description\n    , class.paid_amount\n    , class.allowed_amount\n    , class.charge_amount\n    , class.facility_id\n    , fac_prov.provider_organization_name as facility_name\n    , practice_state as facility_state\n    , practice_city as facility_city\n    , practice_zip_code as facility_zip_code\n    , pat.sex as patient_sex\n    , floor(datediff(\n        hour,\n        pat.birth_date,\n        class.encounter_end_date\n        ) / 8766.0) as patient_age\n    , zip_code as patient_zip_code\n    , latitude as patient_latitude\n    , longitude as patient_longitude\n    , race as patient_race\nfrom dev_tom.ed_classification._int_filter_encounter_with_classification class\ninner join dev_tom.ed_classification._value_set_categories cat\n    on class.classification = cat.classification\nleft join dev_tom.terminology.provider fac_prov \n    on class.facility_id = fac_prov.npi\nleft join __dbt__cte__ed_classification__stg_patient pat\n    on class.patient_id = pat.patient_id", "relation_name": "dev_tom.ed_classification.summary"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.313051Z", "completed_at": "2024-08-23T19:21:36.317686Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.318032Z", "completed_at": "2024-08-23T19:21:36.318035Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.0055048465728759766, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_cbe0055_long", "compiled": true, "compiled_code": "\n\nwith denominator as (\n\n    select\n          patient_id\n        , performance_period_begin\n        , performance_period_end\n        , measure_id\n        , measure_name\n        , measure_version\n        , denominator_flag\n    from dev_tom.quality_measures._int_cbe0055_denominator\n\n)\n\n, numerator as (\n\n    select\n          patient_id\n        , evidence_date\n        , evidence_value\n    from dev_tom.quality_measures._int_cbe0055_numerator\n\n)\n\n, exclusions as (\n\n    select\n          patient_id\n        , exclusion_date\n        , exclusion_reason\n    from dev_tom.quality_measures._int_cbe0055_exclusions\n\n)\n\n, measure_flags as (\n\n    select\n          denominator.patient_id\n        , case\n            when denominator.patient_id is not null\n            then 1\n            else null\n          end as denominator_flag\n        , case\n            when numerator.patient_id is not null and denominator.patient_id is not null\n            then 1\n            when denominator.patient_id is not null\n            then 0\n            else null\n          end as numerator_flag\n        , case\n            when exclusions.patient_id is not null and denominator.patient_id is not null\n            then 1\n            when denominator.patient_id is not null\n            then 0\n            else null\n          end as exclusion_flag\n        , numerator.evidence_date\n        , numerator.evidence_value\n        , exclusions.exclusion_date\n        , exclusions.exclusion_reason\n        , denominator.performance_period_begin\n        , denominator.performance_period_end\n        , denominator.measure_id\n        , denominator.measure_name\n        , denominator.measure_version\n        , (row_number() over(\n            partition by\n                  denominator.patient_id\n                , denominator.performance_period_begin\n                , denominator.performance_period_end\n                , denominator.measure_id\n                , denominator.measure_name\n              order by\n                  case when numerator.evidence_date is null then 1 else 0 end,\n                  numerator.evidence_date desc\n                , case when exclusions.exclusion_date is null then 1 else 0 end,\n                  exclusions.exclusion_date desc\n          )) as rn\n    from denominator\n        left join numerator\n            on denominator.patient_id = numerator.patient_id\n        left join exclusions\n            on denominator.patient_id = exclusions.patient_id\n\n)\n\n/*\n    Deduplicate measure rows by latest evidence date or exclusion date\n*/\n, deduped as (\n\n    select\n          patient_id\n        , denominator_flag\n        , numerator_flag\n        , exclusion_flag\n        , evidence_date\n        , evidence_value\n        , exclusion_date\n        , exclusion_reason\n        , performance_period_begin\n        , performance_period_end\n        , measure_id\n        , measure_name\n        , measure_version\n    from measure_flags\n    where rn = 1\n\n)\n\n, add_data_types as (\n\n    select\n          cast(patient_id as TEXT) as patient_id\n        , cast(denominator_flag as integer) as denominator_flag\n        , cast(numerator_flag as integer) as numerator_flag\n        , cast(exclusion_flag as integer) as exclusion_flag\n        , cast(evidence_date as date) as evidence_date\n        , cast(evidence_value as TEXT) as evidence_value\n        , cast(exclusion_date as date) as exclusion_date\n        , cast(exclusion_reason as TEXT) as exclusion_reason\n        , cast(performance_period_begin as date) as performance_period_begin\n        , cast(performance_period_end as date) as performance_period_end\n        , cast(measure_id as TEXT) as measure_id\n        , cast(measure_name as TEXT) as measure_name\n        , cast(measure_version as TEXT) as measure_version\n    from deduped\n\n)\n\nselect\n      patient_id\n    , denominator_flag\n    , numerator_flag\n    , exclusion_flag\n    , evidence_date\n    , evidence_value\n    , exclusion_date\n    , exclusion_reason\n    , performance_period_begin\n    , performance_period_end\n    , measure_id\n    , measure_name\n    , measure_version\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.quality_measures._int_cbe0055_long"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.318285Z", "completed_at": "2024-08-23T19:21:36.325991Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.326177Z", "completed_at": "2024-08-23T19:21:36.326180Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.009751081466674805, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_cbe0101_long", "compiled": true, "compiled_code": "\n\nwith denominator as (\n\n    select\n          patient_id\n        , performance_period_begin\n        , performance_period_end\n        , measure_id\n        , measure_name\n        , measure_version\n        , denominator_flag\n    from dev_tom.quality_measures._int_cbe0101_denominator\n\n)\n\n, numerator as (\n\n    select\n          patient_id\n        , evidence_date\n        , evidence_value\n    from dev_tom.quality_measures._int_cbe0101_numerator\n\n)\n\n, exclusions as (\n\n    select\n          patient_id\n        , exclusion_date\n        , exclusion_reason\n    from dev_tom.quality_measures._int_cbe0101_exclusions\n\n)\n\n, measure_flags as (\n\n    select\n          denominator.patient_id\n        , case\n            when denominator.patient_id is not null\n            then 1\n            else null\n          end as denominator_flag\n        , case\n            when numerator.patient_id is not null and denominator.patient_id is not null\n            then 1\n            when denominator.patient_id is not null\n            then 0\n            else null\n          end as numerator_flag\n        , case\n            when exclusions.patient_id is not null and denominator.patient_id is not null\n            then 1\n            when denominator.patient_id is not null\n            then 0\n            else null\n          end as exclusion_flag\n        , numerator.evidence_date\n        , numerator.evidence_value\n        , exclusions.exclusion_date\n        , exclusions.exclusion_reason\n        , denominator.performance_period_begin\n        , denominator.performance_period_end\n        , denominator.measure_id\n        , denominator.measure_name\n        , denominator.measure_version\n        , (row_number() over(\n            partition by\n                  denominator.patient_id\n                , denominator.performance_period_begin\n                , denominator.performance_period_end\n                , denominator.measure_id\n                , denominator.measure_name\n              order by\n                  case when numerator.evidence_date is null then 1 else 0 end,\n                  numerator.evidence_date desc\n                , case when exclusions.exclusion_date is null then 1 else 0 end,\n                  exclusions.exclusion_date desc\n          )) as rn\n    from denominator\n        left join numerator\n            on denominator.patient_id = numerator.patient_id\n        left join exclusions\n            on denominator.patient_id = exclusions.patient_id\n\n)\n\n/*\n    Deduplicate measure rows by latest evidence date or exclusion date\n*/\n, deduped as (\n\n    select\n          patient_id\n        , denominator_flag\n        , numerator_flag\n        , exclusion_flag\n        , evidence_date\n        , evidence_value\n        , exclusion_date\n        , exclusion_reason\n        , performance_period_begin\n        , performance_period_end\n        , measure_id\n        , measure_name\n        , measure_version\n    from measure_flags\n    where rn = 1\n\n)\n\n, add_data_types as (\n\n    select\n          cast(patient_id as TEXT) as patient_id\n        , cast(denominator_flag as integer) as denominator_flag\n        , cast(numerator_flag as integer) as numerator_flag\n        , cast(exclusion_flag as integer) as exclusion_flag\n        , cast(evidence_date as date) as evidence_date\n        , cast(evidence_value as TEXT) as evidence_value\n        , cast(exclusion_date as date) as exclusion_date\n        , cast(exclusion_reason as TEXT) as exclusion_reason\n        , cast(performance_period_begin as date) as performance_period_begin\n        , cast(performance_period_end as date) as performance_period_end\n        , cast(measure_id as TEXT) as measure_id\n        , cast(measure_name as TEXT) as measure_name\n        , cast(measure_version as TEXT) as measure_version\n    from deduped\n\n)\n\nselect\n      patient_id\n    , denominator_flag\n    , numerator_flag\n    , exclusion_flag\n    , evidence_date\n    , evidence_value\n    , exclusion_date\n    , exclusion_reason\n    , performance_period_begin\n    , performance_period_end\n    , measure_id\n    , measure_name\n    , measure_version\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.quality_measures._int_cbe0101_long"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.321717Z", "completed_at": "2024-08-23T19:21:36.326614Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.326976Z", "completed_at": "2024-08-23T19:21:36.326978Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.00562596321105957, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_cqm236_exclusions", "compiled": true, "compiled_code": "with frailty as (\n\n  select\n      patient_id\n    , exclusion_date\n    , exclusion_reason\n  from dev_tom.quality_measures._int_shared_exclusions_frailty\n  where exclusion_date between (\n  select \n    performance_period_begin\n  from dev_tom.quality_measures._int_cqm236__performance_period\n\n) and (\n  select \n    performance_period_end\n  from dev_tom.quality_measures._int_cqm236__performance_period\n\n)\n\n)\n\n, denominator as (\n\n  select\n      patient_id\n    , age\n  from dev_tom.quality_measures._int_cqm236_denominator\n\n)\n-- advanced illness start\n, advanced_illness_exclusion as (\n\n  select\n    source.*\n  from dev_tom.quality_measures._int_shared_exclusions_advanced_illness as source\n  inner join frailty\n    on source.patient_id = frailty.patient_id\n  where source.exclusion_date\n    between\n      \n\n    dateadd(\n        year,\n        -1,\n        (\n  select \n    performance_period_begin\n  from dev_tom.quality_measures._int_cqm236__performance_period\n\n)\n        )\n\n\n      and (\n  select \n    performance_period_end\n  from dev_tom.quality_measures._int_cqm236__performance_period\n\n)\n\n)\n\n, acute_inpatient_advanced_illness as (\n\n  select\n    *\n  from advanced_illness_exclusion\n  where patient_type = 'acute_inpatient'\n\n)\n\n, nonacute_outpatient_advanced_illness as (\n\n  select\n    *\n  from advanced_illness_exclusion\n  where patient_type = 'nonacute_outpatient'\n\n)\n\n, acute_inpatient_counts as (\n\n    select\n          patient_id\n        , exclusion_type\n        , count(distinct exclusion_date) as encounter_count\n    from acute_inpatient_advanced_illness\n    group by patient_id, exclusion_type\n\n)\n\n, nonacute_outpatient_counts as (\n\n    select\n          patient_id\n        , exclusion_type\n        , count(distinct exclusion_date) as encounter_count\n    from nonacute_outpatient_advanced_illness\n    group by patient_id, exclusion_type\n\n)\n\n, valid_advanced_illness_exclusions as (\n\n    select\n          acute_inpatient_advanced_illness.patient_id\n        , acute_inpatient_advanced_illness.exclusion_date\n        , acute_inpatient_advanced_illness.exclusion_reason\n        , acute_inpatient_advanced_illness.exclusion_type\n    from acute_inpatient_advanced_illness\n    left join acute_inpatient_counts\n      on acute_inpatient_advanced_illness.patient_id = acute_inpatient_counts.patient_id\n    where acute_inpatient_counts.encounter_count >= 1\n\n    union all\n\n    select\n        nonacute_outpatient_advanced_illness.patient_id\n      , nonacute_outpatient_advanced_illness.exclusion_date\n      , nonacute_outpatient_advanced_illness.exclusion_reason\n      , nonacute_outpatient_advanced_illness.exclusion_type\n    from nonacute_outpatient_advanced_illness\n    left join nonacute_outpatient_counts\n      on nonacute_outpatient_advanced_illness.patient_id = nonacute_outpatient_counts.patient_id\n    where nonacute_outpatient_counts.encounter_count >= 2\n\n\n)\n-- advanced illness end\n\n, valid_dementia_exclusions as (\n\n  select\n      source.patient_id\n    , source.exclusion_date\n    , source.exclusion_reason\n    , source.exclusion_type\n  from dev_tom.quality_measures._int_shared_exclusions_dementia source\n  inner join frailty\n    on source.patient_id = frailty.patient_id\n  where (\n    source.dispensing_date\n      between \n\n    dateadd(\n        year,\n        -1,\n        (\n  select \n    performance_period_begin\n  from dev_tom.quality_measures._int_cqm236__performance_period\n\n)\n        )\n\n\n          and (\n  select \n    performance_period_end\n  from dev_tom.quality_measures._int_cqm236__performance_period\n\n)\n    or source.paid_date\n      between \n\n    dateadd(\n        year,\n        -1,\n        (\n  select \n    performance_period_begin\n  from dev_tom.quality_measures._int_cqm236__performance_period\n\n)\n        )\n\n\n          and (\n  select \n    performance_period_end\n  from dev_tom.quality_measures._int_cqm236__performance_period\n\n)\n    )\n\n)\n\n, valid_hospice_palliative as (\n\n  select\n      patient_id\n    , exclusion_date\n    , exclusion_reason\n    , exclusion_type\n  from dev_tom.quality_measures._int_shared_exclusions_hospice_palliative\n  where exclusion_date between (\n  select \n    performance_period_begin\n  from dev_tom.quality_measures._int_cqm236__performance_period\n\n) and (\n  select \n    performance_period_end\n  from dev_tom.quality_measures._int_cqm236__performance_period\n\n)\n\n)\n\n, valid_institutional_snp as (\n\n  select \n      patient_id\n    , exclusion_date\n    , exclusion_reason\n    , exclusion_type\n  from dev_tom.quality_measures._int_shared_exclusions_institutional_snp\n  where exclusion_date between (\n  select \n    performance_period_begin\n  from dev_tom.quality_measures._int_cqm236__performance_period\n\n) and (\n  select \n    performance_period_end\n  from dev_tom.quality_measures._int_cqm236__performance_period\n\n)\n\n)\n\n, measure_specific_procedure_observation_exclusion as (\n\n  select\n      patient_id\n    , exclusion_date\n    , exclusion_reason\n    , exclusion_type\n    , age\n  from dev_tom.quality_measures._int_cqm236_exclude_procedures_observations\n\n)\n\n, exclusions as (\n\n    select *\n    from valid_advanced_illness_exclusions\n  \n    union all\n\n    select *\n    from valid_dementia_exclusions\n\n    union all\n\n    select *\n    from valid_hospice_palliative\n\n    union all\n\n    select *\n    from valid_institutional_snp\n\n    union all\n\n    select *\n    from valid_dementia_exclusions\n\n)\n\n, combined_exclusions as (\n\n  select \n      exclusions.*\n    , denominator.age\n  from exclusions\n  inner join denominator\n      on exclusions.patient_id = denominator.patient_id\n\n)\n\n, frailty_exclusion_older_than_80 as (\n\n  select\n      frailty.patient_id\n    , frailty.exclusion_date\n    , frailty.exclusion_reason\n    , 'measure specific exclusion for patients older than 80' as exclusion_type\n    , denominator.age\n  from frailty\n  inner join denominator\n  on frailty.patient_id = denominator.patient_id\n    where denominator.age >= 81\n\n)\n\n, valid_exclusions as (\n\n  select * from combined_exclusions\n  where exclusion_type != 'hospice_palliative'\n    and age >= 66\n\n  union all\n\n  select * from combined_exclusions\n  where exclusion_type = 'hospice_palliative'\n\n  union all\n\n  select * from frailty_exclusion_older_than_80\n\n  union all\n\n  select * from measure_specific_procedure_observation_exclusion\n\n)\n\n, add_data_types as (\n\n    select\n        distinct\n          cast(patient_id as TEXT) as patient_id\n        , cast(exclusion_date as date) as exclusion_date\n        , cast(exclusion_reason as TEXT) as exclusion_reason\n        , 1 as exclusion_flag\n    from valid_exclusions\n\n)\n\nselect\n      patient_id\n    , exclusion_date\n    , exclusion_reason\n    , exclusion_flag\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.quality_measures._int_cqm236_exclusions"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.327624Z", "completed_at": "2024-08-23T19:21:36.334191Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.334509Z", "completed_at": "2024-08-23T19:21:36.334512Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.007762908935546875, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_cqm438_long", "compiled": true, "compiled_code": "\n\nwith denominator as (\n\n    select\n          patient_id\n        , performance_period_begin\n        , performance_period_end\n        , measure_id\n        , measure_name\n        , measure_version\n        , denominator_flag\n    from dev_tom.quality_measures._int_cqm438_denominator\n\n)\n\n, numerator as (\n\n    select\n          patient_id\n        , evidence_date\n        , evidence_value\n    from dev_tom.quality_measures._int_cqm438_numerator\n\n)\n\n, exclusions as (\n\n    select\n          patient_id\n        , exclusion_date\n        , exclusion_reason\n    from dev_tom.quality_measures._int_cqm438_exclusions\n\n)\n\n, measure_flags as (\n\n    select\n          denominator.patient_id\n        , case\n            when denominator.patient_id is not null\n            then 1\n            else null\n          end as denominator_flag\n        , case\n            when numerator.patient_id is not null and denominator.patient_id is not null\n            then 1\n            when denominator.patient_id is not null\n            then 0\n            else null\n          end as numerator_flag\n        , case\n            when exclusions.patient_id is not null and denominator.patient_id is not null\n            then 1\n            when denominator.patient_id is not null\n            then 0\n            else null\n          end as exclusion_flag\n        , numerator.evidence_date\n        , numerator.evidence_value\n        , exclusions.exclusion_date\n        , exclusions.exclusion_reason\n        , denominator.performance_period_begin\n        , denominator.performance_period_end\n        , denominator.measure_id\n        , denominator.measure_name\n        , denominator.measure_version\n        , (row_number() over(\n            partition by\n                  denominator.patient_id\n                , denominator.performance_period_begin\n                , denominator.performance_period_end\n                , denominator.measure_id\n                , denominator.measure_name\n              order by\n                  case when numerator.evidence_date is null then 1 else 0 end,\n                  numerator.evidence_date desc\n                , case when exclusions.exclusion_date is null then 1 else 0 end,\n                  exclusions.exclusion_date desc\n          )) as rn\n    from denominator\n        left join numerator\n            on denominator.patient_id = numerator.patient_id\n        left join exclusions\n            on denominator.patient_id = exclusions.patient_id\n\n)\n\n/*\n    Deduplicate measure rows by latest evidence date or exclusion date\n*/\n, deduped as (\n\n    select\n          patient_id\n        , denominator_flag\n        , numerator_flag\n        , exclusion_flag\n        , evidence_date\n        , evidence_value\n        , exclusion_date\n        , exclusion_reason\n        , performance_period_begin\n        , performance_period_end\n        , measure_id\n        , measure_name\n        , measure_version\n    from measure_flags\n    where rn = 1\n\n)\n\n, add_data_types as (\n\n    select\n          cast(patient_id as TEXT) as patient_id\n        , cast(denominator_flag as integer) as denominator_flag\n        , cast(numerator_flag as integer) as numerator_flag\n        , cast(exclusion_flag as integer) as exclusion_flag\n        , cast(evidence_date as date) as evidence_date\n        , cast(evidence_value as TEXT) as evidence_value\n        , cast(exclusion_date as date) as exclusion_date\n        , cast(exclusion_reason as TEXT) as exclusion_reason\n        , cast(performance_period_begin as date) as performance_period_begin\n        , cast(performance_period_end as date) as performance_period_end\n        , cast(measure_id as TEXT) as measure_id\n        , cast(measure_name as TEXT) as measure_name\n        , cast(measure_version as TEXT) as measure_version\n    from deduped\n\n)\n\nselect\n      patient_id\n    , denominator_flag\n    , numerator_flag\n    , exclusion_flag\n    , evidence_date\n    , evidence_value\n    , exclusion_date\n    , exclusion_reason\n    , performance_period_begin\n    , performance_period_end\n    , measure_id\n    , measure_name\n    , measure_version\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.quality_measures._int_cqm438_long"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.330903Z", "completed_at": "2024-08-23T19:21:36.334351Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.334766Z", "completed_at": "2024-08-23T19:21:36.334769Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.004263877868652344, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_cqm48_long", "compiled": true, "compiled_code": "\n\nwith denominator as (\n\n    select\n          patient_id\n        , performance_period_begin\n        , performance_period_end\n        , measure_id\n        , measure_name\n        , measure_version\n        , denominator_flag\n    from dev_tom.quality_measures._int_cqm48_denominator\n\n)\n\n, numerator as (\n\n    select\n          patient_id\n        , evidence_date\n        , evidence_value\n    from dev_tom.quality_measures._int_cqm48_numerator\n\n)\n\n, exclusions as (\n\n    select\n          patient_id\n        , exclusion_date\n        , exclusion_reason\n    from dev_tom.quality_measures._int_cqm48_exclusions\n\n)\n\n, measure_flags as (\n\n    select\n          denominator.patient_id\n        , case\n            when denominator.patient_id is not null\n            then 1\n            else null\n          end as denominator_flag\n        , case\n            when numerator.patient_id is not null and denominator.patient_id is not null\n            then 1\n            when denominator.patient_id is not null\n            then 0\n            else null\n          end as numerator_flag\n        , case\n            when exclusions.patient_id is not null and denominator.patient_id is not null\n            then 1\n            when denominator.patient_id is not null\n            then 0\n            else null\n          end as exclusion_flag\n        , numerator.evidence_date\n        , numerator.evidence_value\n        , exclusions.exclusion_date\n        , exclusions.exclusion_reason\n        , denominator.performance_period_begin\n        , denominator.performance_period_end\n        , denominator.measure_id\n        , denominator.measure_name\n        , denominator.measure_version\n        , (row_number() over(\n            partition by\n                  denominator.patient_id\n                , denominator.performance_period_begin\n                , denominator.performance_period_end\n                , denominator.measure_id\n                , denominator.measure_name\n              order by\n                  case when numerator.evidence_date is null then 1 else 0 end,\n                  numerator.evidence_date desc\n                , case when exclusions.exclusion_date is null then 1 else 0 end,\n                  exclusions.exclusion_date desc\n          )) as rn\n    from denominator\n        left join numerator\n            on denominator.patient_id = numerator.patient_id\n        left join exclusions\n            on denominator.patient_id = exclusions.patient_id\n\n)\n\n/*\n    Deduplicate measure rows by latest evidence date or exclusion date\n*/\n, deduped as (\n\n    select\n          patient_id\n        , denominator_flag\n        , numerator_flag\n        , exclusion_flag\n        , evidence_date\n        , evidence_value\n        , exclusion_date\n        , exclusion_reason\n        , performance_period_begin\n        , performance_period_end\n        , measure_id\n        , measure_name\n        , measure_version\n    from measure_flags\n    where rn = 1\n\n)\n\n, add_data_types as (\n\n    select\n          cast(patient_id as TEXT) as patient_id\n        , cast(denominator_flag as integer) as denominator_flag\n        , cast(numerator_flag as integer) as numerator_flag\n        , cast(exclusion_flag as integer) as exclusion_flag\n        , cast(evidence_date as date) as evidence_date\n        , cast(evidence_value as TEXT) as evidence_value\n        , cast(exclusion_date as date) as exclusion_date\n        , cast(exclusion_reason as TEXT) as exclusion_reason\n        , cast(performance_period_begin as date) as performance_period_begin\n        , cast(performance_period_end as date) as performance_period_end\n        , cast(measure_id as TEXT) as measure_id\n        , cast(measure_name as TEXT) as measure_name\n        , cast(measure_version as TEXT) as measure_version\n    from deduped\n\n)\n\nselect\n      patient_id\n    , denominator_flag\n    , numerator_flag\n    , exclusion_flag\n    , evidence_date\n    , evidence_value\n    , exclusion_date\n    , exclusion_reason\n    , performance_period_begin\n    , performance_period_end\n    , measure_id\n    , measure_name\n    , measure_version\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.quality_measures._int_cqm48_long"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.336084Z", "completed_at": "2024-08-23T19:21:36.342873Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.343189Z", "completed_at": "2024-08-23T19:21:36.343192Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.00778508186340332, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_nqf0034_long", "compiled": true, "compiled_code": "with denominator as (\n\n    select\n          patient_id\n    from dev_tom.quality_measures._int_nqf0034_denominator\n\n)\n\n, numerator as (\n\n    select\n          patient_id\n        , evidence_date\n    from dev_tom.quality_measures._int_nqf0034_numerator\n\n)\n\n, exclusions as (\n\n    select\n          patient_id\n        , exclusion_date\n        , exclusion_reason\n    from dev_tom.quality_measures._int_nqf0034_exclusions\n\n)\n\n, measure_flags as (\n\n    select\n          denominator.patient_id\n        , case\n            when denominator.patient_id is not null\n            then 1\n            else null\n          end as denominator_flag\n        , case\n            when numerator.patient_id is not null and denominator.patient_id is not null\n            then 1\n            when denominator.patient_id is not null\n            then 0\n            else null\n          end as numerator_flag\n        , case\n            when exclusions.patient_id is not null and denominator.patient_id is not null\n            then 1\n            when denominator.patient_id is not null\n            then 0\n            else null\n          end as exclusion_flag\n        , numerator.evidence_date\n        , exclusions.exclusion_date\n        , exclusions.exclusion_reason\n        , pp.performance_period_begin\n        , pp.performance_period_end\n        , (\n    select id\nfrom dev_tom.quality_measures._value_set_measures\nwhere id = 'NQF0034'\n    )  as measure_id\n        , (\n\n    select name\nfrom dev_tom.quality_measures._value_set_measures\nwhere id = 'NQF0034'\n\n    )  as measure_name\n        , (\n    select version\nfrom dev_tom.quality_measures._value_set_measures\nwhere id = 'NQF0034'\n\n    )  as measure_version\n    from denominator\n    inner join dev_tom.quality_measures._int_nqf0034__performance_period pp\n        on 1 = 1\n        left join numerator\n            on denominator.patient_id = numerator.patient_id\n        left join exclusions\n            on denominator.patient_id = exclusions.patient_id\n\n)\n\n/*\n    Deduplicate measure rows by latest evidence date or exclusion date\n*/\n, add_rownum as (\n\n    select\n          patient_id\n        , denominator_flag\n        , numerator_flag\n        , exclusion_flag\n        , evidence_date\n        , exclusion_date\n        , exclusion_reason\n        , performance_period_begin\n        , performance_period_end\n        , measure_id\n        , measure_name\n        , measure_version\n        , row_number() over(\n            partition by\n                  patient_id\n                , performance_period_begin\n                , performance_period_end\n                , measure_id\n                , measure_name\n              order by\n                  case when evidence_date is null then 1 else 0 end,\n                  evidence_date desc\n                , case when exclusion_date is null then 1 else 0 end,\n                  exclusion_date desc\n          ) as row_num\n    from measure_flags\n\n)\n\n, deduped as (\n\n    select\n          patient_id\n        , denominator_flag\n        , numerator_flag\n        , exclusion_flag\n        , evidence_date\n        , exclusion_date\n        , exclusion_reason\n        , performance_period_begin\n        , performance_period_end\n        , measure_id\n        , measure_name\n        , measure_version\n    from add_rownum\n    where row_num = 1\n\n)\n\n, add_data_types as (\n\n    select\n          cast(patient_id as TEXT) as patient_id\n        , cast(denominator_flag as integer) as denominator_flag\n        , cast(numerator_flag as integer) as numerator_flag\n        , cast(exclusion_flag as integer) as exclusion_flag\n        , cast(evidence_date as date) as evidence_date\n        , cast(exclusion_date as date) as exclusion_date\n        , cast(exclusion_reason as TEXT) as exclusion_reason\n        , cast(performance_period_begin as date) as performance_period_begin\n        , cast(performance_period_end as date) as performance_period_end\n        , cast(measure_id as TEXT) as measure_id\n        , cast(measure_name as TEXT) as measure_name\n        , cast(measure_version as TEXT) as measure_version\n    from deduped\n\n)\n\nselect\n      patient_id\n    , denominator_flag\n    , numerator_flag\n    , exclusion_flag\n    , evidence_date\n    , cast(null as TEXT) as evidence_value\n    , exclusion_date\n    , exclusion_reason\n    , performance_period_begin\n    , performance_period_end\n    , measure_id\n    , measure_name\n    , measure_version\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.quality_measures._int_nqf0034_long"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.339823Z", "completed_at": "2024-08-23T19:21:36.343025Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.343447Z", "completed_at": "2024-08-23T19:21:36.343449Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.007854223251342773, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_nqf0041_long", "compiled": true, "compiled_code": "\n\nwith denominator as (\n\n    select\n          patient_id\n        , performance_period_begin\n        , performance_period_end\n        , measure_id\n        , measure_name\n        , measure_version\n        , denominator_flag\n    from dev_tom.quality_measures._int_nqf0041_denominator\n\n)\n\n, numerator as (\n\n    select\n          patient_id\n        , evidence_date\n        , evidence_value\n    from dev_tom.quality_measures._int_nqf0041_numerator\n\n)\n\n, exclusions as (\n\n    select\n          patient_id\n        , exclusion_date\n        , exclusion_reason\n    from dev_tom.quality_measures._int_nqf0041_exclusions\n\n)\n\n, measure_flags as (\n\n    select\n          denominator.patient_id\n        , case\n            when denominator.patient_id is not null\n            then 1\n            else null\n          end as denominator_flag\n        , case\n            when numerator.patient_id is not null and denominator.patient_id is not null\n            then 1\n            when denominator.patient_id is not null\n            then 0\n            else null\n          end as numerator_flag\n        , case\n            when exclusions.patient_id is not null and denominator.patient_id is not null\n            then 1\n            when denominator.patient_id is not null\n            then 0\n            else null\n          end as exclusion_flag\n        , numerator.evidence_date\n        , numerator.evidence_value\n        , exclusions.exclusion_date\n        , exclusions.exclusion_reason\n        , denominator.performance_period_begin\n        , denominator.performance_period_end\n        , denominator.measure_id\n        , denominator.measure_name\n        , denominator.measure_version\n        , (row_number() over(\n            partition by\n                  denominator.patient_id\n                , denominator.performance_period_begin\n                , denominator.performance_period_end\n                , denominator.measure_id\n                , denominator.measure_name\n              order by\n                  case when numerator.evidence_date is null then 1 else 0 end,\n                  numerator.evidence_date desc\n                , case when exclusions.exclusion_date is null then 1 else 0 end,\n                  exclusions.exclusion_date desc\n          )) as rn\n    from denominator\n        left join numerator\n            on denominator.patient_id = numerator.patient_id\n        left join exclusions\n            on denominator.patient_id = exclusions.patient_id\n\n)\n\n/*\n    Deduplicate measure rows by latest evidence date or exclusion date\n*/\n, deduped as (\n\n    select\n          patient_id\n        , denominator_flag\n        , numerator_flag\n        , exclusion_flag\n        , evidence_date\n        , evidence_value\n        , exclusion_date\n        , exclusion_reason\n        , performance_period_begin\n        , performance_period_end\n        , measure_id\n        , measure_name\n        , measure_version\n    from measure_flags\n    where rn = 1\n\n)\n\n, add_data_types as (\n\n    select\n          cast(patient_id as TEXT) as patient_id\n        , cast(denominator_flag as integer) as denominator_flag\n        , cast(numerator_flag as integer) as numerator_flag\n        , cast(exclusion_flag as integer) as exclusion_flag\n        , cast(evidence_date as date) as evidence_date\n        , cast(evidence_value as TEXT) as evidence_value\n        , cast(exclusion_date as date) as exclusion_date\n        , cast(exclusion_reason as TEXT) as exclusion_reason\n        , cast(performance_period_begin as date) as performance_period_begin\n        , cast(performance_period_end as date) as performance_period_end\n        , cast(measure_id as TEXT) as measure_id\n        , cast(measure_name as TEXT) as measure_name\n        , cast(measure_version as TEXT) as measure_version\n    from deduped\n\n)\n\nselect\n      patient_id\n    , denominator_flag\n    , numerator_flag\n    , exclusion_flag\n    , evidence_date\n    , evidence_value\n    , exclusion_date\n    , exclusion_reason\n    , performance_period_begin\n    , performance_period_end\n    , measure_id\n    , measure_name\n    , measure_version\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.quality_measures._int_nqf0041_long"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.344713Z", "completed_at": "2024-08-23T19:21:36.353089Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.353414Z", "completed_at": "2024-08-23T19:21:36.353417Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.009377002716064453, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_nqf0053_exclusions_stage_1", "compiled": true, "compiled_code": "with frailty as (\n\n    select\n        patient_id\n      , exclusion_date\n      , exclusion_reason\n    from dev_tom.quality_measures._int_shared_exclusions_frailty\n    where exclusion_date between (\n  select\n    performance_period_begin\n  from dev_tom.quality_measures._int_nqf0053__performance_period\n\n) and (\n  select\n    performance_period_end\n  from dev_tom.quality_measures._int_nqf0053__performance_period\n\n)\n\n)\n\n, frailty_within_defined_window as (\n\n  select\n      patient_id\n    , exclusion_date\n    , exclusion_reason\n  from dev_tom.quality_measures._int_shared_exclusions_frailty\n  where exclusion_date between\n    \n\n    dateadd(\n        month,\n        -6,\n        (\n  select\n    performance_period_begin\n  from dev_tom.quality_measures._int_nqf0053__performance_period\n\n)\n        )\n\n\n    and (\n  select\n    lookback_period_december\n  from dev_tom.quality_measures._int_nqf0053__performance_period\n\n)\n\n)\n\n, valid_hospice_palliative as (\n\n    select\n          patient_id\n        , exclusion_date\n        , exclusion_reason\n        , exclusion_type\n    from dev_tom.quality_measures._int_shared_exclusions_hospice_palliative\n    where exclusion_date between (\n  select\n    performance_period_begin\n  from dev_tom.quality_measures._int_nqf0053__performance_period\n\n) and (\n  select\n    performance_period_end\n  from dev_tom.quality_measures._int_nqf0053__performance_period\n\n)\n\n)\n\n, exclusion_procedure_and_medication as (\n\n    select\n          patient_id\n        , exclusion_date\n        , exclusion_reason\n        , exclusion_type\n    from dev_tom.quality_measures._int_nqf0053_exclude_procedures_medications\n\n)\n\n, valid_institutional_snp as (\n\n  select\n      patient_id\n    , exclusion_date\n    , exclusion_reason\n    , exclusion_type\n  from dev_tom.quality_measures._int_shared_exclusions_institutional_snp\n  where exclusion_date between\n    \n\n    dateadd(\n        month,\n        -6,\n        (\n  select\n    performance_period_begin\n  from dev_tom.quality_measures._int_nqf0053__performance_period\n\n)\n        )\n\n\n\n  and (\n  select\n    lookback_period_december\n  from dev_tom.quality_measures._int_nqf0053__performance_period\n\n)\n\n)\n\n, valid_dementia_exclusions as (\n\n  select\n      source.patient_id\n    , source.exclusion_date\n    , source.exclusion_reason\n    , source.exclusion_type\n  from dev_tom.quality_measures._int_shared_exclusions_dementia source\n  inner join frailty\n    on source.patient_id = frailty.patient_id\n  where (\n    source.dispensing_date\n      between \n\n    dateadd(\n        year,\n        -1,\n        (\n  select\n    performance_period_begin\n  from dev_tom.quality_measures._int_nqf0053__performance_period\n\n)\n        )\n\n\n          and (\n  select\n    performance_period_end\n  from dev_tom.quality_measures._int_nqf0053__performance_period\n\n)\n    or source.paid_date\n      between \n\n    dateadd(\n        year,\n        -1,\n        (\n  select\n    performance_period_begin\n  from dev_tom.quality_measures._int_nqf0053__performance_period\n\n)\n        )\n\n\n          and (\n  select\n    performance_period_end\n  from dev_tom.quality_measures._int_nqf0053__performance_period\n\n)\n    )\n\n)\n\n-- advanced illness start\n, advanced_illness_exclusion as (\n\n  select\n    source.*\n  from dev_tom.quality_measures._int_shared_exclusions_advanced_illness as source\n  inner join frailty\n    on source.patient_id = frailty.patient_id\n  where source.exclusion_date\n    between\n      \n\n    dateadd(\n        year,\n        -1,\n        (\n  select\n    performance_period_begin\n  from dev_tom.quality_measures._int_nqf0053__performance_period\n\n)\n        )\n\n\n      and (\n  select\n    performance_period_end\n  from dev_tom.quality_measures._int_nqf0053__performance_period\n\n)\n\n)\n\n, acute_inpatient_advanced_illness as (\n\n  select\n    *\n  from advanced_illness_exclusion\n  where patient_type = 'acute_inpatient'\n\n)\n\n, nonacute_outpatient_advanced_illness as (\n\n  select\n    *\n  from advanced_illness_exclusion\n  where patient_type = 'nonacute_outpatient'\n\n)\n\n, acute_inpatient_counts as (\n\n    select\n          patient_id\n        , exclusion_type\n        , count(distinct exclusion_date) as encounter_count\n    from acute_inpatient_advanced_illness\n    group by patient_id, exclusion_type\n\n)\n\n, nonacute_outpatient_counts as (\n\n    select\n          patient_id\n        , exclusion_type\n        , count(distinct exclusion_date) as encounter_count\n    from nonacute_outpatient_advanced_illness\n    group by patient_id, exclusion_type\n\n)\n\n, valid_advanced_illness_exclusions as (\n\n    select\n          acute_inpatient_advanced_illness.patient_id\n        , acute_inpatient_advanced_illness.exclusion_date\n        , acute_inpatient_advanced_illness.exclusion_reason\n        , acute_inpatient_advanced_illness.exclusion_type\n    from acute_inpatient_advanced_illness\n    left join acute_inpatient_counts\n      on acute_inpatient_advanced_illness.patient_id = acute_inpatient_counts.patient_id\n    where acute_inpatient_counts.encounter_count >= 1\n\n    union all\n\n    select\n        nonacute_outpatient_advanced_illness.patient_id\n      , nonacute_outpatient_advanced_illness.exclusion_date\n      , nonacute_outpatient_advanced_illness.exclusion_reason\n      , nonacute_outpatient_advanced_illness.exclusion_type\n    from nonacute_outpatient_advanced_illness\n    left join nonacute_outpatient_counts\n      on nonacute_outpatient_advanced_illness.patient_id = nonacute_outpatient_counts.patient_id\n    where nonacute_outpatient_counts.encounter_count >= 2\n\n\n)\n-- advanced illness end\n\n, frailty_patients_within_defined_window as (\n\n    select\n          frailty_within_defined_window.patient_id\n        , frailty_within_defined_window.exclusion_date\n        , frailty_within_defined_window.exclusion_reason\n        , 'measure specific exclusion for defined window' as exclusion_type\n    from frailty_within_defined_window\n\n)\n\n, exclusions as (\n\n    select * from valid_advanced_illness_exclusions\n\n    union all\n\n    select * from valid_dementia_exclusions\n\n    union all\n\n    select * from valid_institutional_snp\n\n    union all\n\n    select * from valid_hospice_palliative\n\n    union all\n\n    select * from exclusion_procedure_and_medication\n\n    union all\n\n    select * from frailty_patients_within_defined_window\n\n)\n\nselect\n      *\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom exclusions", "relation_name": "dev_tom.quality_measures._int_nqf0053_exclusions_stage_1"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.349213Z", "completed_at": "2024-08-23T19:21:36.353238Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.353685Z", "completed_at": "2024-08-23T19:21:36.353687Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.009469032287597656, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_nqf0059_long", "compiled": true, "compiled_code": "\n\nwith denominator as (\n\n    select\n          patient_id\n        , performance_period_begin\n        , performance_period_end\n        , measure_id\n        , measure_name\n        , measure_version\n        , denominator_flag\n    from dev_tom.quality_measures._int_nqf0059_denominator\n\n)\n\n, numerator as (\n\n    select\n          patient_id\n        , evidence_date\n        , evidence_value\n    from dev_tom.quality_measures._int_nqf0059_numerator\n    where numerator_flag = 1\n\n)\n\n, exclusions as (\n\n    select\n          patient_id\n        , exclusion_date\n        , exclusion_reason\n    from dev_tom.quality_measures._int_nqf0059_exclusions\n\n)\n\n, measure_flags as (\n\n    select\n          denominator.patient_id\n        , case\n            when denominator.patient_id is not null\n            then 1\n            else null\n          end as denominator_flag\n        , case\n            when numerator.patient_id is not null and denominator.patient_id is not null\n            then 1\n            when denominator.patient_id is not null\n            then 0\n            else null\n          end as numerator_flag\n        , case\n            when exclusions.patient_id is not null and denominator.patient_id is not null\n            then 1\n            when denominator.patient_id is not null\n            then 0\n            else null\n          end as exclusion_flag\n        , numerator.evidence_date\n        , numerator.evidence_value\n        , exclusions.exclusion_date\n        , exclusions.exclusion_reason\n        , denominator.performance_period_begin\n        , denominator.performance_period_end\n        , denominator.measure_id\n        , denominator.measure_name\n        , denominator.measure_version\n        , (row_number() over(\n            partition by\n                  denominator.patient_id\n                , denominator.performance_period_begin\n                , denominator.performance_period_end\n                , denominator.measure_id\n                , denominator.measure_name\n              order by\n                  case when numerator.evidence_date is null then 1 else 0 end,\n                  numerator.evidence_date desc\n                , case when exclusions.exclusion_date is null then 1 else 0 end,\n                  exclusions.exclusion_date desc\n          )) as rn\n    from denominator\n        left join numerator\n            on denominator.patient_id = numerator.patient_id\n        left join exclusions\n            on denominator.patient_id = exclusions.patient_id\n\n)\n\n/*\n    Deduplicate measure rows by latest evidence date or exclusion date\n*/\n, deduped as (\n\n    select\n          patient_id\n        , denominator_flag\n        , numerator_flag\n        , exclusion_flag\n        , evidence_date\n        , evidence_value\n        , exclusion_date\n        , exclusion_reason\n        , performance_period_begin\n        , performance_period_end\n        , measure_id\n        , measure_name\n        , measure_version\n    from measure_flags\n    where rn = 1\n\n)\n\n, add_data_types as (\n\n    select\n          cast(patient_id as TEXT) as patient_id\n        , cast(denominator_flag as integer) as denominator_flag\n        , cast(numerator_flag as integer) as numerator_flag\n        , cast(exclusion_flag as integer) as exclusion_flag\n        , cast(evidence_date as date) as evidence_date\n        , cast(evidence_value as TEXT) as evidence_value\n        , cast(exclusion_date as date) as exclusion_date\n        , cast(exclusion_reason as TEXT) as exclusion_reason\n        , cast(performance_period_begin as date) as performance_period_begin\n        , cast(performance_period_end as date) as performance_period_end\n        , cast(measure_id as TEXT) as measure_id\n        , cast(measure_name as TEXT) as measure_name\n        , cast(measure_version as TEXT) as measure_version\n    from deduped\n\n)\n\nselect\n      patient_id\n    , denominator_flag\n    , numerator_flag\n    , exclusion_flag\n    , evidence_date\n    , evidence_value\n    , exclusion_date\n    , exclusion_reason\n    , performance_period_begin\n    , performance_period_end\n    , measure_id\n    , measure_name\n    , measure_version\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.quality_measures._int_nqf0059_long"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.355080Z", "completed_at": "2024-08-23T19:21:36.362355Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.362683Z", "completed_at": "2024-08-23T19:21:36.362685Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.008348941802978516, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_nqf0097_long", "compiled": true, "compiled_code": "\n\n/* selecting the full patient population as the grain of this table */\nwith denominator as (\n\n    select\n          patient_id\n        , performance_period_begin\n        , performance_period_end\n        , measure_id\n        , measure_name\n        , measure_version\n        , denominator_flag\n    from dev_tom.quality_measures._int_nqf0097_denominator\n\n)\n\n, numerator as (\n\n    select\n          patient_id\n        , evidence_date\n        , evidence_value\n    from dev_tom.quality_measures._int_nqf0097_numerator\n\n)\n\n, exclusions as (\n\n    select\n          patient_id\n        , exclusion_date\n        , exclusion_reason\n    from dev_tom.quality_measures._int_nqf0097_exclusions\n\n)\n\n, measure_flags as (\n\n    select\n          denominator.patient_id\n        , case\n            when denominator.patient_id is not null\n            then 1\n            else null\n          end as denominator_flag\n        , case\n            when numerator.patient_id is not null and denominator.patient_id is not null\n            then 1\n            when denominator.patient_id is not null\n            then 0\n            else null\n          end as numerator_flag\n        , case\n            when exclusions.patient_id is not null and denominator.patient_id is not null\n            then 1\n            when denominator.patient_id is not null\n            then 0\n            else null\n          end as exclusion_flag\n        , numerator.evidence_date\n        , numerator.evidence_value\n        , exclusions.exclusion_date\n        , exclusions.exclusion_reason\n        , denominator.performance_period_begin\n        , denominator.performance_period_end\n        , denominator.measure_id\n        , denominator.measure_name\n        , denominator.measure_version\n        , (row_number() over(\n            partition by\n                  denominator.patient_id\n                , denominator.performance_period_begin\n                , denominator.performance_period_end\n                , denominator.measure_id\n                , denominator.measure_name\n              order by\n                  case when numerator.evidence_date is null then 1 else 0 end,\n                  numerator.evidence_date desc\n                , case when exclusions.exclusion_date is null then 1 else 0 end,\n                  exclusions.exclusion_date desc\n          )) as rn\n    from denominator\n        left join numerator\n            on denominator.patient_id = numerator.patient_id\n        left join exclusions\n            on denominator.patient_id = exclusions.patient_id\n\n)\n\n/*\n    Deduplicate measure rows by latest evidence date or exclusion date\n*/\n, deduped as (\n\n    select\n          patient_id\n        , denominator_flag\n        , numerator_flag\n        , exclusion_flag\n        , evidence_date\n        , evidence_value\n        , exclusion_date\n        , exclusion_reason\n        , performance_period_begin\n        , performance_period_end\n        , measure_id\n        , measure_name\n        , measure_version\n    from measure_flags\n    where rn = 1\n\n)\n\n, add_data_types as (\n\n    select\n          cast(patient_id as TEXT) as patient_id\n        , cast(denominator_flag as integer) as denominator_flag\n        , cast(numerator_flag as integer) as numerator_flag\n        , cast(exclusion_flag as integer) as exclusion_flag\n        , cast(evidence_date as date) as evidence_date\n        , cast(evidence_value as TEXT) as evidence_value\n        , cast(exclusion_date as date) as exclusion_date\n        , cast(exclusion_reason as TEXT) as exclusion_reason\n        , cast(performance_period_begin as date) as performance_period_begin\n        , cast(performance_period_end as date) as performance_period_end\n        , cast(measure_id as TEXT) as measure_id\n        , cast(measure_name as TEXT) as measure_name\n        , cast(measure_version as TEXT) as measure_version\n    from deduped\n\n)\n\nselect\n      patient_id\n    , denominator_flag\n    , numerator_flag\n    , exclusion_flag\n    , evidence_date\n    , evidence_value\n    , exclusion_date\n    , exclusion_reason\n    , performance_period_begin\n    , performance_period_end\n    , measure_id\n    , measure_name\n    , measure_version\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.quality_measures._int_nqf0097_long"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.358012Z", "completed_at": "2024-08-23T19:21:36.362514Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.362940Z", "completed_at": "2024-08-23T19:21:36.362943Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.008430242538452148, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_nqf2372_exclusions", "compiled": true, "compiled_code": "with frailty as (\n\n  select\n    *\n  from dev_tom.quality_measures._int_shared_exclusions_frailty\n  where exclusion_date between (\n  select \n    performance_period_begin\n  from dev_tom.quality_measures._int_nqf2372__performance_period\n\n) and (\n  select \n    performance_period_end\n  from dev_tom.quality_measures._int_nqf2372__performance_period\n\n)\n\n)\n\n, valid_mastectomy_patients as (\n\n    select\n        patient_id\n      , exclusion_date\n      , exclusion_reason\n    from dev_tom.quality_measures._int_nqf2372_exclude_mastectomy\n)\n\n, valid_hospice_palliative as (\n\n  select\n      patient_id\n    , exclusion_date\n    , exclusion_reason\n    , exclusion_type\n  from dev_tom.quality_measures._int_shared_exclusions_hospice_palliative\n  where lower(exclusion_reason) in \n  (\n        'palliative care encounter'\n      , 'palliative care intervention'\n      , 'hospice care ambulatory'\n      , 'hospice encounter'\n  )\n  and\n  exclusion_date between (\n  select \n    performance_period_begin\n  from dev_tom.quality_measures._int_nqf2372__performance_period\n\n) and (\n  select \n    performance_period_end\n  from dev_tom.quality_measures._int_nqf2372__performance_period\n\n)\n\n)\n\n, valid_institutional_snp as (\n\n  select \n      patient_id\n    , exclusion_date\n    , exclusion_reason\n    , exclusion_type\n  from dev_tom.quality_measures._int_shared_exclusions_institutional_snp\n  where exclusion_date between (\n  select \n    performance_period_begin\n  from dev_tom.quality_measures._int_nqf2372__performance_period\n\n) and (\n  select \n    performance_period_end\n  from dev_tom.quality_measures._int_nqf2372__performance_period\n\n)\n\n)\n\n, valid_dementia_exclusions as (\n\n  select\n      source.patient_id\n    , source.exclusion_date\n    , source.exclusion_reason\n    , source.exclusion_type\n  from dev_tom.quality_measures._int_shared_exclusions_dementia source\n  inner join frailty\n    on source.patient_id = frailty.patient_id\n  where (\n    source.dispensing_date\n      between \n\n    dateadd(\n        year,\n        -1,\n        (\n  select \n    performance_period_begin\n  from dev_tom.quality_measures._int_nqf2372__performance_period\n\n)\n        )\n\n\n          and (\n  select \n    performance_period_end\n  from dev_tom.quality_measures._int_nqf2372__performance_period\n\n)\n    or source.paid_date\n      between \n\n    dateadd(\n        year,\n        -1,\n        (\n  select \n    performance_period_begin\n  from dev_tom.quality_measures._int_nqf2372__performance_period\n\n)\n        )\n\n\n          and (\n  select \n    performance_period_end\n  from dev_tom.quality_measures._int_nqf2372__performance_period\n\n)\n    )\n\n)\n\n-- advanced illness start\n, advanced_illness_exclusion as (\n\n  select\n    source.*\n  from dev_tom.quality_measures._int_shared_exclusions_advanced_illness as source\n  inner join frailty\n    on source.patient_id = frailty.patient_id\n  where source.exclusion_date\n    between\n      \n\n    dateadd(\n        year,\n        -1,\n        (\n  select \n    performance_period_begin\n  from dev_tom.quality_measures._int_nqf2372__performance_period\n\n)\n        )\n\n\n      and (\n  select \n    performance_period_end\n  from dev_tom.quality_measures._int_nqf2372__performance_period\n\n)\n\n)\n\n, acute_inpatient_advanced_illness as (\n\n  select\n    *\n  from advanced_illness_exclusion\n  where patient_type = 'acute_inpatient'\n\n)\n\n, nonacute_outpatient_advanced_illness as (\n\n  select\n    *\n  from advanced_illness_exclusion\n  where patient_type = 'nonacute_outpatient'\n\n)\n\n, acute_inpatient_counts as (\n\n    select\n          patient_id\n        , exclusion_type\n        , count(distinct exclusion_date) as encounter_count\n    from acute_inpatient_advanced_illness\n    group by patient_id, exclusion_type\n\n)\n\n, nonacute_outpatient_counts as (\n\n    select\n          patient_id\n        , exclusion_type\n        , count(distinct exclusion_date) as encounter_count\n    from nonacute_outpatient_advanced_illness\n    group by patient_id, exclusion_type\n\n)\n\n, valid_advanced_illness_exclusions as (\n\n    select\n          acute_inpatient_advanced_illness.patient_id\n        , acute_inpatient_advanced_illness.exclusion_date\n        , acute_inpatient_advanced_illness.exclusion_reason\n        , acute_inpatient_advanced_illness.exclusion_type\n    from acute_inpatient_advanced_illness\n    left join acute_inpatient_counts\n      on acute_inpatient_advanced_illness.patient_id = acute_inpatient_counts.patient_id\n    where acute_inpatient_counts.encounter_count >= 1\n\n    union all\n\n    select\n        nonacute_outpatient_advanced_illness.patient_id\n      , nonacute_outpatient_advanced_illness.exclusion_date\n      , nonacute_outpatient_advanced_illness.exclusion_reason\n      , nonacute_outpatient_advanced_illness.exclusion_type\n    from nonacute_outpatient_advanced_illness\n    left join nonacute_outpatient_counts\n      on nonacute_outpatient_advanced_illness.patient_id = nonacute_outpatient_counts.patient_id\n    where nonacute_outpatient_counts.encounter_count >= 2\n\n)\n-- advanced illness end\n\n, valid_mastectomy_patients_with_exclusion_type as (\n\n    select\n        patient_id\n      , exclusion_date\n      , exclusion_reason\n      , 'mastectomy_performed' as exclusion_type\n    from valid_mastectomy_patients\n)\n\n, exclusions as (\n\n    select * from valid_advanced_illness_exclusions\n\n    union all\n\n    select * from valid_dementia_exclusions\n\n    union all\n\n    select * from valid_institutional_snp\n\n    union all\n\n    select * from valid_hospice_palliative\n\n)\n\n, combined_exclusions as (\n\n    select \n      exclusions.*\n    , denominator.age\n    from exclusions\n    inner join dev_tom.quality_measures._int_nqf2372_denominator denominator\n      on exclusions.patient_id = denominator.patient_id\n\n)\n\n, valid_exclusions as (\n\n  select\n        patient_id\n      , exclusion_date\n      , exclusion_reason\n      , exclusion_type\n  from combined_exclusions\n  where exclusion_type != 'hospice_palliative' \n    and age >= 66\n\n  union all\n\n  select\n        patient_id\n      , exclusion_date\n      , exclusion_reason\n      , exclusion_type\n  from combined_exclusions\n  where exclusion_type = 'hospice_palliative'\n\n)\n\n, valid_exclusions_with_mastectomy as (\n\n    select *\n    from valid_exclusions\n\n    union all\n\n    select *\n    from valid_mastectomy_patients_with_exclusion_type\n\n)\n\n, add_data_types as (\n\n    select\n        distinct\n          cast(patient_id as TEXT) as patient_id\n        , cast(exclusion_date as date) as exclusion_date\n        , cast(exclusion_reason as TEXT) as exclusion_reason\n        , 1 as exclusion_flag\n    from valid_exclusions_with_mastectomy\n\n)\n\nselect\n      patient_id\n    , exclusion_date\n    , exclusion_reason\n    , exclusion_flag\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.quality_measures._int_nqf2372_exclusions"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.364276Z", "completed_at": "2024-08-23T19:21:36.369081Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.369396Z", "completed_at": "2024-08-23T19:21:36.369399Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.005806922912597656, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.readmissions__readmission_crude", "compiled": true, "compiled_code": "\n\n-- Here we calculate readmissions using all encounters\n-- that have valid admit and discharge dates and no overlap.\n-- This is meant to give a crude sense of the readmission\n-- rate without taking into account all the CMS HWR logic.\n\n\nwith encounter_info as (\nselect\n    enc.encounter_id,\n    enc.patient_id,\n    enc.admit_date,\n    enc.discharge_date\nfrom dev_tom.readmissions._int_encounter enc\nleft join dev_tom.readmissions._int_encounter_overlap over_a\n    on enc.encounter_id = over_a.encounter_id_A\nleft join dev_tom.readmissions._int_encounter_overlap over_b\n    on enc.encounter_id = over_b.encounter_id_B\nwhere\n    admit_date is not null\n    and\n    discharge_date is not null\n    and\n    admit_date <= discharge_date\nand over_a.encounter_id_A is null and over_b.encounter_id_B is null\n    ),\n\n\nencounter_sequence as (\nselect\n    encounter_id,\n    patient_id,\n    admit_date,\n    discharge_date,\n    row_number() over(\n        partition by patient_id order by admit_date, discharge_date\n    ) as encounter_seq\nfrom encounter_info\n),\n\n\nreadmission_calc as (\nselect\n    aa.encounter_id,\n    aa.patient_id,\n    aa.admit_date,\n    aa.discharge_date,\n    case\n        when bb.encounter_id is not null then 1\n\telse 0\n    end as had_readmission_flag,\n    datediff(\n        day,\n        bb.admit_date,\n        aa.discharge_date\n        ) as days_to_readmit,\n    case\n        when (datediff(\n        day,\n        bb.admit_date,\n        aa.discharge_date\n        )) <= 30  then 1\n\telse 0\n    end as readmit_30_flag\nfrom encounter_sequence aa left join encounter_sequence bb\n     on aa.patient_id = bb.patient_id\n     and aa.encounter_seq + 1 = bb.encounter_seq\n)\n\n\n\nselect *, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom readmission_calc", "relation_name": "dev_tom.readmissions._int_readmission_crude"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.366637Z", "completed_at": "2024-08-23T19:21:36.369228Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.369653Z", "completed_at": "2024-08-23T19:21:36.369655Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.005883932113647461, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.readmissions__encounter_data_quality", "compiled": true, "compiled_code": "\n\n-- Here we list all encounters from the stg_encounter table\n-- with data quality flags that may disqualify them from\n-- being used for readmission measures \n\n\n-- Flag several potential data quality issues\n-- with all encounters.\n-- Every encounter_id from the stg_encounter model\n-- will be here. This CTE should have the same\n-- number of rows as the stg_encounter model, i.e.,\n-- there is a one to one correspondence between the\n-- rows in stg_encounter and this CTE.\nwith encounter_data_quality_issues as (\nselect\n    aa.encounter_id,\n    case\n        when aa.admit_date is null then 1\n\telse 0\n    end as missing_admit_date_flag,\n    case\n        when aa.discharge_date is null then 1\n\telse 0\n    end as missing_discharge_date_flag,\n    case\n        when aa.admit_date > aa.discharge_date then 1\n\telse 0\n    end as admit_after_discharge_flag,\n    case\n        when aa.discharge_disposition_code is null then 1\n\telse 0\n    end as missing_discharge_disposition_code_flag,\n    case\n        when\n\t    (aa.discharge_disposition_code is not null)\n\t    and\n\t    (bb.discharge_disposition_code is null) then 1\n\telse 0\n    end as invalid_discharge_disposition_code_flag,\n    case\n      when aa.primary_diagnosis_code is null then 1\n      else 0\n    end as missing_primary_diagnosis_flag,\n    case\n        when aa.valid_primary_diagnosis_code_flag = 0 then 1\n\telse 0\n    end as invalid_primary_diagnosis_code_flag,\n    case\n        when aa.ccs_diagnosis_category is null  then 1\n\telse 0\n    end as no_diagnosis_ccs_flag,\n    aa.ccs_diagnosis_category as diagnosis_ccs,\n    case\n        when aa.encounter_id in (select distinct encounter_id_A\n\t                         from dev_tom.readmissions._int_encounter_overlap )\n\t     or\n\t     aa.encounter_id in (select distinct encounter_id_B\n\t                         from dev_tom.readmissions._int_encounter_overlap )\n\tthen 1\n\telse 0\n    end as overlaps_with_another_encounter_flag,\n    case\n        when aa.ms_drg_code is null then 1\n\telse 0\n    end as missing_ms_drg_flag,\n    case\n        when cc.ms_drg_code is null then 1\n\telse 0\n    end as invalid_ms_drg_flag\n\nfrom dev_tom.readmissions._int_encounter_with_ccs aa\n     left join dev_tom.terminology.discharge_disposition bb\n     on aa.discharge_disposition_code = bb.discharge_disposition_code\n     left join dev_tom.terminology.ms_drg cc\n     on aa.ms_drg_code = cc.ms_drg_code\n),\n\n\n-- Here we add a disqualified_encounter_flag.\n-- This disqualified_encounter_flag = 1\n-- when any of the critical data quality flags\n-- from the above CTE are equal to 1.\nall_data_quality_flags as (\nselect\n    encounter_id,\n    diagnosis_ccs,\n    case\n        when\n\t    (missing_admit_date_flag = 1)\n\t    or\n\t    (missing_discharge_date_flag = 1)\n\t    or\n\t    (admit_after_discharge_flag = 1)\n\t    or\n\t    (missing_discharge_disposition_code_flag = 1)\n\t    or\n\t    (invalid_discharge_disposition_code_flag = 1)\n\t    or\n\t    (missing_primary_diagnosis_flag = 1)\n\t    or\n\t    (invalid_primary_diagnosis_code_flag = 1)\n\t    or\n\t    (no_diagnosis_ccs_flag = 1)\n\t    or\n\t    (overlaps_with_another_encounter_flag = 1)\n\t    or\n\t    (missing_ms_drg_flag = 1)\n\t    or\n\t    (invalid_ms_drg_flag = 1)\n\t    then 1\n\telse 0\n    end as disqualified_encounter_flag,\n    missing_admit_date_flag,\n    missing_discharge_date_flag,\n    admit_after_discharge_flag,\n    missing_discharge_disposition_code_flag,\n    invalid_discharge_disposition_code_flag,\n    missing_primary_diagnosis_flag,\n    invalid_primary_diagnosis_code_flag,\n    no_diagnosis_ccs_flag,\n    overlaps_with_another_encounter_flag,\n    missing_ms_drg_flag,\n    invalid_ms_drg_flag\nfrom encounter_data_quality_issues\n)    \n\n\n\nselect *, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom all_data_quality_flags", "relation_name": "dev_tom.readmissions._int_encounter_data_quality"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.370925Z", "completed_at": "2024-08-23T19:21:36.375250Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.375564Z", "completed_at": "2024-08-23T19:21:36.375567Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.005309104919433594, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.readmissions__encounter_specialty_cohort", "compiled": true, "compiled_code": "\n\n-- Here we list the specialty cohort for each encounter that has\n-- an associated specialty cohort.\n-- There are 5 possible specialty cohorts:\n--      [1] Medicine\n--      [2] Surgery/Gynecology\n--      [3] Cardiology\n--      [4] Cardiovascular\n--      [5] Neurology\n-- An encounter that has an ICD-10-PCS procedure code or a\n-- CCS procedure category that corresponds to the\n-- 'Surgery/Gynecology' cohort will always be in that cohort.\n-- For encounters that are not in the 'Surgery/Gynecology' cohort,\n-- we then check to see if they are in one of the other 4 cohorts.\n\n--ranking to eventually assign a cohort to encounters in multiple cohorts\nwith cohort_ranks as (\n    select 'Surgery/Gynecology' as cohort, 1 as c_rank\n    union all\n    select 'Cardiorespiratory' as cohort, 2 as c_rank\n    union all\n    select 'Cardiovascular' as cohort, 3 as c_rank\n    union all\n    select 'Neurology' as cohort, 4 as c_rank\n    union all\n    select 'Medicine' as cohort, 5 as c_rank\n)\n\n\n--get all encounter ids in any procedure or diagnosis based cohorts\n, all_encounter_cohorts as (\n\n    --encounter ids in procedure based cohorts\n        select procs.encounter_id, 1 as c_rank\n        from dev_tom.readmissions._int_procedure_ccs procs\n        left join dev_tom.readmissions._value_set_surgery_gynecology_cohort sgc\n            on procs.procedure_code = sgc.icd_10_pcs\n        left join dev_tom.readmissions._value_set_specialty_cohort sgsc\n            on procs.ccs_procedure_category = sgsc.ccs and sgsc.specialty_cohort = 'Surgery/Gynecology'\n        where sgc.icd_10_pcs is not null or sgsc.ccs is not null\n\n    union all\n\n    --encounter ids in diagnosis based cohorts\n    select diag.encounter_id, cohort_ranks.c_rank\n    from dev_tom.readmissions._int_encounter_with_ccs diag\n    inner join dev_tom.readmissions._value_set_specialty_cohort sc\n        on diag.ccs_diagnosis_category = sc.ccs and sc.procedure_or_diagnosis = 'Diagnosis'\n    inner join cohort_ranks\n        on sc.specialty_cohort = cohort_ranks.cohort\n)\n\n\n-- getting one cohort per encounter\n, main_encounter_cohort as (\n    select encounter_id, min(c_rank) as main_c_rank\n    from all_encounter_cohorts\n    group by encounter_id\n\n)\n\n\n--getting all encounters, with labeled cohorts, if no cohort cohort is \"medicine\"\nselect enc.encounter_id, coalesce(cohort_ranks.cohort, 'Medicine') as specialty_cohort, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.readmissions._int_encounter enc\nleft join main_encounter_cohort mec\n    on enc.encounter_id = mec.encounter_id\nleft join cohort_ranks\n    on mec.main_c_rank = cohort_ranks.c_rank", "relation_name": "dev_tom.readmissions._int_encounter_specialty_cohort"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.373249Z", "completed_at": "2024-08-23T19:21:36.375406Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.375819Z", "completed_at": "2024-08-23T19:21:36.375822Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.005385875701904297, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.readmissions__exclusion", "compiled": true, "compiled_code": "\n\n-- Here we list encounter_ids that are excluded\n-- from being index admissions because they\n-- belong to one of these categories:\n--       [1] Medical Treatment of Cancer\n--       [2] Rehabilitation\n--       [3] Psychiatric\n\n\n-- encounter_ids for encounters that should be\n-- excluded because they belong to one of the\n-- exclusion categories\nwith exclusions as (\nselect distinct encounter_id\nfrom dev_tom.readmissions._int_encounter_with_ccs\nwhere\n(ccs_diagnosis_category is not null)\nand\n(\nccs_diagnosis_category in\n    (select distinct ccs_diagnosis_category\n     from dev_tom.readmissions._value_set_exclusion_ccs_diagnosis_category )\n)\n)\n\n\nselect *, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom exclusions", "relation_name": "dev_tom.readmissions._int_exclusion"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.377210Z", "completed_at": "2024-08-23T19:21:36.402164Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.402476Z", "completed_at": "2024-08-23T19:21:36.402480Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.026035070419311523, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.readmissions__planned_encounter", "compiled": true, "compiled_code": "\n\n-- Here we list encounter_ids for all encounters\n-- that are planned.\n\n\n-- encounter_ids for encounters that we know\n-- are planned because they had a procedure category\n-- that is only present for planned encounters \nwith always_planned_px as (\nselect distinct pccs.encounter_id\nfrom dev_tom.readmissions._int_procedure_ccs pccs\ninner join dev_tom.readmissions._value_set_always_planned_ccs_procedure_category apc\n    on pccs.ccs_procedure_category = apc.ccs_procedure_category\n),\n\n\n-- encounter_ids for encounters that we know\n-- are planned because they had a diagnosis category\n-- that is only present for planned encounters\nalways_planned_dx as (\nselect distinct encounter_id\nfrom dev_tom.readmissions._int_encounter_with_ccs dccs\ninner join dev_tom.readmissions._value_set_always_planned_ccs_diagnosis_category apd\n    on dccs.ccs_diagnosis_category = apd.ccs_diagnosis_category\n),\n\n\n-- encounter_ids for encounters that are potentially planned\n-- based on one of their CCS procedure categories.\n-- For these encounters to actually be planned, we must further\n-- require that they are NOT acute encounters\npotentially_planned_px_ccs as (\nselect distinct encounter_id\nfrom dev_tom.readmissions._int_procedure_ccs pccs\ninner join dev_tom.readmissions._value_set_potentially_planned_ccs_procedure_category pcs\n    on pccs.ccs_procedure_category = pcs.ccs_procedure_category\n),\n\n\n-- encounter_ids for encounters that are potentially planned\n-- based on their ICD-10-PCS procedure codes.\n-- For these encounters to actually be planned, we must further\n-- require that they are NOT acute encounters\npotentially_planned_px_icd_10_pcs as (\nselect distinct encounter_id\nfrom dev_tom.readmissions._int_procedure_ccs pcs\ninner join  dev_tom.readmissions._value_set_potentially_planned_icd_10_pcs pps\n    on pcs.procedure_code = pps.icd_10_pcs\n),\n\n\n-- encounter_ids for encounters that are acute based\n-- on their primary diagnosis code or their CCS diagnosis category\nacute_encounters as (\nselect distinct encounter_id\nfrom dev_tom.readmissions._int_encounter_with_ccs dccs\nleft join dev_tom.readmissions._value_set_acute_diagnosis_icd_10_cm adi\n    on dccs.primary_diagnosis_code = adi.icd_10_cm\nleft join dev_tom.readmissions._value_set_acute_diagnosis_ccs adc\n    on dccs.ccs_diagnosis_category = adc.ccs_diagnosis_category\nwhere adi.icd_10_cm is not null or adc.ccs_diagnosis_category is not null\n),\n\n\n-- encounter_ids for encounters that are:\n--           [1] potentially planned, based on one of\n--               their CCS procedure categories or\n--               their ICD-10-PCS procedure codes\n--           [2] not acute, based on their primary diagnosis code\n--               or their CCS diagnosis category\n-- These encounters are therefore confirmed to be planned\npotentially_planned_that_are_actually_planned as (\nselect distinct ppp.encounter_id\nfrom (\n    select * from potentially_planned_px_ccs\n        union all\n    select * from potentially_planned_px_icd_10_pcs) ppp\nleft join acute_encounters\n    on ppp.encounter_id = acute_encounters.encounter_id\nwhere acute_encounters.encounter_id is null\n\n)\n\n\n-- Aggregate of all encounter_ids for planned encounters\n\nselect * , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run from always_planned_px\n\nunion distinct\n\nselect *, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run from always_planned_dx\n\nunion distinct\n\nselect *, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run from potentially_planned_that_are_actually_planned", "relation_name": "dev_tom.readmissions._int_planned_encounter"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.381126Z", "completed_at": "2024-08-23T19:21:36.402336Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.402737Z", "completed_at": "2024-08-23T19:21:36.402740Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.026089906692504883, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.cms_hcc__patient_risk_scores", "compiled": true, "compiled_code": "\nwith  __dbt__cte__cms_hcc__stg_core__member_months as (\n\nselect\n     patient_id\n    , year_month\n    , payer\n    , plan\n    , data_source\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.member_months\n), seed_adjustment_rates as (\n\n    select\n          model_version\n        , payment_year\n        , normalization_factor\n        , ma_coding_pattern_adjustment\n    from dev_tom.cms_hcc._value_set_adjustment_rates\n\n)\n\n, risk_factors as (\n\n    select\n          patient_id\n        , coefficient\n        , model_version\n        , payment_year\n    from dev_tom.cms_hcc.patient_risk_factors\n\n)\n\n, member_months as (\n\n    select\n        patient_id\n        , cast(\n  substr(year_month, 1, 4)\n as integer) as eligible_year\n        , COUNT(1) as member_months\n    from  __dbt__cte__cms_hcc__stg_core__member_months\n    group by\n        patient_id\n        , cast(\n  substr(year_month, 1, 4)\n as integer)\n)\n\n, raw_score as (\n\n    select\n          patient_id\n        , sum(coefficient) as risk_score\n        , model_version\n        , payment_year\n    from risk_factors\n    group by\n          patient_id\n        , model_version\n        , payment_year\n\n)\n\n/*\n    CMS Guidance for the transition from v24 to v28:\n\n    PY2024 risk scores will be blended using 67% of the risk score calculated\n    from v24 and 33% from v28.\n\n    PY2025 risk scores will be blended using 33% of the risk score calculated\n    from v24 and 67% from v28.\n\n    PY2026 risk scores will be 100% from v28.\n\n    Prior payment years will still be calculated from v24 only.\n*/\n, transition_scores as (\n\n    select\n          patient_id\n        , risk_score\n        , case\n            when payment_year <= 2023 and model_version = 'CMS-HCC-V24' then risk_score\n            when payment_year = 2024 and model_version = 'CMS-HCC-V24' then risk_score * 0.67\n            when payment_year = 2025 and model_version = 'CMS-HCC-V24' then risk_score * 0.33\n            when payment_year >= 2026 and model_version = 'CMS-HCC-V24' then 0\n            end as v24_risk_score\n        , case\n            when payment_year <= 2023 and model_version = 'CMS-HCC-V28' then 0\n            when payment_year = 2024 and model_version = 'CMS-HCC-V28' then risk_score * 0.33\n            when payment_year = 2025 and model_version = 'CMS-HCC-V28' then risk_score * 0.67\n            when payment_year >= 2026 and model_version = 'CMS-HCC-V28' then risk_score\n            end as v28_risk_score\n        , model_version\n        , payment_year\n    from raw_score\n\n)\n\n/*\n    Grouping by patient to create a single row per patient.\n*/\n, transition_scores_grouped as (\n\n    select\n          patient_id\n        , max(v24_risk_score) as v24_risk_score\n        , max(v28_risk_score) as v28_risk_score\n        , payment_year\n    from transition_scores\n    group by\n          patient_id\n        , payment_year\n\n)\n\n, blended as (\n\n    select\n          patient_id\n        , v24_risk_score\n        , v28_risk_score\n        , v24_risk_score + v28_risk_score as blended_risk_score\n        , payment_year\n    from transition_scores_grouped\n\n)\n\n, normalized as (\n\n    select\n          blended.patient_id\n        , blended.v24_risk_score\n        , blended.v28_risk_score\n        , blended.blended_risk_score\n        , blended.blended_risk_score / seed_adjustment_rates.normalization_factor as normalized_risk_score\n        , blended.payment_year\n    from blended\n        left join seed_adjustment_rates\n            on blended.payment_year = seed_adjustment_rates.payment_year\n\n)\n\n, payment as (\n\n    select\n          normalized.patient_id\n        , normalized.v24_risk_score\n        , normalized.v28_risk_score\n        , normalized.blended_risk_score\n        , normalized.normalized_risk_score\n        , normalized.normalized_risk_score * (1 - seed_adjustment_rates.ma_coding_pattern_adjustment) as payment_risk_score\n        , normalized.payment_year\n    from normalized\n        left join seed_adjustment_rates\n            on normalized.payment_year = seed_adjustment_rates.payment_year\n\n)\n\n, weighted_score as (\n\n    select\n        payment.patient_id\n        , payment.v24_risk_score\n        , payment.v28_risk_score\n        , payment.blended_risk_score\n        , payment.normalized_risk_score\n        , payment.payment_risk_score\n        , member_months.member_months\n        , payment.payment_risk_score * member_months.member_months as payment_risk_score_weighted_by_months\n        , payment.payment_year\n    from payment\n    left join member_months\n            on payment.patient_id = member_months.patient_id\n            and payment.payment_year = member_months.eligible_year\n)\n\n, add_data_types as (\n\n    select\n          cast(patient_id as TEXT) as patient_id\n        , round(cast(v24_risk_score as numeric(28,6)),3) as v24_risk_score\n        , round(cast(v28_risk_score as numeric(28,6)),3) as v28_risk_score\n        , round(cast(blended_risk_score as numeric(28,6)),3) as blended_risk_score\n        , round(cast(normalized_risk_score as numeric(28,6)),3) as normalized_risk_score\n        , round(cast(payment_risk_score as numeric(28,6)),3) as payment_risk_score\n        , round(cast(payment_risk_score_weighted_by_months as numeric(28,6)),3) as payment_risk_score_weighted_by_months\n        , cast(member_months as integer) as member_months\n        , cast(payment_year as integer) as payment_year\n    from weighted_score\n\n)\n\nselect\n      patient_id\n    , v24_risk_score\n    , v28_risk_score\n    , blended_risk_score\n    , normalized_risk_score\n    , payment_risk_score\n    , payment_risk_score_weighted_by_months\n    , member_months\n    , payment_year\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.cms_hcc.patient_risk_scores"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.405452Z", "completed_at": "2024-08-23T19:21:36.409833Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.410003Z", "completed_at": "2024-08-23T19:21:36.410006Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.00608062744140625, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.mart_review__patient_risk_factors", "compiled": true, "compiled_code": "\n\nselect *\n,dense_rank() over (order by patient_id, model_version, payment_year ) as patient_risk_sk\nfrom dev_tom.cms_hcc.patient_risk_factors p", "relation_name": "dev_tom.data_quality.mart_review__patient_risk_factors"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.406858Z", "completed_at": "2024-08-23T19:21:36.410260Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.410643Z", "completed_at": "2024-08-23T19:21:36.410646Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.006547212600708008, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.hcc_suspecting__list_rollup", "compiled": true, "compiled_code": "\n\nwith list as (\n\n    select\n          patient_id\n        , data_source\n        , hcc_code\n        , hcc_description\n        , reason\n        , contributing_factor\n        , suspect_date\n        , row_number() over (\n            partition by\n                  patient_id\n                , hcc_code\n            order by suspect_date desc\n          ) as row_num\n    from dev_tom.hcc_suspecting.list\n\n)\n\n, list_dedupe as (\n\n    select\n          patient_id\n        , hcc_code\n        , hcc_description\n        , reason\n        , contributing_factor\n        , suspect_date as latest_suspect_date\n    from list\n    where row_num = 1\n\n)\n\n, add_data_types as (\n\n    select\n          cast(patient_id as TEXT) as patient_id\n        , cast(hcc_code as TEXT) as hcc_code\n        , cast(hcc_description as TEXT) as hcc_description\n        , cast(reason as TEXT) as reason\n        , cast(contributing_factor as TEXT) as contributing_factor\n        , cast(latest_suspect_date as date) as latest_suspect_date\n    from list_dedupe\n\n)\n\nselect\n      patient_id\n    , hcc_code\n    , hcc_description\n    , reason\n    , contributing_factor\n    , latest_suspect_date\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.hcc_suspecting.list_rollup"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.411610Z", "completed_at": "2024-08-23T19:21:36.421490Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.421698Z", "completed_at": "2024-08-23T19:21:36.421701Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.010828018188476562, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.hcc_suspecting__summary", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__hcc_suspecting__stg_core__patient as (\n\nselect\n      patient_id\n    , sex\n    , birth_date\n    , death_date\nfrom dev_tom.core.patient\n), patients as (\n\n    select\n          patient_id\n        , sex\n        , birth_date\n        \n            , floor(datediff(\n        hour,\n        birth_date,\n        current_date\n        ) / 8766.0) as age\n        \n    from __dbt__cte__hcc_suspecting__stg_core__patient\n    where death_date is null\n\n)\n\n, suspecting_list as (\n\n      select\n          patient_id\n        , count(*) as gaps\n    from dev_tom.hcc_suspecting.list\n    group by patient_id\n\n)\n\n, joined as (\n\n    select\n          patients.patient_id\n        , patients.sex\n        , patients.birth_date\n        , patients.age\n        , suspecting_list.gaps\n    from patients\n         inner join suspecting_list\n         on patients.patient_id = suspecting_list.patient_id\n\n)\n\n, add_data_types as (\n\n    select\n          cast(patient_id as TEXT) as patient_id\n        , cast(sex as TEXT) as patient_sex\n        , cast(birth_date as date) as patient_birth_date\n        , cast(age as integer) as patient_age\n        , cast(gaps as integer) as suspecting_gaps\n    from joined\n\n)\n\nselect\n      patient_id\n    , patient_sex\n    , patient_birth_date\n    , patient_age\n    , suspecting_gaps\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.hcc_suspecting.summary"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.419238Z", "completed_at": "2024-08-23T19:21:36.421964Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.422347Z", "completed_at": "2024-08-23T19:21:36.422349Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.010941028594970703, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.ahrq_measures__int_pqi_01_num", "compiled": true, "compiled_code": "\n\nselect\n    e.data_source\n  , e.patient_id\n  , e.year_number\n  , e.encounter_id\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ahrq_measures._stg_pqi_inpatient_encounter as e\ninner join dev_tom.ahrq_measures._value_set_pqi as pqi\n  on e.primary_diagnosis_code = pqi.code\n  and pqi.value_set_name = 'diabetes_with_short-term_complications_diagnosis_codes'\n  and pqi.pqi_number = '01'\ninner join dev_tom.ahrq_measures._int_pqi_01_denom as denom\n  on e.patient_id = denom.patient_id\n  and e.data_source = denom.data_source\n  and e.year_number = denom.year_number\nleft join dev_tom.ahrq_measures._int_pqi_01_exclusions as shared\n  on e.encounter_id = shared.encounter_id\n  and e.data_source = shared.data_source\nwhere shared.encounter_id is null", "relation_name": "dev_tom.ahrq_measures._int_pqi_01_num"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.423370Z", "completed_at": "2024-08-23T19:21:36.428947Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.429118Z", "completed_at": "2024-08-23T19:21:36.429121Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.006541728973388672, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.ahrq_measures__int_pqi_03_num", "compiled": true, "compiled_code": "\n\nselect\n    e.data_source\n  , e.patient_id\n  , e.year_number\n  , e.encounter_id\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ahrq_measures._stg_pqi_inpatient_encounter as e\ninner join dev_tom.ahrq_measures._value_set_pqi as pqi\n  on e.primary_diagnosis_code = pqi.code\n  and pqi.value_set_name = 'diabetes_with_long-term_complications_diagnosis_codes'\n  and pqi.pqi_number = '03'\ninner join dev_tom.ahrq_measures._int_pqi_03_denom as denom\n  on e.patient_id = denom.patient_id\n  and e.data_source = denom.data_source\n  and e.year_number = denom.year_number\nleft join dev_tom.ahrq_measures._int_pqi_03_exclusions as shared\n  on e.encounter_id = shared.encounter_id\n  and e.data_source = shared.data_source\nwhere shared.encounter_id is null", "relation_name": "dev_tom.ahrq_measures._int_pqi_03_num"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.426712Z", "completed_at": "2024-08-23T19:21:36.429573Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.429916Z", "completed_at": "2024-08-23T19:21:36.429918Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.006755828857421875, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.ahrq_measures__int_pqi_05_num", "compiled": true, "compiled_code": "\n\nselect\n    e.data_source\n  , e.patient_id\n  , e.year_number\n  , e.encounter_id\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ahrq_measures._stg_pqi_inpatient_encounter as e\ninner join dev_tom.ahrq_measures._int_pqi_05_denom as denom\n  on e.patient_id = denom.patient_id\n  and e.data_source = denom.data_source\n  and e.year_number = denom.year_number\nleft join dev_tom.ahrq_measures._value_set_pqi as copd\n  on e.primary_diagnosis_code = copd.code\n  and copd.value_set_name = 'chronic_obstructive_pulmonary_disorder'\n  and copd.pqi_number = '05'\nleft join dev_tom.ahrq_measures._value_set_pqi asthma\n  on e.primary_diagnosis_code = asthma.code\n  and asthma.value_set_name = 'asthma'\n  and asthma.pqi_number = '05'\nleft join dev_tom.ahrq_measures._int_pqi_05_exclusions as shared\n  on e.encounter_id = shared.encounter_id\n  and e.data_source = shared.data_source\nwhere shared.encounter_id is null\n  and (\n    asthma.code is not null \n    or copd.code is not null\n    )", "relation_name": "dev_tom.ahrq_measures._int_pqi_05_num"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.430587Z", "completed_at": "2024-08-23T19:21:36.435215Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.435394Z", "completed_at": "2024-08-23T19:21:36.435397Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.005694150924682617, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.ahrq_measures__int_pqi_07_num", "compiled": true, "compiled_code": "\n\nselect\n    e.data_source\n  , e.patient_id\n  , e.year_number\n  , e.encounter_id\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ahrq_measures._stg_pqi_inpatient_encounter as e\ninner join dev_tom.ahrq_measures._value_set_pqi as hyp\n  on e.primary_diagnosis_code = hyp.code\n  and hyp.value_set_name = 'hypertension_diagnosis_codes'\n  and hyp.pqi_number = '07'\ninner join dev_tom.ahrq_measures._int_pqi_07_denom as denom\n  on e.patient_id = denom.patient_id\n  and e.data_source = denom.data_source\n  and e.year_number = denom.year_number\nleft join dev_tom.ahrq_measures._int_pqi_07_exclusions as shared\n  on e.encounter_id = shared.encounter_id\n  and e.data_source = shared.data_source\nwhere shared.encounter_id is null", "relation_name": "dev_tom.ahrq_measures._int_pqi_07_num"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.433086Z", "completed_at": "2024-08-23T19:21:36.435855Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.436192Z", "completed_at": "2024-08-23T19:21:36.436194Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.0035161972045898438, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.ahrq_measures__int_pqi_08_num", "compiled": true, "compiled_code": "\n\nselect\n    e.data_source\n  , e.patient_id\n  , e.year_number\n  , e.encounter_id\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ahrq_measures._stg_pqi_inpatient_encounter as e\ninner join dev_tom.ahrq_measures._value_set_pqi as hyp\n  on e.primary_diagnosis_code = hyp.code\n  and hyp.value_set_name = 'heart_failure_diagnosis_codes'\n  and hyp.pqi_number = '08'\ninner join dev_tom.ahrq_measures._int_pqi_08_denom as denom\n  on e.patient_id = denom.patient_id\n  and e.data_source = denom.data_source\n  and e.year_number = denom.year_number\nleft join dev_tom.ahrq_measures._int_pqi_08_exclusions as shared\n  on e.encounter_id = shared.encounter_id\n  and e.data_source = shared.data_source\nwhere shared.encounter_id is null", "relation_name": "dev_tom.ahrq_measures._int_pqi_08_num"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.436780Z", "completed_at": "2024-08-23T19:21:36.441323Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.441499Z", "completed_at": "2024-08-23T19:21:36.441502Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.00551605224609375, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.ahrq_measures__int_pqi_11_num", "compiled": true, "compiled_code": "\n\nselect\n    e.data_source\n  , e.patient_id\n  , e.year_number\n  , e.encounter_id\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ahrq_measures._stg_pqi_inpatient_encounter as e\ninner join dev_tom.ahrq_measures._value_set_pqi as hyp\n  on e.primary_diagnosis_code = hyp.code\n  and hyp.value_set_name = 'community_acquired_bacterial_pneumonia_diagnosis_codes'\n  and hyp.pqi_number = '11'\ninner join dev_tom.ahrq_measures._int_pqi_11_denom as denom\n  on e.patient_id = denom.patient_id\n  and e.data_source = denom.data_source\n  and e.year_number = denom.year_number\nleft join dev_tom.ahrq_measures._int_pqi_11_exclusions as shared\n  on e.encounter_id = shared.encounter_id\n  and e.data_source = shared.data_source\nwhere shared.encounter_id is null", "relation_name": "dev_tom.ahrq_measures._int_pqi_11_num"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.439231Z", "completed_at": "2024-08-23T19:21:36.442126Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.442427Z", "completed_at": "2024-08-23T19:21:36.442430Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.0035810470581054688, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.ahrq_measures__int_pqi_12_num", "compiled": true, "compiled_code": "\n\nselect\n    e.data_source\n  , e.patient_id\n  , e.year_number\n  , e.encounter_id\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ahrq_measures._stg_pqi_inpatient_encounter as e\ninner join dev_tom.ahrq_measures._value_set_pqi as hyp\n  on e.primary_diagnosis_code = hyp.code\n  and hyp.value_set_name = 'urinary_tract_infection_diagnosis_codes'\n  and hyp.pqi_number = '12'\ninner join dev_tom.ahrq_measures._int_pqi_12_denom as denom\n  on e.patient_id = denom.patient_id\n  and e.data_source = denom.data_source\n  and e.year_number = denom.year_number\nleft join dev_tom.ahrq_measures._int_pqi_12_exclusions as shared\n  on e.encounter_id = shared.encounter_id\n  and e.data_source = shared.data_source\nwhere shared.encounter_id is null", "relation_name": "dev_tom.ahrq_measures._int_pqi_12_num"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.442673Z", "completed_at": "2024-08-23T19:21:36.447303Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.447491Z", "completed_at": "2024-08-23T19:21:36.447493Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.005566120147705078, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.ahrq_measures__int_pqi_14_num", "compiled": true, "compiled_code": "\n\nselect\n    e.data_source\n  , e.patient_id\n  , e.year_number\n  , e.encounter_id\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ahrq_measures._stg_pqi_inpatient_encounter as e\ninner join dev_tom.ahrq_measures._value_set_pqi as hyp\n  on e.primary_diagnosis_code = hyp.code\n  and hyp.value_set_name = 'uncontrolled_diabetes_diagnosis_codes'\n  and hyp.pqi_number = '14'\ninner join dev_tom.ahrq_measures._int_pqi_14_denom as denom\n  on e.patient_id = denom.patient_id\n  and e.data_source = denom.data_source\n  and e.year_number = denom.year_number\nleft join dev_tom.ahrq_measures._int_pqi_14_exclusions as shared\n  on e.encounter_id = shared.encounter_id\n  and e.data_source = shared.data_source\nwhere shared.encounter_id is null", "relation_name": "dev_tom.ahrq_measures._int_pqi_14_num"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.445271Z", "completed_at": "2024-08-23T19:21:36.448104Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.448404Z", "completed_at": "2024-08-23T19:21:36.448406Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.003493785858154297, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.ahrq_measures__int_pqi_15_num", "compiled": true, "compiled_code": "\n\nselect\n    e.data_source\n  , e.patient_id\n  , e.year_number\n  , e.encounter_id\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ahrq_measures._stg_pqi_inpatient_encounter as e\ninner join dev_tom.ahrq_measures._value_set_pqi as hyp\n  on e.primary_diagnosis_code = hyp.code\n  and hyp.value_set_name = 'asthma_diagnosis_codes'\n  and hyp.pqi_number = '15'\ninner join dev_tom.ahrq_measures._int_pqi_15_denom as denom\n  on e.patient_id = denom.patient_id\n  and e.data_source = denom.data_source\n  and e.year_number = denom.year_number\nleft join dev_tom.ahrq_measures._int_pqi_15_exclusions as shared\n  on e.encounter_id = shared.encounter_id\n  and e.data_source = shared.data_source\nwhere shared.encounter_id is null", "relation_name": "dev_tom.ahrq_measures._int_pqi_15_num"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.448645Z", "completed_at": "2024-08-23T19:21:36.469095Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.525507Z", "completed_at": "2024-08-23T19:21:36.525513Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.07761979103088379, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.ahrq_measures__int_pqi_16_num", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__ahrq_measures__stg_pqi_condition as (\n\n\nselect \n    normalized_code_type\n  , normalized_code\n  , encounter_id\n  , data_source\nfrom \n    dev_tom.core.condition\n),  __dbt__cte__ahrq_measures__stg_pqi_procedure as (\n\n\nselect \n    normalized_code_type\n  , normalized_code\n  , encounter_id\n  , data_source\nfrom \n    dev_tom.core.procedure\n), diagnosis as (\n    select distinct\n        c.encounter_id\n      , c.data_source\n    from __dbt__cte__ahrq_measures__stg_pqi_condition as c\n    inner join dev_tom.ahrq_measures._value_set_pqi as pqi\n      on c.normalized_code = pqi.code\n      and c.normalized_code_type = 'icd-10-cm'\n      and pqi.value_set_name = 'diabetes_diagnosis_codes'\n      and pqi_number = '16'\n    where c.encounter_id is not null\n),\n\n\nprocedures as (\n    select distinct\n        p.encounter_id\n      , p.data_source\n    from __dbt__cte__ahrq_measures__stg_pqi_procedure as p\n    inner join diagnosis as d \n      on p.encounter_id = d.encounter_id\n      and d.data_source = p.data_source\n    inner join dev_tom.ahrq_measures._value_set_pqi as pqi\n      on p.normalized_code = pqi.code\n      and p.normalized_code_type = 'icd-10-pcs'\n      and pqi.value_set_name = 'lower-extremity_amputation_procedure_codes'\n      and pqi_number = '16'\n)\n\nselect\n    e.data_source\n  , e.patient_id\n  , e.year_number\n  , e.encounter_id\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ahrq_measures._stg_pqi_inpatient_encounter as e\ninner join dev_tom.ahrq_measures._int_pqi_16_denom as denom \n  on e.patient_id = denom.patient_id\n  and e.data_source = denom.data_source\n  and e.year_number = denom.year_number\n    inner join procedures as p\n  on e.encounter_id = p.encounter_id\n  and e.data_source = p.data_source\nleft join dev_tom.ahrq_measures._int_pqi_16_exclusions as shared\n  on e.encounter_id = shared.encounter_id\n  and e.data_source = shared.data_source\nwhere shared.encounter_id is null", "relation_name": "dev_tom.ahrq_measures._int_pqi_16_num"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.538292Z", "completed_at": "2024-08-23T19:21:36.549493Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.549954Z", "completed_at": "2024-08-23T19:21:36.549957Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.09274506568908691, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.ahrq_measures__pqi_exclusion_long", "compiled": true, "compiled_code": "\n\nselect\n    e.data_source\n  , e.encounter_id\n  , e.exclusion_reason\n  , e.exclusion_number\n  , 1 as pqi_number\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ahrq_measures._int_pqi_01_exclusions as e\n\nunion all\n\nselect\n    e.data_source\n  , e.encounter_id\n  , e.exclusion_reason\n  , e.exclusion_number\n  , 3 as pqi_number\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ahrq_measures._int_pqi_03_exclusions as e\n\nunion all\n\nselect\n    e.data_source\n  , e.encounter_id\n  , e.exclusion_reason\n  , e.exclusion_number\n  , 5 as pqi_number\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ahrq_measures._int_pqi_05_exclusions as e\n\nunion all\n\nselect\n    e.data_source\n  , e.encounter_id\n  , e.exclusion_reason\n  , e.exclusion_number\n  , 7 as pqi_number\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ahrq_measures._int_pqi_07_exclusions as e\n\nunion all\n\nselect\n    e.data_source\n  , e.encounter_id\n  , e.exclusion_reason\n  , e.exclusion_number\n  , 8 as pqi_number\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ahrq_measures._int_pqi_08_exclusions as e\n\nunion all\n\nselect\n    e.data_source\n  , e.encounter_id\n  , e.exclusion_reason\n  , e.exclusion_number\n  , 11 as pqi_number\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ahrq_measures._int_pqi_11_exclusions as e\n\nunion all\n\nselect\n    e.data_source\n  , e.encounter_id\n  , e.exclusion_reason\n  , e.exclusion_number\n  , 12 as pqi_number\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ahrq_measures._int_pqi_12_exclusions as e\n\nunion all\n\nselect\n    e.data_source\n  , e.encounter_id\n  , e.exclusion_reason\n  , e.exclusion_number\n  , 14 as pqi_number\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ahrq_measures._int_pqi_14_exclusions as e\n\nunion all\n\nselect\n    e.data_source\n  , e.encounter_id\n  , e.exclusion_reason\n  , e.exclusion_number\n  , 15 as pqi_number\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ahrq_measures._int_pqi_15_exclusions as e\n\nunion all\n\nselect\n    e.data_source\n  , e.encounter_id\n  , e.exclusion_reason\n  , e.exclusion_number\n  , 16 as pqi_number\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ahrq_measures._int_pqi_16_exclusions as e", "relation_name": "dev_tom.ahrq_measures.pqi_exclusion_long"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.546280Z", "completed_at": "2024-08-23T19:21:36.549800Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.550607Z", "completed_at": "2024-08-23T19:21:36.550611Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.005253791809082031, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.mart_review__ed_classification", "compiled": true, "compiled_code": "\n\nWITH cte AS\n(\n    SELECT DISTINCT location_id, npi, name\n    FROM dev_tom.core.location\n)\n\nSELECT\n    e.encounter_id,\n    case when s.encounter_id is null then 'Not Classified' else s.ed_classification_description end as ed_classification_description,\n    CASE\n        when s.encounter_id is null then 'Non-Avoidable'\n        when cast(s.ed_classification_order as int) <= 3 then s.ed_classification_description\n        ELSE 'Non-Avoidable' END AS avoidable_category,\n    e.paid_amount,\n    e.primary_diagnosis_code,\n    e.primary_diagnosis_description,\n    e.primary_diagnosis_code || ' | ' || e.primary_diagnosis_description as primary_diagnosis_and_description,\n    p.ccsr_parent_category,\n    p.ccsr_category,\n    p.ccsr_category_description,\n    p.ccsr_category || ' | ' || p.ccsr_category_description as ccsr_parent_category_and_description,\n    b.body_system,\n    e.facility_id,\n    e.allowed_amount,\n    e.charge_amount,\n    e.data_source,\n    e.length_of_stay,\n    e.discharge_disposition_code || ' | ' || e.discharge_disposition_description as discharge_code_and_description,\n    e.patient_id || ' | ' || e.data_source as patient_source_key,\n    e.facility_name,\n    e.encounter_start_date\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.encounter e\nleft join dev_tom.ed_classification.summary s on e.encounter_id = s.encounter_id\nleft join cte on e.facility_id = cte.location_id\nleft join dev_tom.ccsr.dx_vertical_pivot as p\n  on e.primary_diagnosis_code = p.code\n  and p.ccsr_category_rank = 1\nleft join dev_tom.ccsr._value_set_dxccsr_v2023_1_body_systems b on p.ccsr_parent_category = b.ccsr_parent_category\nwhere e.encounter_type = 'emergency department'", "relation_name": "dev_tom.data_quality.mart_review__ed_classification"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.552491Z", "completed_at": "2024-08-23T19:21:36.558693Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.558873Z", "completed_at": "2024-08-23T19:21:36.558877Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.0072481632232666016, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_cqm236_long", "compiled": true, "compiled_code": "\n\nwith denominator as (\n\n    select\n          patient_id\n        , performance_period_begin\n        , performance_period_end\n        , measure_id\n        , measure_name\n        , measure_version\n        , denominator_flag\n    from dev_tom.quality_measures._int_cqm236_denominator\n\n)\n\n, numerator as (\n\n    select\n          patient_id\n        , observation_date\n    from dev_tom.quality_measures._int_cqm236_numerator\n    where numerator_flag = 1\n\n)\n\n, exclusions as (\n\n    select\n          patient_id\n        , exclusion_date\n        , exclusion_reason\n    from dev_tom.quality_measures._int_cqm236_exclusions\n\n)\n\n, measure_flags as (\n\n    select\n          denominator.patient_id\n        , case\n            when denominator.patient_id is not null\n            then 1\n            else null\n          end as denominator_flag\n        , case\n            when numerator.patient_id is not null and denominator.patient_id is not null\n            then 1\n            when denominator.patient_id is not null\n            then 0\n            else null\n          end as numerator_flag\n        , case\n            when exclusions.patient_id is not null and denominator.patient_id is not null\n            then 1\n            when denominator.patient_id is not null\n            then 0\n            else null\n          end as exclusion_flag\n        , numerator.observation_date\n        , exclusions.exclusion_date\n        , exclusions.exclusion_reason\n        , denominator.performance_period_begin\n        , denominator.performance_period_end\n        , denominator.measure_id\n        , denominator.measure_name\n        , denominator.measure_version\n        , (row_number() over(\n            partition by\n                  denominator.patient_id\n                , denominator.performance_period_begin\n                , denominator.performance_period_end\n                , denominator.measure_id\n                , denominator.measure_name\n              order by\n                  case when numerator.observation_date is null then 1 else 0 end,\n                  numerator.observation_date desc\n                , case when exclusions.exclusion_date is null then 1 else 0 end,\n                  exclusions.exclusion_date desc\n          )) as rn\n    from denominator\n        left join numerator\n            on denominator.patient_id = numerator.patient_id\n        left join exclusions\n            on denominator.patient_id = exclusions.patient_id\n\n)\n\n/*\n    Deduplicate measure rows by latest evidence date or exclusion date\n*/\n, deduped as (\n\n    select\n          patient_id\n        , denominator_flag\n        , numerator_flag\n        , exclusion_flag\n        , observation_date\n        , exclusion_date\n        , exclusion_reason\n        , performance_period_begin\n        , performance_period_end\n        , measure_id\n        , measure_name\n        , measure_version\n    from measure_flags\n    where rn = 1\n\n)\n\n, add_data_types as (\n\n    select\n          cast(patient_id as TEXT) as patient_id\n        , cast(denominator_flag as integer) as denominator_flag\n        , cast(numerator_flag as integer) as numerator_flag\n        , cast(exclusion_flag as integer) as exclusion_flag\n        , cast(observation_date as date) as evidence_date\n        , cast(exclusion_date as date) as exclusion_date\n        , cast(exclusion_reason as TEXT) as exclusion_reason\n        , cast(performance_period_begin as date) as performance_period_begin\n        , cast(performance_period_end as date) as performance_period_end\n        , cast(measure_id as TEXT) as measure_id\n        , cast(measure_name as TEXT) as measure_name\n        , cast(measure_version as TEXT) as measure_version\n    from deduped\n\n)\n\nselect\n      patient_id\n    , denominator_flag\n    , numerator_flag\n    , exclusion_flag\n    , evidence_date\n    , cast(null as TEXT) as evidence_value\n    , exclusion_date\n    , exclusion_reason\n    , performance_period_begin\n    , performance_period_end\n    , measure_id\n    , measure_name\n    , measure_version\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.quality_measures._int_cqm236_long"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.556086Z", "completed_at": "2024-08-23T19:21:36.559141Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.559496Z", "completed_at": "2024-08-23T19:21:36.559499Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0076181888580322266, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_nqf0053_exclusions", "compiled": true, "compiled_code": "\n\nwith\n\ncombined_exclusions as (\n\n  select\n      exclusions.*\n    , denominator.age\n  from dev_tom.quality_measures._int_nqf0053_exclusions_stage_1 as exclusions\n  inner join dev_tom.quality_measures._int_nqf0053_denominator as denominator\n      on exclusions.patient_id = denominator.patient_id\n\n)\n\n, valid_exclusions as (\n\n    select\n        *\n    from combined_exclusions\n    where exclusion_type = 'institutional_snp'\n    and age >= 66\n\n    union all\n\n    select\n        *\n    from combined_exclusions\n    where exclusion_type in\n    (\n        'advanced_illness'\n      , 'dementia'\n    )\n    and age between 66 and 80\n\n    union all\n\n    select\n      *\n    from combined_exclusions\n    where exclusion_type = 'measure specific exclusion for defined window'\n    and age >= 81\n\n    union all\n\n    select\n        *\n    from combined_exclusions\n    where exclusion_type in\n    (\n        'measure specific exclusion for procedure medication'\n      , 'hospice_palliative'\n    )\n\n)\n\n\n, add_data_types as (\n\n    select\n        distinct\n          cast(patient_id as TEXT) as patient_id\n        , cast(exclusion_date as date) as exclusion_date\n        , cast(exclusion_reason as TEXT) as exclusion_reason\n        , 1 as exclusion_flag\n    from valid_exclusions\n\n)\n\nselect\n      patient_id\n    , exclusion_date\n    , exclusion_reason\n    , exclusion_flag\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.quality_measures._int_nqf0053_exclusions"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.560480Z", "completed_at": "2024-08-23T19:21:36.565946Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.566107Z", "completed_at": "2024-08-23T19:21:36.566110Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.0063741207122802734, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_nqf2372_long", "compiled": true, "compiled_code": "\n\nwith denominator as (\n\n    select\n          patient_id\n        , performance_period_begin\n        , performance_period_end\n        , measure_id\n        , measure_name\n        , measure_version\n        , denominator_flag\n    from dev_tom.quality_measures._int_nqf2372_denominator\n\n)\n\n, numerator as (\n\n    select\n          patient_id\n        , evidence_date\n        , numerator_flag\n    from dev_tom.quality_measures._int_nqf2372_numerator\n\n)\n\n, exclusions as (\n\n    select\n          patient_id\n        , exclusion_date\n        , exclusion_reason\n        , exclusion_flag\n    from dev_tom.quality_measures._int_nqf2372_exclusions\n\n)\n\n, measure_flags as (\n\n    select\n          denominator.patient_id\n        , case\n            when denominator.patient_id is not null\n            then denominator.denominator_flag\n            else null\n          end as denominator_flag\n        , case\n            when numerator.patient_id is not null\n            then numerator.numerator_flag\n            else null\n          end as numerator_flag\n        , case\n            when exclusions.patient_id is not null\n            then exclusions.exclusion_flag\n            else null\n          end as exclusion_flag\n        , numerator.evidence_date\n        , exclusions.exclusion_date\n        , exclusions.exclusion_reason\n        , denominator.performance_period_begin\n        , denominator.performance_period_end\n        , denominator.measure_id\n        , denominator.measure_name\n        , denominator.measure_version\n    from denominator\n        left join numerator\n            on denominator.patient_id = numerator.patient_id\n        left join exclusions\n            on denominator.patient_id = exclusions.patient_id\n\n)\n\n/*\n    Deduplicate measure rows by latest evidence date or exclusion date\n*/\n, add_rownum as (\n\n    select\n          patient_id\n        , denominator_flag\n        , numerator_flag\n        , exclusion_flag\n        , evidence_date\n        , exclusion_date\n        , exclusion_reason\n        , performance_period_begin\n        , performance_period_end\n        , measure_id\n        , measure_name\n        , measure_version\n        , row_number() over(\n            partition by\n                  patient_id\n                , performance_period_begin\n                , performance_period_end\n                , measure_id\n                , measure_name\n                order by\n                    case when evidence_date is null then 1 else 0 end,\n                    evidence_date desc\n                  , case when exclusion_date is null then 1 else 0 end,\n                    exclusion_date desc\n          ) as row_num\n    from measure_flags\n\n)\n\n, deduped as (\n\n    select\n          patient_id\n        , denominator_flag\n        , numerator_flag\n        , exclusion_flag\n        , evidence_date\n        , exclusion_date\n        , exclusion_reason\n        , performance_period_begin\n        , performance_period_end\n        , measure_id\n        , measure_name\n        , measure_version\n    from add_rownum\n    where row_num = 1\n\n)\n\n, add_data_types as (\n\n    select\n          cast(patient_id as TEXT) as patient_id\n        , cast(denominator_flag as integer) as denominator_flag\n        , cast(numerator_flag as integer) as numerator_flag\n        , cast(exclusion_flag as integer) as exclusion_flag\n        , cast(evidence_date as date) as evidence_date\n        , cast(exclusion_date as date) as exclusion_date\n        , cast(exclusion_reason as TEXT) as exclusion_reason\n        , cast(performance_period_begin as date) as performance_period_begin\n        , cast(performance_period_end as date) as performance_period_end\n        , cast(measure_id as TEXT) as measure_id\n        , cast(measure_name as TEXT) as measure_name\n        , cast(measure_version as TEXT) as measure_version\n    from deduped\n\n)\n\nselect\n      patient_id\n    , denominator_flag\n    , numerator_flag\n    , exclusion_flag\n    , evidence_date\n    , cast(null as TEXT) as evidence_value\n    , exclusion_date\n    , exclusion_reason\n    , performance_period_begin\n    , performance_period_end\n    , measure_id\n    , measure_name\n    , measure_version\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.quality_measures._int_nqf2372_long"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.563706Z", "completed_at": "2024-08-23T19:21:36.566364Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.566718Z", "completed_at": "2024-08-23T19:21:36.566721Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.006448268890380859, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.readmissions__index_admission", "compiled": true, "compiled_code": "\n\n-- Here we list all index admissions for the hospital wide readmissions\n-- measure.\n-- These represent encounter_ids that meet the requirements to be an\n-- index admission for the HWR measure.\n-- These are the requirements for a hospitalization to be an index admission\n-- for the HWR measure:\n--\n--     Time Requirement: The discharge data must be at least 30 days\n--                       earlier than the last dischareg date available\n--                       in the dataset.\n-- \n--     Discharge Requirements: The patient must not be discharged to another\n--                             acute care hospital; the patient must not have\n--                             left against medical advice; and the patient\n--                             must be alive at discharge.\n--\n--     Diagnosis Requirements: Exclude encounters where based on the CCS\n--     (exclusions)            diagnosis category we know the encounter was\n--                             for medical treatment of cancer, rehabilitation,\n--                             or psychiatric reasons.\n\n\n\nselect distinct a.encounter_id, '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.readmissions._int_encounter a\ninner join dev_tom.readmissions._int_index_time_requirement b\n    on a.encounter_id = b.encounter_id\ninner join dev_tom.readmissions._int_index_discharge_requirement c\n    on a.encounter_id = c.encounter_id\nleft join dev_tom.readmissions._int_exclusion d\n    on a.encounter_id = d.encounter_id\nwhere d.encounter_id is null", "relation_name": "dev_tom.readmissions._int_index_admission"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.567710Z", "completed_at": "2024-08-23T19:21:36.570855Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.571040Z", "completed_at": "2024-08-23T19:21:36.571043Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.004088878631591797, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.mart_review__patient_risk_scores", "compiled": true, "compiled_code": "\n\n\nselect *\nfrom dev_tom.cms_hcc.patient_risk_scores p", "relation_name": "dev_tom.data_quality.mart_review__patient_risk_scores"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.569216Z", "completed_at": "2024-08-23T19:21:36.571292Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.571671Z", "completed_at": "2024-08-23T19:21:36.571674Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0041751861572265625, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.the_tuva_project.unique_cms_hcc__patient_risk_scores_patient_id.05b154e126", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    patient_id as unique_field,\n    count(*) as n_records\n\nfrom dev_tom.cms_hcc.patient_risk_scores\nwhere patient_id is not null\ngroup by patient_id\nhaving count(*) > 1\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.572659Z", "completed_at": "2024-08-23T19:21:36.580643Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.580834Z", "completed_at": "2024-08-23T19:21:36.580837Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.008920907974243164, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.mart_review__patient_risk", "compiled": true, "compiled_code": "\n\n\nWITH cte AS (\n    SELECT \n        payment_year,\n        patient_id,\n        model_version,\n        patient_risk_sk,\n        SUM(coefficient) AS risk_score\n    FROM dev_tom.data_quality.mart_review__patient_risk_factors\n    GROUP BY payment_year,\n             patient_id,\n             model_version,\n             patient_risk_sk\n)\n\nSELECT \n    CASE \n        WHEN risk_score <= 0.5 THEN '.5'\n        WHEN risk_score BETWEEN 0.5 AND 1.0 THEN '1'\n        WHEN risk_score BETWEEN 1.0 AND 1.5 THEN '1.5'\n        WHEN risk_score BETWEEN 1.5 AND 2.0 THEN '2'\n        WHEN risk_score BETWEEN 2.0 AND 2.5 THEN '2.5'\n        WHEN risk_score BETWEEN 2.5 AND 3.0 THEN '3'\n        WHEN risk_score BETWEEN 3.0 AND 3.5 THEN '3.5'\n        WHEN risk_score BETWEEN 3.5 AND 4.0 THEN '4'\n        WHEN risk_score BETWEEN 4.0 AND 4.5 THEN '4.5'\n        WHEN risk_score BETWEEN 4.5 AND 5.0 THEN '5'\n        WHEN risk_score > 5.0 THEN '5+'\n        ELSE null \n        END AS risk_score_bucket,\n        payment_year,\n        patient_id,\n        model_version,\n        patient_risk_sk,\n        risk_score\n        , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nFROM cte", "relation_name": "dev_tom.data_quality.mart_review__patient_risk"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.574635Z", "completed_at": "2024-08-23T19:21:36.581110Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.581463Z", "completed_at": "2024-08-23T19:21:36.581466Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.009013175964355469, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.ahrq_measures__pqi_num_long", "compiled": true, "compiled_code": "\n\nselect\n    n.data_source\n  , n.patient_id\n  , n.year_number\n  , n.encounter_id\n  , '01' as pqi_number\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ahrq_measures._int_pqi_01_num as n\n\nunion all\n\nselect\n    n.data_source\n  , n.patient_id\n  , n.year_number\n  , n.encounter_id\n  , '03' as pqi_number\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ahrq_measures._int_pqi_03_num as n\n\nunion all\n\nselect\n    n.data_source\n  , n.patient_id\n  , n.year_number\n  , n.encounter_id\n  , '05' as pqi_number\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ahrq_measures._int_pqi_05_num as n\n\nunion all\n\nselect\n    n.data_source\n  , n.patient_id\n  , n.year_number\n  , n.encounter_id\n  , '07' as pqi_number\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ahrq_measures._int_pqi_07_num as n\n\nunion all\n\nselect\n    n.data_source\n  , n.patient_id\n  , n.year_number\n  , n.encounter_id\n  , '08' as pqi_number\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ahrq_measures._int_pqi_08_num as n\n\nunion all\n\nselect\n    n.data_source\n  , n.patient_id\n  , n.year_number\n  , n.encounter_id\n  , '11' as pqi_number\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ahrq_measures._int_pqi_11_num as n\n\nunion all\n\nselect\n    n.data_source\n  , n.patient_id\n  , n.year_number\n  , n.encounter_id\n  , '12' as pqi_number\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ahrq_measures._int_pqi_12_num as n\n\nunion all\n\nselect\n    n.data_source\n  , n.patient_id\n  , n.year_number\n  , n.encounter_id\n  , '14' as pqi_number\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ahrq_measures._int_pqi_14_num as n\n\nunion all\n\nselect\n    n.data_source\n  , n.patient_id\n  , n.year_number\n  , n.encounter_id\n  , '15' as pqi_number\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ahrq_measures._int_pqi_15_num as n\n\nunion all\n\nselect\n    n.data_source\n  , n.patient_id\n  , n.year_number\n  , n.encounter_id\n  , '16' as pqi_number\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ahrq_measures._int_pqi_16_num as n", "relation_name": "dev_tom.ahrq_measures.pqi_num_long"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.582463Z", "completed_at": "2024-08-23T19:21:36.588880Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.589070Z", "completed_at": "2024-08-23T19:21:36.589073Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.007375955581665039, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__int_nqf0053_long", "compiled": true, "compiled_code": "\n\nwith denominator as (\n\n    select\n          patient_id\n        , performance_period_begin\n        , performance_period_end\n        , measure_id\n        , measure_name\n        , measure_version\n        , denominator_flag\n    from dev_tom.quality_measures._int_nqf0053_denominator\n\n)\n\n, numerator as (\n\n    select\n          patient_id\n        , evidence_date\n        , evidence_value\n    from dev_tom.quality_measures._int_nqf0053_numerator\n\n)\n\n, exclusions as (\n\n    select\n          patient_id\n        , exclusion_date\n        , exclusion_reason\n    from dev_tom.quality_measures._int_nqf0053_exclusions\n\n)\n\n, measure_flags as (\n\n    select\n          denominator.patient_id\n        , case\n            when denominator.patient_id is not null\n            then 1\n            else null\n          end as denominator_flag\n        , case\n            when numerator.patient_id is not null and denominator.patient_id is not null\n            then 1\n            when denominator.patient_id is not null\n            then 0\n            else null\n          end as numerator_flag\n        , case\n            when exclusions.patient_id is not null and denominator.patient_id is not null\n            then 1\n            when denominator.patient_id is not null\n            then 0\n            else null\n          end as exclusion_flag\n        , numerator.evidence_date\n        , numerator.evidence_value\n        , exclusions.exclusion_date\n        , exclusions.exclusion_reason\n        , denominator.performance_period_begin\n        , denominator.performance_period_end\n        , denominator.measure_id\n        , denominator.measure_name\n        , denominator.measure_version\n        , (row_number() over(\n            partition by\n                  denominator.patient_id\n                , denominator.performance_period_begin\n                , denominator.performance_period_end\n                , denominator.measure_id\n                , denominator.measure_name\n              order by\n                  case when numerator.evidence_date is null then 1 else 0 end,\n                  numerator.evidence_date desc\n                , case when exclusions.exclusion_date is null then 1 else 0 end,\n                  exclusions.exclusion_date desc\n          )) as rn\n    from denominator\n        left join numerator\n            on denominator.patient_id = numerator.patient_id\n        left join exclusions\n            on denominator.patient_id = exclusions.patient_id\n\n)\n\n/*\n    Deduplicate measure rows by latest evidence date or exclusion date\n*/\n, deduped as (\n\n    select\n          patient_id\n        , denominator_flag\n        , numerator_flag\n        , exclusion_flag\n        , evidence_date\n        , evidence_value\n        , exclusion_date\n        , exclusion_reason\n        , performance_period_begin\n        , performance_period_end\n        , measure_id\n        , measure_name\n        , measure_version\n    from measure_flags\n    where rn = 1\n\n)\n\n, add_data_types as (\n\n    select\n          cast(patient_id as TEXT) as patient_id\n        , cast(denominator_flag as integer) as denominator_flag\n        , cast(numerator_flag as integer) as numerator_flag\n        , cast(exclusion_flag as integer) as exclusion_flag\n        , cast(evidence_date as date) as evidence_date\n        , cast(evidence_value as TEXT) as evidence_value\n        , cast(exclusion_date as date) as exclusion_date\n        , cast(exclusion_reason as TEXT) as exclusion_reason\n        , cast(performance_period_begin as date) as performance_period_begin\n        , cast(performance_period_end as date) as performance_period_end\n        , cast(measure_id as TEXT) as measure_id\n        , cast(measure_name as TEXT) as measure_name\n        , cast(measure_version as TEXT) as measure_version\n    from deduped\n\n)\n\nselect\n      patient_id\n    , denominator_flag\n    , numerator_flag\n    , exclusion_flag\n    , evidence_date\n    , evidence_value\n    , exclusion_date\n    , exclusion_reason\n    , performance_period_begin\n    , performance_period_end\n    , measure_id\n    , measure_name\n    , measure_version\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.quality_measures._int_nqf0053_long"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.586402Z", "completed_at": "2024-08-23T19:21:36.589326Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.589698Z", "completed_at": "2024-08-23T19:21:36.589701Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0074520111083984375, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.readmissions__encounter_augmented", "compiled": true, "compiled_code": "\n\n-- Here we list all encounters from the stg_encounter model\n-- and we augment them with extra fields\n-- that are relevant for readmission measures\nselect\n    aa.encounter_id,\n    aa.patient_id,\n    aa.admit_date,\n    aa.discharge_date,\n    aa.discharge_disposition_code,\n    aa.facility_id,\n    aa.ms_drg_code,\n    aa.paid_amount,\n    datediff(\n        day,\n        aa.admit_date,\n        aa.discharge_date\n        ) as length_of_stay,\n    case\n        when bb.encounter_id is not null then 1\n\t    else 0\n    end as index_admission_flag,\n    case\n        when cc.encounter_id is not null then 1\n\t    else 0\n    end as planned_flag,\n    dd.specialty_cohort,\n    case\n        when aa.discharge_disposition_code = '20' then 1\n\t    else 0\n    end as died_flag,\n    ee.diagnosis_ccs,\n    ee.disqualified_encounter_flag,\n    ee.missing_admit_date_flag,\n    ee.missing_discharge_date_flag,\n    ee.admit_after_discharge_flag,\n    ee.missing_discharge_disposition_code_flag,\n    ee.invalid_discharge_disposition_code_flag,\n    ee.missing_primary_diagnosis_flag,\n    ee.invalid_primary_diagnosis_code_flag,\n    ee.no_diagnosis_ccs_flag,\n    ee.overlaps_with_another_encounter_flag,\n    ee.missing_ms_drg_flag,\n    ee.invalid_ms_drg_flag,\n    '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom\n    dev_tom.readmissions._int_encounter aa\n    left join dev_tom.readmissions._int_index_admission bb\n    on aa.encounter_id = bb.encounter_id\n    left join dev_tom.readmissions._int_planned_encounter cc\n    on aa.encounter_id = cc.encounter_id \n    left join dev_tom.readmissions._int_encounter_specialty_cohort dd\n    on aa.encounter_id = dd.encounter_id\n    left join dev_tom.readmissions._int_encounter_data_quality ee\n    on aa.encounter_id = ee.encounter_id", "relation_name": "dev_tom.readmissions.encounter_augmented"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.590697Z", "completed_at": "2024-08-23T19:21:36.594840Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.595025Z", "completed_at": "2024-08-23T19:21:36.595027Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.005082130432128906, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.ahrq_measures__pqi_rate", "compiled": true, "compiled_code": "\n\nwith num as (\n    select\n        data_source\n      , year_number\n      , pqi_number\n      , count(encounter_id) as num_count\n    from dev_tom.ahrq_measures.pqi_num_long\n    group by\n        data_source\n      , year_number\n      , pqi_number\n)\n\n, denom as (\n    select\n        data_source\n      , year_number\n      , pqi_number\n      , count(patient_id) as denom_count\n    from dev_tom.ahrq_measures.pqi_denom_long as d\n    group by\n        data_source\n      , year_number\n      , pqi_number\n)\n\nselect\n    d.data_source\n  , d.year_number\n  , d.pqi_number\n  , d.denom_count\n  , coalesce(num.num_count, 0) as num_count\n  , coalesce(num.num_count, 0) / d.denom_count * 100000 as rate_per_100_thousand\n  , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom denom as d\nleft join num\n    on d.pqi_number = num.pqi_number\n    and d.year_number = num.year_number\n    and d.data_source = num.data_source", "relation_name": "dev_tom.ahrq_measures.pqi_rate"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.592764Z", "completed_at": "2024-08-23T19:21:36.595275Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.595642Z", "completed_at": "2024-08-23T19:21:36.595645Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.005156040191650391, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.ahrq_measures__pqi_summary", "compiled": true, "compiled_code": "\n\nselect p.pqi_number\n , m.pqi_name\n , e.year_number\n , e.encounter_id\n , e.data_source\n , e.patient_id\n , e.facility_id\n , e.ms_drg_code\n , e.ms_drg_description\n , e.encounter_start_date\n , e.encounter_end_date\n , e.length_of_stay\n , e.paid_amount\n , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.ahrq_measures.pqi_num_long p \ninner join dev_tom.ahrq_measures._stg_pqi_inpatient_encounter e\n    on p.encounter_id = e.encounter_id\n    and p.data_source = e.data_source\ninner join dev_tom.ahrq_measures._value_set_pqi_measures m on cast(p.pqi_number as TEXT)  = m.pqi_number", "relation_name": "dev_tom.ahrq_measures.pqi_summary"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.612848Z", "completed_at": "2024-08-23T19:21:36.616333Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.616515Z", "completed_at": "2024-08-23T19:21:36.616520Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.02014899253845215, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.readmissions__readmission_summary", "compiled": true, "compiled_code": "\n\n-- Here calculate days to readmission for encounters\n-- that had a readmission and create readmission flags\n\n\n-- We create the encounter_sequence integer count\n-- which keeps track of what number of encounter each\n-- encounter is for a given patient\nwith encounter_sequence as (\nselect\n    *,\n    row_number() over(\n        partition by patient_id order by admit_date, discharge_date\n    ) as encounter_seq\nfrom dev_tom.readmissions.encounter_augmented\nwhere disqualified_encounter_flag = 0\n),\n\n\nreadmission_calc as (\nselect\n    aa.encounter_id,\n    aa.patient_id,\n    aa.admit_date,\n    aa.discharge_date,\n    aa.discharge_disposition_code,\n    aa.facility_id,\n    aa.ms_drg_code,\n    aa.paid_amount,\n    aa.length_of_stay,\n    aa.index_admission_flag,\n    aa.planned_flag,\n    aa.specialty_cohort,\n    aa.died_flag,\n    aa.diagnosis_ccs,\n    case\n        when bb.encounter_id is not null then 1\n\t    else 0\n    end as had_readmission_flag,\n    datediff(\n        day,\n        aa.discharge_date,\n        bb.admit_date\n        ) as days_to_readmit,\n    case\n        when (datediff(\n        day,\n        aa.discharge_date,\n        bb.admit_date\n        )) <= 30  then 1\n\t    else 0\n    end as readmit_30_flag,\n    case\n        when\n\t    ((datediff(\n        day,\n        aa.discharge_date,\n        bb.admit_date\n        )) <= 30) and (bb.planned_flag = 0) then 1\n\t    else 0\n    end as unplanned_readmit_30_flag,\n    bb.encounter_id as readmission_encounter_id,\n    bb.admit_date as readmission_admit_date,\n    bb.discharge_date as readmission_discharge_date,\n    bb.discharge_disposition_code as readmission_discharge_disposition_code,\n    bb.facility_id as readmission_facility,\n    bb.ms_drg_code as readmission_ms_drg,\n    bb.length_of_stay as readmission_length_of_stay,\n    bb.index_admission_flag as readmission_index_admission_flag,\n    bb.planned_flag as readmission_planned_flag,\n    bb.specialty_cohort as readmission_specialty_cohort,\n    bb.died_flag as readmission_died_flag,\n    bb.diagnosis_ccs as readmission_diagnosis_ccs,\n    '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom\n    encounter_sequence aa\n    left join encounter_sequence bb\n    on aa.patient_id = bb.patient_id\n    and aa.encounter_seq + 1 = bb.encounter_seq\n)\n\nselect *\nfrom readmission_calc", "relation_name": "dev_tom.readmissions.readmission_summary"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.617389Z", "completed_at": "2024-08-23T19:21:36.619331Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.619522Z", "completed_at": "2024-08-23T19:21:36.619525Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.002496957778930664, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.mart_review__readmissions", "compiled": true, "compiled_code": "\n\nSELECT *\nFROM dev_tom.readmissions.readmission_summary\nWHERE index_admission_flag = 1", "relation_name": "dev_tom.data_quality.mart_review__readmissions"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:35.760952Z", "completed_at": "2024-08-23T19:21:36.549295Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.549645Z", "completed_at": "2024-08-23T19:21:36.549649Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 1.003572940826416, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.chronic_conditions__cms_chronic_conditions_wide", "compiled": true, "compiled_code": "\n\nwith  __dbt__cte__cms_chronic_conditions__stg_core__patient as (\n\n\nselect \n    patient_id\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.patient\n), chronic_conditions as (\n\n    select distinct\n          condition\n        , condition_column_name\n    from dev_tom.chronic_conditions._value_set_cms_chronic_conditions_hierarchy\n\n)\n\n, conditions as (\n\n    select\n          chronic_conditions_unioned.patient_id\n        , chronic_conditions.condition_column_name\n        , 1 as condition_count\n    from dev_tom.chronic_conditions.cms_chronic_conditions_long as chronic_conditions_unioned\n         inner join chronic_conditions as chronic_conditions\n             on chronic_conditions_unioned.condition = chronic_conditions.condition\n\n)\n\nselect\n      p.patient_id\n    , \n  \n    max(\n      \n      case\n      when condition_column_name = 'acute_myocardial_infarction'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as acute_myocardial_infarction\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'adhd_conduct_disorders_and_hyperkinetic_syndrome'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as adhd_conduct_disorders_and_hyperkinetic_syndrome\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'alcohol_use_disorders'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as alcohol_use_disorders\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'alzheimers_disease'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as alzheimers_disease\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'anemia'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as anemia\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'anxiety_disorders'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as anxiety_disorders\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'asthma'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as asthma\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'atrial_fibrillation_and_flutter'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as atrial_fibrillation_and_flutter\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'autism_spectrum_disorders'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as autism_spectrum_disorders\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'benign_prostatic_hyperplasia'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as benign_prostatic_hyperplasia\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'bipolar_disorder'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as bipolar_disorder\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'cancer_breast'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as cancer_breast\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'cancer_colorectal'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as cancer_colorectal\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'cancer_endometrial'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as cancer_endometrial\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'cancer_lung'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as cancer_lung\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'cancer_prostate'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as cancer_prostate\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'cancer_urologic_kidney_renal_pelvis_and_ureter'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as cancer_urologic_kidney_renal_pelvis_and_ureter\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'cataract'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as cataract\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'cerebral_palsy'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as cerebral_palsy\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'chronic_kidney_disease'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as chronic_kidney_disease\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'chronic_obstructive_pulmonary_disease'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as chronic_obstructive_pulmonary_disease\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'cystic_fibrosis_and_other_metabolic_developmental_disorders'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as cystic_fibrosis_and_other_metabolic_developmental_disorders\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'depression_bipolar_or_other_depressive_mood_disorders'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as depression_bipolar_or_other_depressive_mood_disorders\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'depressive_disorders'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as depressive_disorders\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'diabetes'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as diabetes\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'drug_use_disorders'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as drug_use_disorders\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'epilepsy'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as epilepsy\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'fibromyalgia_and_chronic_pain_and_fatigue'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as fibromyalgia_and_chronic_pain_and_fatigue\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'glaucoma'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as glaucoma\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'heart_failure_and_non_ischemic_heart_disease'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as heart_failure_and_non_ischemic_heart_disease\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'hepatitis_a'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as hepatitis_a\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'hepatitis_b_acute_or_unspecified'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as hepatitis_b_acute_or_unspecified\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'hepatitis_b_chronic'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as hepatitis_b_chronic\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'hepatitis_c_acute'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as hepatitis_c_acute\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'hepatitis_c_chronic'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as hepatitis_c_chronic\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'hepatitis_c_unspecified'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as hepatitis_c_unspecified\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'hepatitis_d'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as hepatitis_d\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'hepatitis_e'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as hepatitis_e\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'hip_pelvic_fracture'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as hip_pelvic_fracture\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'human_immunodeficiency_virus_and_or_acquired_immunodeficiency_syndrome_hiv_aids'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as human_immunodeficiency_virus_and_or_acquired_immunodeficiency_syndrome_hiv_aids\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'hyperlipidemia'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as hyperlipidemia\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'hypertension'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as hypertension\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'hypothyroidism'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as hypothyroidism\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'intellectual_disabilities_and_related_conditions'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as intellectual_disabilities_and_related_conditions\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'ischemic_heart_disease'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as ischemic_heart_disease\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'learning_disabilities'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as learning_disabilities\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'leukemias_and_lymphomas'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as leukemias_and_lymphomas\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'liver_disease_cirrhosis_and_other_liver_conditions_except_viral_hepatitis'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as liver_disease_cirrhosis_and_other_liver_conditions_except_viral_hepatitis\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'migraine_and_chronic_headache'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as migraine_and_chronic_headache\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'mobility_impairments'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as mobility_impairments\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'multiple_sclerosis_and_transverse_myelitis'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as multiple_sclerosis_and_transverse_myelitis\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'muscular_dystrophy'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as muscular_dystrophy\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'non_alzheimers_dementia'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as non_alzheimers_dementia\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'obesity'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as obesity\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'opioid_use_disorder_oud'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as opioid_use_disorder_oud\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'osteoporosis_with_or_without_pathological_fracture'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as osteoporosis_with_or_without_pathological_fracture\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'other_developmental_delays'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as other_developmental_delays\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'parkinsons_disease_and_secondary_parkinsonism'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as parkinsons_disease_and_secondary_parkinsonism\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'peripheral_vascular_disease_pvd'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as peripheral_vascular_disease_pvd\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'personality_disorders'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as personality_disorders\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'pneumonia_all_cause'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as pneumonia_all_cause\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'post_traumatic_stress_disorder_ptsd'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as post_traumatic_stress_disorder_ptsd\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'pressure_and_chronic_ulcers'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as pressure_and_chronic_ulcers\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'rheumatoid_arthritis_osteoarthritis'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as rheumatoid_arthritis_osteoarthritis\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'schizophrenia'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as schizophrenia\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'schizophrenia_and_other_psychotic_disorders'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as schizophrenia_and_other_psychotic_disorders\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'sensory_blindness_and_visual_impairment'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as sensory_blindness_and_visual_impairment\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'sensory_deafness_and_hearing_impairment'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as sensory_deafness_and_hearing_impairment\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'sickle_cell_disease'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as sickle_cell_disease\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'spina_bifida_and_other_congenital_anomalies_of_the_nervous_system'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as spina_bifida_and_other_congenital_anomalies_of_the_nervous_system\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'spinal_cord_injury'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as spinal_cord_injury\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'stroke_transient_ischemic_attack'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as stroke_transient_ischemic_attack\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'tobacco_use'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as tobacco_use\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'traumatic_brain_injury_and_nonpsychotic_mental_disorders_due_to_brain_damage'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as traumatic_brain_injury_and_nonpsychotic_mental_disorders_due_to_brain_damage\n      \n    \n    ,\n  \n    max(\n      \n      case\n      when condition_column_name = 'viral_hepatitis_general'\n        then 1\n      else 0\n      end\n    )\n    \n      \n        as viral_hepatitis_general\n      \n    \n    \n  \n\n      , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom __dbt__cte__cms_chronic_conditions__stg_core__patient p\n     left join conditions\n        on p.patient_id = conditions.patient_id\ngroup by\n    p.patient_id", "relation_name": "dev_tom.chronic_conditions.cms_chronic_conditions_wide"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.744821Z", "completed_at": "2024-08-23T19:21:36.751448Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.751894Z", "completed_at": "2024-08-23T19:21:36.751899Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.008163213729858398, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.the_tuva_project.not_null_chronic_conditions__cms_chronic_conditions_wide_patient_id.5c2c8ae105", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect patient_id\nfrom dev_tom.chronic_conditions.cms_chronic_conditions_wide\nwhere patient_id is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.749003Z", "completed_at": "2024-08-23T19:21:36.751666Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:36.752289Z", "completed_at": "2024-08-23T19:21:36.752293Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.00825190544128418, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.the_tuva_project.unique_chronic_conditions__cms_chronic_conditions_wide_patient_id.60c2d9a586", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    patient_id as unique_field,\n    count(*) as n_records\n\nfrom dev_tom.chronic_conditions.cms_chronic_conditions_wide\nwhere patient_id is not null\ngroup by patient_id\nhaving count(*) > 1\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:36.596591Z", "completed_at": "2024-08-23T19:21:38.309288Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:38.309474Z", "completed_at": "2024-08-23T19:21:38.309479Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 1.930711030960083, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__summary_long", "compiled": true, "compiled_code": "\n\n/* measures should already be at the full eligibility population grain */\nwith  __dbt__cte__quality_measures__stg_core__patient as (\n\nselect\n      patient_id\n    , sex\n    , birth_date\n    , death_date\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom dev_tom.core.patient\n), union_measures as (\n\n    \n\n        (\n            select\n                cast('dev_tom.quality_measures._int_nqf2372_long' as TEXT) as _dbt_source_relation,\n\n                \n                    cast(\"PATIENT_ID\" as character varying(16777216)) as \"PATIENT_ID\" ,\n                    cast(\"DENOMINATOR_FLAG\" as NUMBER(38,0)) as \"DENOMINATOR_FLAG\" ,\n                    cast(\"NUMERATOR_FLAG\" as NUMBER(38,0)) as \"NUMERATOR_FLAG\" ,\n                    cast(\"EXCLUSION_FLAG\" as NUMBER(38,0)) as \"EXCLUSION_FLAG\" ,\n                    cast(\"EVIDENCE_DATE\" as DATE) as \"EVIDENCE_DATE\" ,\n                    cast(\"EVIDENCE_VALUE\" as character varying(16777216)) as \"EVIDENCE_VALUE\" ,\n                    cast(\"EXCLUSION_DATE\" as DATE) as \"EXCLUSION_DATE\" ,\n                    cast(\"EXCLUSION_REASON\" as character varying(16777216)) as \"EXCLUSION_REASON\" ,\n                    cast(\"PERFORMANCE_PERIOD_BEGIN\" as DATE) as \"PERFORMANCE_PERIOD_BEGIN\" ,\n                    cast(\"PERFORMANCE_PERIOD_END\" as DATE) as \"PERFORMANCE_PERIOD_END\" ,\n                    cast(\"MEASURE_ID\" as character varying(16777216)) as \"MEASURE_ID\" ,\n                    cast(\"MEASURE_NAME\" as character varying(16777216)) as \"MEASURE_NAME\" ,\n                    cast(\"MEASURE_VERSION\" as character varying(16777216)) as \"MEASURE_VERSION\" ,\n                    cast(\"TUVA_LAST_RUN\" as character varying(32)) as \"TUVA_LAST_RUN\" \n\n            from dev_tom.quality_measures._int_nqf2372_long\n\n            \n        )\n\n        union all\n        \n\n        (\n            select\n                cast('dev_tom.quality_measures._int_nqf0034_long' as TEXT) as _dbt_source_relation,\n\n                \n                    cast(\"PATIENT_ID\" as character varying(16777216)) as \"PATIENT_ID\" ,\n                    cast(\"DENOMINATOR_FLAG\" as NUMBER(38,0)) as \"DENOMINATOR_FLAG\" ,\n                    cast(\"NUMERATOR_FLAG\" as NUMBER(38,0)) as \"NUMERATOR_FLAG\" ,\n                    cast(\"EXCLUSION_FLAG\" as NUMBER(38,0)) as \"EXCLUSION_FLAG\" ,\n                    cast(\"EVIDENCE_DATE\" as DATE) as \"EVIDENCE_DATE\" ,\n                    cast(\"EVIDENCE_VALUE\" as character varying(16777216)) as \"EVIDENCE_VALUE\" ,\n                    cast(\"EXCLUSION_DATE\" as DATE) as \"EXCLUSION_DATE\" ,\n                    cast(\"EXCLUSION_REASON\" as character varying(16777216)) as \"EXCLUSION_REASON\" ,\n                    cast(\"PERFORMANCE_PERIOD_BEGIN\" as DATE) as \"PERFORMANCE_PERIOD_BEGIN\" ,\n                    cast(\"PERFORMANCE_PERIOD_END\" as DATE) as \"PERFORMANCE_PERIOD_END\" ,\n                    cast(\"MEASURE_ID\" as character varying(16777216)) as \"MEASURE_ID\" ,\n                    cast(\"MEASURE_NAME\" as character varying(16777216)) as \"MEASURE_NAME\" ,\n                    cast(\"MEASURE_VERSION\" as character varying(16777216)) as \"MEASURE_VERSION\" ,\n                    cast(\"TUVA_LAST_RUN\" as character varying(32)) as \"TUVA_LAST_RUN\" \n\n            from dev_tom.quality_measures._int_nqf0034_long\n\n            \n        )\n\n        union all\n        \n\n        (\n            select\n                cast('dev_tom.quality_measures._int_nqf0059_long' as TEXT) as _dbt_source_relation,\n\n                \n                    cast(\"PATIENT_ID\" as character varying(16777216)) as \"PATIENT_ID\" ,\n                    cast(\"DENOMINATOR_FLAG\" as NUMBER(38,0)) as \"DENOMINATOR_FLAG\" ,\n                    cast(\"NUMERATOR_FLAG\" as NUMBER(38,0)) as \"NUMERATOR_FLAG\" ,\n                    cast(\"EXCLUSION_FLAG\" as NUMBER(38,0)) as \"EXCLUSION_FLAG\" ,\n                    cast(\"EVIDENCE_DATE\" as DATE) as \"EVIDENCE_DATE\" ,\n                    cast(\"EVIDENCE_VALUE\" as character varying(16777216)) as \"EVIDENCE_VALUE\" ,\n                    cast(\"EXCLUSION_DATE\" as DATE) as \"EXCLUSION_DATE\" ,\n                    cast(\"EXCLUSION_REASON\" as character varying(16777216)) as \"EXCLUSION_REASON\" ,\n                    cast(\"PERFORMANCE_PERIOD_BEGIN\" as DATE) as \"PERFORMANCE_PERIOD_BEGIN\" ,\n                    cast(\"PERFORMANCE_PERIOD_END\" as DATE) as \"PERFORMANCE_PERIOD_END\" ,\n                    cast(\"MEASURE_ID\" as character varying(16777216)) as \"MEASURE_ID\" ,\n                    cast(\"MEASURE_NAME\" as character varying(16777216)) as \"MEASURE_NAME\" ,\n                    cast(\"MEASURE_VERSION\" as character varying(16777216)) as \"MEASURE_VERSION\" ,\n                    cast(\"TUVA_LAST_RUN\" as character varying(32)) as \"TUVA_LAST_RUN\" \n\n            from dev_tom.quality_measures._int_nqf0059_long\n\n            \n        )\n\n        union all\n        \n\n        (\n            select\n                cast('dev_tom.quality_measures._int_cqm236_long' as TEXT) as _dbt_source_relation,\n\n                \n                    cast(\"PATIENT_ID\" as character varying(16777216)) as \"PATIENT_ID\" ,\n                    cast(\"DENOMINATOR_FLAG\" as NUMBER(38,0)) as \"DENOMINATOR_FLAG\" ,\n                    cast(\"NUMERATOR_FLAG\" as NUMBER(38,0)) as \"NUMERATOR_FLAG\" ,\n                    cast(\"EXCLUSION_FLAG\" as NUMBER(38,0)) as \"EXCLUSION_FLAG\" ,\n                    cast(\"EVIDENCE_DATE\" as DATE) as \"EVIDENCE_DATE\" ,\n                    cast(\"EVIDENCE_VALUE\" as character varying(16777216)) as \"EVIDENCE_VALUE\" ,\n                    cast(\"EXCLUSION_DATE\" as DATE) as \"EXCLUSION_DATE\" ,\n                    cast(\"EXCLUSION_REASON\" as character varying(16777216)) as \"EXCLUSION_REASON\" ,\n                    cast(\"PERFORMANCE_PERIOD_BEGIN\" as DATE) as \"PERFORMANCE_PERIOD_BEGIN\" ,\n                    cast(\"PERFORMANCE_PERIOD_END\" as DATE) as \"PERFORMANCE_PERIOD_END\" ,\n                    cast(\"MEASURE_ID\" as character varying(16777216)) as \"MEASURE_ID\" ,\n                    cast(\"MEASURE_NAME\" as character varying(16777216)) as \"MEASURE_NAME\" ,\n                    cast(\"MEASURE_VERSION\" as character varying(16777216)) as \"MEASURE_VERSION\" ,\n                    cast(\"TUVA_LAST_RUN\" as character varying(32)) as \"TUVA_LAST_RUN\" \n\n            from dev_tom.quality_measures._int_cqm236_long\n\n            \n        )\n\n        union all\n        \n\n        (\n            select\n                cast('dev_tom.quality_measures._int_nqf0053_long' as TEXT) as _dbt_source_relation,\n\n                \n                    cast(\"PATIENT_ID\" as character varying(16777216)) as \"PATIENT_ID\" ,\n                    cast(\"DENOMINATOR_FLAG\" as NUMBER(38,0)) as \"DENOMINATOR_FLAG\" ,\n                    cast(\"NUMERATOR_FLAG\" as NUMBER(38,0)) as \"NUMERATOR_FLAG\" ,\n                    cast(\"EXCLUSION_FLAG\" as NUMBER(38,0)) as \"EXCLUSION_FLAG\" ,\n                    cast(\"EVIDENCE_DATE\" as DATE) as \"EVIDENCE_DATE\" ,\n                    cast(\"EVIDENCE_VALUE\" as character varying(16777216)) as \"EVIDENCE_VALUE\" ,\n                    cast(\"EXCLUSION_DATE\" as DATE) as \"EXCLUSION_DATE\" ,\n                    cast(\"EXCLUSION_REASON\" as character varying(16777216)) as \"EXCLUSION_REASON\" ,\n                    cast(\"PERFORMANCE_PERIOD_BEGIN\" as DATE) as \"PERFORMANCE_PERIOD_BEGIN\" ,\n                    cast(\"PERFORMANCE_PERIOD_END\" as DATE) as \"PERFORMANCE_PERIOD_END\" ,\n                    cast(\"MEASURE_ID\" as character varying(16777216)) as \"MEASURE_ID\" ,\n                    cast(\"MEASURE_NAME\" as character varying(16777216)) as \"MEASURE_NAME\" ,\n                    cast(\"MEASURE_VERSION\" as character varying(16777216)) as \"MEASURE_VERSION\" ,\n                    cast(\"TUVA_LAST_RUN\" as character varying(32)) as \"TUVA_LAST_RUN\" \n\n            from dev_tom.quality_measures._int_nqf0053_long\n\n            \n        )\n\n        union all\n        \n\n        (\n            select\n                cast('dev_tom.quality_measures._int_cbe0055_long' as TEXT) as _dbt_source_relation,\n\n                \n                    cast(\"PATIENT_ID\" as character varying(16777216)) as \"PATIENT_ID\" ,\n                    cast(\"DENOMINATOR_FLAG\" as NUMBER(38,0)) as \"DENOMINATOR_FLAG\" ,\n                    cast(\"NUMERATOR_FLAG\" as NUMBER(38,0)) as \"NUMERATOR_FLAG\" ,\n                    cast(\"EXCLUSION_FLAG\" as NUMBER(38,0)) as \"EXCLUSION_FLAG\" ,\n                    cast(\"EVIDENCE_DATE\" as DATE) as \"EVIDENCE_DATE\" ,\n                    cast(\"EVIDENCE_VALUE\" as character varying(16777216)) as \"EVIDENCE_VALUE\" ,\n                    cast(\"EXCLUSION_DATE\" as DATE) as \"EXCLUSION_DATE\" ,\n                    cast(\"EXCLUSION_REASON\" as character varying(16777216)) as \"EXCLUSION_REASON\" ,\n                    cast(\"PERFORMANCE_PERIOD_BEGIN\" as DATE) as \"PERFORMANCE_PERIOD_BEGIN\" ,\n                    cast(\"PERFORMANCE_PERIOD_END\" as DATE) as \"PERFORMANCE_PERIOD_END\" ,\n                    cast(\"MEASURE_ID\" as character varying(16777216)) as \"MEASURE_ID\" ,\n                    cast(\"MEASURE_NAME\" as character varying(16777216)) as \"MEASURE_NAME\" ,\n                    cast(\"MEASURE_VERSION\" as character varying(16777216)) as \"MEASURE_VERSION\" ,\n                    cast(\"TUVA_LAST_RUN\" as character varying(32)) as \"TUVA_LAST_RUN\" \n\n            from dev_tom.quality_measures._int_cbe0055_long\n\n            \n        )\n\n        union all\n        \n\n        (\n            select\n                cast('dev_tom.quality_measures._int_nqf0097_long' as TEXT) as _dbt_source_relation,\n\n                \n                    cast(\"PATIENT_ID\" as character varying(16777216)) as \"PATIENT_ID\" ,\n                    cast(\"DENOMINATOR_FLAG\" as NUMBER(38,0)) as \"DENOMINATOR_FLAG\" ,\n                    cast(\"NUMERATOR_FLAG\" as NUMBER(38,0)) as \"NUMERATOR_FLAG\" ,\n                    cast(\"EXCLUSION_FLAG\" as NUMBER(38,0)) as \"EXCLUSION_FLAG\" ,\n                    cast(\"EVIDENCE_DATE\" as DATE) as \"EVIDENCE_DATE\" ,\n                    cast(\"EVIDENCE_VALUE\" as character varying(16777216)) as \"EVIDENCE_VALUE\" ,\n                    cast(\"EXCLUSION_DATE\" as DATE) as \"EXCLUSION_DATE\" ,\n                    cast(\"EXCLUSION_REASON\" as character varying(16777216)) as \"EXCLUSION_REASON\" ,\n                    cast(\"PERFORMANCE_PERIOD_BEGIN\" as DATE) as \"PERFORMANCE_PERIOD_BEGIN\" ,\n                    cast(\"PERFORMANCE_PERIOD_END\" as DATE) as \"PERFORMANCE_PERIOD_END\" ,\n                    cast(\"MEASURE_ID\" as character varying(16777216)) as \"MEASURE_ID\" ,\n                    cast(\"MEASURE_NAME\" as character varying(16777216)) as \"MEASURE_NAME\" ,\n                    cast(\"MEASURE_VERSION\" as character varying(16777216)) as \"MEASURE_VERSION\" ,\n                    cast(\"TUVA_LAST_RUN\" as character varying(32)) as \"TUVA_LAST_RUN\" \n\n            from dev_tom.quality_measures._int_nqf0097_long\n\n            \n        )\n\n        union all\n        \n\n        (\n            select\n                cast('dev_tom.quality_measures._int_cqm438_long' as TEXT) as _dbt_source_relation,\n\n                \n                    cast(\"PATIENT_ID\" as character varying(16777216)) as \"PATIENT_ID\" ,\n                    cast(\"DENOMINATOR_FLAG\" as NUMBER(38,0)) as \"DENOMINATOR_FLAG\" ,\n                    cast(\"NUMERATOR_FLAG\" as NUMBER(38,0)) as \"NUMERATOR_FLAG\" ,\n                    cast(\"EXCLUSION_FLAG\" as NUMBER(38,0)) as \"EXCLUSION_FLAG\" ,\n                    cast(\"EVIDENCE_DATE\" as DATE) as \"EVIDENCE_DATE\" ,\n                    cast(\"EVIDENCE_VALUE\" as character varying(16777216)) as \"EVIDENCE_VALUE\" ,\n                    cast(\"EXCLUSION_DATE\" as DATE) as \"EXCLUSION_DATE\" ,\n                    cast(\"EXCLUSION_REASON\" as character varying(16777216)) as \"EXCLUSION_REASON\" ,\n                    cast(\"PERFORMANCE_PERIOD_BEGIN\" as DATE) as \"PERFORMANCE_PERIOD_BEGIN\" ,\n                    cast(\"PERFORMANCE_PERIOD_END\" as DATE) as \"PERFORMANCE_PERIOD_END\" ,\n                    cast(\"MEASURE_ID\" as character varying(16777216)) as \"MEASURE_ID\" ,\n                    cast(\"MEASURE_NAME\" as character varying(16777216)) as \"MEASURE_NAME\" ,\n                    cast(\"MEASURE_VERSION\" as character varying(16777216)) as \"MEASURE_VERSION\" ,\n                    cast(\"TUVA_LAST_RUN\" as character varying(32)) as \"TUVA_LAST_RUN\" \n\n            from dev_tom.quality_measures._int_cqm438_long\n\n            \n        )\n\n        union all\n        \n\n        (\n            select\n                cast('dev_tom.quality_measures._int_nqf0041_long' as TEXT) as _dbt_source_relation,\n\n                \n                    cast(\"PATIENT_ID\" as character varying(16777216)) as \"PATIENT_ID\" ,\n                    cast(\"DENOMINATOR_FLAG\" as NUMBER(38,0)) as \"DENOMINATOR_FLAG\" ,\n                    cast(\"NUMERATOR_FLAG\" as NUMBER(38,0)) as \"NUMERATOR_FLAG\" ,\n                    cast(\"EXCLUSION_FLAG\" as NUMBER(38,0)) as \"EXCLUSION_FLAG\" ,\n                    cast(\"EVIDENCE_DATE\" as DATE) as \"EVIDENCE_DATE\" ,\n                    cast(\"EVIDENCE_VALUE\" as character varying(16777216)) as \"EVIDENCE_VALUE\" ,\n                    cast(\"EXCLUSION_DATE\" as DATE) as \"EXCLUSION_DATE\" ,\n                    cast(\"EXCLUSION_REASON\" as character varying(16777216)) as \"EXCLUSION_REASON\" ,\n                    cast(\"PERFORMANCE_PERIOD_BEGIN\" as DATE) as \"PERFORMANCE_PERIOD_BEGIN\" ,\n                    cast(\"PERFORMANCE_PERIOD_END\" as DATE) as \"PERFORMANCE_PERIOD_END\" ,\n                    cast(\"MEASURE_ID\" as character varying(16777216)) as \"MEASURE_ID\" ,\n                    cast(\"MEASURE_NAME\" as character varying(16777216)) as \"MEASURE_NAME\" ,\n                    cast(\"MEASURE_VERSION\" as character varying(16777216)) as \"MEASURE_VERSION\" ,\n                    cast(\"TUVA_LAST_RUN\" as character varying(32)) as \"TUVA_LAST_RUN\" \n\n            from dev_tom.quality_measures._int_nqf0041_long\n\n            \n        )\n\n        union all\n        \n\n        (\n            select\n                cast('dev_tom.quality_measures._int_cbe0101_long' as TEXT) as _dbt_source_relation,\n\n                \n                    cast(\"PATIENT_ID\" as character varying(16777216)) as \"PATIENT_ID\" ,\n                    cast(\"DENOMINATOR_FLAG\" as NUMBER(38,0)) as \"DENOMINATOR_FLAG\" ,\n                    cast(\"NUMERATOR_FLAG\" as NUMBER(38,0)) as \"NUMERATOR_FLAG\" ,\n                    cast(\"EXCLUSION_FLAG\" as NUMBER(38,0)) as \"EXCLUSION_FLAG\" ,\n                    cast(\"EVIDENCE_DATE\" as DATE) as \"EVIDENCE_DATE\" ,\n                    cast(\"EVIDENCE_VALUE\" as character varying(16777216)) as \"EVIDENCE_VALUE\" ,\n                    cast(\"EXCLUSION_DATE\" as DATE) as \"EXCLUSION_DATE\" ,\n                    cast(\"EXCLUSION_REASON\" as character varying(16777216)) as \"EXCLUSION_REASON\" ,\n                    cast(\"PERFORMANCE_PERIOD_BEGIN\" as DATE) as \"PERFORMANCE_PERIOD_BEGIN\" ,\n                    cast(\"PERFORMANCE_PERIOD_END\" as DATE) as \"PERFORMANCE_PERIOD_END\" ,\n                    cast(\"MEASURE_ID\" as character varying(16777216)) as \"MEASURE_ID\" ,\n                    cast(\"MEASURE_NAME\" as character varying(16777216)) as \"MEASURE_NAME\" ,\n                    cast(\"MEASURE_VERSION\" as character varying(16777216)) as \"MEASURE_VERSION\" ,\n                    cast(\"TUVA_LAST_RUN\" as character varying(32)) as \"TUVA_LAST_RUN\" \n\n            from dev_tom.quality_measures._int_cbe0101_long\n\n            \n        )\n\n        union all\n        \n\n        (\n            select\n                cast('dev_tom.quality_measures._int_cqm48_long' as TEXT) as _dbt_source_relation,\n\n                \n                    cast(\"PATIENT_ID\" as character varying(16777216)) as \"PATIENT_ID\" ,\n                    cast(\"DENOMINATOR_FLAG\" as NUMBER(38,0)) as \"DENOMINATOR_FLAG\" ,\n                    cast(\"NUMERATOR_FLAG\" as NUMBER(38,0)) as \"NUMERATOR_FLAG\" ,\n                    cast(\"EXCLUSION_FLAG\" as NUMBER(38,0)) as \"EXCLUSION_FLAG\" ,\n                    cast(\"EVIDENCE_DATE\" as DATE) as \"EVIDENCE_DATE\" ,\n                    cast(\"EVIDENCE_VALUE\" as character varying(16777216)) as \"EVIDENCE_VALUE\" ,\n                    cast(\"EXCLUSION_DATE\" as DATE) as \"EXCLUSION_DATE\" ,\n                    cast(\"EXCLUSION_REASON\" as character varying(16777216)) as \"EXCLUSION_REASON\" ,\n                    cast(\"PERFORMANCE_PERIOD_BEGIN\" as DATE) as \"PERFORMANCE_PERIOD_BEGIN\" ,\n                    cast(\"PERFORMANCE_PERIOD_END\" as DATE) as \"PERFORMANCE_PERIOD_END\" ,\n                    cast(\"MEASURE_ID\" as character varying(16777216)) as \"MEASURE_ID\" ,\n                    cast(\"MEASURE_NAME\" as character varying(16777216)) as \"MEASURE_NAME\" ,\n                    cast(\"MEASURE_VERSION\" as character varying(16777216)) as \"MEASURE_VERSION\" ,\n                    cast(\"TUVA_LAST_RUN\" as character varying(32)) as \"TUVA_LAST_RUN\" \n\n            from dev_tom.quality_measures._int_cqm48_long\n\n            \n        )\n\n        \n\n)\n\n, patient as (\n\n    select distinct patient_id\n    from __dbt__cte__quality_measures__stg_core__patient\n\n)\n\n/* selecting the full patient population as the grain of this table */\n, joined as (\n\n    select distinct\n          patient.patient_id\n        , union_measures.denominator_flag\n        , union_measures.numerator_flag\n        , union_measures.exclusion_flag\n        , case\n            when union_measures.exclusion_flag = 1 then null\n            when union_measures.numerator_flag = 1 then 1\n            when union_measures.denominator_flag = 1 then 0\n            else null\n          end as performance_flag\n        , union_measures.evidence_date\n        , union_measures.evidence_value\n        , union_measures.exclusion_date\n        , union_measures.exclusion_reason\n        , union_measures.performance_period_begin\n        , union_measures.performance_period_end\n        , union_measures.measure_id\n        , union_measures.measure_name\n        , union_measures.measure_version\n    from patient\n        left join union_measures\n            on patient.patient_id = union_measures.patient_id\n)\n\n, add_data_types as (\n\n    select\n          cast(patient_id as TEXT) as patient_id\n        , cast(denominator_flag as integer) as denominator_flag\n        , cast(numerator_flag as integer) as numerator_flag\n        , cast(exclusion_flag as integer) as exclusion_flag\n        , cast(performance_flag as integer) as performance_flag\n        , cast(evidence_date as date) as evidence_date\n        , cast(evidence_value as TEXT) as evidence_value\n        , cast(exclusion_date as date) as exclusion_date\n        , cast(exclusion_reason as TEXT) as exclusion_reason\n        , cast(performance_period_begin as date) as performance_period_begin\n        , cast(performance_period_end as date) as performance_period_end\n        , cast(measure_id as TEXT) as measure_id\n        , cast(measure_name as TEXT) as measure_name\n        , cast(measure_version as TEXT) as measure_version\n    from joined\n\n)\n\nselect\n      patient_id\n    , denominator_flag\n    , numerator_flag\n    , exclusion_flag\n    , performance_flag\n    , evidence_date\n    , evidence_value\n    , exclusion_date\n    , exclusion_reason\n    , performance_period_begin\n    , performance_period_end\n    , measure_id\n    , measure_name\n    , measure_version\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.quality_measures.summary_long"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:38.533477Z", "completed_at": "2024-08-23T19:21:38.547308Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:38.547850Z", "completed_at": "2024-08-23T19:21:38.547856Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.019045114517211914, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.mart_review__quality_measures_summary_long", "compiled": true, "compiled_code": "\n\n\nselect *\nfrom dev_tom.quality_measures.summary_long s", "relation_name": "dev_tom.data_quality.mart_review__quality_measures_summary_long"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:38.537569Z", "completed_at": "2024-08-23T19:21:38.547589Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:38.548325Z", "completed_at": "2024-08-23T19:21:38.548330Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.019034862518310547, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__summary_counts", "compiled": true, "compiled_code": "\n\nwith summary_long as (\n\n    select\n          measure_id\n        , measure_name\n        , measure_version\n        , performance_period_begin\n        , performance_period_end\n        , denominator_flag\n        , numerator_flag\n        , exclusion_flag\n        , performance_flag\n    from dev_tom.quality_measures.summary_long\n    where measure_id is not null\n\n)\n\n, calculate_performance_rate  as (\n\n    select\n          measure_id\n        , measure_name\n        , measure_version\n        , performance_period_begin\n        , performance_period_end\n        , sum(denominator_flag) as denominator_sum\n        , sum(numerator_flag) as numerator_sum\n        , sum(exclusion_flag) as exclusion_sum\n        , (\n            cast(sum(performance_flag) as numeric(28,6)) /\n                (cast(count(performance_flag) as numeric(28,6)) )\n          )*100 as performance_rate\n    from summary_long\n    group by\n          measure_id\n        , measure_name\n        , measure_version\n        , performance_period_begin\n        , performance_period_end\n\n)\n\n, add_data_types as (\n\n    select\n          cast(measure_id as TEXT) as measure_id\n        , cast(measure_name as TEXT) as measure_name\n        , cast(measure_version as TEXT) as measure_version\n        , cast(performance_period_begin as date) as performance_period_begin\n        , cast(performance_period_end as date) as performance_period_end\n        , cast(denominator_sum as integer) as denominator_sum\n        , cast(numerator_sum as integer) as numerator_sum\n        , cast(exclusion_sum as integer) as exclusion_sum\n        , round(cast(performance_rate as numeric(28,6)),3) as performance_rate\n    from calculate_performance_rate\n\n)\n\nselect\n      measure_id\n    , measure_name\n    , measure_version\n    , performance_period_begin\n    , performance_period_end\n    , denominator_sum\n    , numerator_sum\n    , exclusion_sum\n    , performance_rate\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.quality_measures.summary_counts"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:38.542905Z", "completed_at": "2024-08-23T19:21:38.548739Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:38.549096Z", "completed_at": "2024-08-23T19:21:38.549102Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.019327878952026367, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.the_tuva_project.quality_measures__summary_wide", "compiled": true, "compiled_code": "\n\n/*\n    Each measure is pivoted into a boolean column by evaluating the\n    denominator, numerator, and exclusion flags.\n*/\nwith measures_long as (\n\n        select\n          patient_id\n        , denominator_flag\n        , numerator_flag\n        , exclusion_flag\n        , performance_flag\n        , measure_id\n    from dev_tom.quality_measures.summary_long\n\n)\n\n, nqf_2372 as (\n\n    select\n          patient_id\n        , performance_flag\n    from measures_long\n    where measure_id = 'NQF2372'\n\n)\n\n, nqf_0034 as (\n\n    select\n          patient_id\n        , performance_flag\n    from measures_long\n    where measure_id = 'NQF0034'\n\n)\n\n, nqf_0059 as (\n\n    select\n          patient_id\n        , performance_flag\n    from measures_long\n    where measure_id = 'NQF0059'\n\n)\n\n, cqm_236 as (\n\n    select\n          patient_id\n        , performance_flag\n    from measures_long\n    where measure_id = 'CQM236'\n\n)\n\n, nqf_0053 as (\n\n    select\n          patient_id\n        , performance_flag\n    from measures_long\n    where measure_id = 'NQF0053'\n\n)\n\n, cbe_0055 as (\n\n    select\n          patient_id\n        , performance_flag\n    from measures_long\n    where measure_id = 'CBE0055'\n\n)\n\n, nqf_0097 as (\n\n    select\n          patient_id\n        , performance_flag\n    from measures_long\n    where measure_id = 'NQF0097'\n\n)\n\n, cqm_438 as (\n\n    select\n          patient_id\n        , performance_flag\n    from measures_long\n    where measure_id = 'CQM438'\n\n)\n\n, nqf_0041 as (\n\n    select\n          patient_id\n        , performance_flag\n    from measures_long\n    where measure_id = 'NQF0041'\n\n)\n\n, cbe_0101 as (\n\n    select\n          patient_id\n        , performance_flag\n    from measures_long\n    where measure_id = 'CBE0101'\n\n)\n\n, cqm_48 as (\n\n    select\n          patient_id\n        , performance_flag\n    from measures_long\n    where measure_id = 'CQM48'\n\n)\n\n, joined as (\n\n    select\n          measures_long.patient_id\n        , max(nqf_2372.performance_flag) as nqf_2372\n        , max(nqf_0034.performance_flag) as nqf_0034\n        , max(nqf_0059.performance_flag) as nqf_0059\n        , max(cqm_236.performance_flag) as cqm_236\n        , max(nqf_0053.performance_flag) as nqf_0053\n        , max(cbe_0055.performance_flag) as cbe_0055\n        , max(nqf_0097.performance_flag) as nqf_0097\n        , max(cqm_438.performance_flag) as cqm_438\n        , max(nqf_0041.performance_flag) as nqf_0041\n        , max(cbe_0101.performance_flag) as cbe_0101\n        , max(cqm_48.performance_flag) as cqm_48\n    from measures_long\n        left join nqf_2372\n            on measures_long.patient_id = nqf_2372.patient_id\n        left join nqf_0034\n            on measures_long.patient_id = nqf_0034.patient_id\n        left join nqf_0059\n            on measures_long.patient_id = nqf_0059.patient_id\n        left join cqm_236\n            on measures_long.patient_id = cqm_236.patient_id\n        left join nqf_0053\n            on measures_long.patient_id = nqf_0053.patient_id\n        left join cbe_0055\n            on measures_long.patient_id = cbe_0055.patient_id\n        left join nqf_0097\n            on measures_long.patient_id = nqf_0097.patient_id\n        left join cqm_438\n            on measures_long.patient_id = cqm_438.patient_id\n        left join nqf_0041\n            on measures_long.patient_id = nqf_0041.patient_id\n        left join cbe_0101\n            on measures_long.patient_id = cbe_0101.patient_id\n        left join cqm_48\n            on measures_long.patient_id = cqm_48.patient_id\n    group by measures_long.patient_id\n\n)\n\n, add_data_types as (\n\n    select\n          cast(patient_id as TEXT) as patient_id\n        , cast(nqf_2372 as integer) as nqf_2372\n        , cast(nqf_0034 as integer) as nqf_0034\n        , cast(nqf_0059 as integer) as nqf_0059\n        , cast(cqm_236 as integer) as cqm_236\n        , cast(nqf_0053 as integer) as nqf_0053\n        , cast(cbe_0055 as integer) as cbe_0055\n        , cast(nqf_0097 as integer) as nqf_0097\n        , cast(cqm_438 as integer) as cqm_438 \n        , cast(nqf_0041 as integer) as nqf_0041\n        , cast(cbe_0101 as integer) as cbe_0101\n        , cast(cqm_48 as integer) as cqm_48\n    from joined\n\n)\n\nselect\n      patient_id\n    , nqf_2372\n    , nqf_0034\n    , nqf_0059\n    , cqm_236\n    , nqf_0053\n    , cbe_0055\n    , nqf_0097\n    , cqm_438\n    , nqf_0041\n    , cbe_0101\n    , cqm_48\n    , '2024-08-23 19:21:27.787896+00:00' as tuva_last_run\nfrom add_data_types", "relation_name": "dev_tom.quality_measures.summary_wide"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-23T19:21:32.002309Z", "completed_at": "2024-08-23T19:21:43.436740Z"}, {"name": "execute", "started_at": "2024-08-23T19:21:43.437709Z", "completed_at": "2024-08-23T19:21:43.437727Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 11.604803800582886, "adapter_response": {}, "message": null, "failures": null, "unique_id": "operation.the_tuva_project.the_tuva_project-on-run-end-0", "compiled": true, "compiled_code": "\n\n    \n\n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n        \n        \n        \n        \n    \n\n", "relation_name": null}], "elapsed_time": 14.981489896774292, "args": {"printer_width": 80, "indirect_selection": "eager", "defer": false, "exclude": [], "project_dir": "/Users/tomsherwood/Documents/02-Areas/repos/tuva/integration_tests/docs_generate", "macro_debugging": false, "log_file_max_bytes": 10485760, "which": "generate", "require_resource_names_without_spaces": false, "use_colors_file": true, "log_level": "info", "populate_cache": true, "warn_error_options": {"include": [], "exclude": []}, "source_freshness_run_project_hooks": false, "favor_state": false, "static_parser": true, "log_format_file": "debug", "vars": {}, "cache_selected_only": false, "introspect": true, "quiet": false, "print": true, "enable_legacy_logger": false, "log_level_file": "debug", "show_resource_report": false, "partial_parse": true, "select": [], "compile": true, "strict_mode": false, "log_format": "default", "log_path": "/Users/tomsherwood/Documents/02-Areas/repos/tuva/integration_tests/docs_generate/logs", "require_explicit_package_overrides_for_builtin_materializations": true, "write_json": true, "static": false, "version_check": true, "profiles_dir": "/Users/tomsherwood/.dbt", "send_anonymous_usage_stats": true, "partial_parse_file_diff": true, "use_colors": true, "invocation_command": "dbt docs generate --target-path ../target", "empty_catalog": false, "target_path": "../target"}}