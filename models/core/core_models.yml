version: 2

models:
## Final
  - name: core__condition
    description: >
      The core condition table contains information related to medical  conditions
      patients have, including problems, admitting diagnosis codes,  and billable
      diagnosis codes.
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_core
        {% else %}core{%- endif -%}
      alias: condition
      tags: core
      materialized: table
    columns:
      - name: condition_id
        description: Unique identifier for each condition in the table.
        tests:
          - unique:
              config:
                severity: warn
      - name: patient_id
        description: '{{ doc("patient_id") }}'
      - name: encounter_id
        description: '{{ doc("encounter_id") }}'
      - name: claim_id
        description: '{{ doc("claim_id") }}'
      - name: recorded_date
        description: Date when the condition was recorded.
      - name: onset_date
        description: Date when the condition first occurred.
      - name: resolved_date
        description: Date when the condition was resolved.
      - name: status
        description: Status of the condition.
      - name: condition_type
        description: The type of condition i.e. problem, admitting, or billing.
      - name: source_code_type
        description: >
          The type of condition code reported in the source system e.g.  ICD-10-CM.
        meta:
          terminology: 
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__code_type.csv
      - name: source_code
        description: >
          The condition code in the source system e.g. the ICD-10 code.
        meta:
          terminology: 
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__icd_10_cm.csv
          terminology_note: "**Note: this terminology set is too large to be loaded
            as a seed and is instead loaded from public cloud storage for supported
            adapters."
      - name: source_description
        description: Description of the condition code in the source system.
      - name: normalized_code_type
        description: The normalized type of condition code.
        meta:
          terminology: 
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__code_type.csv
      - name: normalized_code
        description: The normalized condition code.
        meta:
          terminology: 
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__icd_10_cm.csv
          terminology_note: "**Note: this terminology set is too large to be loaded
            as a seed and is instead loaded from public cloud storage for supported
            adapters."
      - name: normalized_description
        description: Normalized description of the condition code.
      - name: mapping_method
        description: mapping method used to populate the normalized codes and descriptions.  Can
          be manual (fields were populated in input layer), automatic (dictionary
          codes matching the source code were found and was automatically populated)
          or custom (populated by normalization engine)
      - name: condition_rank
        description: >
          The numerical ranking of a diagnosis code in a claim.  Principle  diagnosis
          code is given a ranking of 1. Claims data typically has a  strict ranking
          of conditions whereas medical records will often not  have this information
          or the information won't be accurate.
        data_type: integer
      - name: present_on_admit_code
        description: The present_on_admit_code related to the condition.
        meta:
          terminology: 
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__present_on_admission.csv
      - name: present_on_admit_description
        description: >
          The description of the present_on_admit_code for the condition.
      - name: data_source
        description: '{{ doc("data_source") }}'
      - name: tuva_last_run
        description: '{{ doc("tuva_last_run") }}'

  - name: core__eligibility
    description: >
      The eligibility table contains information on patient health plan and  supplemental
      insurance eligibility.
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_core
        {% else %}core{%- endif -%}
      alias: eligibility
      tags: core
      materialized: table
    columns:
      - name: eligibility_id
        description: Unique identifier for each eligibility row in the table.
        tests:
          - unique:
              config:
                severity: warn
      - name: patient_id
        description: '{{ doc("patient_id") }}'
      - name: member_id
        description: >
          Identifier that links a patient to a particular insurance product or  health
          plan. A patient can have more than one member_id because they  can have
          more than one insurance product/plan.
      - name: subscriber_id
        description: Identifier that links a patient to a particular insurance product
          or health plan.
      - name: birth_date
        description: '{{ doc("birth_date") }}'
      - name: death_date
        description: Date the patient died.
      - name: enrollment_start_date
        description: Date the patient's insurance eligibility began.
      - name: enrollment_end_date
        description: Date the patient's insurance eligibility ended.
      - name: payer
        description: '{{ doc("payer") }}'
      - name: payer_type
        description: Type of payer (e.g. commercial, medicare, medicaid, etc.).
        meta:
          terminology: 
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__payer_type.csv
      - name: plan
        description: '{{ doc("plan") }}'
      - name: original_reason_entitlement_code
        description: Original reason for Medicare entitlement code.
        meta:
          terminology: 
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__medicare_orec.csv
      - name: dual_status_code
        description: >
          Indicates whether the patient is dually eligible for Medicare and  Medicaid.
        meta:
          terminology: 
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__medicare_dual_eligibility.csv
      - name: medicare_status_code
        description: Indicates how the patient became eligible for Medicare.
        meta:
          terminology: 
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__medicare_status.csv
      - name: subscriber_relation
        description: Identifier that links a patient to a particular insurance product
          or health plan.
      - name: data_source
        description: '{{ doc("data_source") }}'
      - name: tuva_last_run
        description: '{{ doc("tuva_last_run") }}'

  - name: core__encounter
    description: >
      The encounter table contains information about patients visits (i.e.  encounters).  This
      includes acute inpatient, emergency department, office  visits, SNF stays, etc.
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_core
        {% else %}core{%- endif -%}
      alias: encounter
      tags:
        - core
        - encounters
      materialized: table
    columns:
      - name: encounter_id
        description: '{{ doc("encounter_id") }}'
        tests:
          - unique
      - name: patient_id
        description: '{{ doc("patient_id") }}'
      - name: patient_data_source_id
        description: '{{ doc("patient_data_source_id") }}'
      - name: encounter_type
        description: >-
          '{{ doc("encounter_type") }}'
        meta:
          terminology: 
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__encounter_type.csv
      - name: encounter_group
        description: '{{ doc("encounter_group") }}'
      - name: encounter_start_date
        description: '{{ doc("encounter_start_date") }}'
      - name: encounter_end_date
        description: '{{ doc("encounter_end_date") }}'
      - name: length_of_stay
        description: >-
          '{{ doc("length_of_stay") }}'
      - name: admit_source_code
        description: '{{ doc("admit_source_code") }}'
        meta:
          terminology: 
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__admit_source.csv
      - name: admit_source_description
        description: '{{ doc("admit_source_description") }}'
      - name: admit_type_code
        description: '{{ doc("admit_type_code") }}'
        meta:
          terminology: 
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__admit_type.csv
      - name: admit_type_description
        description: '{{ doc("admit_type_description") }}'
      - name: discharge_disposition_code
        description: '{{ doc("discharge_disposition_code") }}'
        meta:
          terminology: 
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__discharge_disposition.csv
      - name: discharge_disposition_description
        description: '{{ doc("discharge_disposition_description") }}'
      - name: observation_flag
        description: '{{ doc("observation_flag") }}'
      - name: lab_flag
        description: '{{ doc("lab_flag") }}'
      - name: dme_flag
        description: '{{ doc("dme_flag") }}'
      - name: ambulance_flag
        description: '{{ doc("ambulance_flag") }}'
      - name: pharmacy_flag
        description: '{{ doc("pharmacy_flag") }}'
      - name: ed_flag
        description: '{{ doc("ed_flag") }}'
      - name: delivery_flag
        description: '{{ doc("delivery_flag") }}'
      - name: delivery_type
        description: '{{ doc("delivery_type") }}'
      - name: newborn_flag
        description: '{{ doc("newborn_flag") }}'
      - name: nicu_flag
        description: '{{ doc("nicu_flag") }}'
      - name: primary_diagnosis_code_type
        description: '{{ doc("primary_diagnosis_code_type") }}'
        meta:
          terminology: 
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__code_type.csv
      - name: primary_diagnosis_code
        description: '{{ doc("primary_diagnosis_code") }}'
        meta:
          terminology: 
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__icd_10_cm.csv
          terminology_note: "**Note: this terminology set is too large to be loaded
            as a seed and is instead loaded from public cloud storage for supported
            adapters."
      - name: primary_diagnosis_description
        description: '{{ doc("primary_diagnosis_description") }}'
      - name: ms_drg_code
        description: '{{ doc("ms_drg_code") }}'
        meta:
          terminology: 
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__ms_drg.csv
      - name: ms_drg_description
        description: '{{ doc("ms_drg_description") }}'
      - name: apr_drg_code
        description: '{{ doc("apr_drg_code") }}'
        meta:
          terminology: 
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__apr_drg.csv
      - name: apr_drg_description
        description: '{{ doc("apr_drg_description") }}'
      - name: paid_amount
        description: '{{ doc("paid_amount") }}'
      - name: allowed_amount
        description: '{{ doc("allowed_amount") }}'
      - name: charge_amount
        description: '{{ doc("charge_amount") }}'
      - name: data_source
        description: '{{ doc("data_source") }}'
      - name: claim_count
        description: '{{ doc("claim_count") }}'
      - name: inst_claim_count
        description: '{{ doc("inst_claim_count") }}'
      - name: prof_claim_count
        description: '{{ doc("prof_claim_count") }}'
      - name: source_model
        description: Indicates the DBT source relation name from which data is derived.
      - name: tuva_last_run
        description: '{{ doc("tuva_last_run") }}'
      - name: encounter_source_type
        description: Indicates whether the encounter is from a claims or clinical
          data source

  - name: core__lab_result
    description: >
      The lab result table contains information about lab test results,  including
      the LOINC code and description, units, reference range, and  result.
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_core
        {% else %}core{%- endif -%}
      alias: lab_result
      tags: core
      materialized: table
    columns:
      - name: lab_result_id
        description: Unique identifier for each lab result.
        tests:
          - unique:
              config:
                severity: warn
      - name: patient_id
        description: '{{ doc("patient_id") }}'
      - name: encounter_id
        description: '{{ doc("encounter_id") }}'
      - name: accession_number
        description: The lab order number from the source system.
      - name: source_code_type
        description: The code type from the source system.
        meta:
          terminology: 
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__code_type.csv
      - name: source_code
        description: The code for the lab from the source system.
        meta:
          terminology: 
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__loinc.csv
          terminology_note: "**Note: this terminology set is too large to be loaded
            as a seed and is instead loaded from public cloud storage for supported
            adapters."
      - name: source_description
        description: The description for the lab test from the source system.
      - name: source_component
        description: >
          The description for the component of the test from the source system.
        meta:
          terminology: 
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__loinc.csv
          terminology_note: "**Note: this terminology set is too large to be loaded
            as a seed and is instead loaded from public cloud storage for supported
            adapters."
      - name: normalized_code_type
        description: The normalized code type.
        meta:
          terminology: 
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__code_type.csv
      - name: normalized_code
        description: The normalized code e.g. LOINC.
        meta:
          terminology: 
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__loinc.csv
          terminology_note: "**Note: this terminology set is too large to be loaded
            as a seed and is instead loaded from public cloud storage for supported
            adapters."
      - name: normalized_description
        description: The normalized description for the code.
      - name: mapping_method
        description: mapping method used to populate the normalized codes and descriptions.  Can
          be manual (fields were populated in input layer), automatic (dictionary
          codes matching the source code were found and was automatically populated)
          or custom (populated by normalization engine)
      - name: normalized_component
        description: The normalized component.
        meta:
          terminology: 
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__loinc.csv
          terminology_note: "**Note: this terminology set is too large to be loaded
            as a seed and is instead loaded from public cloud storage for supported
            adapters."
      - name: status
        description: The status of the lab test.
      - name: result
        description: The result of the lab test.
      - name: result_date
        description: Date of the test result.
      - name: collection_date
        description: Date the test was collected.
      - name: source_units
        description: Source units of the lab test.
      - name: normalized_units
        description: Normalized units of the lab test.
      - name: source_reference_range_low
        description: The low end of the reference range from the source system.
      - name: source_reference_range_high
        description: The high end of the reference range from the source system.
      - name: normalized_reference_range_low
        description: The normalized low end of the reference range.
      - name: normalized_reference_range_high
        description: The normalized high end of the reference range.
      - name: source_abnormal_flag
        description: Indicates whether the result is abnormal or normal.
      - name: normalized_abnormal_flag
        description: Normalized abnormal flag.
      - name: specimen
        description: The type of specimen e.g. blood, plasma, urine.
      - name: ordering_practitioner_id
        description: >
          Unique identifier for the practitioner who ordered the lab test.
        meta:
          terminology: 
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__provider.csv
          terminology_note: "**Note: this terminology set is too large to be loaded
            as a seed and is instead loaded from public cloud storage for supported
            adapters."
      - name: data_source
        description: '{{ doc("data_source") }}'
      - name: tuva_last_run
        description: '{{ doc("tuva_last_run") }}'

  - name: core__location
    description: >
      The location table contains information on practice and facility locations  where
      patients receive medical care.
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_core
        {% else %}core{%- endif -%}
      alias: location
      tags: core
      materialized: table
    columns:
      - name: location_id
        description: Unique identifier for each location.
        tests:
          - unique:
              config:
                severity: warn
      - name: npi
        description: >
          The national provider identifier associated with the location e.g.  facility_npi.
        meta:
          terminology: 
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__provider.csv
          terminology_note: "**Note: this terminology set is too large to be loaded
            as a seed and is instead loaded from public cloud storage for supported
            adapters."
      - name: name
        description: The name of the location.
      - name: facility_type
        description: '{{ doc("facility_type") }}'
      - name: parent_organization
        description: The parent organization associated with the facility.
      - name: address
        description: The street address of the location.
      - name: city
        description: The city of the location.
      - name: state
        description: The state of the location.
      - name: zip_code
        description: The zip code of the location.
      - name: latitude
        description: The latitude of the location.
      - name: longitude
        description: The longitude of the location.
      - name: data_source
        description: '{{ doc("data_source") }}'
      - name: tuva_last_run
        description: '{{ doc("tuva_last_run") }}'

  - name: core__medical_claim
    description: >
      The medical claim table contains information on services rendered to  patients
      and billed by the provider to the insurer as claims.
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_core
        {% else %}core{%- endif -%}
      alias: medical_claim
      tags:
        - core
        - encounters
      materialized: table
    columns:
      - name: medical_claim_id
        description: Unique identifier for each row in the table.
        tests:
          - unique:
              config:
                severity: error
      - name: claim_id
        description: '{{ doc("claim_id") }}'
      - name: claim_line_number
        description: '{{ doc("claim_line_number") }}'
        data_type: integer
      - name: encounter_id
        description: '{{ doc("encounter_id") }}'
      - name: claim_type
        description: '{{ doc("claim_type") }}'
        meta:
          terminology: 
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__claim_type.csv
      - name: patient_id
        description: '{{ doc("patient_id") }}'
      - name: member_id
        description: >
          Identifier that links a patient to a particular insurance product or  health
          plan. A patient can have more than one member_id because they  can have
          more than one insurance product/plan.
      - name: payer
        description: '{{ doc("payer") }}'
      - name: plan
        description: '{{ doc("plan") }}'
      - name: claim_start_date
        description: '{{ doc("claim_start_date") }}'
      - name: claim_end_date
        description: '{{ doc("claim_end_date") }}'
      - name: claim_line_start_date
        description: '{{ doc("claim_line_start_date") }}'
      - name: claim_line_end_date
        description: '{{ doc("claim_line_end_date") }}'
      - name: admission_date
        description: '{{ doc("admission_date") }}'
      - name: discharge_date
        description: '{{ doc("discharge_date") }}'
      - name: service_category_1
        description: '{{ doc("service_category_1") }}'
        meta:
          terminology: 
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/value_sets/service_categories/service_category__service_categories.csv
      - name: service_category_2
        description: '{{ doc("service_category_2") }}'
        meta:
          terminology:
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/value_sets/service_categories/service_category__service_categories.csv
      - name: service_category_3
        description: The most specific service category. Only exists for a small number of service categories.
        meta:
          terminology:
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/value_sets/service_categories/service_category__service_categories.csv
      - name: admit_source_code
        description: '{{ doc("admit_source_code") }}'
        meta:
          terminology: 
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__admit_source.csv
      - name: admit_source_description
        description: '{{ doc("admit_source_description") }}'
      - name: admit_type_code
        description: '{{ doc("admit_type_code") }}'
        meta:
          terminology: 
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__admit_type.csv
      - name: admit_type_description
        description: '{{ doc("admit_type_description") }}'
      - name: discharge_disposition_code
        description: '{{ doc("discharge_disposition_code") }}'
        meta:
          terminology: 
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__discharge_disposition.csv
      - name: discharge_disposition_description
        description: '{{ doc("discharge_disposition_description") }}'
      - name: place_of_service_code
        description: '{{ doc("place_of_service_code") }}'
        meta:
          terminology: 
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__place_of_service.csv
      - name: place_of_service_description
        description: '{{ doc("place_of_service_description") }}'
      - name: bill_type_code
        description: '{{ doc("bill_type_code") }}'
        meta:
          terminology: 
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__bill_type.csv
      - name: bill_type_description
        description: '{{ doc("bill_type_description") }}'
      - name: ms_drg_code
        description: '{{ doc("ms_drg_code") }}'
        meta:
          terminology: 
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__ms_drg.csv
      - name: ms_drg_description
        description: '{{ doc("ms_drg_description") }}'
      - name: apr_drg_code
        description: '{{ doc("apr_drg_code") }}'
        meta:
          terminology: 
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__apr_drg.csv
      - name: apr_drg_description
        description: '{{ doc("apr_drg_description") }}'
      - name: revenue_center_code
        description: '{{ doc("revenue_center_code") }}'
        meta:
          terminology: 
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__revenue_center.csv
      - name: revenue_center_description
        description: '{{ doc("revenue_center_description") }}'
      - name: service_unit_quantity
        description: The number of units for the particular revenue center code.
        data_type: integer
      - name: hcpcs_code
        description: '{{ doc("hcpcs_code") }}'
        meta:
          terminology: 
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__hcpcs_level_2.csv
      - name: hcpcs_modifier_1
        description: '{{ doc("hcpcs_modifier_1") }}'
        meta:
          terminology: 
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__hcpcs_level_2.csv
      - name: hcpcs_modifier_2
        description: '{{ doc("hcpcs_modifier_2") }}'
        meta:
          terminology: 
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__hcpcs_level_2.csv
      - name: hcpcs_modifier_3
        description: '{{ doc("hcpcs_modifier_3") }}'
        meta:
          terminology: 
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__hcpcs_level_2.csv
      - name: hcpcs_modifier_4
        description: '{{ doc("hcpcs_modifier_4") }}'
        meta:
          terminology: 
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__hcpcs_level_2.csv
      - name: hcpcs_modifier_5
        description: '{{ doc("hcpcs_modifier_5") }}'
        meta:
          terminology: 
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__hcpcs_level_2.csv
      - name: rendering_id
        description: '{{ doc("rendering_id") }}'
        meta:
          terminology: 
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__provider.csv
          terminology_note: "**Note: this terminology set is too large to be loaded
            as a seed and is instead loaded from public cloud storage for supported
            adapters."
      - name: rendering_tin
        description: Rendering provider tax identification number (TIN).
      - name: rendering_name
        description: Rendering provider name.
      - name: billing_id
        description: '{{ doc("billing_id") }}'
        meta:
          terminology: 
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__provider.csv
          terminology_note: "**Note: this terminology set is too large to be loaded
            as a seed and is instead loaded from public cloud storage for supported
            adapters."
      - name: billing_tin
        description: Billing provider tax identification number (TIN).
      - name: billing_name
        description: Billing provider name.
      - name: facility_id
        description: '{{ doc("facility_id") }}'
        meta:
          terminology: 
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__provider.csv
          terminology_note: "**Note: this terminology set is too large to be loaded
            as a seed and is instead loaded from public cloud storage for supported
            adapters."
      - name: facility_name
        description: '{{ doc("facility_name") }}'
      - name: paid_date
        description: The date the claim was paid.
      - name: paid_amount
        description: '{{ doc("paid_amount") }}'
      - name: allowed_amount
        description: '{{ doc("allowed_amount") }}'
      - name: charge_amount
        description: '{{ doc("charge_amount") }}'
      - name: coinsurance_amount
        description: The total coinsurance charged on the claim by the provider.
      - name: copayment_amount
        description: The total copayment charged on the claim by the provider.
      - name: deductible_amount
        description: The total amount charged on the claim by the provider.
      - name: total_cost_amount
        description: The total amount paid on the claim by different parties.
      - name: in_network_flag
        description: Flag indicating if the claim was in or out of network.
      - name: enrollment_flag
        description: >
          Flag indicating if the claim has corresponding enrollment during  the same
          time period the service occurred.
      - name: data_source
        description: '{{ doc("data_source") }}'
      - name: tuva_last_run
        description: '{{ doc("tuva_last_run") }}'

  - name: core__medication
    description: >
      The medication table contains information on medications ordered and/or  administered
      during a patient encounter.
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_core
        {% else %}core{%- endif -%}
      alias: medication
      tags: core
      materialized: table
    columns:
      - name: medication_id
        description: Unique identifier for each medication in the table.
        tests:
          - unique:
              config:
                severity: warn
      - name: patient_id
        description: '{{ doc("patient_id") }}'
      - name: encounter_id
        description: '{{ doc("encounter_id") }}'
      - name: dispensing_date
        description: Date the medication was dispensed.
      - name: prescribing_date
        description: Date the medication was prescribed.
      - name: source_code_type
        description: The source code type of the medication.
        meta:
          terminology: 
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__code_type.csv
      - name: source_code
        description: The source code for the medication.
        meta:
          terminology: https://www.nlm.nih.gov/research/umls/rxnorm/index.html
      - name: source_description
        description: The source description of the medication.
      - name: ndc_code
        description: National drug code associated with the medication.
        meta:
          terminology: 
            https://www.fda.gov/drugs/drug-approvals-and-databases/national-drug-code-directory
      - name: ndc_description
        description: Description for the NDC.
      - name: ndc_mapping_method
        description: mapping method used to populate the normalized codes and descriptions.  Can
          be manual (fields were populated in input layer), automatic (dictionary
          codes matching the source code were found and was automatically populated)
          or custom (populated by normalization engine)
      - name: rxnorm_code
        description: RxNorm code associated with the medication.
        meta:
          terminology: https://www.nlm.nih.gov/research/umls/rxnorm/index.html
      - name: rxnorm_description
        description: Description for the RxNorm code.
      - name: rxnorm_mapping_method
        description: mapping method used to populate the normalized codes and descriptions.  Can
          be manual (fields were populated in input layer), automatic (dictionary
          codes matching the source code were found and was automatically populated)
          or custom (populated by normalization engine)
      - name: atc_code
        description: ATC code for the medication.
        meta:
          terminology: https://www.who.int/tools/atc-ddd-toolkit/atc-classification
      - name: atc_description
        description: Description for the ATC code.
      - name: atc_mapping_method
        description: mapping method used to populate the normalized codes and descriptions.  Can
          be manual (fields were populated in input layer), automatic (dictionary
          codes matching the source code were found and was automatically populated)
          or custom (populated by normalization engine)
      - name: route
        description: The route used to administer the medication.
      - name: strength
        description: The strength of the medication.
      - name: quantity
        description: The quantity of the medication.
      - name: quantity_unit
        description: The units for the quantity.
      - name: days_supply
        description: The number of days supply included.
      - name: practitioner_id
        description: >
          Unique identifier for the practitioner who ordered the medication.
        meta:
          terminology: 
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__provider.csv
          terminology_note: "**Note: this terminology set is too large to be loaded
            as a seed and is instead loaded from public cloud storage for supported
            adapters."
      - name: data_source
        description: '{{ doc("data_source") }}'
      - name: tuva_last_run
        description: '{{ doc("tuva_last_run") }}'

  - name: core__member_months
    description: Creates member months from eligibility data
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_core
        {% else %}core{%- endif -%}
      alias: member_months
      tags:
        - core
      materialized: table
    columns:
      - name: patient_id
        description: '{{ doc("patient_id") }}'
      - name: year_month
        description: Unique year-month of in the dataset computed from eligibility.
      - name: payer
        description: '{{ doc("payer") }}'
      - name: plan
        description: '{{ doc("plan") }}'
      - name: data_source
        description: '{{ doc("data_source") }}'
      - name: tuva_last_run
        description: '{{ doc("tuva_last_run") }}'

  - name: core__observation
    description: >
      The observation table contains information on measurements other than  lab tests
      e.g. blood pressure, height, and weight.
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_core
        {% else %}core{%- endif -%}
      alias: observation
      tags: core
      materialized: table
    columns:
      - name: observation_id
        description: Unique identifier for each observation in the dataset.
        tests:
          - unique:
              config:
                severity: warn
      - name: patient_id
        description: '{{ doc("patient_id") }}'
      - name: encounter_id
        description: '{{ doc("encounter_id") }}'
      - name: panel_id
        description: Unique identifier for the panel.
      - name: observation_date
        description: Date the observation was recorded.
      - name: observation_type
        description: Type of observation.
      - name: source_code_type
        description: Source code type of the observation.
        meta:
          terminology: 
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__code_type.csv
      - name: source_code
        description: Source code of the observation.
      - name: source_description
        description: Source description of the observation.
      - name: normalized_code_type
        description: Normalized code type of the observation.
      - name: normalized_code
        description: Normalized code of the observation.
      - name: normalized_description
        description: Normalized description of the observation.
      - name: mapping_method
        description: mapping method used to populate the normalized codes and descriptions.  Can
          be manual (fields were populated in input layer), automatic (dictionary
          codes matching the source code were found and was automatically populated)
          or custom (populated by normalization engine)
      - name: result
        description: The result of the observation.
      - name: source_units
        description: Source units of the lab test.
      - name: normalized_units
        description: Normalized units of the lab test.
      - name: source_reference_range_low
        description: The low end of the reference range from the source system.
      - name: source_reference_range_high
        description: The high end of the reference range from the source system.
      - name: normalized_reference_range_low
        description: The normalized low end of the reference range.
      - name: normalized_reference_range_high
        description: The normalized high end of the reference range.
      - name: data_source
        description: '{{ doc("data_source") }}'
      - name: tuva_last_run
        description: '{{ doc("tuva_last_run") }}'

  - name: core__patient
    description: >
      The patient table contains demographic and geographic information on  patients.
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_core
        {% else %}core{%- endif -%}
      alias: patient
      tags: core
      materialized: table
    columns:
      - name: patient_id
        description: '{{ doc("patient_id") }}'
        tests:
          - unique:
              config:
                severity: error
      - name: sex
        description: The gender of the patient.
        meta:
          terminology: 
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__gender.csv
      - name: race
        description: '{{ doc("race") }}'
        meta:
          terminology: 
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__race.csv
      - name: birth_date
        description: '{{ doc("birth_date") }}'
      - name: death_date
        description: The death date of the patient if there is one.
      - name: death_flag
        description: A flag indicating if the patient has died.
        data_type: boolean
      - name: first_name
        description: The first name of the patient.
      - name: last_name
        description: The last name of the patient.
      - name: social_security_number
        description: The social security number of the patient.
      - name: address
        description: The address of the patient.
      - name: city
        description: The city where the patient lives.
      - name: state
        description: The state where the patient lives.
      - name: zip_code
        description: The zip code for the patient.
      - name: county
        description: The county for the patient.
      - name: latitude
        description: The latitude for the patient.
      - name: longitude
        description: The longitude for the patient.
      - name: phone
        description: The phone number for the patient.
      - name: age
        description: >
          The age of the patient calculated based on their date of birth and  the
          last time the data was refreshed.
      - name: age_group
        description: The decade age group the patient falls into based on their calculated
          age.
      - name: data_source
        description: '{{ doc("data_source") }}'
      - name: tuva_last_run
        description: '{{ doc("tuva_last_run") }}'

  - name: core__pharmacy_claim
    description: >
      The pharmacy claim table contains information on prescription drugs that  were
      filled and billed to the insurer.
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_core
        {% else %}core{%- endif -%}
      alias: pharmacy_claim
      tags: core
      materialized: table
    columns:
      - name: pharmacy_claim_id
        description: Unique identifier for each row in the table.
        tests:
          - unique:
              config:
                severity: error
      - name: claim_id
        description: '{{ doc("claim_id") }}'
      - name: claim_line_number
        description: '{{ doc("claim_line_number") }}'
        data_type: integer
      - name: patient_id
        description: '{{ doc("patient_id") }}'
      - name: member_id
        description: >
          Identifier that links a patient to a particular insurance product or  health
          plan. A patient can have more than one member_id because they  can have
          more than one insurance product/plan.
      - name: payer
        description: '{{ doc("payer") }}'
      - name: plan
        description: '{{ doc("plan") }}'
      - name: prescribing_provider_id
        description: >
          ID for the provider that wrote the prescription (e.g. priamry care  physician).
        meta:
          terminology: 
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__provider.csv
          terminology_note: "**Note: this terminology set is too large to be loaded
            as a seed and is instead loaded from public cloud storage for supported
            adapters."
      - name: prescribing_provider_name
        description: Prescribing provider name.
      - name: dispensing_provider_id
        description: >
          ID for the provider that dispensed the prescription (e.g. pharmacy).
        meta:
          terminology: 
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__provider.csv
          terminology_note: "**Note: this terminology set is too large to be loaded
            as a seed and is instead loaded from public cloud storage for supported
            adapters."
      - name: dispensing_provider_name
        description: Dispensing provider name.
      - name: dispensing_date
        description: Date the prescription was filled.
      - name: ndc_code
        description: National drug code on the claim.
        meta:
          terminology: 
            https://www.fda.gov/drugs/drug-approvals-and-databases/national-drug-code-directory
      - name: ndc_description
        description: National drug description on the claim.
      - name: quantity
        description: Number of doses.
        data_type: integer
      - name: days_supply
        description: Number of days supply.
        data_type: integer
      - name: refills
        description: Number of refills for the prescription.
        data_type: integer
      - name: paid_date
        description: Date the claim was paid.
      - name: paid_amount
        description: '{{ doc("paid_amount") }}'
      - name: allowed_amount
        description: '{{ doc("allowed_amount") }}'
      - name: charge_amount
        description: '{{ doc("charge_amount") }}'
      - name: coinsurance_amount
        description: The total coinsurance charged on the claim by the provider.
      - name: copayment_amount
        description: The total copayment charged on the claim by the provider.
      - name: deductible_amount
        description: The total amount charged on the claim by the provider.
      - name: in_network_flag
        description: Flag indicating if the claim was in or out of network.
      - name: data_source
        description: '{{ doc("data_source") }}'
      - name: tuva_last_run
        description: '{{ doc("tuva_last_run") }}'

  - name: core__practitioner
    description: >
      The practitioner table contains information on the providers in the  dataset
      e.g. physicians, physicians assistants, etc.
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_core
        {% else %}core{%- endif -%}
      alias: practitioner
      tags: core
      materialized: table
    columns:
      - name: practitioner_id
        description: Unique ID for the provider.
        tests:
          - unique:
              config:
                severity: warn
      - name: npi
        description: NPI for the provider.
        meta:
          terminology: 
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__provider.csv
          terminology_note: "**Note: this terminology set is too large to be loaded
            as a seed and is instead loaded from public cloud storage for supported
            adapters."
      - name: provider_first_name
        description: '{{ doc("provider_first_name") }}'
      - name: provider_last_name
        description: '{{ doc("provider_last_name") }}'
      - name: practice_affiliation
        description: Practice affiliation of the provider.
      - name: specialty
        description: Specialty of the provider.
      - name: sub_specialty
        description: Sub specialty of the provider.
      - name: data_source
        description: '{{ doc("data_source") }}'
      - name: tuva_last_run
        description: '{{ doc("tuva_last_run") }}'

  - name: core__procedure
    description: >
      The procedure table contains information on procedures that were performed  on
      patients in the dataset.
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_core
        {% else %}core{%- endif -%}
      alias: procedure
      tags: core
      materialized: table
    columns:
      - name: procedure_id
        description: The unique identifier for the performed procedure.
        tests:
          - unique:
              config:
                severity: warn
      - name: encounter_id
        description: '{{ doc("encounter_id") }}'
      - name: claim_id
        description: '{{ doc("claim_id") }}'
      - name: patient_id
        description: '{{ doc("patient_id") }}'
      - name: procedure_date
        description: Date when the procedure was performed.
      - name: source_code_type
        description: >
          Type of procedure code for the procedure in the source system.
        meta:
          terminology: 
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__code_type.csv
      - name: source_code
        description: The procedure code in the source system.
        meta:
          terminology: 
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__icd_10_pcs.csv
          terminology_note: "**Note: this terminology set is too large to be loaded
            as a seed and is instead loaded from public cloud storage for supported
            adapters."
      - name: source_description
        description: Description of the procedure code.
      - name: normalized_code_type
        description: Normalized type of procedure code for the procedure.
        meta:
          terminology: 
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__code_type.csv
      - name: normalized_code
        description: The normalized procedure code.
        meta:
          terminology: 
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__icd_10_pcs.csv
          terminology_note: "**Note: this terminology set is too large to be loaded
            as a seed and is instead loaded from public cloud storage for supported
            adapters."
      - name: normalized_description
        description: Description of the procedure code.
        meta:
          terminology: 
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__hcpcs_level_2.csv
      - name: mapping_method
        description: mapping method used to populate the normalized codes and descriptions.  Can
          be manual (fields were populated in input layer), automatic (dictionary
          codes matching the source code were found and was automatically populated)
          or custom (populated by normalization engine)
      - name: modifier_1
        description: First modifier for the procedure code.
        meta:
          terminology: 
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__hcpcs_level_2.csv
      - name: modifier_2
        description: Second modifier for the procedure code.
        meta:
          terminology: 
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__hcpcs_level_2.csv
      - name: modifier_3
        description: Third modifier for the procedure code.
        meta:
          terminology: 
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__hcpcs_level_2.csv
      - name: modifier_4
        description: Fourth modifier for the procedure code.
        meta:
          terminology: 
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__hcpcs_level_2.csv
      - name: modifier_5
        description: Fifth modifier for the procedure code.
        meta:
          terminology: 
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__hcpcs_level_2.csv
      - name: practitioner_id
        description: ID of the provider who performed the procedure.
        meta:
          terminology: 
            https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__provider.csv
          terminology_note: "**Note: this terminology set is too large to be loaded
            as a seed and is instead loaded from public cloud storage for supported
            adapters."
      - name: data_source
        description: '{{ doc("data_source") }}'
      - name: tuva_last_run
        description: '{{ doc("tuva_last_run") }}'


        
## Staging - Claims
  - name: core__stg_claims_medical_claim
    description: Staging core medical claims
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_core
        {% else %}core{%- endif -%}
      alias: _stg_claims_medical_claim
      tags: 
        - core_stage_claims
        - encounters
      materialized: table

  - name: core__stg_claims_encounter
    description: Staging core claims encounters
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_core
        {% else %}core{%- endif -%}
      alias: _stg_claims_encounter
      tags: 
        - core_stage_claims
        - encounters
      materialized: table

  - name: core__stg_claims_location
    description: Staging core claims locations
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_core
        {% else %}core{%- endif -%}
      alias: _stg_claims_location
      tags: core_stage_claims
      materialized: table

  - name: core__stg_claims_patient
    description: Staging core claims patients
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_core
        {% else %}core{%- endif -%}
      alias: _stg_claims_patient
      tags: core_stage_claims
      materialized: table

  - name: core__stg_claims_condition
    description: Staging core claims conditions
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_core
        {% else %}core{%- endif -%}
      alias: _stg_claims_condition
      tags: core_stage_claims
      materialized: table

  - name: core__stg_claims_procedure
    description: Staging core claims procedures
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_core
        {% else %}core{%- endif -%}
      alias: _stg_claims_procedure
      tags: core_stage_claims
      materialized: table

  - name: core__stg_claims_pharmacy_claim
    description: Staging core pharmacy claims
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_core
        {% else %}core{%- endif -%}
      alias: _stg_claims_pharmacy_claim
      tags: core_stage_claims
      materialized: table

  - name: core__stg_claims_eligibility
    description: Staging core eligibility
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_core
        {% else %}core{%- endif -%}
      alias: _stg_claims_eligibility
      tags: core_stage_claims
      materialized: table

  - name: core__stg_claims_practitioner
    description: Staging core providers in the claims dataset
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_core
        {% else %}core{%- endif -%}
      alias: _stg_claims_practitioner
      tags: core_stage_claims
      materialized: table

## Staging - Clinical
  - name: core__stg_clinical_condition
    description: Staging core clinical conditions
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_core
        {% else %}core{%- endif -%}
      alias: _stg_clinical_condition
      tags: core_stage_clinical
      materialized: view

  - name: core__stg_clinical_encounter
    description: Staging core clinical encounters
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_core
        {% else %}core{%- endif -%}
      alias: _stg_clinical_encounter
      tags: core_stage_clinical
      materialized: view

  - name: core__stg_clinical_lab_result
    description: Staging core clinical lab results
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_core
        {% else %}core{%- endif -%}
      alias: _stg_clinical_lab_result
      tags: core_stage_clinical
      materialized: view

  - name: core__stg_clinical_location
    description: Staging core clinical locations
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_core
        {% else %}core{%- endif -%}
      alias: _stg_clinical_location
      tags: core_stage_clinical
      materialized: view

  - name: core__stg_clinical_medication
    description: Staging core clinical medications
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_core
        {% else %}core{%- endif -%}
      alias: _stg_clinical_medication
      tags: core_stage_clinical
      materialized: view

  - name: core__stg_clinical_observation
    description: Staging core clinical observations
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_core
        {% else %}core{%- endif -%}
      alias: _stg_clinical_observation
      tags: core_stage_clinical
      materialized: view

  - name: core__stg_clinical_patient
    description: Staging core clinical patients
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_core
        {% else %}core{%- endif -%}
      alias: _stg_clinical_patient
      tags: core_stage_clinical
      materialized: view

  - name: core__stg_clinical_practitioner
    description: Staging core clinical providers
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_core
        {% else %}core{%- endif -%}
      alias: _stg_clinical_practitioner
      tags: core_stage_clinical
      materialized: view

  - name: core__stg_clinical_procedure
    description: Staging core clinical procedures
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_core
        {% else %}core{%- endif -%}
      alias: _stg_clinical_procedure
      tags: core_stage_clinical
      materialized: view
