version: 2

models:
#### Encounters

## Final
  - name: acute_inpatient__encounter_grain
    description: This table pulls together all the data needed to perform acute inpatient analytics into a single table.
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      alias: acute_inpatient__encounter_grain
      tags: 
        - acute_inpatient
        - claims_preprocessing
        - encounters
      materialized: table
    columns:
      - name: encounter_id
        description: Unique identifier for the acute inpatient encounter.
      - name: encounter_start_date
        description: Date when the patient was admitted.
      - name: encounter_end_date
        description: Date when the patient was discharged.
      - name: encounter_type
        description: type of encounter
      - name: patient_id
        description: Unique identifier for each patient in the dataset.
      - name: admit_age
        description: The age of the patient as of their admission date.
      - name: gender
        description: The gender of the patient.
        meta:
          terminology: https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__gender.csv
      - name: race
        description: The race of the patient.
        meta:
          terminology: https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__race.csv
      - name: facility_npi
        description: The NPI for the facility where the encounter occurred.
      - name: provider_first_name
        description: The first name of the provider.
      - name: provider_last_name
        description: The last name of the provider.
      - name: ms_drg_code
        description: The MS-DRG code associted with the inpatient visit
        meta:
          terminology: https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__ms_drg.csv
      - name: ms_drg_description
        description: The MS-DRG description associted with the inpatient visit
      - name: medical_surgical
        description: Indicates whether the MS-DRG is medical or surgical in nature.
        meta:
          terminology: https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__ms_drg.csv
      - name: apr_drg_code
        description: The APR-DRG code associted with the inpatient visit
        meta:
          terminology: https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__apr_drg.csv
      - name: apr_drg_description
        description: The APR-DRG description associted with the inpatient visit
      - name: admit_source_code
        description: Admission source code for the encounter.
        meta:
          terminology: https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__admit_source.csv
      - name: admit_source_description
        description: Admission source description for the encounter.
      - name: admit_type_code
        description: Admission type code for the encounter.
        meta:
          terminology: https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__admit_type.csv
      - name: admit_type_description
        description: Admission type description for the encounter.
      - name: discharge_disposition_code
        description: Discharge disposition code for the encounter.
        meta:
          terminology: https://github.com/tuva-health/the_tuva_project/blob/main/seeds/terminology/terminology__discharge_disposition.csv
      - name: discharge_disposition_description
        description: Discharge disposition description for the encounter.
      - name: total_paid_amount
        description: The total paid amount across all claims for the encounter.
      - name: total_allowed_amount
        description: The total allowed amount across all claims for the encounter.
      - name: total_charge_amount
        description: The total charge amount across all claims for the encounter.
      - name: length_of_stay
        description: The length of stay for the encounter.
      - name: mortality_flag
        description: 1 if a patient died during the encounter, 0 otherwise.
      - name: data_source
        description: User-configured field that indicates the data source (e.g. typically named after the payer and state "BCBS Tennessee").
      - name: tuva_last_run
        description: The time at with the model was materialized. Generated by `dbt_utils.pretty_time` as the local time of the `dbt run` environment.  Timezone is configurable via the `tuva_last_run` var.

  - name: emergency_department__encounter_grain
    description: This table pulls together all the data needed to perform acute inpatient analytics into a single table.
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      alias: emergency_department__encounter_grain
      tags: 
        - emergency_department
        - claims_preprocessing
        - encounters
      materialized: table
    columns:
      - name: encounter_id
        description: Unique identifier for the emergency_department encounter.
      - name: encounter_start_date
        description: Date when the patient was admitted.
      - name: encounter_end_date
        description: Date when the patient was discharged.
      - name: patient_id
        description: Unique identifier for each patient in the dataset.
      - name: encounter_type
        description: type of encounter
      - name: admit_age
        description: The age of the patient as of their admission date.
      - name: gender
        description: The gender of the patient.
        meta:
          terminology: https://github.com/tuva-health/tuva/blob/main/seeds/terminology/terminology__gender.csv
      - name: race
        description: The race of the patient.
        meta:
          terminology: https://github.com/tuva-health/tuva/blob/main/seeds/terminology/terminology__race.csv
      - name: primary_diagnosis_code_type.
        description: Code system used for the primary diagnosis
        meta:
          terminology: https://github.com/tuva-health/tuva/blob/main/seeds/reference_data/reference_data__code_type.csv
      - name: primary_diagnosis_code
        description: Primary diagnosis on claim.
        meta:
          terminology: https://github.com/tuva-health/tuva/blob/main/seeds/terminology/terminology__icd_10_cm.csv
      - name: primary_diagnosis_description
        description: Description of primary diagnosis code.
      - name: facility_npi
        description: The NPI for the facility where the encounter occurred.
      - name: provider_first_name
        description: The first name of the provider.
      - name: provider_last_name
        description: The last name of the provider.
      - name: ms_drg_code
        description: The MS-DRG code associted with the inpatient visit
        meta:
          terminology: https://github.com/tuva-health/tuva/blob/main/seeds/terminology/terminology__ms_drg.csv
      - name: ms_drg_description
        description: The MS-DRG description associted with the inpatient visit
      - name: medical_surgical
        description: Indicates whether the MS-DRG is medical or surgical in nature.
      - name: apr_drg_code
        description: The APR-DRG code associted with the inpatient visit
        meta:
          terminology: https://github.com/tuva-health/tuva/blob/main/seeds/terminology/terminology__apr_drg.csv
      - name: apr_drg_description
        description: The APR-DRG description associted with the inpatient visit
        meta:
          terminology: https://github.com/tuva-health/tuva/blob/main/seeds/terminology/terminology__apr_drg.csv
      - name: admit_source_code
        description: Admission source code for the encounter.
        meta:
          terminology: https://github.com/tuva-health/tuva/blob/main/seeds/terminology/terminology__admit_source.csv
      - name: admit_source_description
        description: Admission source description for the encounter.
      - name: admit_type_code
        description: Admission type code for the encounter.
        meta:
          terminology: https://github.com/tuva-health/tuva/blob/main/seeds/terminology/terminology__admit_type.csv
      - name: admit_type_description
        description: Admission type description for the encounter.
      - name: discharge_disposition_code
        description: Discharge disposition code for the encounter.
        meta:
          terminology: https://github.com/tuva-health/tuva/blob/main/seeds/terminology/terminology__discharge_disposition.csv
      - name: discharge_disposition_description
        description: Discharge disposition description for the encounter.
      - name: total_paid_amount
        description: The total paid amount across all claims for the encounter.
      - name: total_allowed_amount
        description: The total allowed amount across all claims for the encounter.
      - name: total_charge_amount
        description: The total charge amount across all claims for the encounter.
      - name: length_of_stay
        description: The length of stay for the encoujnter.
      - name: mortality_flag
        description: 1 if a patient died during the encounter, 0 otherwise.
      - name: data_source
        description: User-configured field that indicates the data source (e.g. typically named after the payer and state "BCBS Tennessee").
      - name: tuva_last_run
        description: The time at with the model was materialized. Generated by `dbt_utils.pretty_time` as the local time of the `dbt run` environment.  Timezone is configurable via the `tuva_last_run` var.


  - name: inpatient_psych__encounter_grain
    description: "Encounters for inpatient psych. One row per encounter."
    config:
      schema: |
        {%- if var('tuva_schema_prefix', None) != None -%}
          {{ var('tuva_schema_prefix') }}_claims_preprocessing
        {% else %}
          claims_preprocessing
        {%- endif -%}
      materialized: table
      tags:
        - claims_preprocessing
        - encounters
    columns:
      - name: encounter_id
        description: "The unique identifier for each encounter."
        tests:
          - unique

  - name: inpatient_rehab__encounter_grain
    description: "Encounters for inpatient rehab. One row per encounter."
    config:
      schema: |
        {%- if var('tuva_schema_prefix', None) != None -%}
          {{ var('tuva_schema_prefix') }}_claims_preprocessing
        {% else %}
          claims_preprocessing
        {%- endif -%}
      materialized: table
      tags:
        - claims_preprocessing
        - encounters
    columns:
      - name: encounter_id
        description: "The unique identifier for each encounter."
        tests:
          - unique

  - name: inpatient_snf__encounter_grain
    description: "Encounters for inpatient rehab. One row per encounter."
    config:
      schema: |
        {%- if var('tuva_schema_prefix', None) != None -%}
          {{ var('tuva_schema_prefix') }}_claims_preprocessing
        {% else %}
          claims_preprocessing
        {%- endif -%}
      materialized: table
      tags:
        - claims_preprocessing
        - encounters
    columns:
      - name: encounter_id
        description: "The unique identifier for each encounter."
        tests:
          - unique

  - name: inpatient_substance_use__encounter_grain
    description: "Encounters for inpatient rehab. One row per encounter."
    config:
      schema: |
        {%- if var('tuva_schema_prefix', None) != None -%}
          {{ var('tuva_schema_prefix') }}_claims_preprocessing
        {% else %}
          claims_preprocessing
        {%- endif -%}
      materialized: table
      tags:
        - claims_preprocessing
        - encounters
    columns:
      - name: encounter_id
        description: "The unique identifier for each encounter."
        tests:
          - unique

  - name: inpatient_hospice__encounter_grain
    description: "Encounters for inpatient rehab. One row per encounter."
    config:
      schema: |
        {%- if var('tuva_schema_prefix', None) != None -%}
          {{ var('tuva_schema_prefix') }}_claims_preprocessing
        {% else %}
          claims_preprocessing
        {%- endif -%}
      materialized: table
      tags:
        - claims_preprocessing
        - encounters
    columns:
      - name: encounter_id
        description: "The unique identifier for each encounter."
        tests:
          - unique

  - name: encounters__combined_claim_line_crosswalk
    description: all claim lines that belong to an encounter
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: table 
      tags:
        - claims_preprocessing
        - encounters

  - name: urgent_care__encounter_grain
    description: one row per urgent care encounter id summarizing encounter level metrics
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: table 
      tags:
        - claims_preprocessing
        - encounters

  - name: outpatient_psych__encounter_grain
    description: one row per outpatient psych encounter id summarizing encounter level metrics
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: table 
      tags:
        - claims_preprocessing
        - encounters

  - name: outpatient_rehab__encounter_grain
    description: one row per outpatient rehab encounter id summarizing encounter level metrics
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: table 
      tags:
        - claims_preprocessing
        - encounters
  
  - name: outpatient_hospital_or_clinic__encounter_grain
    description: one row per outpatient rehab encounter id summarizing encounter level metrics
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: table 
      tags:
        - claims_preprocessing
        - encounters

  - name: asc__encounter_grain
    description: one row per asc encounter id summarizing encounter level metrics
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: table 
      tags:
        - claims_preprocessing
        - encounters

  - name: dialysis__encounter_grain
    description: one row per dialysis encounter id summarizing encounter level metrics
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: table 
      tags:
        - claims_preprocessing
        - encounters

  - name: outpatient_hospice__encounter_grain
    description: one row per outpatient hospice encounter id summarizing encounter level metrics
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: table 
      tags:
        - claims_preprocessing
        - encounters

  - name: home_health__encounter_grain
    description: one row per outpatient hospice encounter id summarizing encounter level metrics
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: table 
      tags:
        - claims_preprocessing
        - encounters

  - name: outpatient_injections__encounter_grain
    description: one row per outpatient hospice encounter id summarizing encounter level metrics
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: table 
      tags:
        - claims_preprocessing
        - encounters


## Intermediate
## acute inpatient
  - name: acute_inpatient__generate_encounter_id
    description: generate encounter id and stitch inpatient psych claims together
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: table 
      tags:
        - claims_preprocessing
        - encounters

  - name: acute_inpatient__start_end_dates
    description: calculate start and end date of encounter 
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: table 
      tags:
        - claims_preprocessing
        - encounters

  - name: acute_inpatient__prof_claims
    description: match corresponding prof claims to institutional claims
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: table 
      tags:
        - claims_preprocessing
        - encounters

## ed
  - name: emergency_department__generate_encounter_id
    description: generate encounter id and stitch inpatient psych claims together
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: table 
      tags:
        - claims_preprocessing
        - encounters

  - name: emergency_department__start_end_dates
    description: calculate start and end date of encounter 
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: table 
      tags:
        - claims_preprocessing
        - encounters

  - name: emergency_department__prof_claims
    description: match corresponding prof claims to institutional claims
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: table 
      tags:
        - claims_preprocessing
        - encounters


  - name: inpatient_psych__generate_encounter_id
    description: generate encounter id and stitch inpatient psych claims together
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: table 
      tags:
        - claims_preprocessing
        - encounters

  - name: inpatient_psych__start_end_dates
    description: calculate start and end date of encounter 
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: table 
      tags:
        - claims_preprocessing
        - encounters

  - name: inpatient_psych__prof_claims
    description: match corresponding prof claims to institutional claims
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: table 
      tags:
        - claims_preprocessing
        - encounters


##inpatient rehab
  - name: inpatient_rehab__generate_encounter_id
    description: generate encounter id and stitch inpatient rehab claims together
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: table 
      tags:
        - claims_preprocessing
        - encounters

  - name: inpatient_rehab__start_end_dates
    description: calculate start and end date of encounter 
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: table 
      tags:
        - claims_preprocessing
        - encounters

  - name: inpatient_rehab__prof_claims
    description: match corresponding prof claims to institutional claims
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: table 
      tags:
        - claims_preprocessing
        - encounters


##inpatient snf
  - name: inpatient_snf__generate_encounter_id
    description: generate encounter id and stitch inpatient snf claims together
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: table 
      tags:
        - claims_preprocessing
        - encounters

  - name: inpatient_snf__start_end_dates
    description: calculate start and end date of encounter 
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: table 
      tags:
        - claims_preprocessing
        - encounters

  - name: inpatient_snf__prof_claims
    description: match corresponding prof claims to institutional claims
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: table 
      tags:
        - claims_preprocessing
        - encounters

##inpatient substance use
  - name: inpatient_substance_use__generate_encounter_id
    description: generate encounter id and stitch inpatient substance_use claims together
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: table 
      tags:
        - claims_preprocessing
        - encounters

  - name: inpatient_substance_use__start_end_dates
    description: calculate start and end date of encounter 
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: table 
      tags:
        - claims_preprocessing
        - encounters

  - name: inpatient_substance_use__prof_claims
    description: match corresponding prof claims to institutional claims
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: table 
      tags:
        - claims_preprocessing
        - encounters

##inpatient hospice
  - name: inpatient_hospice__generate_encounter_id
    description: generate encounter id and stitch inpatient hospice claims together
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: table 
      tags:
        - claims_preprocessing
        - encounters

  - name: inpatient_hospice__start_end_dates
    description: calculate start and end date of encounter 
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: table 
      tags:
        - claims_preprocessing
        - encounters

  - name: inpatient_hospice__prof_claims
    description: match corresponding prof claims to institutional claims
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: table 
      tags:
        - claims_preprocessing
        - encounters



##office visits
  - name: office_visits__int_office_visits_injections
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: view
      tags:
      - claims_preprocessing
      - encounters

  - name: office_visits__int_office_visits_ptotst
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: view
      tags:
      - claims_preprocessing
      - encounters

  - name: office_visits__int_office_visits_radiology
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: view
      tags:
      - claims_preprocessing
      - encounters

  - name: office_visits__int_office_visits_surgery
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: view
      tags:
      - claims_preprocessing
      - encounters

  - name: office_visits__int_office_visits
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: view
      tags:
      - claims_preprocessing
      - encounters

  - name: urgent_care__anchor_events
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: view
      tags:
      - claims_preprocessing
      - encounters
      - urgent_care

  - name: urgent_care__generate_encounter_id
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: view
      tags:
      - claims_preprocessing
      - encounters
      - urgent_care

  - name: urgent_care__match_claims_to_anchor
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: view
      tags:
      - claims_preprocessing
      - encounters

  - name: outpatient_psych__anchor_events
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: view
      tags:
      - claims_preprocessing
      - encounters
      - outpatient_psych

  - name: outpatient_psych__generate_encounter_id
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: view
      tags:
      - claims_preprocessing
      - encounters
      - outpatient_psych

  - name: outpatient_psych__match_claims_to_anchor
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: view
      tags:
      - claims_preprocessing
      - encounters
      - outpatient_psych

  - name: outpatient_rehab__anchor_events
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: view
      tags:
      - claims_preprocessing
      - encounters
      - outpatient_rehab

  - name: outpatient_rehab__generate_encounter_id
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: view
      tags:
      - claims_preprocessing
      - encounters
      - outpatient_rehab

  - name: outpatient_rehab__match_claims_to_anchor
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: view
      tags:
      - claims_preprocessing
      - encounters
      - outpatient_rehab

  - name: outpatient_hospital_or_clinic__anchor_events
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: view
      tags:
      - claims_preprocessing
      - encounters
      - outpatient_hospital_or_clinic

  - name: outpatient_hospital_or_clinic__generate_encounter_id
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: view
      tags:
      - claims_preprocessing
      - encounters
      - outpatient_hospital_or_clinic

  - name: outpatient_hospital_or_clinic__match_claims_to_anchor
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: view
      tags:
      - claims_preprocessing
      - encounters
      - outpatient_hospital_or_clinic


  - name: asc__anchor_events
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: view
      tags:
      - claims_preprocessing
      - encounters
      - asc

  - name: asc__generate_encounter_id
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: view
      tags:
      - claims_preprocessing
      - encounters
      - asc

  - name: asc__match_claims_to_anchor
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: view
      tags:
      - claims_preprocessing
      - encounters
      - asc

  - name: asc__start_end_dates
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: view
      tags:
      - claims_preprocessing
      - encounters
      - asc

  - name: dialysis__anchor_events
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: view
      tags:
      - claims_preprocessing
      - encounters
      - dialysis

  - name: dialysis__generate_encounter_id
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: view
      tags:
      - claims_preprocessing
      - encounters
      - dialysis

  - name: dialysis__match_claims_to_anchor
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: view
      tags:
      - claims_preprocessing
      - encounters
      - dialysis

  - name: outpatient_hospice__anchor_events
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: view
      tags:
      - claims_preprocessing
      - encounters
      - outpatient_hospice

  - name: outpatient_hospice__generate_encounter_id
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: view
      tags:
      - claims_preprocessing
      - encounters
      - outpatient_hospice

  - name: outpatient_hospice__match_claims_to_anchor
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: view
      tags:
      - claims_preprocessing
      - encounters
      - outpatient_hospice

  - name: home_health__anchor_events
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: view
      tags:
      - claims_preprocessing
      - encounters
      - home_health

  - name: home_health__generate_encounter_id
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: view
      tags:
      - claims_preprocessing
      - encounters
      - home_health

  - name: home_health__match_claims_to_anchor
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: view
      tags:
      - claims_preprocessing
      - encounters
      - home_health

  - name: outpatient_injections__anchor_events
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: view
      tags:
      - claims_preprocessing
      - encounters
      - outpatient_injections

  - name: outpatient_injections__generate_encounter_id
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: view
      tags:
      - claims_preprocessing
      - encounters
      - outpatient_injections

  - name: outpatient_injections__match_claims_to_anchor
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: view
      tags:
      - claims_preprocessing
      - encounters
      - outpatient_injections

## Staging
  - name: encounters__stg_medical_claim
    description: Staging med claims for encounter grouper
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: table # change back
      tags:
        - claims_preprocessing
        - encounters

  - name: encounters__stg_inpatient_institutional
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: table
      tags:
        - claims_preprocessing
        - encounters

  - name: encounters__stg_outpatient_institutional
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: table
      tags:
        - claims_preprocessing
        - encounters

  - name: encounters__stg_professional
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: table
      tags:
        - claims_preprocessing
        - encounters

  - name: encounters__stg_eligibility
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_claims_preprocessing
        {% else %}claims_preprocessing{%- endif -%}
      materialized: table
      tags:
        - claims_preprocessing
        - encounters